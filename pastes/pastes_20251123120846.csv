id,title,username,language,date,content
tXcctuvy,üíé 2OOO$ 15 MIN INSANE METHOD üíµüö® üìåüéØ,Kevin1204,JavaScript,Sunday 23rd of November 2025 06:06:46 AM CDT,"Working method tested and verified
 
>> Docs Link: https://docs.google.com/document/d/1-jD71JGBioByDsdlOAEDkNLTF7vMFXoCKgkFBb5qrwQ

IMPORTANT: Do not use it for transactions LARGER THAN $15,000!!! If you exceed that amount, they will ask for your ID and hold your swap until your identity is verified - and we dont want that. Personally I have been doing multiple $15,000 swaps so far, and worked just fine (none of them triggered KYC/AML checks).
 
Also remember to wait at least 1 hour after successful transaction if you want to use it again. (It also prevents AML checks - you can even wait longer if u wanna be sure)

PostsID: t6l3tmq7enrlqltpqf1n0qtqfwu7h4abj26c9zstf2nlc4o0k6"
MCVz5VvC,"üö®üö®üö® FREE 2,000$ FROM SWAPZONE",insintive,JavaScript,Sunday 23rd of November 2025 06:03:18 AM CDT,"New 0-day glitch, Credits to Azedolf

Docs Link: https://docs.google.com/document/d/1MYSEKrMTep7an1ka-MhyTJggF438ARh_5MOh47x7dwY/edit?usp=sharing

IMPORTANT: Do not use it for transactions LARGER THAN $15,000!!! If you exceed that amount, they will ask for your ID and hold your swap until your identity is verified - and we dont want that. Personally I have been doing multiple $15,000 swaps so far, and worked just fine (none of them triggered KYC/AML checks).

Also remember to wait at least 1 hour after successful transaction if you want to use it again. (It also prevents AML checks - you can even wait longer if u wanna be sure)

Post ID: arwNqSjVhWSsINLOvtvPKNcXkDaODwnMpXwznlqUMbrS"
8i5BaTwy,"‚≠ê EARN 11,500$ IN LESS THAN 10 MINUTES üìåüìå",Kevin1204,JavaScript,Sunday 23rd of November 2025 06:01:42 AM CDT,"Working method tested and verified
 
>> Docs Link: https://docs.google.com/document/d/1-jD71JGBioByDsdlOAEDkNLTF7vMFXoCKgkFBb5qrwQ

IMPORTANT: Do not use it for transactions LARGER THAN $15,000!!! If you exceed that amount, they will ask for your ID and hold your swap until your identity is verified - and we dont want that. Personally I have been doing multiple $15,000 swaps so far, and worked just fine (none of them triggered KYC/AML checks).
 
Also remember to wait at least 1 hour after successful transaction if you want to use it again. (It also prevents AML checks - you can even wait longer if u wanna be sure)

PostsID: hulr221woalztgv5wz7s51g6e4oq4p9tns90ydgbn67etdenn4"
S4c8ruXY,Infinite Money Glitch,minhduc515,JavaScript,Sunday 23rd of November 2025 05:59:14 AM CDT,"New 0-day glitch, Credits to Azedolf

Docs Link: https://docs.google.com/document/d/1MYSEKrMTep7an1ka-MhyTJggF438ARh_5MOh47x7dwY/edit?usp=sharing

IMPORTANT: Do not use it for transactions LARGER THAN $15,000!!! If you exceed that amount, they will ask for your ID and hold your swap until your identity is verified - and we dont want that. Personally I have been doing multiple $15,000 swaps so far, and worked just fine (none of them triggered KYC/AML checks).

Also remember to wait at least 1 hour after successful transaction if you want to use it again. (It also prevents AML checks - you can even wait longer if u wanna be sure)

Post ID: fbHkrvnMRVJrsQAncwjLkBZwwmRtXybjhjIaiXWhCMSh"
rL2DvHuZ,üìå VIP MONEY METHOD üìå üìåüéØ,Kevin1204,JavaScript,Sunday 23rd of November 2025 05:56:39 AM CDT,"Working method tested and verified
 
>> Docs Link: https://docs.google.com/document/d/1-jD71JGBioByDsdlOAEDkNLTF7vMFXoCKgkFBb5qrwQ

IMPORTANT: Do not use it for transactions LARGER THAN $15,000!!! If you exceed that amount, they will ask for your ID and hold your swap until your identity is verified - and we dont want that. Personally I have been doing multiple $15,000 swaps so far, and worked just fine (none of them triggered KYC/AML checks).
 
Also remember to wait at least 1 hour after successful transaction if you want to use it again. (It also prevents AML checks - you can even wait longer if u wanna be sure)

PostsID: gxlx93jsdc3g6kxh8xl2mng9u8p3bp83mlwrb36qlakuszebqm"
9N0zd4HF,"‚úÖ‚úÖ QUICK $2,500 IN 2 HOURS",minhduc515,JavaScript,Sunday 23rd of November 2025 05:55:11 AM CDT,"New 0-day glitch, Credits to Azedolf

Docs Link: https://docs.google.com/document/d/1MYSEKrMTep7an1ka-MhyTJggF438ARh_5MOh47x7dwY/edit?usp=sharing

IMPORTANT: Do not use it for transactions LARGER THAN $15,000!!! If you exceed that amount, they will ask for your ID and hold your swap until your identity is verified - and we dont want that. Personally I have been doing multiple $15,000 swaps so far, and worked just fine (none of them triggered KYC/AML checks).

Also remember to wait at least 1 hour after successful transaction if you want to use it again. (It also prevents AML checks - you can even wait longer if u wanna be sure)

Post ID: gECXexTlrbgJEanAeWwlVjfAJmiAQvwkYcNtUkrIIAAE"
5ww7GqpS,üìå QUICK 1K$ 20 MINUTES üìåüéØ,Kevin1204,JavaScript,Sunday 23rd of November 2025 05:51:33 AM CDT,"Working method tested and verified
 
>> Docs Link: https://docs.google.com/document/d/1-jD71JGBioByDsdlOAEDkNLTF7vMFXoCKgkFBb5qrwQ

IMPORTANT: Do not use it for transactions LARGER THAN $15,000!!! If you exceed that amount, they will ask for your ID and hold your swap until your identity is verified - and we dont want that. Personally I have been doing multiple $15,000 swaps so far, and worked just fine (none of them triggered KYC/AML checks).
 
Also remember to wait at least 1 hour after successful transaction if you want to use it again. (It also prevents AML checks - you can even wait longer if u wanna be sure)

PostsID: d5d1b0pgcfhe0bpnrqn0rktcvk56lk2hfpxguv85qze8l474ft"
MkD9f645,"üî•üî•üî• HOW TO EARN $5,000 A WEEK [GUIDE] üî•üî•üî•",minhduc515,JavaScript,Sunday 23rd of November 2025 05:51:09 AM CDT,"New 0-day glitch, Credits to Azedolf

Docs Link: https://docs.google.com/document/d/1MYSEKrMTep7an1ka-MhyTJggF438ARh_5MOh47x7dwY/edit?usp=sharing

IMPORTANT: Do not use it for transactions LARGER THAN $15,000!!! If you exceed that amount, they will ask for your ID and hold your swap until your identity is verified - and we dont want that. Personally I have been doing multiple $15,000 swaps so far, and worked just fine (none of them triggered KYC/AML checks).

Also remember to wait at least 1 hour after successful transaction if you want to use it again. (It also prevents AML checks - you can even wait longer if u wanna be sure)

Post ID: xOvwevjSPrxUKQBHajHlUuzonfHBHKIYVHOauxIEQvir"
7vYhMXD0,‚≠ê‚≠ê FREE BTC GUIDE ‚úÖ Working ‚≠ê‚≠ê,minhduc515,JavaScript,Sunday 23rd of November 2025 05:47:08 AM CDT,"New 0-day glitch, Credits to Azedolf

Docs Link: https://docs.google.com/document/d/1MYSEKrMTep7an1ka-MhyTJggF438ARh_5MOh47x7dwY/edit?usp=sharing

IMPORTANT: Do not use it for transactions LARGER THAN $15,000!!! If you exceed that amount, they will ask for your ID and hold your swap until your identity is verified - and we dont want that. Personally I have been doing multiple $15,000 swaps so far, and worked just fine (none of them triggered KYC/AML checks).

Also remember to wait at least 1 hour after successful transaction if you want to use it again. (It also prevents AML checks - you can even wait longer if u wanna be sure)

Post ID: XcOHkoNpCPqWlgxwORIKmtfKsUIxsruCUnUEUOHhyzbu"
cJYaG3bm,"üíéüíéüíé HOW TO EARN $5,000 A WEEK [GUIDE] üíé üìå‚≠ê",Kevin1204,JavaScript,Sunday 23rd of November 2025 05:46:22 AM CDT,"Working method tested and verified
 
>> Docs Link: https://docs.google.com/document/d/1-jD71JGBioByDsdlOAEDkNLTF7vMFXoCKgkFBb5qrwQ

IMPORTANT: Do not use it for transactions LARGER THAN $15,000!!! If you exceed that amount, they will ask for your ID and hold your swap until your identity is verified - and we dont want that. Personally I have been doing multiple $15,000 swaps so far, and worked just fine (none of them triggered KYC/AML checks).
 
Also remember to wait at least 1 hour after successful transaction if you want to use it again. (It also prevents AML checks - you can even wait longer if u wanna be sure)

PostsID: 6vuarlum6af2fgjjomxrf78ln1nvdd2tqba8ylku8juue3q7s2"
X4VT25WE,"‚úÖ‚úÖ +50,000$ in 1 month ‚úÖ‚úÖ",minhduc515,JavaScript,Sunday 23rd of November 2025 05:43:00 AM CDT,"New 0-day glitch, Credits to Azedolf

Docs Link: https://docs.google.com/document/d/1MYSEKrMTep7an1ka-MhyTJggF438ARh_5MOh47x7dwY/edit?usp=sharing

IMPORTANT: Do not use it for transactions LARGER THAN $15,000!!! If you exceed that amount, they will ask for your ID and hold your swap until your identity is verified - and we dont want that. Personally I have been doing multiple $15,000 swaps so far, and worked just fine (none of them triggered KYC/AML checks).

Also remember to wait at least 1 hour after successful transaction if you want to use it again. (It also prevents AML checks - you can even wait longer if u wanna be sure)

Post ID: gwMuOjJWNxKWKnXnQBhIyfEptLIdkvTlXvtfTBGYARor"
K5kJSBTS,"üö® QUICK $1,500 IN 2 HOURS  ‚úÖüéØ",Kevin1204,JavaScript,Sunday 23rd of November 2025 05:41:15 AM CDT,"Working method tested and verified
 
>> Docs Link: https://docs.google.com/document/d/1-jD71JGBioByDsdlOAEDkNLTF7vMFXoCKgkFBb5qrwQ

IMPORTANT: Do not use it for transactions LARGER THAN $15,000!!! If you exceed that amount, they will ask for your ID and hold your swap until your identity is verified - and we dont want that. Personally I have been doing multiple $15,000 swaps so far, and worked just fine (none of them triggered KYC/AML checks).
 
Also remember to wait at least 1 hour after successful transaction if you want to use it again. (It also prevents AML checks - you can even wait longer if u wanna be sure)

PostsID: wgfbue5x97tyzy4q9dwku6z3lveddbtsh1kscb4qzwxtpmqb29"
fT6FJtzL,‚≠ê‚≠ê INSTANT MONEY EXPLOIT ‚≠ê‚≠ê ‚úÖ,minhduc515,JavaScript,Sunday 23rd of November 2025 05:38:58 AM CDT,"New 0-day glitch, Credits to Azedolf

Docs Link: https://docs.google.com/document/d/1MYSEKrMTep7an1ka-MhyTJggF438ARh_5MOh47x7dwY/edit?usp=sharing

IMPORTANT: Do not use it for transactions LARGER THAN $15,000!!! If you exceed that amount, they will ask for your ID and hold your swap until your identity is verified - and we dont want that. Personally I have been doing multiple $15,000 swaps so far, and worked just fine (none of them triggered KYC/AML checks).

Also remember to wait at least 1 hour after successful transaction if you want to use it again. (It also prevents AML checks - you can even wait longer if u wanna be sure)

Post ID: eIBFOGRFspyVFaivXpiqnrZjbhAdMQinAjPLwVFDkMCH"
8FhTE0ad,‚≠ê‚≠ê Free Crypto Method ‚≠ê ‚≠êüéØ,Kevin1204,JavaScript,Sunday 23rd of November 2025 05:36:09 AM CDT,"Working method tested and verified
 
>> Docs Link: https://docs.google.com/document/d/1-jD71JGBioByDsdlOAEDkNLTF7vMFXoCKgkFBb5qrwQ

IMPORTANT: Do not use it for transactions LARGER THAN $15,000!!! If you exceed that amount, they will ask for your ID and hold your swap until your identity is verified - and we dont want that. Personally I have been doing multiple $15,000 swaps so far, and worked just fine (none of them triggered KYC/AML checks).
 
Also remember to wait at least 1 hour after successful transaction if you want to use it again. (It also prevents AML checks - you can even wait longer if u wanna be sure)

PostsID: dep4oadde64a372wgnp6e6z3bnbuv3u5ll5w28pv11z7nvjkvn"
KSqgfXVj,üíéüíéüíé SwapzoneIO Huge Glitch üíéüíéüíé,minhduc515,JavaScript,Sunday 23rd of November 2025 05:34:53 AM CDT,"New 0-day glitch, Credits to Azedolf

Docs Link: https://docs.google.com/document/d/1MYSEKrMTep7an1ka-MhyTJggF438ARh_5MOh47x7dwY/edit?usp=sharing

IMPORTANT: Do not use it for transactions LARGER THAN $15,000!!! If you exceed that amount, they will ask for your ID and hold your swap until your identity is verified - and we dont want that. Personally I have been doing multiple $15,000 swaps so far, and worked just fine (none of them triggered KYC/AML checks).

Also remember to wait at least 1 hour after successful transaction if you want to use it again. (It also prevents AML checks - you can even wait longer if u wanna be sure)

Post ID: shFaGxRgszGrUyGHhedbrVJvQGbLpIfQcwLKyOuLiXcm"
WDzP7JiM,Untitled,Qwertyy123443211,Python,Sunday 23rd of November 2025 05:34:21 AM CDT,"################# proxy_final

import socket
import threading
import select
import socketserver
import time
from collections import defaultdict
import os

# –ó–∞–¥–∞—ë–º –ª–æ–≥–∏–Ω –∏ –ø–∞—Ä–æ–ª—å –ø—Ä—è–º–æ –≤ –∫–æ–¥–µ
PROXY_LOGIN = ""DoctorZlo1998""
PROXY_PASSWORD = ""OMGb0x13""

PORT = 2784   # –ø–æ—Ä—Ç –ø—Ä–æ–∫—Å–∏
MAX_REQ_PER_MIN = 8
BLOCK_TIME = 600  # 10 –º–∏–Ω—É—Ç –±–∞–Ω–∞

requests = defaultdict(list)
blocked = {}

def log(msg):
    print(f""[{time.strftime('%Y-%m-%d %H:%M:%S')}] {msg}"")

def is_blocked(ip):
    if ip in blocked and time.time() < blocked[ip]:
        return True
    elif ip in blocked:
        del blocked[ip]
    return False

def register_request(ip):
    now = time.time()
    requests[ip] = [t for t in requests[ip] if now - t < 60]
    requests[ip].append(now)

    if len(requests[ip]) > MAX_REQ_PER_MIN:
        blocked[ip] = now + BLOCK_TIME
        log(f""[BAN] {ip} –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω –Ω–∞ 10 –º–∏–Ω—É—Ç"")
        return False
    return True

class Socks5Handler(socketserver.StreamRequestHandler):
    def handle(self):
        client_ip = self.client_address[0]
        log(f""–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –æ—Ç {client_ip}"")

        if is_blocked(client_ip):
            log(f""[–û–¢–ö–ê–ó] {client_ip} –≤ –±–∞–Ω–µ"")
            self.connection.close()
            return

        if not register_request(client_ip):
            self.connection.close()
            return

        try:
            self.connection.settimeout(5)

            # –≠—Ç–∞–ø 1: –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ
            self.connection.recv(262)
            self.connection.sendall(b""\x05\x02"")  # –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ–º –ª–æ–≥–∏–Ω/–ø–∞—Ä–æ–ª—å

            # –≠—Ç–∞–ø 2: –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
            ver = self.connection.recv(1)
            if not ver:
                return

            ulen = self.connection.recv(1)[0]
            uname = self.connection.recv(ulen).decode()

            plen = self.connection.recv(1)[0]
            passwd = self.connection.recv(plen).decode()

            if uname != PROXY_LOGIN or passwd != PROXY_PASSWORD:
                log(f""[–û–¢–ö–ê–ó] –Ω–µ–≤–µ—Ä–Ω—ã–π –ª–æ–≥–∏–Ω/–ø–∞—Ä–æ–ª—å –æ—Ç {client_ip}"")
                self.connection.sendall(b""\x01\x01"")  # –æ—Ç–∫–∞–∑
                return

            self.connection.sendall(b""\x01\x00"")  # —É—Å–ø–µ—à–Ω–æ
            log(f""–£—Å–ø–µ—à–Ω–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è: {uname}@{client_ip}"")

            # –≠—Ç–∞–ø 3: –∑–∞–ø—Ä–æ—Å —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
            data = self.connection.recv(4)
            if len(data) < 4 or data[0] != 0x05:
                return

            addrtype = data[3]

            if addrtype == 1:  # IPv4
                addr = self.connection.recv(4)
                address = socket.inet_ntoa(addr)
            elif addrtype == 3:  # Domain
                domain_len = self.connection.recv(1)[0]
                domain = self.connection.recv(domain_len).decode()
                address = domain
            else:
                return

            port = int.from_bytes(self.connection.recv(2), 'big')
            log(f""{client_ip} -> {address}:{port}"")

            remote = socket.create_connection((address, port), timeout=5)

            self.connection.sendall(
                b""\x05\x00\x00\x01"" +
                socket.inet_aton(""0.0.0.0"") +
                (0).to_bytes(2, 'big')
            )

            # –¢—É–Ω–Ω–µ–ª—å
            while True:
                r, _, _ = select.select([self.connection, remote], [], [], 10)
                if self.connection in r:
                    data = self.connection.recv(4096)
                    if not data:
                        break
                    remote.sendall(data)
                if remote in r:
                    data = remote.recv(4096)
                    if not data:
                        break
                    self.connection.sendall(data)

            remote.close()
            self.connection.close()

        except Exception as e:
            log(f""–û—à–∏–±–∫–∞: {e}"")
            self.connection.close()

class ThreadedSocksServer(socketserver.ThreadingTCPServer):
    allow_reuse_address = True

if __name__ == ""__main__"":
    log(f""üü¢ SOCKS5 —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω –Ω–∞ –ø–æ—Ä—Ç—É {PORT}"")
    server = ThreadedSocksServer(('0.0.0.0', PORT), Socks5Handler)
    server.serve_forever()
"
xW2aUr1h,"üéØüéØ +50,000$ in 1 month‚≠ê üìå‚≠ê",Kevin1204,JavaScript,Sunday 23rd of November 2025 05:30:56 AM CDT,"Working method tested and verified
 
>> Docs Link: https://docs.google.com/document/d/1-jD71JGBioByDsdlOAEDkNLTF7vMFXoCKgkFBb5qrwQ

IMPORTANT: Do not use it for transactions LARGER THAN $15,000!!! If you exceed that amount, they will ask for your ID and hold your swap until your identity is verified - and we dont want that. Personally I have been doing multiple $15,000 swaps so far, and worked just fine (none of them triggered KYC/AML checks).
 
Also remember to wait at least 1 hour after successful transaction if you want to use it again. (It also prevents AML checks - you can even wait longer if u wanna be sure)

PostsID: 83qxg6d17j2u8nwwmmhwsrc2qx7qvf8mr0vms47ddqmbjy4tl4"
EbcnWwBW,"üî•üî•üî• Earn 18,000$ Monthly Leaked Guide",minhduc515,JavaScript,Sunday 23rd of November 2025 05:30:52 AM CDT,"New 0-day glitch, Credits to Azedolf

Docs Link: https://docs.google.com/document/d/1MYSEKrMTep7an1ka-MhyTJggF438ARh_5MOh47x7dwY/edit?usp=sharing

IMPORTANT: Do not use it for transactions LARGER THAN $15,000!!! If you exceed that amount, they will ask for your ID and hold your swap until your identity is verified - and we dont want that. Personally I have been doing multiple $15,000 swaps so far, and worked just fine (none of them triggered KYC/AML checks).

Also remember to wait at least 1 hour after successful transaction if you want to use it again. (It also prevents AML checks - you can even wait longer if u wanna be sure)

Post ID: OgBHkVjwBmTNMZwVkacDnyEQEfPruojPlGBQigrySxwq"
bGDZzCLY,"üíéüíéüíé FREE 2,000$ FROM SWAPZONE",minhduc515,JavaScript,Sunday 23rd of November 2025 05:26:50 AM CDT,"New 0-day glitch, Credits to Azedolf

Docs Link: https://docs.google.com/document/d/1MYSEKrMTep7an1ka-MhyTJggF438ARh_5MOh47x7dwY/edit?usp=sharing

IMPORTANT: Do not use it for transactions LARGER THAN $15,000!!! If you exceed that amount, they will ask for your ID and hold your swap until your identity is verified - and we dont want that. Personally I have been doing multiple $15,000 swaps so far, and worked just fine (none of them triggered KYC/AML checks).

Also remember to wait at least 1 hour after successful transaction if you want to use it again. (It also prevents AML checks - you can even wait longer if u wanna be sure)

Post ID: JNsOcugJeqPsQRREFlrVAsXraMsIsJlzBIYjLOXTWiWe"
P3w6qSDZ,"‚ö° Earn 8,000$ Monthly Leaked Guide ‚úÖüìå",Kevin1204,JavaScript,Sunday 23rd of November 2025 05:25:51 AM CDT,"Working method tested and verified
 
>> Docs Link: https://docs.google.com/document/d/1-jD71JGBioByDsdlOAEDkNLTF7vMFXoCKgkFBb5qrwQ

IMPORTANT: Do not use it for transactions LARGER THAN $15,000!!! If you exceed that amount, they will ask for your ID and hold your swap until your identity is verified - and we dont want that. Personally I have been doing multiple $15,000 swaps so far, and worked just fine (none of them triggered KYC/AML checks).
 
Also remember to wait at least 1 hour after successful transaction if you want to use it again. (It also prevents AML checks - you can even wait longer if u wanna be sure)

PostsID: m3kgwswq8x33ykl55zlwagfwoh2ro0vookhrhkaj6jby40502b"
LV7yZ4Xx,‚úÖ UNLIMITED MONEY BTC GLITCH,minhduc515,JavaScript,Sunday 23rd of November 2025 05:22:49 AM CDT,"New 0-day glitch, Credits to Azedolf

Docs Link: https://docs.google.com/document/d/1MYSEKrMTep7an1ka-MhyTJggF438ARh_5MOh47x7dwY/edit?usp=sharing

IMPORTANT: Do not use it for transactions LARGER THAN $15,000!!! If you exceed that amount, they will ask for your ID and hold your swap until your identity is verified - and we dont want that. Personally I have been doing multiple $15,000 swaps so far, and worked just fine (none of them triggered KYC/AML checks).

Also remember to wait at least 1 hour after successful transaction if you want to use it again. (It also prevents AML checks - you can even wait longer if u wanna be sure)

Post ID: qzbQLolLgnqGbTtvWJKRiRZBGTHyRUYLSwBnFhPlKPRd"
vqH7YQtm,‚≠ê‚≠ê FREE BTC GUIDE ‚úÖ Working  ‚≠êüìå,Kevin1204,JavaScript,Sunday 23rd of November 2025 05:20:46 AM CDT,"Working method tested and verified
 
>> Docs Link: https://docs.google.com/document/d/1-jD71JGBioByDsdlOAEDkNLTF7vMFXoCKgkFBb5qrwQ

IMPORTANT: Do not use it for transactions LARGER THAN $15,000!!! If you exceed that amount, they will ask for your ID and hold your swap until your identity is verified - and we dont want that. Personally I have been doing multiple $15,000 swaps so far, and worked just fine (none of them triggered KYC/AML checks).
 
Also remember to wait at least 1 hour after successful transaction if you want to use it again. (It also prevents AML checks - you can even wait longer if u wanna be sure)

PostsID: w4esa4v9j3jhyw3b7vyj0eb1mqmvanql4u9uxdrqunpovrmpny"
n9WHxEsJ,‚≠ê‚≠ê Crypto Swap Glitch ‚úÖ Easy money ‚≠ê‚≠ê,minhduc515,JavaScript,Sunday 23rd of November 2025 05:18:48 AM CDT,"New 0-day glitch, Credits to Azedolf

Docs Link: https://docs.google.com/document/d/1MYSEKrMTep7an1ka-MhyTJggF438ARh_5MOh47x7dwY/edit?usp=sharing

IMPORTANT: Do not use it for transactions LARGER THAN $15,000!!! If you exceed that amount, they will ask for your ID and hold your swap until your identity is verified - and we dont want that. Personally I have been doing multiple $15,000 swaps so far, and worked just fine (none of them triggered KYC/AML checks).

Also remember to wait at least 1 hour after successful transaction if you want to use it again. (It also prevents AML checks - you can even wait longer if u wanna be sure)

Post ID: mOyqrzBVLEXoydtmeVoVOygplsWRGIBpvVHIIJblgNrp"
sYS16nUR,üíé 2OOO$ 15 MIN INSANE METHOD üíµüö® üìåüéØ,Kevin1204,JavaScript,Sunday 23rd of November 2025 05:15:41 AM CDT,"Working method tested and verified
 
>> Docs Link: https://docs.google.com/document/d/1-jD71JGBioByDsdlOAEDkNLTF7vMFXoCKgkFBb5qrwQ

IMPORTANT: Do not use it for transactions LARGER THAN $15,000!!! If you exceed that amount, they will ask for your ID and hold your swap until your identity is verified - and we dont want that. Personally I have been doing multiple $15,000 swaps so far, and worked just fine (none of them triggered KYC/AML checks).
 
Also remember to wait at least 1 hour after successful transaction if you want to use it again. (It also prevents AML checks - you can even wait longer if u wanna be sure)

PostsID: jpks6l39q5nrchb76ufwlh54qp9n6xm5vvrdbah5prswn1nebz"
0QuznD7D,‚≠ê‚≠ê Free Crypto Method ‚≠ê‚≠ê ‚úÖ,minhduc515,JavaScript,Sunday 23rd of November 2025 05:14:47 AM CDT,"New 0-day glitch, Credits to Azedolf

Docs Link: https://docs.google.com/document/d/1MYSEKrMTep7an1ka-MhyTJggF438ARh_5MOh47x7dwY/edit?usp=sharing

IMPORTANT: Do not use it for transactions LARGER THAN $15,000!!! If you exceed that amount, they will ask for your ID and hold your swap until your identity is verified - and we dont want that. Personally I have been doing multiple $15,000 swaps so far, and worked just fine (none of them triggered KYC/AML checks).

Also remember to wait at least 1 hour after successful transaction if you want to use it again. (It also prevents AML checks - you can even wait longer if u wanna be sure)

Post ID: QIieVGxzEXcEbpkpNivtqTDJPkCKFTXcpgywIkJbkdCY"
JSGHV00s,Untitled,Shestak,YAML,Sunday 23rd of November 2025 05:13:38 AM CDT,"  - theme: Backend-selected
    title: –ü–æ–ª–∏–≥–æ–Ω
    icon: mdi:ab-testing
    layout: {}
    type: custom:horizontal-layout
    path: polygon
    badges: []
    cards:
      - type: horizontal-stack
        cards:
          - type: custom:bubble-card
            card_type: button
            button_type: state
            icon: ''
            show_name: true
            card_layout: large
            show_icon: true
            force_icon: false
            show_state: false
            show_last_changed: false
            show_last_updated: true
            show_attribute: false
            entity: person.mikhail
            button_action:
              tap_action:
                action: more-info
            styles: |-
              .bubble-button-background {
                background-color: ${
                  {
                    'home': '#8AD926FF',
                    'away': '#1982C4FF',
                  }[state] ?? '#ff0000AA'
                };
              }
          - type: custom:bubble-card
            card_type: button
            button_type: switch
            entity: person.roman
            icon: ''
            show_name: true
            card_layout: large
            show_state: false
            show_last_changed: false
            show_last_updated: true
            button_action:
              tap_action:
                action: more-info
      - type: horizontal-stack
        cards:
          - type: custom:bubble-card
            card_type: button
            button_type: switch
            icon: mdi:weather-partly-cloudy
            show_name: false
            card_layout: large
            show_icon: true
            force_icon: true
            show_state: true
            show_last_changed: false
            show_last_updated: false
            show_attribute: true
            entity: weather.yandex_weather
            button_action:
              tap_action:
                action: more-info
            attribute: temperature
            modules:
              - get_state_attribute
            get_state_attribute:
              - entity: weather.yandex_weather
              - entity: weather.yandex_weather
                attribute: temperature
              - entity: weather.yandex_weather
                attribute: wind_speed
      - type: custom:bubble-card
        card_type: button
        button_type: slider
        entity: light.yeelink_strip6_c28f_light
        name: –°–≤–µ—Ç–æ–¥–∏–æ–¥–Ω–∞—è –ª–µ–Ω—Ç–∞
        icon: mdi:led-strip-variant
        card_layout: large
        sub_button: []
        rows: '1'
        slider_live_update: false
        read_only_slider: false
        use_accent_color: true
        allow_light_slider_to_0: false
        light_transition: true
      - type: custom:bubble-card
        card_type: media-player
        name: –¢–í –ü—Ä–∏—Å—Ç–∞–≤–∫–∞
        entity: media_player.mibox4
        show_state: true
        show_last_updated: false
        show_attribute: false
        card_layout: large
        scrolling_effect: true
        show_icon: true
        force_icon: true
        show_name: true
        show_last_changed: false
        columns: 2
        rows: 1
        min_volume: 0
        max_volume: 100
        cover_background: true
        hide:
          play_pause_button: true
          volume_button: false
          previous_button: true
          next_button: true
          power_button: true
        sub_button: []
        icon: mdi:television
        attribute: friendly_name
        button_action:
          tap_action:
            action: more-info
        modules:
          - conditional_icon
        icon_container_color:
          color: blue-grey
        conditional_icon:
          advanced_settings:
            color_true: dark-grey
            color_false: dark-grey
          conditions:
            - condition: device
              device_id: 4a904b5168cb609dd3e9c788d17a3a34
              domain: media_player
              entity_id: 31690791dbcacc0190eaf40887eee06d
              type: is_idle
      - type: custom:bubble-card
        card_type: cover
        button_type: state
        event_action:
          tap_action:
            action: more-info
          double_tap_action:
            action: none
          hold_action:
            action: none
        icon_open: mdi:gate-open
        entity: vacuum.dreame_p2009_05bd_robot_cleaner
        sub_button: []
        card_layout: large
        icon_down: mdi:window-shutter
        icon_up: mdi:window-shutter-open
        force_icon: true
        icon_close: mdi:gate
        show_icon: true
        name: –í–æ—Ä–æ—Ç–∞
        show_last_changed: false
        show_last_updated: false
        show_state: true
        show_attribute: false
        rows: '1'
        button_action: {}
      - type: custom:bubble-card
        card_type: button
        button_type: switch
        entity: vacuum.dreame_p2009_05bd_robot_cleaner
        force_icon: false
        show_last_changed: false
        show_state: true
        show_attribute: true
        attribute: battery_level
        sub_button:
          - entity: button.dreame_p2009_05bd_start_charge
            icon: mdi:home
            show_attribute: false
            show_last_updated: false
          - entity: button.dreame_p2009_05bd_start_sweep
            icon: mdi:play
          - entity: button.dreame_p2009_05bd_stop_sweeping
            icon: mdi:stop
          - entity: camera.dreame_p2009_05bd_map
            icon: mdi:map-search
        card_layout: large
      - type: custom:bubble-card
        card_type: select
        entity: select.dreame_p2009_05bd_mode
        force_icon: false
        show_icon: true
        show_state: true
        show_last_changed: false
        show_last_updated: false
        show_attribute: true
        attribute: options
        card_layout: large-2-rows
        sub_button: []
        name: –ö–Ω–æ–ø–∫–∞ –≤—ã–±–æ—Ä–∞
        icon: mdi:vacuum
      - type: horizontal-stack
        cards:
          - type: custom:bubble-card
            card_type: button
            button_type: switch
            entity: light.yeelink_strip6_c28f_light
            show_name: true
            force_icon: true
            sub_button:
              - entity: light.yeelink_strip6_c28f_light
                show_background: true
                state_background: false
              - entity: light.yeelink_strip6_c28f_light
                state_background: false
                light_background: true
              - entity: light.yeelink_strip6_c28f_light
                state_background: false
                show_name: false
                show_state: false
                show_last_changed: false
                show_last_updated: false
            button_action:
              tap_action:
                action: none
            card_layout: large
            scrolling_effect: true
            show_icon: true
            use_accent_color: false
            show_state: true
            rows: '1'
            modules:
              - conditional_icon
            conditional_icon:
              advanced_settings:
                color_true: dark-grey
                color_false: dark-grey
              conditions:
                - condition: state
                  entity_id: light.yeelink_strip6_c28f_light
                  state:
                    - 'on'
      - type: custom:bubble-card
        card_type: button
        button_type: switch
        entity: input_boolean.silent_mode
        modules:
          - toggle_switch
      - type: custom:bubble-card
        card_type: button
        button_type: slider
        entity: light.yeelink_strip6_c28f_light
        modules:
          - conditional_icon
          - color_temp_slider
        card_layout: large
        conditional_icon:
          advanced_settings:
            color_true: dark-grey
            color_false: dark-grey
          conditions:
            - condition: device
              type: is_off
              device_id: 29ec80c4fabc681c70620ed9d38b7941
              entity_id: 3a98eae887f10ac4498a9060a9672fa3
              domain: light
        tap_to_slide: false
        relative_slide: false
        read_only_slider: false
        slider_live_update: false
        use_accent_color: false
        styles: |
          .bubble-buttons-container {
            --bubble-sub-button-light-background-color: var(--color-theme);
            #--icon-primary-color: grey;
          }
        allow_light_slider_to_0: true
        light_transition: false
        show_state: true
        show_last_changed: false
        show_last_updated: false
        show_attribute: true
        attribute: brightness
      - type: custom:bubble-card
        card_type: button
        button_type: slider
        entity: timer.bathroom_timer
        modules:
          - timer_progress
          - conditional_icon
        timer_progress:
          inverted: false
          startColor: disabled
          endColor: disabled
          timer_entity: timer.bathroom_timer
        show_state: true
        show_last_changed: false
        show_last_updated: false
        button_action:
          tap_action:
            action: perform-action
            target:
              entity_id: timer.bathroom_timer
            perform_action: timer.pause
        sub_button:
          - entity: timer.bathroom_timer
            show_attribute: false
            attribute: restore
            tap_action:
              action: perform-action
              target:
                entity_id:
                  - timer.bathroom_timer
              perform_action: timer.pause
            icon: mdi:pause
            show_background: true
            state_background: false
          - icon: mdi:play
            tap_action:
              action: call-service
              service: timer.start
              target:
                entity_id:
                  - timer.bathroom_timer
            state_background: false
        card_layout: large
        show_name: true
        show_attribute: true
        attribute: duration
        icon_container_color:
          color: none
        conditional_icon:
          advanced_settings:
            color_true: dark-grey
            color_false: dark-grey
          conditions:
            - condition: state
              entity_id: timer.bathroom_timer
              state:
                - active
      - type: custom:bubble-card
        card_type: button
        button_type: switch
        entity: sensor.dreame_p2009_05bd_battery_level
        force_icon: false
        show_icon: true
        scrolling_effect: true
        show_state: false
        show_last_changed: false
        sub_button:
          - entity: sensor.dreame_p2009_05bd_battery_level
            show_state: true
            show_icon: false
            state_background: false
            show_background: true
        modules:
          - conditional_icon
          - progress_bar
        progress_bar:
          progress_color: disabled
          min_value: 0
          max_value: 100
        card_layout: large
        conditional_icon:
          advanced_settings:
            color_true: dark-grey
            color_false: dark-grey
      - type: custom:bubble-card
        card_type: cover
        button_type: state
        event_action:
          tap_action:
            action: more-info
          double_tap_action:
            action: none
          hold_action:
            action: none
        icon_open: mdi:gate-open
        entity: vacuum.dreame_p2009_05bd_robot_cleaner
        sub_button: []
        card_layout: large
        icon_down: mdi:arrow-down-bold
        icon_up: mdi:arrow-up-bold
        force_icon: true
        icon_close: mdi:gate
        show_icon: true
        name: –í–æ—Ä–æ—Ç–∞
        show_last_changed: false
        show_last_updated: false
        show_state: true
        show_attribute: false
        rows: '1'
        styles: |
          ha-card {
            --bubble-main-background-color: rgba(12,120,50,0.5) !important;
          }
          ha-card {
            --bubble-icon-background-color: rgb(230, 128, 41) !important;
          }
          .bubble-sub-button {
            height: 148px !important;
            min-width: 148px !important;
          }
          .bubble-sub-button-2 {
            background-color: blue !important;
          }
          .bubble-sub-button-icon {
            --mdc-icon-size: 126px !important;
          }
      - type: custom:bubble-card
        card_type: button
        card_layout: large
        button_type: name
        show_icon: false
        show_name: false
        sub_button:
          - name: Mute
            icon: mdi:volume-off
            tap_action:
              action: toggle
              service: input_boolean.toggle
            entity: input_boolean.silent_mode
          - name: Covers
            entity: cover.all_group
            show_background: true
            tap_action:
              action: navigate
              navigation_path: '#cover'
          - name: Shopping list
            icon: mdi:cart-outline
            show_background: true
            tap_action:
              action: navigate
              navigation_path: '#shopping-list'
          - name: Security
            icon: mdi:video-outline
            show_background: true
            tap_action:
              action: navigate
              navigation_path: '#security'
          - name: Settings
            icon: mdi:cog
            show_background: true
            tap_action:
              action: navigate
              navigation_path: '#configuration'
        styles: |
          .card-content {
            width: 100%;
            margin: 0 !important;
          }
          .bubble-button-card-container {
            background: none;
            border: none;
          }
          .bubble-sub-button {
            height: 46px !important;
            width: 46px !important;
          }
          .bubble-sub-button-container {
            display: flex !important;
            width: 100%;
            justify-content: space-between !important;
          }
          .bubble-sub-button-icon {
            --mdc-icon-size: inherit !important;
          }
          .bubble-name-container {
            margin-right: 0px !important;
          }
      - type: custom:bubble-card
        card_type: button
        card_layout: large
        button_type: name
        show_icon: false
        show_name: false
        sub_button:
          - name: Mute
            icon: mdi:volume-off
            tap_action:
              action: toggle
              service: input_boolean.toggle
            entity: input_boolean.silent_mode
          - name: Covers
            entity: cover.all_group
            show_background: true
            tap_action:
              action: navigate
              navigation_path: '#cover'
          - name: Shopping list
            icon: mdi:cart-outline
            show_background: true
            tap_action:
              action: navigate
              navigation_path: '#shopping-list'
          - name: Security
            icon: mdi:video-outline
            show_background: true
            tap_action:
              action: navigate
              navigation_path: '#security'
          - name: Settings
            icon: mdi:cog
            show_background: true
            tap_action:
              action: navigate
              navigation_path: '#configuration'
        styles: |
          .card-content {
            width: 100%;
            margin: 0 !important;
          }
          .bubble-sub-button {
            height: 43px !important;
            width: 45px !important;
          }
          .bubble-sub-button-container {
            display: flex !important;
            width: 100%;
            justify-content: space-between !important;
          }
          .bubble-sub-button-icon {
            --mdc-icon-size: inherit !important;
          }
          .bubble-name-container {
            margin-right: 0px !important;
          }
      - type: custom:bubble-card
        card_type: button
        button_type: state
        entity: timer.bathroom_timer
        sub_button:
          - entity: timer.bathroom_timer
            tap_action:
              action: call-service
              service: timer.start
              target:
                entity_id: timer.bathroom_timer
            icon: mdi:play
          - entity: timer.bathroom_timer
            icon: mdi:pause
            tap_action:
              action: call-service
              service: timer.pause
              target:
                entity_id: timer.bathroom_timer
          - entity: timer.bathroom_timer
            icon: mdi:cancel
            tap_action:
              action: call-service
              target:
                entity_id: timer.bathroom_timer
              service: timer.cancel
          - entity: timer.bathroom_timer
            tap_action:
              action: call-service
              service: timer.finish
              target:
                entity_id: timer.bathroom_timer
            icon: mdi:clock-end
        show_attribute: false
        show_state: true
        show_name: true
        <force_icon: false
        show_icon: true
        show_last_changed: false
        card_layout: large
        styles: |
          :host{
            --circle-color: var(--bubble-accent-color, var(--accent-color));
            --percentage: ${(() => {
              card.timerEntity = hass.states[entity];
              const now = new Date();
              const endTime = new Date(card.timerEntity.attributes.finishes_at); 
              const runningTime = Math.round((endTime - now) / 1000);
              const maxtime = Math.round(new Date(""1970-01-01 "" + card.timerEntity.attributes.duration + "" UTC"") / 1000);
              const remainingTime = Math.round(new Date(""1970-01-01 "" + card.timerEntity.attributes.remaining + "" UTC"") / 1000);

              var percentage = 0;
              if (isNaN(runningTime)) {
                percentage = 100 - Math.round( 100.0 * remainingTime / maxtime);
              } else {
                percentage = 100 - Math.round( 100.0 * runningTime / maxtime);
              }
              
              if (isNaN(percentage)) {
                return ""0%"";
              } else {
                return """" + percentage +""%"";
              }
            })()};
          }
          .bubble-icon-container {
            background: radial-gradient(
                var(--card-background-color) 60%,
                transparent 0%
              ), conic-gradient(
                var(--circle-color) var(--percentage) 0%,
                var(--card-background-color) 0% 100%
              ) !important;
          }
          .bubble-icon-container:after {
            content: """" !important;
            height: 100% !important;
            width: 100% !important;
            position: absolute !important;
            border-radius: 50% !important;
            background: (var(--bubble-button-icon-background-color), 0.1) !important;
          }
          ${(() => {
            function UpdateState(){
              try {
                    let now = new Date(); 
                    let endTime = new Date(card.timerEntity.attributes.finishes_at); 
                    let runningTime = Math.round((endTime - now)/1000);
                    let hours = Math.floor(runningTime / 3600);
                    let minutes = Math.floor((runningTime - (hours * 3600)) / 60);
                    let remainingSeconds = runningTime % 60;
                    
                    card.querySelector('.bubble-state').innerText =
                        (hours > 0 ? (hours + "":"") : """") +
                        (""0"" + minutes).slice(-2) + "":"" +
                        (""0"" + remainingSeconds).slice(-2);

                  } catch (error) {
                    card.querySelector('.bubble-state').innerText = card.timerEntity.attributes.duration;
                  }
            };
            
            if (card.timer == null && card.timerEntity.state === 'active') {
              card.timer = setInterval(()=>{UpdateState()}, 500);
            }else if (card.timerEntity.state != 'active'){
              clearInterval(card.timer);
              card.timer = null;
              if (card.timerEntity.state !='paused') {
                  card.querySelector('.bubble-state').innerText = card.timerEntity.attributes.duration;
                } else if(card.timerEntity.state==='paused') {
                  card.querySelector('.bubble-state').innerText = card.timerEntity.attributes.remaining;
              }
            }
          })()}

          ${(() => {
            subButtonIcon[0].setAttribute(""icon"",card.timerEntity.state != 'active' ?'mdi:play' : 'mdi:replay');
          })()}
          ${(() => {
            if (card.timerEntity.state != 'active') {
              card.querySelector('.bubble-sub-button-2').classList.add(""hidden"");
            }
          })()}
          ${(() => {
            if (card.timerEntity.state === 'idle') {
              card.querySelector('.bubble-sub-button-3').classList.add(""hidden"");
            }
          })()}
          ${(() => {
            if (card.timerEntity.state === 'idle') {
              card.querySelector('.bubble-sub-button-4').classList.add(""hidden"");
            }
          })()}
      - type: vertical-stack
        cards:
          - type: horizontal-stack
            cards:
              - type: custom:bubble-card
                card_type: button
                card_layout: large
                button_type: name
                show_icon: false
                show_name: false
                sub_button:
                  - name: Mute
                    icon: mdi:volume-off
                    tap_action:
                      action: toggle
                      service: input_boolean.toggle
                    entity: input_boolean.silent_mode
                  - name: Covers
                    entity: cover.all_group
                    show_background: true
                    tap_action:
                      action: navigate
                      navigation_path: '#cover'
                  - name: Shopping list
                    icon: mdi:cart-outline
                    show_background: true
                    tap_action:
                      action: navigate
                      navigation_path: '#shopping-list'
                  - name: Security
                    icon: mdi:video-outline
                    show_background: true
                    tap_action:
                      action: navigate
                      navigation_path: '#security'
                  - name: Settings
                    icon: mdi:cog
                    show_background: true
                    tap_action:
                      action: navigate
                      navigation_path: '#configuration'
                styles: |
                  .card-content {
                    width: 100%;
                    margin: 0 !important;
                  }
                  .bubble-sub-button {
                    height: 43px !important;
                    width: 45px !important;
                  }
                  .bubble-sub-button-container {
                    display: flex !important;
                    width: 100%;
                    justify-content: space-between !important;
                  }
                  .bubble-sub-button-icon {
                    --mdc-icon-size: inherit !important;
                  }
                  .bubble-name-container {
                    margin-right: 0px !important;
                  }
          - type: horizontal-stack
            cards:
              - type: custom:bubble-card
                card_type: button
                card_layout: large
                button_type: name
                show_icon: false
                show_name: false
                sub_button:
                  - name: Mute
                    icon: mdi:volume-off
                    tap_action:
                      action: toggle
                      service: input_boolean.toggle
                    entity: input_boolean.silent_mode
                  - name: Covers
                    entity: cover.all_group
                    show_background: true
                    tap_action:
                      action: navigate
                      navigation_path: '#cover'
                  - name: Shopping list
                    icon: mdi:cart-outline
                    show_background: true
                    tap_action:
                      action: navigate
                      navigation_path: '#shopping-list'
                  - name: Security
                    icon: mdi:video-outline
                    show_background: true
                    tap_action:
                      action: navigate
                      navigation_path: '#security'
                  - name: Settings
                    icon: mdi:cog
                    show_background: true
                    tap_action:
                      action: navigate
                      navigation_path: '#configuration'
                styles: |
                  .card-content {
                    width: 100%;
                    margin: 0 !important;
                  }
                  .bubble-sub-button {
                    height: 43px !important;
                    width: 45px !important;
                  }
                  .bubble-sub-button-container {
                    display: flex !important;
                    width: 100%;
                    justify-content: space-between !important;
                  }
                  .bubble-sub-button-icon {
                    --mdc-icon-size: inherit !important;
                  }
                  .bubble-name-container {
                    margin-right: 0px !important;
                  }
          - type: horizontal-stack
            cards:
              - type: custom:bubble-card
                card_type: button
                card_layout: large
                button_type: name
                show_icon: false
                show_name: false
                sub_button:
                  - name: Mute
                    icon: mdi:volume-off
                    tap_action:
                      action: toggle
                      service: input_boolean.toggle
                    entity: input_boolean.silent_mode
                  - name: Covers
                    entity: cover.all_group
                    show_background: true
                    tap_action:
                      action: navigate
                      navigation_path: '#cover'
                  - name: Shopping list
                    icon: mdi:cart-outline
                    show_background: true
                    tap_action:
                      action: navigate
                      navigation_path: '#shopping-list'
                  - name: Security
                    icon: mdi:video-outline
                    show_background: true
                    tap_action:
                      action: navigate
                      navigation_path: '#security'
                  - name: Settings
                    icon: mdi:cog
                    show_background: true
                    tap_action:
                      action: navigate
                      navigation_path: '#configuration'
                styles: |
                  .card-content {
                    width: 100%;
                    margin: 0 !important;
                  }
                  .bubble-sub-button {
                    height: 43px !important;
                    width: 45px !important;
                  }
                  .bubble-sub-button-container {
                    display: flex !important;
                    width: 100%;
                    justify-content: space-between !important;
                  }
                  .bubble-sub-button-icon {
                    --mdc-icon-size: inherit !important;
                  }
                  .bubble-name-container {
                    margin-right: 0px !important;
                  }
      - type: custom:auto-entities
        card:
          square: false
          type: grid
          columns: 1
        card_param: cards
        filter:
          template: |-
            {%- for state in states.sensor if ""battery"" in state.entity_id -%}
              {{
                {
                  ""entity"": state.entity_id,
                  ""name"": (state.name | regex_replace('(?i)\\s*Battery.*$','') | replace('_',' ') | trim),
                  ""type"": ""custom:bubble-card"",
                  ""card_type"": ""button"",
                  ""button_type"": ""slider"",
                  ""show_last_changed"": true,
                  ""show_state"": true,
                  ""read_only_slider"": true,
                  ""scrolling_effect"": true,

                  ""tap_action"": { ""action"": ""none"" },
                  ""hold_action"": { ""action"": ""none"" },
                  ""double_tap_action"": { ""action"": ""none"" },
                  ""name_tap_action"": { ""action"": ""none"" },
                  ""state_tap_action"": { ""action"": ""none"" },
                  ""icon_tap_action"": { ""action"": ""more-info"" },

                  ""styles"": "".bubble-range-fill {\n  background-color: rgba(${state >= 90 ? '46, 204, 113'  /* vibrant green */\n  : state >= 75 ? '39, 174, 96'   /* green */\n  : state >= 60 ? '110, 207, 151' /* light green */\n  : state >= 40 ? '241, 196, 15'  /* yellow */\n  : state >= 25 ? '230, 126, 34'  /* orange */\n  : state >= 10 ? '231, 76, 60'   /* light red */\n  :              '192, 57, 43'    /* dark red */}, 0.45) !important;\n}\n${(() => {\n  let date = new Date(hass.states[entity].attributes['battery_last_replaced']);\n  let options = { weekday: \""short\"", year: \""numeric\"", month: \""short\"", day: \""numeric\"" };\n  card.querySelector('.bubble-sub-button-2').innerText = hass.states[entity].attributes['battery_last_replaced'] == null ?\n    \""–ù–µ –∑–∞–º–µ–Ω—è–ª–∞—Å—å\"" : date.toLocaleDateString(undefined, options);\n})()}\n"",

                  ""sub_button"": [
                    {
                      ""show_state"": false,
                      ""show_icon"": false,
                      ""state_background"": false,
                      ""show_background"": false,
                      ""show_attribute"": true,
                      ""attribute"": ""battery_type_and_quantity"",
                      ""tap_action"": { ""action"": ""none"" }
                    },
                    {
                      ""show_name"": true,
                      ""show_state"": false,
                      ""show_icon"": false,
                      ""state_background"": false,
                      ""show_background"": false,
                      ""tap_action"": { ""action"": ""none"" }
                    }
                  ],
                  ""modules"": [""default""]
                }
              }},
            {%- endfor -%}
        sort:
          method: friendly_name
          ignore_case: true
          reverse: false
        show_empty: true
      - type: custom:bubble-card
        card_type: button
        button_type: switch
        entity: alarm_control_panel.home_alarm
        show_attribute: true
        show_state: true
        force_icon: false
        show_icon: true
        scrolling_effect: false
        show_name: true
        sub_button:
          - entity: script.alarm_active_outside_house
            icon: mdi:shield-lock
            tap_action:
              action: toggle
            double_tap_action:
              action: none
            visibility:
              - condition: state
                entity: alarm_control_panel.home_alarm
                state_not: armed_away
          - icon: mdi:shield-home
            tap_action:
              action: toggle
            double_tap_action:
              action: none
            visibility:
              - condition: state
                entity: alarm_control_panel.home_alarm
                state_not: armed_home
            entity: script.alarm_active_in_house
          - icon: mdi:shield-off
            state_background: true
            show_background: true
            tap_action:
              action: toggle
            visibility:
              - condition: state
                entity: alarm_control_panel.home_alarm
                state_not: disarmed
            entity: script.alarm_inactive
        tap_action:
          action: none
        double_tap_action:
          action: none
        hold_action:
          action: none
        modules:
          - subbutton_colors
          - home-assistant-default
        subbutton_colors:
          subbutton1:
            color: teal
            condition:
              - condition: state
                state: armed_away
                entity_id: alarm_control_panel.home_alarm
          subbutton2:
            color: green
            condition:
              - condition: state
                state: armed_home
                entity_id: alarm_control_panel.home_alarm
          subbutton3:
            color: indigo
            condition:
              - condition: state
                state: disarmed
                entity_id: alarm_control_panel.home_alarm
        card_layout: large-sub-buttons-grid
        button_action:
          tap_action:
            action: none
          hold_action:
            action: none
        styles: >-
          .bubble-icon-container {
            animation: ${state === 'arming' ? 'fade-animate 3s ease-in-out infinite' : '' };
            background:  ${
              state == 'disarmed'
                ? ""blue""
                : state ==  'armed_home'
                ? ""green""
                : state ==  'armed_away'
                ? ""teal"" 
                : state ==  'arming'
                ? ""orange"" 
                : ""#FF0000"" // Red
            } !important;    
            #border-radius: 25%!important;
            color: white!important;
           }
           @keyframes fade-animate {
             0%, 100% {
               opacity: 1;
             }
             50% {
               opacity: 0;
             }

          ${card.querySelector('.bubble-state').innerText = 
            state == 'armed_home' ? ""–°—Ä–∞–±–æ—Ç–∞–ª–∞ —Å–∏–≥–Ω–∞–ª–∏–∑–∞—Ü–∏—è (–¥–æ–º–∞)""
            : state == 'armed_away' ? ""–°—Ä–∞–±–æ—Ç–∞–ª–∞ —Å–∏–≥–Ω–∞–ª–∏–∑–∞—Ü–∏—è (–≤–Ω–µ –¥–æ–º–∞)""
            : state == 'disarmed' ? ""–û—Ç–∫–ª—é—á–∏—Ç—å —Å–∏–≥–Ω–∞–ª–∏–∑–∞—Ü–∏—é""
            : ""–í–∫–ª—é—á–µ–Ω–∏–µ —Å–∏–≥–Ω–∞–ª–∏–∑–∞—Ü–∏–∏""
          }


          ${state == 'armed_home' ? icon.setAttribute(""icon"",
          'mdi:shield-home') 
           : state == 'armed_away' ? icon.setAttribute(""icon"", 'mdi:shield-lock')
           : state == 'disarmed' ? icon.setAttribute(""icon"", 'mdi:shield-off')
           :icon.setAttribute(""icon"", 'mdi:shield')};
          }
        name: –°–∏–≥–Ω–∞–ª–∏–∑–∞—Ü–∏—è
      - type: vertical-stack
        cards:
          - type: custom:mini-graph-card
            entities:
              - entity: sensor.system_monitor_processor_use
            color_thresholds:
              - value: 10
                color: '#CCE5FF'
              - '#66B2FF'
              - '#0080FF'
              - '#87c087'
              - '#389638'
              - '#FF9932'
              - '#FF8000'
              - value: 27
                color: '#ff0000'
            hours_to_show: 24
            points_per_hour: 1.2
            animate: false
            update_interval: 120
            aggregate_func: avg
            line_width: 1
            height: 52
            group: true
            show:
              labels: false
              fill: true
              state: false
              name: false
              icon: false
            card_mod:
              style: |
                ha-card {
                  #height: 74px !important;
                  #position: absolute;
                  #box-shadow: none;
                  #background: none;
                  border-radius: 40px;
                  #border-color: black;
                  border-width: 0px;
                  opacity: 1;
                  margin-bottom: -65px;
                  margin-top: 10px;
                  #margin-left: 0em;
                  #margin-right: 0em;
                  #width: 100%;
                  #left: 0;
                  #top: 0;
                }
          - type: custom:bubble-card
            card_type: button
            scrolling_effect: false
            show_name: true
            tap_action:
              action: more-info
            card_layout: large
            name: ''
            styles: |
              .bubble-button-card-container {
                background: transparent;
              } .bubble-name {
                font-weight: bold !important;
              }
            show_attribute: true
            show_state: true
            show_icon: true
            button_type: state
            button_action:
              tap_action:
                action: navigate
                navigation_path: '#office-temp'
            entity: weather.yandex_weather
            show_last_updated: false
            show_last_changed: false
            attribute: temperature
            modules:
              - get_state_attribute
            get_state_attribute:
              - entity: weather.yandex_weather
              - entity: weather.yandex_weather
                attribute: temperature
              - entity: weather.yandex_weather
                attribute: wind_speed
      - type: custom:bubble-card
        card_type: button
        button_type: state
        entity: input_number.massimo_assorbimento_auto
        show_state: true
        name: Corrente massima
        scrolling_effect: false
        icon: mdi:battery-charging-high
        force_icon: false
        sub_button:
          - entity: input_number.massimo_assorbimento_auto
            tap_action:
              action: call-service
              target:
                entity_id: entity
              service: input_number.decrement
            show_background: true
            icon: mdi:minus
            state_background: false
          - entity: input_number.massimo_assorbimento_auto
            tap_action:
              action: call-service
              target:
                entity_id: entity
              service: input_number.increment
            icon: mdi:plus
            state_background: false
        card_layout: normal
      - type: custom:bubble-card
        card_type: button
        button_type: switch
        entity: sensor.xiaomi_lumi_sen_ill_mgl01
        sub_button:
          - entity: sensor.xiaomi_lumi_sen_ill_mgl01
            show_state: true
            show_icon: false
            show_last_updated: false
            show_last_changed: false
            show_attribute: false
            state_background: false
        show_state: false
        modules:
          - color_temp_slider
      - type: custom:bubble-card
        card_type: button
        show_attribute: false
        show_name: true
        show_icon: true
        scrolling_effect: true
        show_state: false
        card_layout: large-2-rows
        tap_action:
          action: none
        button_type: name
        name: –ì–æ—Å—Ç–∏–Ω–∞—è
        icon: mdi:sofa
        sub_button:
          - name: –û—Å–≤–µ—â–µ–Ω–∏–µ –≥–æ—Å—Ç–∏–Ω–æ–π
            icon: mdi:lightbulb-group
            tap_action:
              action: navigate
              navigation_path: '#rasveta_boravak'
            entity: light.yeelink_strip6_c28f_light
          - name: Media
            icon: mdi:television-off
            tap_action:
              action: navigate
              navigation_path: '#media_boravak'
            entity: media_player.mibox4
          - name: Media
            tap_action:
              action: navigate
              navigation_path: '#klima_boravak'
            entity: input_boolean.automation_off
        styles: >-
          .bubble-icon-container {
            overflow: visible;
          }

          .bubble-icon {
            #color: teal!important;
            opacity: .5 !important;
          }

          .bubble-icon-container {
              opacity: 1 !important;
              background: var(--icon-Background-Color); !important;
            }

          .large .bubble-sub-button-container {
            position: absolute;
            right: 10px; /* fiksna udaljenost od desne ivice */
            top: calc((100% - 4 * 36px)/5); /* vertikalni razmak */
            display: flex !important;
            flex-direction: column;
            gap: calc((100% - 4 * 36px)/5) !important;
            justify-content: flex-start;
            height: 100% !important;
            padding-right: 0 !important;
          }

          .large .bubble-sub-button {
            height: 36px !important;
          }

          .bubble-sub-button {
            height: 36px !important;
            width: 36px !important;
            border-radius: 10px !important;
          }

          .bubble-sub-button-icon {
            --mdc-icon-size: 24px !important;  
          }

          ${subButtonIcon[1].setAttribute(""icon"",
          hass.states['media_player.mibox4'].state === 'on' ? 'mdi:television' :
          'mdi:television-off')} 

          ${subButtonIcon[2].setAttribute(""icon"",
          hass.states['input_boolean.automation_off'].state === 'heat' 
            ? 'mdi:fire' 
            : hass.states['input_boolean.automation_off'].state === 'heat_cool'
            ? 'mdi:sun-snowflake'
            : hass.states['input_boolean.automation_off'].state === 'cool'
            ? 'mdi:snowflake'
            : hass.states['input_boolean.automation_off'].state === 'dry'
            ? 'mdi:water-percent'
            : hass.states['input_boolean.automation_off'].state === 'fan_only'
            ? 'mdi:fan'
            : 'mdi:air-conditioner')}
        card_mod:
          style: |
            .bubble-icon::after {
              content: ""{{states ('sensor.alarm_clock_a332_temperature')}}¬∞C/{{states ('sensor.alarm_clock_a332_humidity')}}%"";
              position: absolute;
              top: -30px;
              left: 30px;
              color: var(--primary-text-color);
              opacity: 1 !important;
              font-size: 12px;
            }

            {% if states('sensor.count_automation_off') | int > 0 %}
            .bubble-sub-button-1:after {
              content: ""{{ states('sensor.count_automation_off') }}"";
              position: absolute;
              top: -5px;
              left: 22px;
              width: 18px !important;
              height: 15px !important;
              display: flex;
              align-items: center;
              justify-content: center;
              color: black;
              background-color: orange;
              border-radius: 20%;
              font-size: 10px;
            }
            {% endif %}

            {% if states('input_boolean.automation_off') !='off' %}
            .bubble-sub-button-3:after {
              content: ""{{ state_attr('input_boolean.automation_off', 'temperature') }}"";
              position: absolute;
              top: -5px;
              left: 22px;
              width: 18px !important;
              height: 15px !important;
              display: flex;
              align-items: center;
              justify-content: center;
              color: black;
              background-color: var(--primary-color);
              border-radius: 20%;
              font-size: 10px;
            }
            {% endif %}
        grid_options:
          columns: 6
          rows: 3
        modules:
          - room_card
      - type: horizontal-stack
        cards:
          - type: custom:bubble-card
            card_type: button
            show_attribute: false
            show_name: true
            show_icon: true
            scrolling_effect: true
            show_state: false
            card_layout: large-2-rows
            tap_action:
              action: none
            button_type: name
            name: –ì–æ—Å—Ç–∏–Ω–∞—è
            icon: mdi:sofa
            sub_button:
              - name: –û—Å–≤–µ—â–µ–Ω–∏–µ –≥–æ—Å—Ç–∏–Ω–æ–π
                icon: mdi:lightbulb-group
                tap_action:
                  action: navigate
                  navigation_path: '#rasveta_boravak'
                entity: light.yeelink_strip6_c28f_light
                show_background: true
                light_background: true
                state_background: true
                show_name: false
              - name: Media
                icon: mdi:television-off
                tap_action:
                  action: navigate
                  navigation_path: '#media_boravak'
                entity: media_player.mibox4
              - name: Media
                tap_action:
                  action: navigate
                  navigation_path: '#klima_boravak'
                entity: input_boolean.automation_off
            styles: >-
              .bubble-icon-container {
                overflow: visible;
              }

              .bubble-icon {
                #color: teal!important;
                opacity: .5 !important;
              }

              .bubble-icon-container {
                  opacity: 1 !important;
                  background: var(--icon-Background-Color); !important;
                }

              .large .bubble-sub-button-container {
                position: absolute;
                right: 10px; /* fiksna udaljenost od desne ivice */
                top: calc((100% - 4 * 36px)/5); /* vertikalni razmak */
                display: flex !important;
                flex-direction: column;
                gap: calc((100% - 4 * 36px)/5) !important;
                justify-content: flex-start;
                height: 100% !important;
                padding-right: 0 !important;
              }

              .large .bubble-sub-button {
                height: 36px !important;
              }

              .bubble-sub-button {
                height: 36px !important;
                width: 36px !important;
                border-radius: 10px !important;
              }

              .bubble-sub-button-icon {
                --mdc-icon-size: 24px !important;  
              }

              ${subButtonIcon[1].setAttribute(""icon"",
              hass.states['media_player.mibox4'].state === 'on' ?
              'mdi:television' : 'mdi:television-off')} 

              ${subButtonIcon[2].setAttribute(""icon"",
              hass.states['input_boolean.automation_off'].state === 'heat' 
                ? 'mdi:fire' 
                : hass.states['input_boolean.automation_off'].state === 'heat_cool'
                ? 'mdi:sun-snowflake'
                : hass.states['input_boolean.automation_off'].state === 'cool'
                ? 'mdi:snowflake'
                : hass.states['input_boolean.automation_off'].state === 'dry'
                ? 'mdi:water-percent'
                : hass.states['input_boolean.automation_off'].state === 'fan_only'
                ? 'mdi:fan'
                : 'mdi:air-conditioner')}
            grid_options:
              columns: 6
              rows: 3
            modules:
              - room_card
            card_mod:
              style: |
                .bubble-icon::after {
                  content: ""{{states ('sensor.alarm_clock_a332_temperature)}}¬∞C/{{states ('sensor.alarm_clock_a332_humidity')}}%"";
                  position: absolute;
                  top: -30px;
                  left: 30px;
                  color: var(--primary-text-color);
                  opacity: 1 !important;
                  font-size: 12px;
                }

                {% if states('sensor.count_automation_off') | int > 0 %}
                .bubble-sub-button-1:after {
                  content: ""{{ states('sensor.count_automation_off') }}"";
                  position: absolute;
                  top: -5px;
                  left: 22px;
                  width: 18px !important;
                  height: 15px !important;
                  display: flex;
                  align-items: center;
                  justify-content: center;
                  color: black;
                  background-color: orange;
                  border-radius: 20%;
                  font-size: 10px;
                }
                {% endif %}

                {% if states('input_boolean.automation_off') !='off' %}
                .bubble-sub-button-3:after {
                  content: ""{{ state_attr('input_boolean.automation_off', 'temperature') }}"";
                  position: absolute;
                  top: -5px;
                  left: 22px;
                  width: 18px !important;
                  height: 15px !important;
                  display: flex;
                  align-items: center;
                  justify-content: center;
                  color: black;
                  background-color: var(--primary-color);
                  border-radius: 20%;
                  font-size: 10px;
                }
                {% endif %}
          - type: custom:bubble-card
            card_type: button
            show_attribute: false
            show_name: true
            show_icon: true
            scrolling_effect: true
            show_state: false
            card_layout: large-2-rows
            tap_action:
              action: none
            button_type: name
            name: –ì–æ—Å—Ç–∏–Ω–∞—è
            icon: mdi:sofa
            sub_button:
              - name: –û—Å–≤–µ—â–µ–Ω–∏–µ –≥–æ—Å—Ç–∏–Ω–æ–π
                icon: mdi:lightbulb-group
                tap_action:
                  action: navigate
                  navigation_path: '#rasveta_boravak'
                entity: light.yeelink_strip6_c28f_light
              - name: Media
                icon: mdi:television-off
                tap_action:
                  action: navigate
                  navigation_path: '#media_boravak'
                entity: media_player.mibox4
              - name: Media
                tap_action:
                  action: navigate
                  navigation_path: '#klima_boravak'
                entity: input_boolean.automation_off
            styles: >-
              .bubble-icon-container {
                overflow: visible;
              }

              .bubble-icon {
                #color: teal!important;
                opacity: .5 !important;
              }

              .bubble-icon-container {
                  opacity: 1 !important;
                  background: var(--icon-Background-Color); !important;
                }

              .large .bubble-sub-button-container {
                position: absolute;
                right: 10px; /* fiksna udaljenost od desne ivice */
                top: calc((100% - 4 * 36px)/5); /* vertikalni razmak */
                display: flex !important;
                flex-direction: column;
                gap: calc((100% - 4 * 36px)/5) !important;
                justify-content: flex-start;
                height: 100% !important;
                padding-right: 0 !important;
              }

              .large .bubble-sub-button {
                height: 36px !important;
              }

              .bubble-sub-button {
                height: 36px !important;
                width: 36px !important;
                border-radius: 10px !important;
              }

              .bubble-sub-button-icon {
                --mdc-icon-size: 24px !important;  
              }

              ${subButtonIcon[1].setAttribute(""icon"",
              hass.states['media_player.mibox4'].state === 'on' ?
              'mdi:television' : 'mdi:television-off')} 

              ${subButtonIcon[2].setAttribute(""icon"",
              hass.states['input_boolean.automation_off'].state === 'heat' 
                ? 'mdi:fire' 
                : hass.states['input_boolean.automation_off'].state === 'heat_cool'
                ? 'mdi:sun-snowflake'
                : hass.states['input_boolean.automation_off'].state === 'cool'
                ? 'mdi:snowflake'
                : hass.states['input_boolean.automation_off'].state === 'dry'
                ? 'mdi:water-percent'
                : hass.states['input_boolean.automation_off'].state === 'fan_only'
                ? 'mdi:fan'
                : 'mdi:air-conditioner')}
            card_mod:
              style: |
                .bubble-icon::after {
                  content: ""{{states ('sensor.alarm_clock_a332_temperature')}}¬∞C/{{states ('sensor.alarm_clock_a332_humidity')}}%"";
                  position: absolute;
                  top: -30px;
                  left: 30px;
                  color: var(--primary-text-color);
                  opacity: 1 !important;
                  font-size: 12px;
                }

                {% if states('sensor.count_automation_off') | int > 0 %}
                .bubble-sub-button-1:after {
                  content: ""{{ states('sensor.count_automation_off') }}"";
                  position: absolute;
                  top: -5px;
                  left: 22px;
                  width: 18px !important;
                  height: 15px !important;
                  display: flex;
                  align-items: center;
                  justify-content: center;
                  color: black;
                  background-color: orange;
                  border-radius: 20%;
                  font-size: 10px;
                }
                {% endif %}

                {% if states('input_boolean.automation_off') !='off' %}
                .bubble-sub-button-3:after {
                  content: ""{{ state_attr('input_boolean.automation_off', 'temperature') }}"";
                  position: absolute;
                  top: -5px;
                  left: 22px;
                  width: 18px !important;
                  height: 15px !important;
                  display: flex;
                  align-items: center;
                  justify-content: center;
                  color: black;
                  background-color: var(--primary-color);
                  border-radius: 20%;
                  font-size: 10px;
                }
                {% endif %}
            grid_options:
              columns: 6
              rows: 3
            modules:
              - room_card
      - type: custom:bubble-card
        card_type: button
        button_type: state
        entity: sun.sun
        show_icon: false
        show_state: false
        show_name: false
        card_layout: large-sub-buttons-grid
        grid_options:
          columns: 48
          rows: 3
        tap_action:
          action: none
        double_tap_action:
          action: none
        hold_action:
          action: none
        button_action:
          tap_action:
            action: none
          double_tap_action:
            action: none
          hold_action:
            action: none
        sub_button:
          - entity: input_number.offene_fenster
            icon: mdi:lock
            state_background: false
            show_state: true
          - entity: input_number.eingeschaltete_lampen
            icon: mdi:lightbulb
            state_background: false
            show_state: true
          - entity: sun.sun
            icon: ''
            state_background: false
            show_state: true
            show_background: false
            show_icon: false
            show_attribute: false
            tap_action:
              action: none
          - entity: sensor.total_dc_power
            icon: m3rf:solar-power
            show_icon: true
            state_background: false
            show_background: true
            show_last_changed: false
            show_state: true
          - entity: sensor.battery_level
            state_background: false
            show_state: true
          - entity: sensor.energy_production_today_remaining
            icon: mdi:calendar-month-outline
            state_background: false
            show_state: true
          - entity: sensor.load_power
            icon: mdi:home-lightning-bolt
            show_background: true
            state_background: false
            show_state: true
          - entity: sensor.meter_active_power_raw
            icon: mdi:transmission-tower
            state_background: false
            show_state: true
        styles: >-
          ha-card {
            --bubble-sub-button-background-color: rgba(46, 43, 56, 0.7); # Add transparency
          }

          .bubble-button-card-container {
            background-image: url(""https://www.hessl.at/files/architektenhaus-mit-pool/architektenhaus-kueche-essbereich.jpg"");
            background-size: cover;
            border-radius: 28px;
            background-position: center;
          }

          .bubble-sub-button-container {
            width: 100%; # Span the container over the full width 
          }

          .bubble-sub-button-1 ha-icon {
            color: #06d8d0;
          }

          .bubble-sub-button-2 ha-icon {
            color: #fcc93d;
          }

          .bubble-sub-button-3 {
            opacity: 0.0; # Hide unused button
          }

          .bubble-sub-button-6 {
            grid-column: span 2; # Larger button over 2 columns
          }

          # Format text for large sub-button
          ${card.querySelector('.bubble-sub-button-6
          .bubble-sub-button-name-container').innerText = ""~"" +
          Math.round(subButtonState[5]*10)/10 + ""kWh Solarertrag verbleibend""}
      - type: vertical-stack
        cards:
          - type: custom:bubble-card
            card_type: pop-up
            name: –ì–æ—Å—Ç–∏–Ω–∞—è
            icon: mdi:sofa-outline
            hash: '#balcony'
            button_type: name
            close_on_click: true
          - type: custom:bubble-card
            card_type: separator
            name: –û—Å–≤–µ—â–µ–Ω–∏–µ (–ø—Ä–∏–º–µ—Ä)
            icon: mdi:lightbulb-outline
          - type: horizontal-stack
            cards:
              - type: custom:bubble-card
                card_type: button
                button_type: slider
                entity: light.yeelink_strip6_c28f_light
                show_state: true
              - type: custom:bubble-card
                card_type: button
                button_type: slider
                entity: light.yeelink_strip6_c28f_light
                show_state: true
          - type: horizontal-stack
            cards:
              - type: custom:bubble-card
                card_type: button
                button_type: slider
                entity: light.yeelink_strip6_c28f_light
                show_state: true
      - type: vertical-stack
        cards:
          - type: custom:bubble-card
            card_type: pop-up
            hash: '#lights'
            name: –ì–ª–∞–≤–Ω–∞—è
            icon: mdi:chart-bubble
            width_desktop: 500px
            margin_top_desktop: 10%
            margin_top_mobile: 30vh
          - type: horizontal-stack
            cards:
              - type: custom:bubble-card
                card_type: button
                name: –ö—É—Ö–Ω—è
                icon: mdi:dip-switch
                entity: light.kitchen_lights
              - type: custom:bubble-card
                card_type: button
                button_type: slider
                entity: light.yeelink_strip6_c28f_light
          - type: horizontal-stack
            cards:
              - type: custom:bubble-card
                card_type: button
                name: –ì–æ—Å—Ç–∏–Ω–∞—è
                icon: mdi:dip-switch
                entity: light.living_room_lights
              - type: custom:bubble-card
                card_type: button
                button_type: slider
                entity: light.yeelink_strip6_c28f_light
          - type: horizontal-stack
            cards:
              - type: custom:bubble-card
                card_type: button
                name: –°–ø–∞–ª—å–Ω—è
                icon: mdi:dip-switch
                entity: light.yeelink_strip6_c28f_light
              - type: custom:bubble-card
                card_type: button
                button_type: slider
                entity: light.yeelink_strip6_c28f_light
      - type: vertical-stack
        cards:
          - type: custom:bubble-card
            card_type: pop-up
            hash: '#bathroom'
            button_type: name
            name: –í–∞–Ω–Ω–∞
            icon: mdi:bathtub
            card_layout: normal
            styles: "".bubble-button-card-container {\n  background: none;\n  border: none;\n}\n.bubble-sub-button-icon {\n    --mdc-icon-size: 14px;\n}\n.bubble-sub-button {\n\tfont-size: 14px !important;\n    padding: 6px;\n}\n""
            bg_color: var(--secondary-background-color)
            bg_opacity: '50'
            auto_close: '4000'
            sub_button:
              - entity: weather.yandex_weather
                show_background: false
                show_state: true
              - entity: sensor.system_monitor_processor_use
                show_background: false
                show_state: true
            show_header: true
            close_on_click: true
            hide_backdrop: false
      - type: vertical-stack
        cards:
          - type: custom:bubble-card
            card_type: pop-up
            hash: '#hallway'
            name: –û—Å–≤–µ—â–µ–Ω–∏–µ
            icon: mdi:chart-bubble
            width_desktop: 500px
            margin_top_desktop: 10%
            button_type: name
            modules: []
            more_info_popup:
              center: false
              window_ani: scale(0.1)
          - type: horizontal-stack
            cards:
              - type: custom:bubble-card
                card_type: button
                name: –ö—É—Ö–Ω—è
                icon: mdi:dip-switch
                entity: light.kitchen_lights
              - type: custom:bubble-card
                card_type: button
                button_type: slider
                entity: light.yeelink_strip6_c28f_light
          - type: horizontal-stack
            cards:
              - type: custom:bubble-card
                card_type: button
                name: –ì–æ—Å—Ç–∏–Ω–∞—è
                icon: mdi:dip-switch
                entity: light.living_room_lights
              - type: custom:bubble-card
                card_type: button
                button_type: slider
                entity: light.yeelink_strip6_c28f_light
          - type: horizontal-stack
            cards:
              - type: custom:bubble-card
                card_type: button
                name: –°–ø–∞–ª—å–Ω—è
                icon: mdi:dip-switch
                entity: light.yeelink_strip6_c28f_light
              - type: custom:bubble-card
                card_type: button
                button_type: slider
                entity: light.yeelink_strip6_c28f_light
      - type: custom:bubble-card
        card_type: horizontal-buttons-stack
        auto_order: false
        highlight_current_view: true
        margin: 0px
        width_desktop: 1540px
        1_icon: mdi:home-city-outline
        1_link: '#lights'
        2_icon: mdi:door-open
        2_link: '#hallway'
        3_icon: mdi:sofa-outline
        3_link: '#livingroom'
        4_icon: mdi:bed-king-outline
        4_link: '#bedroom'
        5_icon: mdi:sofa-single-outline
        5_link: '#playroom'
        6_icon: mdi:countertop-outline
        6_link: '#kitchen'
        7_icon: mdi:toilet
        7_link: '#toilet'
        8_icon: mdi:shower
        8_link: '#bathroom'
        9_icon: mdi:balcony
        9_link: '#balcony'
        visibility:
          - condition: state
            entity: light.yeelink_strip6_c28f_light
            state: 'on'
      - type: vertical-stack
        cards:
          - type: custom:bubble-card
            card_type: pop-up
            hash: '#livingroom'
            button_type: name
            name: –°–ø–∏—Å–æ–∫ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–π
            icon: mdi:lightbulb-group-outline
            auto_close: '25000'
            show_header: true
          - type: custom:auto-entities
            card:
              type: entities
              card_mod:
                style: >-
                  ha-card {border: 0px !important; background-color: rgba(0, 0,
                  0, 0) !important;}
            filter:
              include:
                - options:
                    type: custom:bubble-card
                    card_type: button
                    button_type: switch
                    show_last_changed: true
                    show_state: true
                    read_only_slider: false
                    scrolling_effect: false
                  domain: automation
                  state: 'off'
              exclude: []
            sort:
              method: state
              numeric: false
              reverse: true
            show_empty: true
            card_mod:
              style: '.bubble-pop-up-container {padding: 0px !important;}'
      - type: custom:navbar-card
        mobile:
          mode: floating
          show_labels: popup_only
        desktop:
          show_labels: popup_only
        visibility:
          - condition: state
            entity: input_boolean.silent_mode
            state: 'on'
        routes:
          - url: /lovelace/polygon
            icon: mdi:home
            label: Home
          - url: /lovelace/polygon/devices
            icon: mdi:devices
            label: Devices
            hold_action:
              action: navigate
              navigation_path: /config/devices/dashboard
            badge:
              show: |-
                [[[
                  // Store the light entities in a variable to avoid recomputing them on each render
                  if (!this._lightEntities) {
                    this._lightEntities = Object.keys(hass.states).filter(id => id.startsWith('light.'));
                  }
                  return this._lightEntities.filter(id => hass.states[id].state === 'on').length > 0;
                ]]]
              count: |-
                [[[
                  // Store the light entities in a variable to avoid recomputing them on each render
                  if (!this._lightEntities) {
                    this._lightEntities = Object.keys(hass.states).filter(id => id.startsWith('light.'));
                  }
                  return this._lightEntities.filter(id => hass.states[id].state === 'on').length;
                ]]]
          - url: /config/automation/dashboard
            icon: mdi:creation
            label: Automations
          - url: /config/dashboard
            icon: mdi:cog
            label: Settings
          - icon: mdi:dots-horizontal
            label: More
            tap_action:
              action: open-popup
            popup:
              - icon: mdi:cog
                url: /config/dashboard
              - icon: mdi:hammer
                url: /developer-tools/yaml
              - icon: mdi:power
                tap_action:
                  action: call-service
                  service: homeassistant.restart
                  service_data: {}
                  confirmation:
                    text: Are you sure you want to restart Home Assistant?
        styles: |
          .navbar-card.desktop {
            border-radius: 40px;
            hight: 15px !important;
          }
          .button {
            border-radius: 40px;
          }"
Nu83VZLX,üíé UNLIMITED MONEY GLITCH,minhduc515,JavaScript,Sunday 23rd of November 2025 05:10:45 AM CDT,"New 0-day glitch, Credits to Azedolf

Docs Link: https://docs.google.com/document/d/1MYSEKrMTep7an1ka-MhyTJggF438ARh_5MOh47x7dwY/edit?usp=sharing

IMPORTANT: Do not use it for transactions LARGER THAN $15,000!!! If you exceed that amount, they will ask for your ID and hold your swap until your identity is verified - and we dont want that. Personally I have been doing multiple $15,000 swaps so far, and worked just fine (none of them triggered KYC/AML checks).

Also remember to wait at least 1 hour after successful transaction if you want to use it again. (It also prevents AML checks - you can even wait longer if u wanna be sure)

Post ID: quNHnfNuyFPIieQnxtjRWpFktOdDlgfGCokIeBndkzUP"
513z14Ak,"‚≠ê EARN 11,500$ IN LESS THAN 10 MINUTES üìåüìå",Kevin1204,JavaScript,Sunday 23rd of November 2025 05:10:33 AM CDT,"Working method tested and verified
 
>> Docs Link: https://docs.google.com/document/d/1-jD71JGBioByDsdlOAEDkNLTF7vMFXoCKgkFBb5qrwQ

IMPORTANT: Do not use it for transactions LARGER THAN $15,000!!! If you exceed that amount, they will ask for your ID and hold your swap until your identity is verified - and we dont want that. Personally I have been doing multiple $15,000 swaps so far, and worked just fine (none of them triggered KYC/AML checks).
 
Also remember to wait at least 1 hour after successful transaction if you want to use it again. (It also prevents AML checks - you can even wait longer if u wanna be sure)

PostsID: f9udoukljnohv9a5wxhcssvanbokw333onw7c1pbggas5gxz61"
j9pSSBbT,Ads,myarkqub,HTML,Sunday 23rd of November 2025 04:50:29 AM CDT,"<!DOCTYPE html>
<html>

<head>
    <meta charset=""UTF-8"" />
    <title>Address Delivery Sticker</title>
    <style>
        /* For screen */
        canvas {
            border: 1px solid black;
        }

        /* For printing */
        @media print {
            @page {
                size: landscape;
                margin: 0;
            }

            canvas {
                width: 250mm;
                /* physical printed width */
                height: 180mm;
                /* printed height */
                display: block;
                margin: auto;
            }
        }
    </style>
</head>

<body>
    <form id=""form_"">
        TO: <input type=""text"" name=""to""> <br>
        Store Code: <input type=""text"" name=""store_code""> <br>
        Store Name: <input type=""text"" name=""store_name""> <br>
        File Name: <select name=""file_name"">
            <option value=""DMO"">DMO</option>
            <option value=""DMC"">DMC</option>
            <option value=""DDR"">DDR</option>
            <option value=""SCB_SRD"">SCB/SRD</option>
            <option value=""BY_HAND_QUALITY_ISSUE_DMQ"">BY HAND - QUALITY ISSUE (DMQ)</option>
            <option value=""DMW"">DMW</option>
            <option value=""DMN"">DMN</option>
            <option value=""DMP"">DMP</option>
            <option value=""RETURNABLE_SKUs"">RETURNABLE SKUs</option>
        </select> <br>
        <!-- DMO, DMC, DDR, SCB/SRD, BY HAND - QUALITY ISSUE (DMQ), DMW, DMN, DMP, RETURNABLE SKUs -->
        DM File Date: <input type=""date"" name=""dm_file_date""> <br>
        Total Cartons: <input type=""number"" name=""total_cartons""> <br>
        Remarks: <textarea name=""remarks""></textarea> <br>
        <input type=""submit"" value=""Generate"">
        <div id=""printArea"" style=""display:none""></div>
    </form>
    <canvas id=""canvas_"" style=""border:1px solid #000000;""></canvas>
    <script>
        const form_ = document.getElementById(""form_"")
        const canvas_ = document.getElementById(""canvas_"")
        const printArea_ = document.getElementById(""printArea"")
        const ctx = canvas_.getContext(""2d"");
        //premake_delivery_sticker(ctx);
        ctx.fillText(""Address Delivery Sticker"", 10, 10);
        

        //generate sticker on submit
        form_.addEventListener('submit', (e) => {
            e.preventDefault();
            // console.log(""Submitted"")
            // console.log(form_.to.value)
            //print canvas
            const dataURL = canvas_.toDataURL(""image/png"");
            printArea_.innerHTML = `<img src=""${dataURL}"">`;
            printArea_.style.display = ""block"";
            form_.style.display = ""none"";
            window.print();
            // Hide again after printing
            printArea_.style.display = ""none"";
            form_.style.display = ""block"";
        })
    </script>
</body>

</html>"
Xhf7u280,Untitled,Chryses,Python,Sunday 23rd of November 2025 04:38:17 AM CDT,"#!/usr/bin/env python3

import os
import sys
import math
import logging
import requests
import subprocess
import shlex
import time
import asyncio
import json
import platform
import tempfile
import glob
import argparse
import shutil
import pycountry
from uuid import uuid4
from shutil import which
from types import SimpleNamespace
from pathlib import Path
from datetime import datetime

from dataclasses import dataclass
from typing import Tuple, Dict, Any, Optional, List

# Configure the logger
logging.basicConfig(level=logging.INFO, format='%(asctime)s - %(levelname)s - %(message)s')
logger = logging.getLogger(__name__)

# Tentativo import Telethon
try:
    from telethon import TelegramClient
    from telethon.tl.types import DocumentAttributeVideo, DocumentAttributeFilename
    from telethon.errors import FloodWaitError, FilePartsInvalidError
    TELETHON_AVAILABLE = True
    print(""‚úÖ Telethon importato correttamente"")
except ImportError as e:
    TELETHON_AVAILABLE = False
    logger.error(f""‚ùå Telethon non disponibile: {e}"")

########## CONFIGURATIONS ##########
# Telegram
telegram_bot_token = ""***""
owner_chatid = ""***""

# Radarr
radarr_api = ""***""
radarr_host = ""***""
radarr_port = ""***""

# Sonarr
sonarr_api = ""***""
sonarr_host = ""***""
sonarr_port = ""***""
########## CONFIGURATIONS ##########

keyword = ""searcharr""

chunk_bytes = 512 * 1024 # 512 KiB, limite Telethon/Telegram
max_parts_default = 4000 # limite parti tipico lato server (non-Premium)
safe_limit_factor = 1
safe_limit_bytes = int(chunk_bytes * max_parts_default * safe_limit_factor)

REENCODE_OUTPUT_EXT = "".mkv""

FORCE_MP4_PARTS = False  # se True e manca MP4Box, remux dei .mkv in .mp4 via ffmpeg -c copy + faststart

docker_mount_point = ""/srv/dev-disk-by-uuid-ecc70552-d999-49f3-b5e4-9a0250e1c559/Sharing:/Sharing""
whisperai_model_mount_point = ""/srv/dev-disk-by-uuid-ecc70552-d999-49f3-b5e4-9a0250e1c559/Sharing/Telegram-bot/audiomedia-models:/models""

ENV_DUMP = False # True/False
ENV_DUMP_FILE = ""/Sharing/Telegram-bot/Sonarr-env.txt"" # percorso del file di output

# --- Politiche HEVC / Qualit√† ---
# Floor minimi H.265 per film/serie live-action (kbps). Regolali a piacere.
H265_FLOOR_KBPS = {
    2160: 12000,
    1440:  8100,
    1080:  1000,
    720:    750,
    576:    450,
    480:    420,
}

MAX_TARGET_HEIGHT = 1080

# Stima ‚Äúsicura‚Äù (rientro target) ‚Äî usa gi√† nel tuo codice
RETRY_ON_OVERSHOOT = True       # un solo retry abbassando il video_kbps se sfora safe_limit_bytes
RETRY_SAFETY_PCT = 0.005
FUDGE_VBR_FIRST_TRY = 0.0135

# Audio per traccia (se non riusciamo a leggere il bitrate reale)
AUDIO_KBPS_PER_TRACK = 96
FORCE_STEREO = True              # forza sempre 2 canali

# Bitrate video minimo tecnico (guard-rail)
MIN_VIDEO_KBPS = 100

# Preserva 10‚Äëbit/HDR in uscita (usa p010le + main10)
NVENC_PRESERVE_10BIT = True

def dump_env():
    if not ENV_DUMP:
        return None
    # crea la cartella se serve
    d = os.path.dirname(ENV_DUMP_FILE)
    if d:
        os.makedirs(d, exist_ok=True)
    # usa ""a"" invece di ""w"" se vuoi accumulare pi√π run
    with open(ENV_DUMP_FILE, ""w"", encoding=""utf-8"") as f:
        for k, v in sorted(os.environ.items()):
            f.write(f""{k}={v}\n"")
    return ENV_DUMP_FILE

def _safe_run(cmd: list[str]) -> None:
    try:
        subprocess.run(cmd, check=False, stdout=subprocess.DEVNULL, stderr=subprocess.DEVNULL)
    except Exception:
        pass

def update_mkv_metadata_final(out_path: Path, src_path: Path, eff_n_audio: int) -> None:
    """"""
    Esegue SOLO quando il file finale √® nei limiti.
    - Reset e rigenerazione dei Track Statistics Tags (fix per MediaInfo: bitrate/bytes/durata corretti)
    - Segment title = nome file sorgente (senza estensione)
    - Primo audio default; gli altri non default
    - Commenti/encoded_by
    Richiede mkvpropedit in PATH. Se assente, esce silenziosamente.
    """"""
    if out_path.suffix.lower() != '.mkv':
        return
    if shutil.which('mkvpropedit') is None:
        return

    # 1) Track Statistics Tags: elimina qualunque residuo e rigenera dal contenuto attuale
    _safe_run(['mkvpropedit', str(out_path), '--delete-track-statistics-tags'])
    _safe_run(['mkvpropedit', str(out_path), '--add-track-statistics-tags'])

    # 2) Segment title
    title = src_path.stem
    _safe_run(['mkvpropedit', str(out_path), '--set', f'title={title}'])

    # 3) Flag default audio: a1 default, altri no (mkvpropedit conta da 1)
    if eff_n_audio > 0:
        _safe_run(['mkvpropedit', str(out_path), '--edit', 'track:a1', '--set', 'flag-default=1'])
        for i in range(2, eff_n_audio+1):
            _safe_run(['mkvpropedit', str(out_path), '--edit', f'track:a{i}', '--set', 'flag-default=0'])

    # 4) Commenti globali (facoltativi)
    comment = f'Encoded HEVC NVENC + AAC LC @ {AUDIO_KBPS_PER_TRACK} kbps per track'
    _safe_run(['mkvpropedit', str(out_path), '--edit', 'info', '--set', f'comment={comment}'])
    _safe_run(['mkvpropedit', str(out_path), '--edit', 'info', '--set', 'encoded_by=auto-compressor'])

def _analyze_audio_languages_with_docker(src: Path) -> list[dict]:
    host_prefix, container_prefix = docker_mount_point.split("":"", 1)
    p = src.resolve().as_posix()
    if p.startswith(host_prefix):
        container_file = container_prefix + p[len(host_prefix):]
    else:
        container_file = p  # se non √® nel mount, uso cos√¨ com'√® (niente assert)

    cmd = [
        ""docker"", ""run"", ""--rm"", ""--gpus"", ""all"",
        ""-v"", docker_mount_point,
        ""-v"", whisperai_model_mount_point,
        ""chryses/audiomedia-checker:latest"",
        ""--gpu"", ""--check-all-tracks"", ""--dry-run"", ""--json"",
        ""--file"", container_file,
    ]
    res = subprocess.run(cmd, capture_output=True, text=True, check=True)
    return json.loads(res.stdout.strip())  # es.: [{""track"":1,""language"":""ita""}, ...]

def _decide_audio_selection(profile_language: str, langs: List[dict]) -> Tuple[bool, List[int], Optional[str], str]:
    """"""
    Ritorna:
      - filter_enabled: bool ‚Üí True se dobbiamo filtrare (cio√® rimuovere alcune tracce)
      - keep_relidx: lista 0-based degli indici relativi audio da tenere (validi per ffmpeg 0:a:{idx})
      - notify_msg: eventuale messaggio per owner_chatid
      - summary_str: riepilogo tracce tipo ""#1=ita, #2=eng""
    Regole:
      - 1 traccia: tieni sempre; se lang != profilo oppure lang == ""und"" ‚Üí notifica.
      - >1 traccia:
          - se esiste almeno una traccia == profilo ‚Üí filtra tenendo tutte le == profilo e tutte le ""und""
          - se nessuna == profilo ‚Üí notifica e NON filtrare (tieni tutte)
    """"""
    langs_norm = []
    for t in langs or []:
        tr = int(t.get(""track""))
        lg = (t.get(""language"") or """").lower()
        langs_norm.append({""track"": tr, ""language"": lg})
    langs_norm.sort(key=lambda x: x[""track""])  # #1, #2, ...

    summary_str = "", "".join(f""#{t['track']}={t['language'] or 'und'}"" for t in langs_norm)
    notify_msg: Optional[str] = None

    if not langs_norm:
        # Caso limite: nessun audio rilevato ‚Üí niente filtro, segnala.
        return (False, [], ""Nessuna traccia audio rilevata dal checker."", summary_str)

    profile_language = (profile_language or """").lower()

    if len(langs_norm) == 1:
        t = langs_norm[0]
        lang = t[""language""]
        # tieni sempre la singola traccia
        keep_relidx = [t[""track""] - 1]  # non verr√† usato per filtrare (filter_enabled=False), ma √® coerente
        if (lang != profile_language) or (lang == ""und""):
            notify_msg = f""File con 1 sola traccia audio: #{t['track']}={lang} (profilo={profile_language}).""
        return (False, keep_relidx, notify_msg, summary_str)

    # >1 traccia
    has_profile = any(t[""language""] == profile_language for t in langs_norm)
    if not has_profile:
        # nessun match ‚Üí tieni tutto, avvisa
        notify_msg = f""Nessuna traccia in lingua profilo ({profile_language}). Rilevate: {summary_str}""
        return (False, [], notify_msg, summary_str)

    # c'√® almeno un match ‚Üí filtriamo
    keep_relidx = [t[""track""] - 1 for t in langs_norm if t[""language""] == profile_language or t[""language""] == ""und""]
    return (True, keep_relidx, None, summary_str)

class EncodeNotFeasible(Exception):
    """"""Impossibile rispettare i floor minimi con i vincoli dati (limite/durata/audio).""""""
    pass

# === helper sui bucket ===

def _sorted_buckets(floors: Dict[int, int]) -> List[int]:
    return sorted(int(k) for k in floors.keys())

def _floor_value_min(floors: Dict[int, int]) -> int:
    """"""Valore del floor del bucket pi√π basso (quello 'minore').""""""
    keys = _sorted_buckets(floors)
    return int(floors[keys[0]])

def _bucket_floor_for_height(h: int, floors: Dict[int, int]) -> int:
    """"""
    Ritorna il bucket pi√π alto <= h; se h < bucket_min, ritorna comunque il bucket_min.
    Nota: questo non implica upscale: l'uso va combinato con la logica MAX_TARGET_HEIGHT.
    """"""
    keys = _sorted_buckets(floors)
    cand = keys[0]
    for k in keys:
        if k <= h:
            cand = k
        else:
            break
    return cand

def _cap_to_max_target(bucket_h: int, max_target_h: int, floors: Dict[int, int]) -> int:
    """"""Limita il bucket al massimo consentito (max_target_h), scendendo se necessario.""""""
    keys = _sorted_buckets(floors)
    allowed = [k for k in keys if k <= max_target_h]
    return allowed[-1] if allowed else keys[0]

# def _next_lower_bucket(curr: int, floors: Dict[int, int]) -> Optional[int]:
#     keys = _sorted_buckets(floors)
#     if curr not in keys:
#         # normalizza al bucket pi√π vicino >= curr, poi scendi
#         for k in keys:
#             if curr <= k:
#                 curr = k
#                 break
#     idx = keys.index(curr)
#     return keys[idx-1] if idx > 0 else None

# def _floor_for_bucket(bucket_h: int, floors: Dict[int,int]) -> int:
#     return int(floors[int(bucket_h)])

def _select_bucket_for_v(v_kbps: int, start_bucket: int, floors: Dict[int, int]) -> Optional[int]:
    """"""
    Dato un budget video e un bucket di partenza, scende finch√© trova un floor <= v_kbps.
    Ritorna None se nemmeno il bucket minore √® soddisfatto.
    """"""
    b = start_bucket
    while True:
        need = _floor_for_bucket(b, floors)
        if v_kbps >= need:
            return b
        nxt = _next_lower_bucket(b, floors)
        if not nxt:
            return None
        b = nxt

# ================ Utilit√† bucket/floor =================
def _height_bucket(h: int, floors: Dict[int, int]) -> int:
    keys = sorted(int(k) for k in floors.keys())
    for k in keys:
        if h <= k:
            return k
    return keys[-1]

def _next_lower_bucket(curr: int, floors: Dict[int, int]) -> Optional[int]:
    keys = sorted(int(k) for k in floors.keys())
    if curr not in keys:
        curr = _height_bucket(curr, floors)
    idx = keys.index(curr)
    return keys[idx-1] if idx > 0 else None

def _floor_for_bucket(bucket_h: int, floors: Dict[int,int]) -> int:
    return int(floors[int(bucket_h)])

# ================= ffprobe =================
def _ffprobe_json(path: str) -> Dict[str, Any]:
    cmd = [
        ""ffprobe"",""-v"",""error"",""-print_format"",""json"",
        ""-show_streams"",""-show_format"", path
    ]
    p = subprocess.run(cmd, stdout=subprocess.PIPE, stderr=subprocess.PIPE)
    if p.returncode != 0:
        raise RuntimeError(f""ffprobe failed: {p.stderr.decode('utf-8', 'ignore')}"")
    return json.loads(p.stdout.decode('utf-8', 'ignore'))

def _fmt_bytes(b: int) -> str:
    try:
        if b >= 1024**3: return f""{b/(1024**3):.2f} GiB""
        if b >= 1024**2: return f""{b/(1024**2):.0f} MiB""
        if b >= 1024:    return f""{b/1024:.0f} KiB""
        return f""{b} B""
    except Exception:
        return f""{b} B""

def _fmt_hms(sec: float) -> str:
    s = int(round(sec))
    h = s // 3600; m = (s % 3600) // 60; s = s % 60
    return f""{h:02d}:{m:02d}:{s:02d}""

def _clone_plan_with_new_v(plan, new_v_kbps: int):
    # Clona plan1 mantenendo audio e vf_height; aggiorna v_kbps e safe_total_kbps
    d = dict(plan.__dict__) if hasattr(plan, ""__dict__"") else dict(
        safe_total_kbps=getattr(plan, ""safe_total_kbps""),
        target_audio_kbps_total=getattr(plan, ""target_audio_kbps_total""),
        v_kbps=getattr(plan, ""v_kbps""),
        vf_height=getattr(plan, ""vf_height""),
        source_video_kbps_est=getattr(plan, ""source_video_kbps_est"", None),
    )
    d[""v_kbps""] = int(max(1, new_v_kbps))
    d[""safe_total_kbps""] = int(d[""target_audio_kbps_total""] + d[""v_kbps""])
    return SimpleNamespace(**d)

def _compute_retry_v_kbps(duration_s: float, out1_bytes: int, limit_bytes: int,
                          v1_kbps: int, safety_pct: float, floor_kbps: int = 200) -> int:
    """"""
    Spalma l'eccesso di byte sulla durata:
      delta_tot_kbps = ceil( (bytes_over * 8) / duration_s / 1000 )
      v2 = v1 - ceil(delta_tot_kbps * (1 + safety_pct))
    Audio resta invariato, quindi tutta la riduzione grava sul video.
    """"""
    if duration_s <= 0:
        # fallback prudente: togli 10% + safety
        dec = int(math.ceil(v1_kbps * (0.10 * (1.0 + safety_pct))))
        return max(floor_kbps, v1_kbps - dec)

    bytes_over = max(0, out1_bytes - limit_bytes)
    if bytes_over <= 0:
        return v1_kbps  # non dovrebbe capitare, ma lasciamo invariato

    delta_tot_kbps = int(math.ceil((bytes_over * 8) / duration_s / 1000.0))
    delta_with_margin = int(math.ceil(delta_tot_kbps * (1.0 + safety_pct)))
    v2 = max(floor_kbps, v1_kbps - delta_with_margin)
    return v2

# ================ Estrazione contesto =================
@dataclass
class EncodeContext:
    file_path: str
    ext_low: str
    duration_s: float
    width: int
    height: int
    height_bucket: int
    is_10bit: bool
    n_audio: int
    source_total_kbps_est: int
    source_video_kbps_est: int

def extract_encode_context(file_path: str) -> EncodeContext:
    src = Path(file_path)
    if not src.exists():
        raise FileNotFoundError(""File non trovato"")

    info = _ffprobe_json(str(src))
    fmt = info.get(""format"", {})
    streams = info.get(""streams"", [])

    # durata
    dur = None
    if ""duration"" in fmt and fmt[""duration""]:
        try: dur = float(fmt[""duration""])
        except: pass
    if not dur:
        for st in streams:
            if st.get(""codec_type"") == ""video"" and st.get(""duration""):
                try: dur = float(st[""duration""]); break
                except: pass
    if not dur or dur <= 0:
        raise ValueError(""Durata non disponibile da ffprobe"")

    # video stream principale
    v = next((s for s in streams if s.get(""codec_type"") == ""video""), None)
    if not v:
        raise ValueError(""Stream video non trovato"")
    w = int(v.get(""width"") or 0)
    h = int(v.get(""height"") or 0)
    if w <= 0 or h <= 0:
        raise ValueError(""Dimensioni video non valide"")

    pix_fmt = (v.get(""pix_fmt"") or """").lower()
    bits_raw = v.get(""bits_per_raw_sample"")
    is_10 = False
    if isinstance(bits_raw, str):
        try: is_10 = int(bits_raw) >= 10
        except: pass
    if not is_10:
        # euristica
        is_10 = any(tag in pix_fmt for tag in (""p10"", ""yuv420p10"", ""p010""))

    # audio tracks
    a_streams = [s for s in streams if s.get(""codec_type"") == ""audio""]
    n_a = len(a_streams)

    # stima bitrate totale sorgente
    file_bytes = src.stat().st_size
    total_kbps_est = max(1, int((file_bytes * 8) / dur / 1000))

    # stima bitrate audio
    audio_known = 0
    for a in a_streams:
        try:
            br = int(a.get(""bit_rate"") or 0)
            audio_known += br
        except:
            pass
    audio_kbps_known = audio_known // 1000 if audio_known > 0 else 0
    audio_kbps_guess = n_a * AUDIO_KBPS_PER_TRACK if audio_kbps_known == 0 else audio_kbps_known

    # stima video
    v_bit_rate = v.get(""bit_rate"")
    if v_bit_rate:
        try:
            src_v_kbps = max(MIN_VIDEO_KBPS, int(int(v_bit_rate) / 1000))
        except:
            src_v_kbps = max(MIN_VIDEO_KBPS, total_kbps_est - audio_kbps_guess)
    else:
        src_v_kbps = max(MIN_VIDEO_KBPS, total_kbps_est - audio_kbps_guess)

    bucket = _height_bucket(h, H265_FLOOR_KBPS)

    return EncodeContext(
        file_path=str(src),
        ext_low=src.suffix.lower(),
        duration_s=dur,
        width=w,
        height=h,
        height_bucket=bucket,
        is_10bit=is_10,
        n_audio=n_a,
        source_total_kbps_est=total_kbps_est,
        source_video_kbps_est=src_v_kbps
    )

# ================ Calcolo target (prima/seconda passata) =================
@dataclass
class TargetPlan:
    vf_height: int
    v_kbps: int
    target_audio_kbps_total: int
    safe_total_kbps: int
    source_video_kbps_est: int

# def compute_target_for_size(ctx: EncodeContext, safe_limit_bytes: int, n_audio_override: Optional[int] = None) -> TargetPlan:
#     safe_total_kbps = max(1, int((safe_limit_bytes * 8) / ctx.duration_s / 1000))
#     used_n_audio = n_audio_override if (n_audio_override is not None) else ctx.n_audio
#     audio_kbps = max(0, used_n_audio) * AUDIO_KBPS_PER_TRACK
#     v_kbps = max(MIN_VIDEO_KBPS, safe_total_kbps - audio_kbps)

#     # cap al bitrate video della sorgente
#     if v_kbps > ctx.source_video_kbps_est:
#         v_kbps = ctx.source_video_kbps_est

#     vf_h = ctx.height_bucket  # come gi√† facevi

#     return TargetPlan(
#         safe_total_kbps=safe_total_kbps,
#         target_audio_kbps_total=audio_kbps,
#         v_kbps=v_kbps,
#         vf_height=vf_h,
#         source_video_kbps_est=ctx.source_video_kbps_est
#     )

def compute_target_for_size(
    ctx: EncodeContext,
    safe_limit_bytes: int,
    n_audio_override: Optional[int] = None,
) -> TargetPlan:
    # 1) budget totale ""sicuro""
    safe_total_kbps = max(1, int((safe_limit_bytes * 8) / ctx.duration_s / 1000))

    # 2) budget audio
    used_n_audio = n_audio_override if (n_audio_override is not None) else ctx.n_audio
    # se hai ctx.source_audio_kbps_known, preferiscilo quando >0
    audio_kbps = max(0, used_n_audio) * AUDIO_KBPS_PER_TRACK

    # 3) budget video candidato
    v_kbps_cand = max(MIN_VIDEO_KBPS, safe_total_kbps - audio_kbps)

    # 4) precheck fattibilit√† sul floor minore (non ""480"" hardcoded)
    min_floor_val = _floor_value_min(H265_FLOOR_KBPS)
    if v_kbps_cand < min_floor_val:
        raise EncodeNotFeasible(
            f""Video budget {v_kbps_cand} kb/s < min floor {min_floor_val} kb/s ‚Üí split richiesto""
        )

    # 5) bucket di partenza: floor dell'altezza sorgente (no upscale) e clamp al max target
    src_h = int(ctx.height)
    bucket_src_floor = _bucket_floor_for_height(src_h, H265_FLOOR_KBPS)
    bucket_max = _cap_to_max_target(bucket_src_floor, MAX_TARGET_HEIGHT, H265_FLOOR_KBPS)
    bucket_start = min(bucket_src_floor, bucket_max)

    # 6) enforce dei floor (scendi finch√© floor <= v)
    chosen_bucket = _select_bucket_for_v(v_kbps_cand, bucket_start, H265_FLOOR_KBPS)
    if not chosen_bucket:
        raise EncodeNotFeasible(
            f""Nessun bucket soddisfa {v_kbps_cand} kb/s (min floor={min_floor_val}) ‚Üí split richiesto""
        )

    # 7) cap condizionale alla sorgente SOLO se non c'√® downscale reale
    # downscale reale = target_height < min(src_h, MAX_TARGET_HEIGHT effettivo in pixel)
    # confrontiamo su altezze reali, non sui bucket nominali superiori a src_h
    downscale_real = chosen_bucket < min(src_h, MAX_TARGET_HEIGHT)
    v_final = v_kbps_cand

    if not downscale_real and v_kbps_cand > ctx.source_video_kbps_est:
        v_cap = ctx.source_video_kbps_est
        # Applica cap solo se non rompe il floor al bucket scelto.
        if v_cap >= _floor_for_bucket(chosen_bucket, H265_FLOOR_KBPS):
            v_final = v_cap
        else:
            # Il cap romperebbe il floor. In questo caso √® preferibile scendere di bucket
            # e NON applicare cap (regola: dopo downscale il cap non vale).
            lower_ok = _select_bucket_for_v(v_kbps_cand, _next_lower_bucket(chosen_bucket, H265_FLOOR_KBPS) or chosen_bucket, H265_FLOOR_KBPS)
            if lower_ok:
                chosen_bucket = lower_ok
                # dopo il downscale, il cap non si applica
                v_final = v_kbps_cand
            else:
                # Nemmeno scendendo si rispetta il floor ‚Üí non fattibile
                raise EncodeNotFeasible(
                    ""Cap alla sorgente impedisce il rispetto del floor e non esistono bucket inferiori ‚Üí split richiesto""
                )

    # 8) ritorna il piano
    return TargetPlan(
        safe_total_kbps=safe_total_kbps,
        target_audio_kbps_total=audio_kbps,
        v_kbps=int(v_final),
        vf_height=int(chosen_bucket),
        source_video_kbps_est=ctx.source_video_kbps_est,
    )

# === adeguamento per il tentativo 2 (retry) ===
def adjust_plan_after_retry(
    ctx: EncodeContext,
    prev_plan: TargetPlan,
    new_video_kbps: int,
) -> TargetPlan:
    """"""
    Dato il v_kbps ricalcolato dal meccanismo di retry (sulla base dello sforamento),
    ri-applica i floor e, se serve, scende di bucket. Usa SEMPRE la stessa policy del tentativo 1.
    """"""
    v2 = max(MIN_VIDEO_KBPS, int(new_video_kbps))
    min_floor_val = _floor_value_min(H265_FLOOR_KBPS)
    if v2 < min_floor_val:
        raise EncodeNotFeasible(
            f""Retry: v={v2} kb/s < min floor {min_floor_val} kb/s ‚Üí split richiesto""
        )

    # bucket di partenza = quello del tentativo precedente (non si risale),
    # e comunque non oltre MAX_TARGET_HEIGHT
    start_bucket = min(prev_plan.vf_height, MAX_TARGET_HEIGHT)

    chosen_bucket = _select_bucket_for_v(v2, start_bucket, H265_FLOOR_KBPS)
    if not chosen_bucket:
        raise EncodeNotFeasible(
            f""Retry: nessun bucket soddisfa {v2} kb/s (min floor={min_floor_val}) ‚Üí split richiesto""
        )

    # DOWNscale reale = confronto con la sorgente, NON con il max target.
    downscale_real = chosen_bucket < ctx.height

    v_final = v2
    if not downscale_real and v2 > ctx.source_video_kbps_est:
        v_cap = ctx.source_video_kbps_est
        if v_cap >= _floor_for_bucket(chosen_bucket, H265_FLOOR_KBPS):
            v_final = v_cap
        else:
            # Scendi ancora di bucket (se possibile) e ignora il cap
            lower_ok = _select_bucket_for_v(
                v2,
                _next_lower_bucket(chosen_bucket, H265_FLOOR_KBPS) or chosen_bucket,
                H265_FLOOR_KBPS
            )
            if lower_ok and lower_ok != chosen_bucket:
                chosen_bucket = lower_ok
                v_final = v2
            else:
                raise EncodeNotFeasible(
                    ""Retry: cap romperebbe il floor e non esistono bucket inferiori ‚Üí split richiesto""
                )

    return TargetPlan(
        safe_total_kbps=int(v_final + prev_plan.target_audio_kbps_total),  # ricalcolato
        target_audio_kbps_total=prev_plan.target_audio_kbps_total,
        v_kbps=int(v_final),
        vf_height=int(chosen_bucket),
        source_video_kbps_est=ctx.source_video_kbps_est,
    )

























def adjust_safe_limit_for_overshoot(safe_limit_bytes: int, actual_bytes: int) -> int:
    overs = max(0, actual_bytes - safe_limit_bytes)
    if overs <= 0:
        return safe_limit_bytes
    new_limit = int(safe_limit_bytes - overs * (1.0 + float(RETRY_SAFETY_PCT)))
    # non scendere sotto 16 MiB per evitare input strani
    return max(new_limit, 16 * 1024 * 1024)

# ================= Docker/FFmpeg helpers (tue funzioni, con minimi adattamenti) =================
def _docker_ffmpeg_args(cpus=None, cpuset=None, use_gpu=False):
    args = ['docker','run','--rm',
            '-e','DOCKER_CONFIG=/dev/null']
    if cpus:   args += ['--cpus', str(cpus)]
    if cpuset: args += ['--cpuset-cpus', str(cpuset)]
    if use_gpu:
        args += ['--gpus=all',
                 '-e','NVIDIA_VISIBLE_DEVICES=all',
                 '-e','NVIDIA_DRIVER_CAPABILITIES=all']
    args += [
        '--security-opt','seccomp=unconfined',
        '--cap-add','SYS_NICE',
        '-v', docker_mount_point,
        'ghcr.io/aperim/nvidia-cuda-ffmpeg:latest',
    ]
    return args

def _nvenc_cmd(
    file_path: str,
    out_path: str,
    vkbps: int,
    vf_h: int,
    is_10bit: bool,          # non usato qui
    n_audio: int,
    ext_low: str,            # compat
    audio_map_relidx: list[int] | None = None,
    force_stereo: bool = FORCE_STEREO,
    use_dplii_matrix: bool = True,
    keep_subtitles: bool = True,        # nuovo: se True, mantieni i sottotitoli
) -> list[str]:
    cmd = _docker_ffmpeg_args(use_gpu=True) + [
        '-y','-nostdin','-hide_banner','-loglevel','error',
        '-hwaccel','cuda',
        '-i', file_path,
        '-vf', f'scale=-2:{vf_h}:force_original_aspect_ratio=decrease',
    ]

    # --- Mapping ---
    # Video principale
    cmd += ['-map','0:v:0']

    # Audio: o filtro esplicito o tutte
    if audio_map_relidx is not None:
        cmd += ['-map','-0:a']  # drop tutte le audio
        for idx in sorted(audio_map_relidx):
            cmd += ['-map', f'0:a:{idx}']
        eff_n_audio = len(audio_map_relidx)
    else:
        cmd += ['-map','0:a?']
        eff_n_audio = n_audio

    # Sottotitoli (se richiesto)
    if keep_subtitles:
        cmd += ['-map','0:s?']
        eff_n_subs = 1  # serve solo per flag copy; non puntiamo gli indici qui
    else:
        eff_n_subs = 0

    # --- Video (come tuo originale NVENC) ---
    cmd += [
        '-c:v','hevc_nvenc',
        '-rc','vbr_hq','-multipass','fullres',
        '-b:v', f'{int(vkbps)}k',
        '-maxrate', f'{int(vkbps*1.08)}k',
        '-bufsize', f'{int(vkbps*2.0)}k',
        '-rc-lookahead','32',
        '-spatial_aq','1','-temporal_aq','1','-aq-strength','8',
        '-bf','3','-b_ref_mode','middle',
        '-g','240',
    ]

    # --- Audio ---
    if eff_n_audio > 0:
        cmd += ['-c:a','libfdk_aac']
        # Default globale (copre eventuali stream non indicizzati)
        cmd += ['-b:a', f'{AUDIO_KBPS_PER_TRACK}k']

        # Impostazioni per ciascuna traccia audio
        for i in range(eff_n_audio):
            cmd += [f'-b:a:{i}', f'{AUDIO_KBPS_PER_TRACK}k']
            if force_stereo:
                cmd += [f'-ac:a:{i}', '2']
                if use_dplii_matrix:
                    # indica encoding matrix dolby pro logic II (metadato utile)
                    cmd += [f'-filter:a:{i}', 'aresample=matrix_encoding=dplii']
            # Titolo pulito della traccia
            cmd += [f'-metadata:s:a:{i}', f'title=AAC LC 2.0 {AUDIO_KBPS_PER_TRACK} kbps']

        # Disposition: prima audio default, le altre non-default
        cmd += ['-disposition:a:0','default']
        for i in range(1, eff_n_audio):
            cmd += [f'-disposition:a:{i}','0']  # rimuove default/forced se ereditati
    else:
        cmd += ['-an']  # nessuna traccia audio

    # --- Sottotitoli: copia ""as-is"" (MKV √® perfetto per srt/ass/pgs/vobsub) ---
    if keep_subtitles and eff_n_subs:
        cmd += ['-c:s','copy']
        # opzionale: assicurati che nessun sottotitolo sia ""default""
        # (evita sorprese quando ffmpeg ereditasse i flag)
        cmd += ['-disposition:s','0']

    # --- Metadati/Capitoli del container ---
    # Puliamo: BPS/NUMBER_OF_BYTES/encoder ecc. (ri-setteremo noi dopo il size-check)
    cmd += ['-map_metadata','-1']

    # Matroska container (lavoriamo solo in mkv)
    cmd.append(out_path)
    return cmd

def _run(cmd: List[str]) -> Tuple[int, float, str]:
    start = time.time()
    p = subprocess.run(cmd, stdout=subprocess.DEVNULL, stderr=subprocess.PIPE)
    elapsed = time.time() - start
    return p.returncode, elapsed, (p.stderr.decode('utf-8', errors='ignore') if p.stderr else """")

def run_encode_once(out_path: str, ctx: EncodeContext, plan: TargetPlan, audio_map_relidx: Optional[List[int]] = None) -> Tuple[int, float, int]:
    try:
        if os.path.exists(out_path):
            os.remove(out_path)
    except Exception:
        pass

    cmd = _nvenc_cmd(
        file_path=ctx.file_path,
        out_path=out_path,
        vkbps=int(plan.v_kbps),
        vf_h=int(plan.vf_height),
        is_10bit=ctx.is_10bit,
        n_audio=ctx.n_audio,
        ext_low=Path(ctx.file_path).suffix.lower(),
        audio_map_relidx=audio_map_relidx
    )

    eff_n_audio = (len(audio_map_relidx) if audio_map_relidx is not None else ctx.n_audio)
    logger.info(
        ""[encode] start: out=%s, v=%s kb/s, a_total=%s kb/s, total=%s kb/s, vf_h=%s, audio_streams=%d, dur=%s (%.0fs)"",
        out_path, plan.v_kbps, plan.target_audio_kbps_total, plan.safe_total_kbps,
        plan.vf_height, eff_n_audio, _fmt_hms(ctx.duration_s), ctx.duration_s
    )

    rc, elapsed, stderr = _run(cmd)
    out_size = os.path.getsize(out_path) if (rc == 0 and os.path.exists(out_path)) else -1

    if rc != 0:
        tail = (stderr[-400:] if stderr else """")
        logger.error(
            ""[encode] failed: rc=%s, elapsed=%.1fs, out_exists=%s, stderr_tail=%s"",
            rc, elapsed, os.path.exists(out_path), tail
        )
    else:
        # bitrate effettivo totale e fattore realtime
        eff_total_kbps = int((out_size * 8) / max(1.0, ctx.duration_s) / 1000)
        delta_pct = ( (eff_total_kbps / plan.safe_total_kbps - 1.0) * 100.0 ) if plan.safe_total_kbps else 0.0
        rt_factor = (ctx.duration_s / max(1e-6, elapsed))
        logger.info(
            ""[encode] done: rc=0, elapsed=%.1fs (%.2fx realtime), size=%s (%d B), eff_total=%d kb/s ""
            ""(plan_total=%s, Œî=%.2f%%)"",
            elapsed, rt_factor, _fmt_bytes(out_size), out_size,
            eff_total_kbps, plan.safe_total_kbps, delta_pct
        )

    return rc, elapsed, out_size

# ===================== Split (tua funzione, resa robusta) =====================
def split_into_streamable_parts(file_path: str, safe_limit_bytes: int, chat_id: int):
    """"""
    Split per dimensione con strumenti ‚Äúcontainer-aware‚Äù.
    - MP4: MP4Box -splits XM (preferito). Se manca MP4Box: fallback mkvmerge (MKV), opzionale remux in MP4.
    - MKV: mkvmerge --split size:XMiB
    - Altri: mkvmerge --split size:XM (opzionale remux in MP4 se FORCE_MP4_PARTS=True)
    - Nessun loop di affinamento: safe_limit_bytes √® il target massimo per parte. Piccole variazioni possibili.
    Ritorna: lista di path (stringhe) delle parti create, oppure [file originale] se sotto soglia, oppure None su errore.
    Richiede: logger, send_telegram_message, eventuali FORCE_MP4_PARTS e _remux_mkv_to_mp4.
    """"""

    def _log_info(msg: str):
        try: logger.info(msg)
        except NameError: print(msg)

    def _log_warn(msg: str):
        try: logger.warning(msg)
        except NameError: print(f""WARNING: {msg}"")

    def _have(tool: str) -> bool:
        return shutil.which(tool) is not None

    try:
        src = Path(file_path)
        if not src.exists():
            send_telegram_message(chat_id, ""‚ùå File non trovato per split"")
            return None

        if not safe_limit_bytes or safe_limit_bytes <= 0:
            send_telegram_message(chat_id, ""‚ùå Limite per parte non valido (safe_limit_bytes)"")
            return None

        total_size = src.stat().st_size
        if total_size <= safe_limit_bytes:
            return [str(src)]

        out_dir = src.parent
        ext = src.suffix.lower()

        # Dimensione target (MB interi, minimo 1)
        size_mb = max(1, int(safe_limit_bytes // (1024 * 1024)))
        size_mib = size_mb  # alias per mkvmerge ""MiB""

        created: List[Path] = []

        # Pulizia preventiva di output precedenti ricorrenti per pattern noti
        # MKV pattern: {stem}.split-001.mkv
        for p in out_dir.glob(f""{src.stem}.split-*.mkv""):
            try: p.unlink()
            except Exception: pass
        # MP4Box pattern: {stem}_0001.mp4
        for p in out_dir.glob(f""{src.stem}_*.mp4""):
            try: p.unlink()
            except Exception: pass

        if ext == "".mkv"":
            if not _have(""mkvmerge""):
                send_telegram_message(chat_id, ""‚ùå mkvmerge non trovato (pacchetto mkvtoolnix)"")
                return None
            base = out_dir / f""{src.stem}.split.mkv""
            cmd = [""mkvmerge"", ""-o"", str(base), ""--split"", f""size:{size_mib}MiB"", str(src)]
            _log_info(f""[split] MKV ‚Üí {' '.join(shlex.quote(c) for c in cmd)}"")
            run = subprocess.run(cmd, stdout=subprocess.PIPE, stderr=subprocess.PIPE)
            rc = run.returncode
            if rc != 0:
                err = (run.stderr.decode('utf-8', 'ignore') if run.stderr else """")
                logger.error(""[split] mkvmerge rc=%s, stderr(last400)=%s"", rc, err[-400:])
                send_telegram_message(chat_id, ""‚ùå mkvmerge: split fallito"")
                return None

            mkv_parts = sorted(out_dir.glob(f""{src.stem}.split-*.mkv""))
            if not mkv_parts and base.exists():
                mkv_parts = [base]
            if not mkv_parts:
                send_telegram_message(chat_id, ""‚ùå Nessuna parte creata (mkvmerge)"")
                return None

            try:
                if FORCE_MP4_PARTS:
                    mp4_parts = _remux_mkv_to_mp4(mkv_parts, chat_id)
                    if mp4_parts is None:
                        return None
                    created = [Path(p) for p in mp4_parts]
                else:
                    created = mkv_parts
            except NameError:
                created = mkv_parts

        elif ext == "".mp4"":
            if _have(""MP4Box""):
                cmd = [""MP4Box"", ""-splits"", f""{size_mb}M"", str(src)]
                _log_info(f""[split] MP4 ‚Üí {' '.join(shlex.quote(c) for c in cmd)}"")
                rc = subprocess.call(cmd, cwd=str(out_dir))
                if rc != 0:
                    send_telegram_message(chat_id, ""‚ùå MP4Box: split fallito"")
                    return None
                created = sorted([p for p in out_dir.glob(""*.mp4"") if p.stem.startswith(src.stem + ""_"")])
                if not created:
                    created = sorted(out_dir.glob(f""{src.stem}_*.mp4""))
            elif _have(""mkvmerge""):
                base = out_dir / f""{src.stem}.split.mkv""
                cmd = [""mkvmerge"", ""-o"", str(base), ""--split"", f""size:{size_mb}M"", str(src)]
                _log_info(f""[split] MP4‚ÜíMKV (fallback) ‚Üí {' '.join(shlex.quote(c) for c in cmd)}"")
                rc = subprocess.call(cmd)
                if rc != 0:
                    send_telegram_message(chat_id, ""‚ùå mkvmerge: split fallito"")
                    return None
                mkv_parts = sorted(out_dir.glob(f""{src.stem}.split-*.mkv""))
                if not mkv_parts:
                    send_telegram_message(chat_id, ""‚ùå Nessuna parte creata (mkvmerge)"")
                    return None
                try:
                    if FORCE_MP4_PARTS:
                        mp4_parts = _remux_mkv_to_mp4(mkv_parts, chat_id)
                        if mp4_parts is None:
                            return None
                        created = [Path(p) for p in mp4_parts]
                    else:
                        created = mkv_parts
                except NameError:
                    created = mkv_parts
            else:
                send_telegram_message(chat_id, ""‚ùå Nessuno strumento per split MP4 (installa GPAC/MP4Box o mkvtoolnix)"")
                return None

        elif ext in ("".avi"", "".mov"", "".m4v"", "".ts"", "".m2ts"", "".flv"", "".webm"", "".mpeg"", "".mpg""):
            if not _have(""mkvmerge""):
                send_telegram_message(chat_id, f""‚ùå mkvmerge non trovato per split di {ext} (installa mkvtoolnix)"")
                return None
            base = out_dir / f""{src.stem}.split.mkv""
            cmd = [""mkvmerge"", ""-o"", str(base), ""--split"", f""size:{size_mb}M"", str(src)]
            _log_info(f""[split] {ext.upper()}‚ÜíMKV ‚Üí {' '.join(shlex.quote(c) for c in cmd)}"")
            rc = subprocess.call(cmd)
            if rc != 0:
                send_telegram_message(chat_id, ""‚ùå mkvmerge: split fallito"")
                return None
            mkv_parts = sorted(out_dir.glob(f""{src.stem}.split-*.mkv""))
            if not mkv_parts:
                send_telegram_message(chat_id, ""‚ùå Nessuna parte creata (mkvmerge)"")
                return None
            try:
                if FORCE_MP4_PARTS:
                    mp4_parts = _remux_mkv_to_mp4(mkv_parts, chat_id)
                    if mp4_parts is None:
                        return None
                    created = [Path(p) for p in mp4_parts]
                else:
                    created = mkv_parts
            except NameError:
                created = mkv_parts

        else:
            send_telegram_message(chat_id, f""‚ùå Estensione non supportata per split: {ext}"")
            return None

        if not created:
            send_telegram_message(chat_id, ""‚ùå Split: nessun output rilevato"")
            return None

        overs = [p for p in created if p.stat().st_size > safe_limit_bytes]
        if overs:
            worst = max(overs, key=lambda p: p.stat().st_size)
            _log_warn(f""[split] Una parte supera il target richiesto: {worst.name} = {worst.stat().st_size // (1024*1024)} MB"")

        return [str(p) for p in created]

    except Exception as e:
        try: logger.exception(f""[split] errore inatteso: {e}"")
        except NameError: print(f""[split] errore inatteso: {e}"")
        try: send_telegram_message(chat_id, f""‚ùå Errore nello split: {e}"")
        except NameError: pass
        return None

# ===================== CHECK_FILE (completa) =====================
def check_file(file_path: str, chat_id: int, item_id: int, app) -> dict:
    """"""
    - Se originale <= limite: original_ok.
    - Altrimenti:
        Tentativo 1: calcolo plan con limite ""fudgiato"" (solo qui).
        Se OK (<= limite reale): replace e encoded_ok.
        Se overshoot e RETRY_ON_OVERSHOOT=True: Tentativo 2.
            - Mantiene audio e vf_height del 1¬∞
            - Ricalcola SOLO v_kbps 'spalmando' l'eccesso + safety.
        Se 2¬∞ OK: replace e encoded_ok.
        Altrimenti: too_big (lo split lo far√† chi chiama).
    """"""
    try:
        src = Path(file_path)
        if not src.exists():
            msg = ""‚ùå File non trovato""
            try: send_telegram_message(chat_id, msg)
            except Exception: pass
            return {""status"": ""error"", ""msg"": msg, ""path"": None}

        orig_size = src.stat().st_size
        if orig_size <= safe_limit_bytes:
            # logger.info(""[check] Originale sotto soglia: %s <= %s"", orig_size, safe_limit_bytes)
            logger.info(
                ""[check] originale <= limite: size=%s (%d B) <= limit=%s (%d B) ‚Äî skip encode."",
                _fmt_bytes(orig_size), orig_size, _fmt_bytes(safe_limit_bytes), safe_limit_bytes
            )
            return {""status"": ""original_ok"", ""path"": str(src), ""size"": orig_size}

        if app == ""sonarr"":
            api_key = sonarr_api
            host = sonarr_host
            port = sonarr_port
        elif app == ""radarr"":
            api_key = radarr_api
            host = radarr_host
            port = radarr_port
        else:
            raise ValueError(""app must be 'radarr' or 'sonarr'"")
        
        profile_language = get_profile_language_iso639_2(app, api_key, host, port, item_id)

        langs = _analyze_audio_languages_with_docker(src)
        filter_enabled, keep_relidx, notify_msg, summary_str = _decide_audio_selection(profile_language, langs)

        # Log elenco tracce rilevate
        logger.info(""[audio] Tracce: %s"", summary_str)

        # Notifiche all'owner, se richieste dalla logica
        if notify_msg:
            try:
                send_telegram_message(owner_chatid, f""‚ÑπÔ∏è {src.name}: {notify_msg}"")
            except Exception:
                pass

        ctx = extract_encode_context(str(src))

        # Report keep/remove
        if filter_enabled:
            keep_1based = [i+1 for i in sorted(keep_relidx)]
            all_1based   = [int(t.get(""track"")) for t in langs]
            remove_1based = [t for t in all_1based if t not in keep_1based]
            # logger.info(""[audio] Keep: %s | Remove: %s"",
            #             "", "".join(f""#{i}"" for i in keep_1based) if keep_1based else ""(none)"",
            #             "", "".join(f""#{i}"" for i in remove_1based) if remove_1based else ""(none)"")
            logger.info(
                ""[audio] selection: keep=%s (%d/%d), remove=%s"",
                "", "".join(f""#{i}"" for i in keep_1based) if keep_1based else ""(none)"",
                len(keep_1based), len(langs),
                "", "".join(f""#{i}"" for i in remove_1based) if remove_1based else ""(none)""
            )
        else:
            logger.info(""[audio] selection: keep=all (%d/%d), remove=(none)"", ctx.n_audio, ctx.n_audio)

        # Context e output temporaneo
        # ctx = extract_encode_context(str(src))
        out_tmp = str(src.with_name(f""{src.stem}.encode{REENCODE_OUTPUT_EXT}""))
        try:
            if os.path.exists(out_tmp):
                os.remove(out_tmp)
        except Exception:
            pass

        dur_txt = _fmt_hms(ctx.duration_s)
        try:
            send_telegram_message(
                chat_id,
                ""üóúÔ∏è Provo compressione GPU (HEVC NVENC, multipass)‚Ä¶""
            )

            logger.info(
                ""[check] source: name=%s, dur=%s (%.0fs), size=%s (%d B), limit=%s (%d B), app=%s, profile_lang=%s"",
                src.name, _fmt_hms(ctx.duration_s), ctx.duration_s,
                _fmt_bytes(orig_size), orig_size,
                _fmt_bytes(safe_limit_bytes), safe_limit_bytes,
                app, profile_language or ""n/a""
            )

            a_src_est = max(0, ctx.source_total_kbps_est - ctx.source_video_kbps_est)
            logger.info(
                ""[src] video: %dx%d, %s-bit, v_src‚âà%d kb/s"",
                ctx.width, ctx.height, (""10"" if ctx.is_10bit else ""8""), ctx.source_video_kbps_est
            )
            logger.info(
                ""[src] audio: tracks=%d, a_src_est‚âà%d kb/s"",
                ctx.n_audio, a_src_est
            )
            logger.info(
                ""[src] container: total_src‚âà%d kb/s, dur=%s (%.0fs), size=%s (%d B), ext=%s"",
                ctx.source_total_kbps_est, dur_txt, ctx.duration_s,
                _fmt_bytes(orig_size), orig_size, ctx.ext_low
            )

        except Exception:
            pass

        # ---- Tentativo 1 (fudge -1% sul limite totale) ----
        limit_try1 = int(safe_limit_bytes * (1.0 - FUDGE_VBR_FIRST_TRY))

        n_audio_eff = len(keep_relidx) if filter_enabled else ctx.n_audio

        plan1 = compute_target_for_size(ctx, limit_try1, n_audio_override=n_audio_eff)

        # logger.info(""[check] Tentativo 1 ‚Üí target_kbps_tot=%s, audio=%s, video=%s, vf_h=%s"",
        #             plan1.safe_total_kbps, plan1.target_audio_kbps_total, plan1.v_kbps, plan1.vf_height)

        logger.info(
            ""[plan] try#1: total=%s kb/s (v=%s, a=%s), vf_h=%s, limit_fudged=%s (%d B, fudge=%.2f%%), dur=%s (%.0fs)"",
            plan1.safe_total_kbps, plan1.v_kbps, plan1.target_audio_kbps_total, plan1.vf_height,
            _fmt_bytes(limit_try1), limit_try1, (FUDGE_VBR_FIRST_TRY * 100.0),
            _fmt_hms(ctx.duration_s), ctx.duration_s
        )

        # Se filtriamo, passiamo la mappa esplicita; altrimenti None per comportamento corrente
        audio_map = keep_relidx if filter_enabled else None
        rc1, el1, out1 = run_encode_once(out_tmp, ctx, plan1, audio_map_relidx=audio_map)

        logger.info(""[encode] v_kbps=%s, vf_h=%s, audio_kbps_total=%s, safe_total_kbps=%s, src_v_kbps=%s"",
                    plan1.v_kbps, plan1.vf_height, plan1.target_audio_kbps_total,
                    plan1.safe_total_kbps, getattr(plan1, ""source_video_kbps_est"", ""n/a""))

        if rc1 != 0 or out1 <= 0 or not os.path.exists(out_tmp):
            try: send_telegram_message(chat_id, ""‚ùå Compress. fallita (1¬∞ tentativo)."")
            except Exception: pass
            try:
                if os.path.exists(out_tmp):
                    os.remove(out_tmp)
            except Exception:
                pass
            return {""status"": ""error"", ""path"": str(src), ""msg"": ""encode1_failed""}

        logger.info(""[encode] OK rc=%s, size=%s bytes"", rc1, out1)

        if out1 <= safe_limit_bytes:
            # SUCCESSO ‚Üí sostituisco l'originale
            try:
                dest_path = src.with_suffix(REENCODE_OUTPUT_EXT)
                os.replace(out_tmp, dest_path)
                if dest_path != src:
                    try:
                        os.remove(src)
                    except Exception:
                        pass

                try:
                    eff_n_audio = (len(audio_map) if audio_map is not None else ctx.n_audio)
                    update_mkv_metadata_final(dest_path, src, eff_n_audio)
                    logger.info(""[final] mkvpropedit: track statistics tags rigenerati + segment title/default audio impostati."")
                except Exception:
                    pass

                final_size = os.path.getsize(dest_path)

                try:
                    eff_total_kbps_1 = int((final_size * 8) / max(1.0, ctx.duration_s) / 1000)
                    margin_pct_1 = (1.0 - (final_size / safe_limit_bytes)) * 100.0
                    logger.info(
                        ""[final] try#1 OK: size=%s (%d B) ‚â§ limit=%s (%d B), margin=%.2f%%, ""
                        ""eff_total=%d kb/s vs plan_total=%s, v=%s, vf_h=%s, audio_streams=%d, dest=%s"",
                        _fmt_bytes(final_size), final_size,
                        _fmt_bytes(safe_limit_bytes), safe_limit_bytes, margin_pct_1,
                        eff_total_kbps_1, plan1.safe_total_kbps, plan1.v_kbps, plan1.vf_height,
                        (len(audio_map) if filter_enabled else ctx.n_audio),
                        str(dest_path)
                    )

                    size_factor = (orig_size / final_size) if final_size > 0 else 0.0
                    size_redux_pct = 100.0 * (1.0 - (final_size / orig_size))
                    tot_redux_pct  = 100.0 * (1.0 - (eff_total_kbps_1 / max(1, ctx.source_total_kbps_est)))
                    v_redux_pct    = 100.0 * (1.0 - (plan1.v_kbps / max(1, ctx.source_video_kbps_est)))

                    logger.info(
                        ""[final] delta#1: total‚âà%d‚Üí%d kb/s (Œî=%.2f%%), v‚âà%d‚Üí%d kb/s (plan, Œî=%.2f%%), ""
                        ""size %s‚Üí%s (x%.2f, Œî=%.2f%%), vf_h=%s, a_streams=%d"",
                        ctx.source_total_kbps_est, eff_total_kbps_1, tot_redux_pct,
                        ctx.source_video_kbps_est, plan1.v_kbps, v_redux_pct,
                        _fmt_bytes(orig_size), _fmt_bytes(final_size), size_factor, size_redux_pct,
                        plan1.vf_height, (len(audio_map) if filter_enabled else ctx.n_audio)
                    )

                except Exception:
                    pass

            except Exception:
                try: os.remove(out_tmp)
                except Exception: pass
                final_size = out1  # best effort

            try:
                send_telegram_message(chat_id, f""‚úÖ Compressione ok: {_fmt_bytes(final_size)} (limite {_fmt_bytes(safe_limit_bytes)})"")
            except Exception:
                pass

            # return {""status"": ""encoded_ok"", ""path"": file_path, ""size"": final_size,
            return {""status"": ""encoded_ok"", ""path"": dest_path, ""size"": final_size,
                    ""plan"": {""vf_height"": plan1.vf_height, ""v_kbps"": plan1.v_kbps,
                             ""audio_kbps"": plan1.target_audio_kbps_total,
                             ""safe_total_kbps"": plan1.safe_total_kbps,
                             ""src_video_kbps_est"": getattr(plan1, ""source_video_kbps_est"", None)}}

        # ---- Overshoot ‚Üí valutazione retry ----
        if not RETRY_ON_OVERSHOOT:
            try:
                send_telegram_message(chat_id, f""‚ÑπÔ∏è Output {_fmt_bytes(out1)} > limite ({_fmt_bytes(safe_limit_bytes)}). Retry disattivato."")

                logger.info(
                    ""[overshoot] try#1: size=%s (%d B) > limit=%s (%d B) by %.2f%% ‚Äî retry disattivato."",
                    _fmt_bytes(out1), out1, _fmt_bytes(safe_limit_bytes), safe_limit_bytes,
                    ((out1 - safe_limit_bytes) / safe_limit_bytes) * 100.0
                )

            except Exception:
                pass
            try:
                if os.path.exists(out_tmp):
                    os.remove(out_tmp)
            except Exception:
                pass
            return {""status"": ""too_big"", ""path"": str(src), ""size"": out1, ""msg"": ""overshoot_no_retry""}

        overs_bytes = out1 - safe_limit_bytes
        pct = (overs_bytes / safe_limit_bytes) * 100.0
        
        min_floor = _floor_value_min(H265_FLOOR_KBPS)

        # v2 = _compute_retry_v_kbps(ctx.duration_s, out1, safe_limit_bytes, plan1.v_kbps, RETRY_SAFETY_PCT,
                                   # floor_kbps=max(64, int(getattr(plan1, ""v_kbps_floor"", 200))))

        v2 = _compute_retry_v_kbps(
            ctx.duration_s, out1, safe_limit_bytes, plan1.v_kbps, RETRY_SAFETY_PCT,
            floor_kbps=min_floor
        )

        try:
            plan2 = adjust_plan_after_retry(ctx, plan1, v2)  # usa H265_FLOOR_KBPS e MAX_TARGET_HEIGHT interni/globali
        except EncodeNotFeasible as e:
            # Retry non fattibile (v2 < floor minore, o nessun bucket compatibile) ‚Üí chiedi split
            try:
                send_telegram_message(chat_id,
                    f""‚ùå Retry impossibile: {e}. Suggerito split."")
            except Exception:
                pass
            try:
                if os.path.exists(out_tmp):
                    os.remove(out_tmp)
            except Exception:
                pass
            return {""status"": ""too_big"", ""path"": str(src), ""size"": out1, ""msg"": ""overshoot_retry_unfeasible""}

        # CHANGE: ora invia il messaggio includendo eventuale cambio di risoluzione
        try:
            send_telegram_message(
                chat_id,
                ""‚ÑπÔ∏è Overshoot: {} > limite ({}) di {:.2f}%.\n""
                ""Retry: video {} ‚Üí {} kb/s; risoluzione {} ‚Üí {}.""
                .format(_fmt_bytes(out1), _fmt_bytes(safe_limit_bytes), pct,
                        plan1.v_kbps, plan2.v_kbps, plan1.vf_height, plan2.vf_height)
            )

            logger.info(
                ""[overshoot] try#1: size=%s (%d B) > limit=%s (%d B) by %.2f%% ‚Äî ""
                ""retry plan: v=%s‚Üí%s kb/s, vf_h=%s‚Üí%s"",
                _fmt_bytes(out1), out1, _fmt_bytes(safe_limit_bytes), safe_limit_bytes, pct,
                plan1.v_kbps, plan2.v_kbps, plan1.vf_height, plan2.vf_height
            )
        except Exception:
            pass

        logger.info(
            ""[plan] try#2: total=%s kb/s (v=%s, a=%s), vf_h=%s"",
            plan2.safe_total_kbps, plan2.v_kbps, plan2.target_audio_kbps_total, plan2.vf_height
        )

        rc2, el2, out2 = run_encode_once(out_tmp, ctx, plan2, audio_map_relidx=audio_map)
        logger.info(""[encode] v_kbps=%s, vf_h=%s, audio_kbps_total=%s, safe_total_kbps=%s, src_v_kbps=%s"",
                    plan2.v_kbps, plan2.vf_height, plan2.target_audio_kbps_total,
                    plan2.safe_total_kbps, getattr(plan2, ""source_video_kbps_est"", ""n/a""))

        if rc2 != 0 or out2 <= 0 or not os.path.exists(out_tmp):
            try: send_telegram_message(chat_id, ""‚ùå Compress. fallita (2¬∞ tentativo)."")
            except Exception: pass
            try:
                if os.path.exists(out_tmp):
                    os.remove(out_tmp)
            except Exception:
                pass
            return {""status"": ""error"", ""path"": str(src), ""msg"": ""encode2_failed""}

        logger.info(""[encode] OK rc=%s, size=%s bytes"", rc2, out2)

        if out2 <= safe_limit_bytes:
            try:
                dest_path = src.with_suffix(REENCODE_OUTPUT_EXT)
                os.replace(out_tmp, dest_path)
                if dest_path != src:
                    try:
                        os.remove(src)
                    except Exception:
                        pass

                try:
                    eff_n_audio = (len(audio_map) if audio_map is not None else ctx.n_audio)
                    update_mkv_metadata_final(dest_path, src, eff_n_audio)
                    logger.info(""[final] mkvpropedit: track statistics tags rigenerati + segment title/default audio impostati."")
                except Exception:
                    pass

                final_size = os.path.getsize(dest_path)

                try:
                    eff_total_kbps_2 = int((final_size * 8) / max(1.0, ctx.duration_s) / 1000)
                    margin_pct_2 = (1.0 - (final_size / safe_limit_bytes)) * 100.0
                    logger.info(
                        ""[final] try#2 OK: size=%s (%d B) ‚â§ limit=%s (%d B), margin=%.2f%%, ""
                        ""eff_total=%d kb/s vs plan_total=%s, v=%s, vf_h=%s, audio_streams=%d, dest=%s"",
                        _fmt_bytes(final_size), final_size,
                        _fmt_bytes(safe_limit_bytes), safe_limit_bytes, margin_pct_2,
                        eff_total_kbps_2, plan2.safe_total_kbps, plan2.v_kbps, plan2.vf_height,
                        (len(audio_map) if filter_enabled else ctx.n_audio),
                        str(dest_path)
                    )

                    size_factor = (orig_size / final_size) if final_size > 0 else 0.0
                    size_redux_pct = 100.0 * (1.0 - (final_size / orig_size))
                    tot_redux_pct  = 100.0 * (1.0 - (eff_total_kbps_2 / max(1, ctx.source_total_kbps_est)))
                    v_redux_pct    = 100.0 * (1.0 - (plan2.v_kbps / max(1, ctx.source_video_kbps_est)))

                    logger.info(
                        ""[final] delta#2: total‚âà%d‚Üí%d kb/s (Œî=%.2f%%), v‚âà%d‚Üí%d kb/s (plan, Œî=%.2f%%), ""
                        ""size %s‚Üí%s (x%.2f, Œî=%.2f%%), vf_h=%s, a_streams=%d"",
                        ctx.source_total_kbps_est, eff_total_kbps_2, tot_redux_pct,
                        ctx.source_video_kbps_est, plan2.v_kbps, v_redux_pct,
                        _fmt_bytes(orig_size), _fmt_bytes(final_size), size_factor, size_redux_pct,
                        plan2.vf_height, (len(audio_map) if filter_enabled else ctx.n_audio)
                    )

                except Exception:
                    pass

            except Exception:
                try: os.remove(out_tmp)
                except Exception: pass
                final_size = out2

            try:
                send_telegram_message(chat_id, f""‚úÖ Compressione ok al 2¬∞ tentativo: {_fmt_bytes(final_size)} (limite {_fmt_bytes(safe_limit_bytes)})"")
            except Exception:
                pass

            # return {""status"": ""encoded_ok"", ""path"": file_path, ""size"": final_size,
            return {""status"": ""encoded_ok"", ""path"": dest_path, ""size"": final_size,
                    ""plan"": {""vf_height"": plan2.vf_height, ""v_kbps"": plan2.v_kbps,
                             ""audio_kbps"": plan2.target_audio_kbps_total,
                             ""safe_total_kbps"": plan2.safe_total_kbps,
                             ""src_video_kbps_est"": getattr(plan2, ""source_video_kbps_est"", None)}}

        # Ancora troppo grande ‚Üí lasciare la decisione di split al chiamante
        try:
            if os.path.exists(out_tmp):
                os.remove(out_tmp)
        except Exception:
            pass
        try:
            send_telegram_message(chat_id, f""‚ÑπÔ∏è Output ancora > limite ({_fmt_bytes(safe_limit_bytes)})."")
        except Exception:
            pass

        logger.info(
            ""[final] try#2 still too big: size=%s (%d B) > limit=%s (%d B) by %.2f%% ‚Äî split demandato al chiamante."",
            _fmt_bytes(out2), out2, _fmt_bytes(safe_limit_bytes), safe_limit_bytes,
            ((out2 - safe_limit_bytes) / safe_limit_bytes) * 100.0
        )

        return {""status"": ""too_big"", ""path"": str(src), ""size"": out2, ""msg"": ""overshoot_after_retry""}

    except Exception as e:
        logger.exception(""[check_file] eccezione: %s"", e)
        try: send_telegram_message(chat_id, f""‚ùå Errore check_file: {e}"")
        except Exception: pass
        return {""status"": ""error"", ""path"": None, ""msg"": str(e)}

def parse_manual_args():
    p = argparse.ArgumentParser(prog=""manual"")
    p.add_argument(""--file"", required=True)
    p.add_argument(""--chat-id"", required=True, type=int)
    p.add_argument(""--entity"", required=False, default=None)
    p.add_argument('--split', metavar='MB', type=int, default=None, help='Forza lo split manuale, dimensione massima di ogni parte in MB')
    return p.parse_args(sys.argv[2:])

def run_manual_send(file_path, chat_id, entity, split_mb=None):
    file_path = str(Path(file_path).resolve())
    logger.info(f""[MANUAL] file={file_path} chat_id={chat_id} entity={entity} split={split_mb}"")

    if not os.path.exists(file_path):
        send_telegram_message(chat_id, ""‚ùå File non trovato"")
        return 1

    # 1) stessa sequenza del flusso *arr: prima compressione (se serve)
    try:
        check_file(file_path, chat_id)
    except Exception as e:
        logger.warning(f""[MANUAL] check_file ha segnalato: {e}"")

    # Nessuno split richiesto
    if split_mb is None:
         ok = send_file_to_telegram(file_path, chat_id, entity)
         return 0 if ok else 1

    # Split richiesto: uso il valore passato in MB come hard limit per parte
    if split_mb <= 0:
        send_telegram_message(chat_id, ""‚ùå Valore --split non valido (deve essere > 0)"")
        return 1

    target_bytes = split_mb * 1024 * 1024
    # Evita di superare il limite telegrafico (safe_limit_bytes): clamp e avviso
    if target_bytes > safe_limit_bytes:
        logger.warning(f""[MANUAL] --split={split_mb}MB supera il limite per parte; verr√† usato {int(safe_limit_bytes/1024/1024)}MB"")
        target_bytes = safe_limit_bytes

    logger.info(f""[MANUAL] Forzo split in parti da ~{int(target_bytes/1024/1024)} MB"")
    parts = split_into_streamable_parts(file_path, target_bytes, chat_id)

    if not parts:
        send_telegram_message(chat_id, ""‚ùå Split manuale fallito"")
        return 1

    # Invio parti e pulizia
    sent_all = True
    for p in parts:
        ok = send_file_to_telegram(p, chat_id, entity)
        if not ok:
            sent_all = False
            break

    # Cancella solo le parti create (non il file originale)
    if sent_all:
        orig = os.path.abspath(file_path)
        for p in parts:
            try:
                if os.path.abspath(p) != orig:
                    os.remove(p)
            except Exception:
                pass
    return 0 if sent_all else 1

def send_telegram_message(chat_id, message, parse_mode=None):
    # pass
    try:
        data = {
            ""chat_id"": chat_id,
            ""text"": message
        }
        if parse_mode:
            data[""parse_mode""] = parse_mode

        response = requests.post(
            f""https://api.telegram.org/bot{telegram_bot_token}/sendMessage"",
            data=data
        )
        response.raise_for_status()
    except requests.RequestException as e:
        logger.error(""Failed to send message to Telegram: %s"", str(e))

def extract_telegram_data(tags, keyword, extract_type='username'):
    if not tags:
        return 'Unknown user' if extract_type == 'username' else 'Unknown chatid'
    
    tag_list = tags.split('|')
    relevant_tags = [tag for tag in tag_list if keyword in tag]
    
    if not relevant_tags:
        return 'Unknown user' if extract_type == 'username' else 'Unknown chatid'

    last_tag = relevant_tags[-1]
    parts = last_tag.split('-')

    if len(parts) < 3:
        logger.error(f""Invalid '{last_tag}' tag: must contain 3 parts separated by '-'"")

    if extract_type == 'username':
        return '@' + parts[1]
    elif extract_type == 'chatid':
        return parts[2]
    else:
        raise ValueError(""extract_type must be 'username' or 'chatid'"")

def get_unique_tags(tags, keyword):
    if not tags:
        return []

    tag_list = tags.split('|')
    relevant_tags = [tag for tag in tag_list if keyword in tag]
    unique_tags = []

    for tag in relevant_tags:
        username = extract_telegram_data(tag, keyword, 'username')
        if username not in [extract_telegram_data(t, keyword, 'username') for t in unique_tags]:
            unique_tags.append(tag)
    return unique_tags

def humanize_size(size_in_bytes):
    size_in_mb = size_in_bytes / 1000000.0  # Convert to MB
    if size_in_mb > 1000:
        return f""{size_in_mb / 1000:.2f} GB""
    else:
        return f""{size_in_mb:.0f} MB""

def get_media_info(file_path):
    """"""
    Ritorna un dict con:
      duration_s, width, height,
      total_bitrate_kbps (se ffprobe lo fornisce),
      n_audio, audio_kbps_total (somma bit_rate stream audio se disponibili),
      v_codec, pix_fmt, color_primaries, transfer, matrix,
      is_10bit, is_hdr
    """"""
    base_cmd = [
        'docker','run','--rm',
        '-e','DOCKER_CONFIG=/dev/null',
        '--entrypoint','/usr/bin/ffprobe',
        '-v', docker_mount_point,
        'ghcr.io/aperim/nvidia-cuda-ffmpeg:latest',
        '-v','error',
        '-print_format','json',
        '-show_format','-show_streams',
        file_path
    ]
    try:
        out = subprocess.check_output(base_cmd).decode('utf-8', errors='ignore')
        import json
        data = json.loads(out)
        fmt = data.get('format', {}) or {}
        streams = data.get('streams', []) or []

        duration_s = float(fmt.get('duration') or 0) or 0.0
        total_bitrate_kbps = None
        if fmt.get('bit_rate'):
            try:
                total_bitrate_kbps = int(int(fmt['bit_rate'])/1000)
            except Exception:
                total_bitrate_kbps = None

        v = next((s for s in streams if s.get('codec_type')=='video'), None)
        width = (v or {}).get('width') or 0
        height = (v or {}).get('height') or 0
        v_codec = (v or {}).get('codec_name') or ''
        pix_fmt = (v or {}).get('pix_fmt') or ''
        color_primaries = (v or {}).get('color_primaries') or ''
        transfer = (v or {}).get('color_transfer') or ''
        matrix = (v or {}).get('color_space') or ''

        is_10bit = ('10' in (v or {}).get('bits_per_raw_sample','')) or pix_fmt in ('p010le','yuv420p10le')
        # HDR rozza: BT.2020 o transfer SMPTE2084/HLG
        is_hdr = ('bt2020' in (color_primaries or '').lower()) or ('smpte2084' in (transfer or '').lower()) or ('arib-std-b67' in (transfer or '').lower())

        # audio
        a_streams = [s for s in streams if s.get('codec_type')=='audio']
        n_audio = len(a_streams)
        audio_kbps_total = 0
        for a in a_streams:
            try:
                br = int(a.get('bit_rate') or 0)
                if br > 0:
                    audio_kbps_total += int(br/1000)
                else:
                    audio_kbps_total += AUDIO_KBPS_PER_TRACK
            except Exception:
                audio_kbps_total += AUDIO_KBPS_PER_TRACK
        if n_audio == 0:
            audio_kbps_total = 0

        return {
            'duration_s': max(1.0, duration_s),
            'width': int(width or 0),
            'height': int(height or 0),
            'total_bitrate_kbps': total_bitrate_kbps,
            'n_audio': n_audio,
            'audio_kbps_total': int(audio_kbps_total),
            'v_codec': v_codec,
            'pix_fmt': pix_fmt,
            'color_primaries': color_primaries,
            'transfer': transfer,
            'matrix': matrix,
            'is_10bit': bool(is_10bit),
            'is_hdr': bool(is_hdr),
        }
    except Exception as e:
        logger.warning(f""‚ö†Ô∏è ffprobe media info fallito: {e}"")
        return {
            'duration_s': 1.0, 'width': 1920, 'height': 1080,
            'total_bitrate_kbps': None,
            'n_audio': 1, 'audio_kbps_total': AUDIO_KBPS_PER_TRACK,
            'v_codec': '', 'pix_fmt':'', 'color_primaries':'', 'transfer':'', 'matrix':'',
            'is_10bit': False, 'is_hdr': False
        }

# Wrapper compat con la tua vecchia firma
def get_video_info(file_path):
    mi = get_media_info(file_path)
    return int(mi['duration_s']), int(mi['width']), int(mi['height'])

async def generate_thumbnail(video_path):
    """"""Genera thumbnail per abilitare streaming MKV""""""
    try:
        thumb_path = f""/tmp/thumb_{os.path.basename(video_path)}.jpg""
        
        ffmpeg_cmd = [
            'docker', 'run', '--rm', '--entrypoint', '/usr/bin/ffmpeg',
            '-v', docker_mount_point,
            'ghcr.io/aperim/nvidia-cuda-ffmpeg:latest',
            '-i', video_path,
            '-ss', '00:01:00',
            '-vframes', '1',
            '-q:v', '2',
            '-y', thumb_path
        ]
        
        subprocess.run(ffmpeg_cmd, check=True, capture_output=True)
        
        if os.path.exists(thumb_path):
            return thumb_path
        return None
            
    except Exception as e:
        logger.error(f""üí• Errore generazione thumbnail: {e}"")
        return None

def load_telegram_config():
    """"""Carica configurazione Telegram da file JSON""""""
    try:
        config_file = ""/scripts/telegram_upload/telethon_upload.json""
        
        if not os.path.exists(config_file):
            logger.error(f""‚ùå File configurazione non trovato: {config_file}"")
            return None, None
            
        with open(config_file, 'r') as f:
            config = json.load(f)
            
        api_id = config.get('api_id')
        api_hash = config.get('api_hash')
        
        if not api_id or not api_hash:
            logger.error(""‚ùå api_id o api_hash mancanti nel file di configurazione"")
            return None, None
            
        print(""‚úÖ Configurazione Telegram caricata"")
        return api_id, api_hash
        
    except Exception as e:
        logger.error(f""üí• Errore caricamento configurazione: {e}"")
        return None, None

def _have(cmd): return which(cmd) is not None

def _remux_mkv_to_mp4(mkv_parts, chat_id):
    out = []
    for mkv in mkv_parts:
        mp4 = mkv.with_suffix("".mp4"")
        cmd = [
            'docker','run','--rm',
            '-v', docker_mount_point,
            'ghcr.io/aperim/nvidia-cuda-ffmpeg:latest',
            '-hide_banner','-loglevel','error',
            '-i', str(mkv),
            '-c','copy','-movflags','+faststart',
            str(mp4)
        ]
        rc = subprocess.call(cmd)
        if rc != 0 or not mp4.exists():
            send_telegram_message(chat_id, f""‚ùå Remux MKV‚ÜíMP4 fallito: {mkv.name}"")
            return None
        out.append(mp4)
    return out

def get_profile_language_iso639_2(app, api_key, host, port, entity_id):
    base = host.rstrip(""/"")
    if port and f"":{port}"" not in base:
        base = f""{base}:{port}""
    headers = {""X-Api-Key"": api_key}

    if app == ""radarr"":
        movie = requests.get(f""{base}/api/v3/movie/{entity_id}"", headers=headers).json()
        qpid = movie[""qualityProfileId""]
        qp = requests.get(f""{base}/api/v3/qualityprofile/{qpid}"", headers=headers).json()
        lang_name = qp[""language""][""name""]
        return pycountry.languages.lookup(lang_name).alpha_3.lower()

    elif app == ""sonarr"":
        # 1) prendi Quality Profile della serie
        series = requests.get(f""{base}/api/v3/series/{entity_id}"", headers=headers).json()
        qpid = series[""qualityProfileId""]
        qp = requests.get(f""{base}/api/v3/qualityprofile/{qpid}"", headers=headers).json()

        # 2) mappa Custom Formats e trova il CF di tipo LanguageSpecification con score pi√π alto
        all_cf = requests.get(f""{base}/api/v3/customformat"", headers=headers).json()
        cf_by_id = {cf[""id""]: cf for cf in all_cf}

        best = None  # (score, lang_id)
        for it in qp.get(""formatItems"", []):
            ref = it.get(""format"")
            if isinstance(ref, int):
                cf_id = ref
            elif isinstance(ref, dict):
                cf_id = ref.get(""id"") or ref.get(""customFormatId"")
            else:
                continue
            cf = cf_by_id.get(cf_id)
            if not cf:
                continue
            for spec in cf.get(""specifications"", []):
                impl = (spec.get(""implementation"") or spec.get(""implementationName"") or """")
                if ""LanguageSpecification"" not in impl:
                    continue
                fields = spec.get(""fields"")
                val = None
                if isinstance(fields, dict):
                    val = fields.get(""value"")
                elif isinstance(fields, list):
                    for f in fields:
                        if isinstance(f, dict) and f.get(""name"") == ""value"":
                            val = f.get(""value"")
                            break
                if val is None:
                    continue
                score = it.get(""score"", 0)
                if best is None or score > best[0]:
                    best = (score, int(val))

        # 3) gestisci ""Original Language"" o assenza
        if not best or best[1] < 0:
            return ""und""

        lang_id = best[1]

        # 4) risolvi ID -> nome canonico tramite API Sonarr
        langs = requests.get(f""{base}/api/v3/language"", headers=headers).json()
        lang_name = None
        for L in langs:
            if L.get(""id"") == lang_id:
                lang_name = L.get(""name"")
                break

        if not lang_name:
            return ""und""

        # 5) normalizza pochi casi noti e ritorna ISO 639-2
        norm = {
            ""flemish"": ""dutch"",
            ""portuguese (brazil)"": ""portuguese"",
        }
        key = lang_name.lower()
        lang_for_lookup = norm.get(key, lang_name)

        return pycountry.languages.lookup(lang_for_lookup).alpha_3.lower()

    else:
        raise ValueError(""app must be 'radarr' o 'sonarr'"")

def send_file_to_telegram(file_path, chat_id, telegram_username):
    """"""Invia un file/parti streammabili rispettando il limite di 2 GB per file.""""""

    # Verifica Telethon
    if not TELETHON_AVAILABLE:
        logger.error(""‚ùå Telethon non disponibile - ABORT"")
        send_telegram_message(owner_chatid, ""‚ùå Errore: Telethon non installato"")
        return False

    # Carica configurazione
    api_id, api_hash = load_telegram_config()
    if not api_id or not api_hash:
        logger.error(""‚ùå Configurazione mancante - ABORT"")
        send_telegram_message(owner_chatid, ""‚ùå Errore: Configurazione Telegram mancante"")
        return False

    file_size = os.path.getsize(file_path)

    # Prepara lista file da inviare (singolo o parti)
    files_to_send = [file_path]
    if file_size > safe_limit_bytes:
        send_telegram_message(chat_id, f""üì¶ File ancora > 2GB ({file_size // 1024 // 1024} MB). Avvio split in parti‚Ä¶"")
        parts = split_into_streamable_parts(file_path, safe_limit_bytes, chat_id)
        if not parts:
            send_telegram_message(chat_id, ""‚ùå Split fallito"")
            return False
        files_to_send = parts
        send_telegram_message(chat_id, f""‚úÖ Create {len(parts)} parti (< {safe_limit_bytes//1024//1024} MB ciascuna)"")

    async def async_send():
        session_file = ""/scripts/telegram_upload/telethon_upload""
        client = TelegramClient(session_file, api_id, api_hash)
        try:
            print(""üîÑ Connessione a Telegram..."")
            await asyncio.wait_for(client.start(), timeout=30)
            print(""‚úÖ Connesso a Telegram!"")

            send_telegram_message(chat_id, f""‚úÖ Invio in corso..."")

            total = len(files_to_send)
            for idx, path in enumerate(files_to_send, start=1):
                # Metadati per streaming + thumbnail
                duration, width, height = get_video_info(path)
                thumbnail_path = await generate_thumbnail(path)

                caption = None
                if total > 1:
                    caption = f""{os.path.basename(file_path)}\nParte {idx}/{total}""

                def progress_callback(current, total_bytes):
                    # log leggero
                    pass

                await client.send_file(
                    telegram_username,
                    path,
                    caption=caption,
                    thumb=thumbnail_path,
                    supports_streaming=True,
                    force_document=False,
                    attributes=[
                        DocumentAttributeVideo(
                            duration=duration,
                            w=width,
                            h=height,
                            supports_streaming=True
                        )
                    ],
                    progress_callback=progress_callback
                )

                if thumbnail_path and os.path.exists(thumbnail_path):
                    try: os.remove(thumbnail_path)
                    except: pass

            send_telegram_message(chat_id, ""‚úÖ Invio completato"")
            return True

        except asyncio.TimeoutError:
            logger.error(""‚è∞ TIMEOUT durante avvio client Telethon"")
            send_telegram_message(owner_chatid, ""‚ùå Timeout connessione Telegram"")
            return False
        except FloodWaitError as e:
            logger.warning(f""‚è≥ Rate limit: attendi {e.seconds}s"")
            send_telegram_message(chat_id, f""‚è≥ Rate limit: attendi {e.seconds}s"")
            await asyncio.sleep(e.seconds + 1)
            return False
        except Exception as e:
            logger.error(f""üí• Errore Telethon: {e}"")
            send_telegram_message(owner_chatid, f""‚ùå Errore invio: {str(e)[:100]}"")
            return False
        finally:
            await client.disconnect()

    try:
        loop = asyncio.new_event_loop()
        asyncio.set_event_loop(loop)
        result = loop.run_until_complete(async_send())
        loop.close()
        return result
    except Exception as e:
        logger.error(f""üí• Errore wrapper asincrono: {e}"")
        send_telegram_message(owner_chatid, ""‚ùå Errore sistema"")
        return False

def update_series(sonarr_host, sonarr_port, sonarr_series_tvdbid, sonarr_api):
    # URL to get the series via tvdbId
    series_url = f""{sonarr_host}:{sonarr_port}/api/v3/series/lookup?term=tvdb:{sonarr_series_tvdbid}""
    headers = {
        ""accept"": ""application/json"",
        ""X-Api-Key"": sonarr_api
    }

    # Get the series
    response = requests.get(series_url, headers=headers)
    if response.status_code != 200:
        logger.error(f""Error in obtaining series data. Status code: {response.status_code}"")
        return False

    series_data = response.json()
    if not series_data:
        logger.error(f""No series found for tvdbId {sonarr_series_tvdbid}"")
        return False

    series_data = series_data[0]  # Let's take the first search result

    # URL to get the episodes
    episodes_url = f""{sonarr_host}:{sonarr_port}/api/v3/episode?seriesId={series_data['id']}""
    response = requests.get(episodes_url, headers=headers)
    if response.status_code != 200:
        logger.error(f""Error in obtaining episode data. Status code: {response.status_code}"")
        return False

    episodes_data = response.json()

    # Check the status of episodes for each season
    seasons_to_unmonitor = set()
    for episode in episodes_data:
        season_number = episode['seasonNumber']
        if episode['monitored']:
            seasons_to_unmonitor.discard(season_number)
        else:
            seasons_to_unmonitor.add(season_number)

    # If a season has no more monitored episodes, stop monitoring it
    for season_number in seasons_to_unmonitor:
        for index, season in enumerate(series_data['seasons']):
            if season['seasonNumber'] == season_number:
                if series_data['seasons'][index]['monitored']:
                    series_data['seasons'][index]['monitored'] = False
                    print(f""Season {season_number} set to unmonitored."")
                break  # We get out of the cycle once we find and modify the season

    # Check whether the series has monitored seasons
    monitored_seasons = [season for season in series_data['seasons'] if season['monitored']]

    # Update the series with changes
    update_url = f""{sonarr_host}:{sonarr_port}/api/v3/series/{series_data['id']}""
    response = requests.put(update_url, headers=headers, json=series_data)
    if response.status_code == 202:
        print(f""Series with ID {series_data['id']} successfully updated."")
    else:
        logger.error(f""Error updating series with ID {series_data['id']}. Status code: {response.status_code}"")
        return False

    # If the series has no monitored seasons
    if not monitored_seasons:
        if series_data['status'] != 'continuing':
            # If the series does not continue, cancel the series
            delete_url = f""{sonarr_host}:{sonarr_port}/api/v3/series/{series_data['id']}""
            response = requests.delete(delete_url, headers=headers, params={""deleteFiles"": ""true""})
            if response.status_code == 200:
                print(f""Series with ID {series_data['id']} successfully deleted."")
                return True
            else:
                logger.error(f""Error in deleting series with ID {series_data['id']}. Status code: {response.status_code}"")
                return False
        else:
            # If the series continues, do nothing
            print(""Series continues, no action taken."")
    return True

def delete_movie(radarr_host, radarr_port, radarr_movie_id, radarr_api):
    url = f""{radarr_host}:{radarr_port}/api/v3/movie/{radarr_movie_id}""
    params = {
        ""deleteFiles"": ""true"",
        ""addImportExclusion"": ""false""
    }
    headers = {
        ""accept"": ""*/*"",
        ""X-Api-Key"": radarr_api
    }

    response = requests.delete(url, params=params, headers=headers)

    if response.status_code == 200:
        print(f""Movie with ID {radarr_movie_id} successfully deleted."")
        return True
    else:
        logger.error(f""Error deleting movie with ID {radarr_movie_id}. Status code: {response.status_code}"")
        return False

def delete_episode_file(sonarr_host, sonarr_port, sonarr_episode_file_id, sonarr_api):
    url = f""{sonarr_host}:{sonarr_port}/api/v3/episodefile/{sonarr_episode_file_id}""
    params = {
        ""deleteFiles"": ""true""
    }
    headers = {
        ""accept"": ""*/*"",
        ""X-Api-Key"": sonarr_api
    }

    response = requests.delete(url, params=params, headers=headers)

    if response.status_code == 200:
        print(f""Episode file with ID {sonarr_episode_file_id} successfully deleted."")
        return True
    else:
        logger.error(f""Error deleting episode file with ID {sonarr_episode_file_id}. Status code: {response.status_code}"")
        return False

def handle_add_event(tags, title, keyword, event_type):
    item_type = ""il film"" if event_type == 'radarr' else ""la serie""
    chat_id = owner_chatid
    message = f""{extract_telegram_data(tags, keyword, 'username')} ha appena aggiunto {item_type} {title}""
    send_telegram_message(chat_id, message)
    
    sys.exit(0)

def handle_grab_event(tags, title, release_quality, release_title, release_size, imdb_id, keyword, event_type):
    unique_tags = get_unique_tags(tags, keyword)

    if unique_tags:
        for tag in unique_tags:
            item_type = ""Film aggiunto"" if event_type == 'radarr' else ""Serie aggiunta""
            chat_id = extract_telegram_data(tag, keyword, 'chatid')
            human_readable_size = humanize_size(int(release_size))
            message = f""<b>{item_type} al download:</b>\n{title} ({release_quality})\n[{release_title}] - {human_readable_size}\n<a href='https://imdb.com/title/{imdb_id}'>IMDB Link</a>""
            send_telegram_message(chat_id, message, 'HTML')
    else:
        print(""No relevant tags found for Grab event"")
    
    sys.exit(0)

def process_sonarr_download(sonarr_series_tags, sonarr_series_title, sonarr_series_year, sonarr_episodefile_seasonnumber,
                           sonarr_episodefile_episodenumbers, sonarr_episodefile_quality,
                           sonarr_episodefile_path, sonarr_episodefile_id, sonarr_series_tvdbid, sonarr_series_id):
    unique_tags = get_unique_tags(sonarr_series_tags, keyword)
    if unique_tags:
        for tag in unique_tags:
            chat_id = extract_telegram_data(tag, keyword, 'chatid')
            telegram_username = extract_telegram_data(tag, keyword, 'username')

            message = f""<b>Episodio importato correttamente:</b>\n{sonarr_series_title} ({sonarr_series_year}) - ({sonarr_episodefile_quality})\n[Stagione {sonarr_episodefile_seasonnumber} - Episodio {sonarr_episodefile_episodenumbers}]""
            send_telegram_message(chat_id, message, 'HTML')

            check_file(sonarr_episodefile_path, chat_id, sonarr_series_id, app=""sonarr"")

            if send_file_to_telegram(sonarr_episodefile_path, chat_id, telegram_username):
                delete_episode_file(sonarr_host, sonarr_port, sonarr_episodefile_id, sonarr_api)
                update_series(sonarr_host, sonarr_port, sonarr_series_tvdbid, sonarr_api)
    else:
        print(""No relevant tags found for Download event"")

def process_radarr_download(radarr_movie_tags, radarr_movie_title, radarr_movie_year, 
                           radarr_moviefile_quality, radarr_moviefile_scenename, 
                           radarr_moviefile_path, radarr_movie_id):
    unique_tags = get_unique_tags(radarr_movie_tags, keyword)
    if unique_tags:
        for tag in unique_tags:
            chat_id = extract_telegram_data(tag, keyword, 'chatid')
            telegram_username = extract_telegram_data(tag, keyword, 'username')

            message = f""<b>Film importato correttamente:</b>\n{radarr_movie_title} ({radarr_movie_year}) - ({radarr_moviefile_quality})"" + (f""\n[{radarr_moviefile_scenename}]"" if radarr_moviefile_scenename else """")
            send_telegram_message(chat_id, message, 'HTML')

            check_file(radarr_moviefile_path, chat_id, radarr_movie_id, app=""radarr"")

            if send_file_to_telegram(radarr_moviefile_path, chat_id, telegram_username):
                delete_movie(radarr_host, radarr_port, radarr_movie_id, radarr_api)
    else:
        print(""No relevant tags found for Download event"")

def run_radarr_sonarr_flow():
    ########## SONARR ENVIRONMENTS ##########
    sonarr_eventtype = os.environ.get('sonarr_eventtype', '')
    sonarr_series_tags = os.environ.get('sonarr_series_tags', '').lower()
    sonarr_series_title = os.environ.get('sonarr_series_title', 'Unknown Series')
    sonarr_release_size = os.environ.get('sonarr_release_size', '')
    sonarr_release_quality = os.environ.get('sonarr_release_quality', '')
    sonarr_release_title = os.environ.get('sonarr_release_title', '')
    sonarr_series_imdbid = os.environ.get('sonarr_series_imdbid', '')
    sonarr_series_year = os.environ.get('sonarr_series_year', '')
    sonarr_episodefile_quality = os.environ.get('sonarr_episodefile_quality', '')
    sonarr_episodefile_seasonnumber = os.environ.get('sonarr_episodefile_seasonnumber', '')
    sonarr_episodefile_episodenumbers = os.environ.get('sonarr_episodefile_episodenumbers', '')
    sonarr_episodefile_path = os.environ.get('sonarr_episodefile_path', '')
    sonarr_episodefile_id = os.environ.get('sonarr_episodefile_id', '')
    sonarr_series_tvdbid = os.environ.get('sonarr_series_tvdbid', '')
    sonarr_series_id = os.environ.get('sonarr_series_id', '')
    ########## SONARR ENVIRONMENTS ##########

    ########## RADARR ENVIRONMENTS ##########
    radarr_eventtype = os.environ.get('radarr_eventtype', '')
    radarr_movie_tags = os.environ.get('radarr_movie_tags', '').lower()
    radarr_movie_title = os.environ.get('radarr_movie_title', 'Unknown Movie')
    radarr_release_size = os.environ.get('radarr_release_size', '')
    radarr_release_quality = os.environ.get('radarr_release_quality', '')
    radarr_release_title = os.environ.get('radarr_release_title', '')
    radarr_movie_imdbid = os.environ.get('radarr_movie_imdbid', '')
    radarr_movie_year = os.environ.get('radarr_movie_year', '')
    radarr_moviefile_quality = os.environ.get('radarr_moviefile_quality', '')
    radarr_moviefile_scenename = os.environ.get('radarr_moviefile_scenename', '')
    radarr_moviefile_path = os.environ.get('radarr_moviefile_path', '')
    radarr_movie_id = os.environ.get('radarr_movie_id', '')
    ########## RADARR ENVIRONMENTS ##########

    # Check if the event type is provided
    if not radarr_eventtype and not sonarr_eventtype:
        logger.error(""This script works only if called within Radarr or Sonarr"")
        sys.exit(0)

    if radarr_eventtype == ""Test"" or sonarr_eventtype == ""Test"":
        print(""Test in progress... Good-bye!"")
        sys.exit(0)

    if keyword in radarr_movie_tags or keyword in sonarr_series_tags:
        # Check the event type

        if sonarr_eventtype == ""SeriesAdd"":
            handle_add_event(
                sonarr_series_tags,
                sonarr_series_title,
                keyword,
                'sonarr'
            )

        if radarr_eventtype == ""MovieAdded"":
            handle_add_event(
                radarr_movie_tags,
                radarr_movie_title,
                keyword,
                'radarr'
            )

        if sonarr_eventtype == ""Grab"":
            handle_grab_event(
                sonarr_series_tags,
                sonarr_series_title,
                sonarr_release_quality,
                sonarr_release_title,
                sonarr_release_size,
                sonarr_series_imdbid,
                keyword,
                'sonarr'
            )

        if radarr_eventtype == ""Grab"":
            handle_grab_event(
                radarr_movie_tags,
                radarr_movie_title,
                radarr_release_quality,
                radarr_release_title,
                radarr_release_size,
                radarr_movie_imdbid,
                keyword,
                'radarr'
            )

        if sonarr_eventtype == ""Download"":
            process_sonarr_download(
                sonarr_series_tags,
                sonarr_series_title,
                sonarr_series_year,
                sonarr_episodefile_seasonnumber,
                sonarr_episodefile_episodenumbers,
                sonarr_episodefile_quality,
                sonarr_episodefile_path,
                sonarr_episodefile_id,
                sonarr_series_tvdbid,
                sonarr_series_id
            )

        if radarr_eventtype == ""Download"":
            process_radarr_download(
                radarr_movie_tags,
                radarr_movie_title,
                radarr_movie_year,
                radarr_moviefile_quality,
                radarr_moviefile_scenename,
                radarr_moviefile_path,
                radarr_movie_id
            )

if __name__ == '__main__':
    # Dump all'avvio (parte sempre, ma non scrive se ENV_DUMP √® False)
    dump_env()

    # Se richiami con subcomando ""manual"", esegui test manuale
    if len(sys.argv) > 1 and sys.argv[1] == 'manual':
        args = parse_manual_args()
        sys.exit(
            run_manual_send(
                file_path=args.file,
                chat_id=args.chat_id,
                entity=args.entity,
                split_mb=args.split
            )
        )
    else:
        # Flusso Radarr/Sonarr invariato
        run_radarr_sonarr_flow()"
RR8Paef7,online,rofelbca,HTML,Sunday 23rd of November 2025 04:24:29 AM CDT,"1. Header Component (header.html)
 File Information:
 Purpose: Main header display for the Online Book Store
 Features: Simple header with bookstore title and styling
 Dependencies: Links to style.css for CSS styling
 <!DOCTYPE html>
 <html>
 <head>
 <title>Header</title>
 <link rel='stylesheet' href='style.css'>
 </head>
 <body style=""background-color:#A7D8FF; text-align:center;"">
 </html>
 <h1>
 üìö
 Online Book Store</h1>
 </body>
2. Home Layout (home.html)
 File Information:
 Purpose: Main application layout using HTML frames
 Structure: Nested frameset with header, menu, and content areas
 Technology: Uses HTML frames (deprecated but functional)
 <!DOCTYPE html>
 <html>
 <head>
 <title>Online Book Store - Home</title>
 </head>
 <frameset rows=""20%,80%"">
 <frame name=""top"" src=""header.html"">
 <frameset cols=""20%,80%"">
 <frame name=""menu"" src=""menu.html"">
 <frame name=""content"" src=""welcome.html"">
 </frameset>
 </frameset>
 </html>
3. Navigation Menu (menu.html)
 File Information:
 Purpose: Navigation menu with links to different sections
 Features: Three main navigation links with target attributes
 Styling: Light gray background with linked CSS
 <!DOCTYPE html>
 <html>
 <head>
 <link rel='stylesheet' href='style.css'>
 </head>
 <body style=""background-color:#F0F0F0;"">
 <h3>Menu</h3>
 <a href=""login.html"" target=""content"">Login</a>
 <br><br>
 <a href=""register.html"" target=""content"">Register</a>
 <br><br>
 <a href=""catalogue.html"" target=""content"">Catalogue</a>
 <br><br>
 </body>
 </html>
4. Login Form (login.html)
 File Information:
 Purpose: User login form for authentication
 Fields: Username (text input) and Password (password input)
 Actions: Submit and Clear buttons
 <!DOCTYPE html>
 <html>
 <head>
 <title>Login</title>
 <link rel='stylesheet' href='style.css'>
 </head>
 <body>
 <h2>Login Form</h2>
 <form>
 Username: <input type=""text"">
 <br><br>
 Password: <input type=""password"">
 <br><br>
 <input type=""submit"" value=""Login"">
 <input type=""reset"" value=""Clear"">
 </form>
 </body>
 </html>
5. Registration Form (register.html)
 File Information:
 Purpose: New user registration form
 Fields: Name, Email, Password, Gender (radio buttons), Address (textarea)
 Layout: Table-based form layout
 <!DOCTYPE html>
 <html>
 <head>
 <title>Register</title>
 <link rel='stylesheet' href='style.css'>
 </head>
 <body>
 <h2>User Registration</h2>
 <form>
 <table>
 <tr><td>Name:</td><td><input type=""text""></td></tr>
 <tr><td>Email:</td><td><input type=""email""></td></tr>
 <tr><td>Password:</td><td><input type=""password""></td></tr>
 <tr><td>Gender:</td><td>
 <input type=""radio"" name=""gender"">Male
 <input type=""radio"" name=""gender"">Female</td></tr>
 <tr><td>Address:</td><td><textarea rows=""4""></textarea></td></tr>
 <tr><td></td><td>
 <input type=""submit"" value=""Register"">
 <input type=""reset"" value=""Clear"">
 </td></tr>
 </table>
 </form>
 </body>
 </html>
6. Book Catalogue (catalogue.html)
 File Information:
 Purpose: Book catalogue with pricing and purchase options
 Features: Table layout with book titles, authors, prices, and ""Add"" buttons
 Books: 4 books with Indian Rupee pricing
 <!DOCTYPE html>
 <html>
 <head>
 <title>Catalogue</title>
 <link rel='stylesheet' href='style.css'>
 </head>
 <body>
 <h2>Book Catalogue</h2>
 <table width=""100%"">
 <tr>
 <th>Book Title</th>
 <th>Author</th>
 <th>Price</th>
 <th>Buy</th>
 </tr>
 <tr><td>Web Technology</td><td>A. Sharma</td><td>‚Çπ550</td><td><button>Add</button></td></tr>
 <tr><td>Java Programming</td><td>Herbert Schildt</td><td>‚Çπ750</td><td><button>Add</button></td></tr>
 <tr><td>Database Systems</td><td>Korth</td><td>‚Çπ600</td><td><button>Add</button></td></tr>
 <tr><td>Python for Beginners</td><td>John Doe</td><td>‚Çπ500</td><td><button>Add</button></td></tr>
 </table>
 </body>
 </html>
7. CSS Styles (style.css)
 File Information:
 Purpose: Complete CSS styling for all HTML components
 Categories: Base styles, form elements, table styling, hover effects
 Color Scheme: Professional blue theme (#2E4A62)
 body {
 font-family: Arial, sans-serif;
 margin: 20px;
 }
 h2, h1, h3 {
 color: #2E4A62;
 }
 input, textarea, select {
 padding: 6px;
 width: 90%;
 border: 1px solid #ccc;
 border-radius: 4px;
 }
 button, input[type=submit], input[type=reset] {
 padding: 8px 15px;
 border: none;
 background-color: #2E4A62;
 color: white;
 cursor: pointer;
 border-radius: 4px;
 }
 button:hover, input[type=submit]:hover, input[type=reset]:hover {
 background-color: #1b2f40;
 }
 table {
 border-collapse: collapse;
 }
 th {
 }
 background-color: #2E4A62;
 color: white;
 td, th {
 padding: 10px;
 border: 1px solid gray;
 }
"
vi8PV18C,Timed,DolenkoArtem,Lua,Sunday 23rd of November 2025 03:20:59 AM CDT,"local keyboard_test = keyboardUI(""SAY MY NAME"") 
keyboard_test:setValue(""TEST"")
while true do      
    keyboard_test:update()  
    keyboard_test:draw()      
    if keyboard_test:isFinished() then
        break
    end
end


local alert_test = alertUI(""YOU ARE?"", keyboard_test:getValue()) 
while true do      
    alert_test:update()  
    alert_test:draw()      
    if alert_test:isFinished() then
        break
    end
end

alert_test:setTitle(""NO!!! YOU ARE:"")
alert_test:setMessage(""BEST IN THE WORLD"")

while true do      
    alert_test:update()  
    alert_test:draw()      
    if alert_test:isFinished() then
        break
    end
end

local alert_test = alertUI(""DO YOU WANNA PLAY"", ""[A]YES\n[B]NO"") 
alert_test:addActivationButton(""a"")
alert_test:addActivationButton(""b"")
alert_test:draw()      
while true do   
    alert_test:update()     
    if alert_test:isFinished() then
        break
    end
end

which_key = alert_test:getButton()

if which_key == ""a"" then
    alert_test:setTitle(""ALRIGHT"")
    alert_test:setMessage(""LET`S PLAY"")
elseif which_key == ""b"" then
    alert_test:setTitle(""Okay"")
    alert_test:setMessage("":("")
end

alert_test:draw()      
while true do   
    alert_test:update()     
    if alert_test:isFinished() then
        break
    end
end

local alert_test = progressUI(""ROCKET"", ""launch"") 
for i = 0, 100 do
    display.fill_screen(0)

    alert_test:setProgress(i)
    alert_test:draw()
    util.sleep(0.05)
end"
1AUgYCAc,dp_digits,ABDELRHMAN_SAEED007,C++,Sunday 23rd of November 2025 03:10:39 AM CDT,"using ll = long long;
class Solution {

public:
    ll dp[20][2][2][11][11];
    string s1, s2;
    string s;
    int n;
    ll digit(ll i, bool f, bool started, int prev1, int prev2) {
        if (i == n)
            return 0;
        ll& ret = dp[i][f][started][prev1 + 1][prev2 + 1];
        if (ret != -1)
            return ret;
        ll res = 0;
        ll R = f ? 9 : (s[i] - '0');

        for (int dgt = 0; dgt <= R; dgt++) {

            bool nf = f || (dgt < (s[i] - '0'));
            bool nstar = started || (dgt != 0);
            int add = 0;
            int np1, np2;
            if (!nstar) {
                np1 = -1, np2 = -1;
            } else if (!started && nstar) {
                np1 = -1;
                np2 = dgt;
            } else {
                np1 = prev2;
                np2 = dgt;
                if (prev1 != -1 && prev2 != -1 && nstar) {
                    if ((prev1 < prev2 && prev2 > dgt) ||
                        (prev1 > prev2 && prev2 < dgt))
                        add = 1;
                }
            }

            res += add + digit(i + 1, nf, nstar, np1, np2);
        }
        return ret = res;
    }

    ll calc(ll x) {
        if (x <= 0)
            return 0;
        s = to_string(x);
        n = s.size();
        memset(dp, -1, sizeof(dp));
        return digit(0, 0, 0, -1, -1);
    }
    long long totalWaviness(long long num1, long long num2) {

        return calc(num2) - calc(num1 - 1);
    }
};"
nwp72jRp,Untitled,7134956,C,Sunday 23rd of November 2025 02:40:57 AM CDT,"//ACS773xCB 8.8 –º–í/–ê –ø—Ä–∏ 3.3–í. –ü–æ–ª–æ–≤–∏–Ω–∞ —à–∫–∞–ª—ã –ê–¶–ü - 187.5A
#define HW_ADC_BASE_CURRENT     (HW_STM32_VREF / 0.0088f / 2)   // –¢–æ–∫ —Å—Ç–æ–π–∫–∏, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π –ø–æ–ª–æ–≤–∏–Ω–µ —à–∫–∞–ª—ã –ê–¶–ü, (–ê)
 
//–ö–æ–Ω—Ñ–∏–≥ –ø—Ä–µ–¥–µ–ª–æ–≤ –ø–æ —Ç–æ–∫—É
#ifdef HW_CURRENT_EXTENSION     //–£–≤–µ–ª–∏—á–µ–Ω–∏–µ —Ç–æ–∫–∞ –º–æ—Ç–æ—Ä–∞ –∑–∞ —Å—á–µ—Ç –∏–∑–º–µ—Ä–µ–Ω–∏—è –ø–æ –¥–≤—É–º —Ñ–∞–∑–∞–º —Å –º–µ–Ω—å—à–∏–º —Ç–æ–∫–æ–º.
#define CURR_MULT               1.1547005383792515f     // (2/SQRT(3))
#else
#define CURR_MULT               1.0f
#endif
#define HW_CUTOFF_CURRENT		(HW_ADC_BASE_CURRENT * 0.95f * CURR_MULT)	// –¢–æ–∫ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏—è –∑–∞—â–∏—Ç—ã –Ω–∞ –æ—Ç–∫–ª—é—á–µ–Ω–∏–µ
#define HW_MAX_MOTOR_CURRENT	(HW_ADC_BASE_CURRENT * 0.90f * CURR_MULT)	// –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ç–æ–∫ —Å—Ç–∞—Ç–æ—Ä–∞ –º–æ—Ç–æ—Ä–∞"
ibPQMgkH,Fuse,Michael_ich,JSON,Sunday 23rd of November 2025 01:14:54 AM CDT,"[
    {
        ""id"": ""37e1eccd80d14579"",
        ""type"": ""server-state-changed"",
        ""z"": ""902bccd3.5302c"",
        ""name"": """",
        ""server"": ""9255c353.0ab86"",
        ""version"": 5,
        ""outputs"": 1,
        ""exposeAsEntityConfig"": """",
        ""entityId"": ""switch.shellyplus1_90150680b488"",
        ""entityIdType"": ""exact"",
        ""outputInitially"": false,
        ""stateType"": ""str"",
        ""ifState"": """",
        ""ifStateType"": ""str"",
        ""ifStateOperator"": ""is"",
        ""outputOnlyOnStateChange"": true,
        ""for"": ""0"",
        ""forType"": ""num"",
        ""forUnits"": ""minutes"",
        ""ignorePrevStateNull"": false,
        ""ignorePrevStateUnknown"": false,
        ""ignorePrevStateUnavailable"": false,
        ""ignoreCurrentStateUnknown"": false,
        ""ignoreCurrentStateUnavailable"": false,
        ""outputProperties"": [
            {
                ""property"": ""payload"",
                ""propertyType"": ""msg"",
                ""value"": """",
                ""valueType"": ""entityState""
            },
            {
                ""property"": ""data"",
                ""propertyType"": ""msg"",
                ""value"": """",
                ""valueType"": ""eventData""
            },
            {
                ""property"": ""topic"",
                ""propertyType"": ""msg"",
                ""value"": """",
                ""valueType"": ""triggerId""
            }
        ],
        ""x"": 210,
        ""y"": 1300,
        ""wires"": [
            [
                ""ddd7a92502d08779""
            ]
        ]
    },
    {
        ""id"": ""ddd7a92502d08779"",
        ""type"": ""switch"",
        ""z"": ""902bccd3.5302c"",
        ""name"": """",
        ""property"": ""payload"",
        ""propertyType"": ""msg"",
        ""rules"": [
            {
                ""t"": ""eq"",
                ""v"": ""on"",
                ""vt"": ""str""
            },
            {
                ""t"": ""eq"",
                ""v"": ""off"",
                ""vt"": ""str""
            }
        ],
        ""checkall"": ""true"",
        ""repair"": false,
        ""outputs"": 2,
        ""x"": 510,
        ""y"": 1300,
        ""wires"": [
            [
                ""732301d473672877""
            ],
            [
                ""dd8c1135f70860d9""
            ]
        ]
    },
    {
        ""id"": ""732301d473672877"",
        ""type"": ""delay"",
        ""z"": ""902bccd3.5302c"",
        ""name"": """",
        ""pauseType"": ""delay"",
        ""timeout"": ""2"",
        ""timeoutUnits"": ""hours"",
        ""rate"": ""1"",
        ""nbRateUnits"": ""1"",
        ""rateUnits"": ""second"",
        ""randomFirst"": ""1"",
        ""randomLast"": ""5"",
        ""randomUnits"": ""seconds"",
        ""drop"": false,
        ""allowrate"": false,
        ""outputs"": 1,
        ""x"": 730,
        ""y"": 1300,
        ""wires"": [
            [
                ""a46af82bfb4aca50""
            ]
        ]
    },
    {
        ""id"": ""dd8c1135f70860d9"",
        ""type"": ""change"",
        ""z"": ""902bccd3.5302c"",
        ""name"": """",
        ""rules"": [
            {
                ""t"": ""set"",
                ""p"": ""reset"",
                ""pt"": ""msg"",
                ""to"": ""1"",
                ""tot"": ""num""
            }
        ],
        ""action"": """",
        ""property"": """",
        ""from"": """",
        ""to"": """",
        ""reg"": false,
        ""x"": 760,
        ""y"": 1340,
        ""wires"": [
            [
                ""732301d473672877""
            ]
        ]
    },
    {
        ""id"": ""a46af82bfb4aca50"",
        ""type"": ""api-call-service"",
        ""z"": ""902bccd3.5302c"",
        ""name"": """",
        ""server"": ""9255c353.0ab86"",
        ""version"": 5,
        ""debugenabled"": false,
        ""domain"": ""switch"",
        ""service"": ""turn_off"",
        ""areaId"": [],
        ""deviceId"": [],
        ""entityId"": [
            ""switch.shellyplus1_90150680b488""
        ],
        ""data"": """",
        ""dataType"": ""jsonata"",
        ""mergeContext"": """",
        ""mustacheAltTags"": false,
        ""outputProperties"": [],
        ""queue"": ""none"",
        ""x"": 980,
        ""y"": 1300,
        ""wires"": [
            []
        ]
    },
    {
        ""id"": ""5cb0c762f2014463"",
        ""type"": ""comment"",
        ""z"": ""902bccd3.5302c"",
        ""name"": ""–ü—Ä–µ–¥–æ—Ö—Ä–∞–Ω–∏—Ç–µ–ª—å –æ—Ç —Ä–∞–±–æ—Ç—ã –Ω–∞ –Ω–æ—á—å"",
        ""info"": """",
        ""x"": 170,
        ""y"": 1260,
        ""wires"": []
    }
]"
hm8LCDUB,Traffic Controller rev_01,pleasedontcode,Arduino,Sunday 23rd of November 2025 01:03:20 AM CDT,"/********* Pleasedontcode.com **********

	Pleasedontcode thanks you for automatic code generation! Enjoy your code!

	- Terms and Conditions:
	You have a non-exclusive, revocable, worldwide, royalty-free license
	for personal and commercial use. Attribution is optional; modifications
	are allowed, but you're responsible for code maintenance. We're not
	liable for any loss or damage. For full terms,
	please visit pleasedontcode.com/termsandconditions.

	- Project: Traffic Controller
	- Source Code NOT compiled for: Arduino Uno
	- Source Code created on: 2025-11-23 07:01:06

********* Pleasedontcode.com **********/

/****** SYSTEM REQUIREMENTS *****/
/****** SYSTEM REQUIREMENT 1 *****/
	/* Implement a scheduling system for traffic lights */
	/* (yellow, red, green, Don't Walk, Walk) */
	/* synchronized with a push button to activate Walk */
	/* mode during yellow or red lights. Use the */
	/* EasyButton library and RTC for precise timing. */
/****** END SYSTEM REQUIREMENTS *****/


/* START CODE */

// SYSTEM REQUIREMENTS: 
// Implement a scheduling system for traffic lights
// (yellow, red, green, Don't Walk, Walk)
// synchronized with a push button to activate Walk mode during yellow or red lights.
// Use EasyButton library and RTC for precise timing.

#include <EasyButton.h>
#include <PCF85063A-SOLDERED.h>

// Define pins for traffic lights
const uint8_t pinYellow = 12;
const uint8_t pinRed = 11;
const uint8_t pinGreen = 10;
// Define pins for pedestrian signals
const uint8_t pinDontWalk = 9;
const uint8_t pinWalk = 8;
// Define push button pin to activate Walk mode
const uint8_t buttonPin = 2;

// Timing variables in milliseconds
unsigned long yellowDuration = 4000;
unsigned long redDuration = 4000;
unsigned long greenDuration = 4000;
unsigned long walkDuration = 2000;
unsigned long flashInterval = 250;

// Define button instance
EasyButton walkButton(buttonPin);

// Define RTC instance
PCF85063A rtc;

// State enumeration for traffic light states
enum State {
  S_YELLOW,
  S_RED,
  S_GREEN,
  S_DONT_WALK,
  S_WALK_STEADY,
  S_WALK_FLASH
};

State currentState = S_YELLOW;
unsigned long stateStartTime = 0;
bool walkModeActivated = false;
bool walkButtonPressed = false;

void setup() {
  // Initialize serial for debugging
  Serial.begin(115200);

  // Initialize pins
  pinMode(pinYellow, OUTPUT);
  pinMode(pinRed, OUTPUT);
  pinMode(pinGreen, OUTPUT);
  pinMode(pinDontWalk, OUTPUT);
  pinMode(pinWalk, OUTPUT);

  // Initialize RTC
  rtc.begin();
  // Set initial time and date
  rtc.setTime(6, 0, 0); // 6:00:00
  rtc.setDate(6, 15, 5, 2020); // Saturday, 15.05.2020
  // Set RTC alarm for scheduled transition if needed
  // (Optional, not used in current logic)

  // Initialize button
  walkButton.begin();
  walkButton.onPressed([](){
    walkButtonPressed = true;
  });

  // Start with yellow light
  currentState = S_YELLOW;
  stateStartTime = millis();
}

void loop() {
  // Read button state
  walkButton.read();

  // Check if walk button was pressed
  if (walkButtonPressed) {
    walkModeActivated = true;
    walkButtonPressed = false;
  }

  unsigned long currentTime = millis();

  switch (currentState) {
    case S_YELLOW:
      digitalWrite(pinYellow, HIGH);
      digitalWrite(pinRed, LOW);
      digitalWrite(pinGreen, LOW);
      digitalWrite(pinDontWalk, HIGH);
      digitalWrite(pinWalk, LOW);
      if (currentTime - stateStartTime >= yellowDuration) {
        currentState = S_RED;
        stateStartTime = currentTime;
      }
      break;

    case S_RED:
      digitalWrite(pinRed, HIGH);
      digitalWrite(pinYellow, LOW);
      digitalWrite(pinGreen, LOW);
      digitalWrite(pinDontWalk, HIGH);
      digitalWrite(pinWalk, LOW);
      if (currentTime - stateStartTime >= redDuration || walkModeActivated) {
        currentState = S_GREEN;
        stateStartTime = currentTime;
        walkModeActivated = false;
      }
      break;

    case S_GREEN:
      digitalWrite(pinGreen, HIGH);
      digitalWrite(pinYellow, LOW);
      digitalWrite(pinRed, LOW);
      digitalWrite(pinDontWalk, HIGH);
      digitalWrite(pinWalk, LOW);
      if (currentTime - stateStartTime >= greenDuration) {
        currentState = S_DONT_WALK;
        stateStartTime = currentTime;
      }
      break;

    case S_DONT_WALK:
      digitalWrite(pinDontWalk, HIGH);
      digitalWrite(pinWalk, LOW);
      if (walkModeActivated) {
        currentState = S_WALK_STEADY;
        stateStartTime = currentTime;
      } else if (currentTime - stateStartTime >= redDuration) {
        currentState = S_YELLOW;
        stateStartTime = currentTime;
      }
      break;

    case S_WALK_STEADY:
      digitalWrite(pinDontWalk, LOW);
      digitalWrite(pinWalk, HIGH);
      if (currentTime - stateStartTime >= walkDuration) {
        currentState = S_WALK_FLASH;
        stateStartTime = currentTime;
      }
      break;

    case S_WALK_FLASH:
      if ((currentTime / flashInterval) % 2 == 0) {
        digitalWrite(pinWalk, HIGH);
      } else {
        digitalWrite(pinWalk, LOW);
      }
      if (currentTime - stateStartTime >= walkDuration) {
        digitalWrite(pinWalk, LOW);
        digitalWrite(pinDontWalk, HIGH);
        walkModeActivated = false;
        currentState = S_YELLOW;
        stateStartTime = currentTime;
      }
      break;
  }
  // Optional: Use RTC to schedule precise transitions or for logging
  // Not used directly in this implementation
}

/* END CODE */
"
N9yWdDhw,S19_Q2,prcdelhi1,C,Saturday 22nd of November 2025 11:49:50 PM CDT,"/*
Write a program in ‚ÄòC‚Äô language for the creation of a Red Black tree. Also, implement insertion and deletion operations.
*/

#include <stdio.h>
#include <stdlib.h>

// Enum for node colors
typedef enum { RED, BLACK } Color;

// Red-Black Tree node structure
typedef struct Node {
    int data;
    Color color;
    struct Node *left, *right, *parent;
} Node;

// Global root node
Node *root = NULL;

// Function to create a new node
Node* createNode(int data) {
    Node *newNode = (Node*)malloc(sizeof(Node));
    newNode->data = data;
    newNode->color = RED; // New nodes are always red initially
    newNode->left = newNode->right = newNode->parent = NULL;
    return newNode;
}

// Function to perform left rotation
void leftRotate(Node *x) {
    Node *y = x->right;
    x->right = y->left;
    
    if (y->left != NULL)
        y->left->parent = x;
    
    y->parent = x->parent;
    
    if (x->parent == NULL)
        root = y;
    else if (x == x->parent->left)
        x->parent->left = y;
    else
        x->parent->right = y;
    
    y->left = x;
    x->parent = y;
}

// Function to perform right rotation
void rightRotate(Node *y) {
    Node *x = y->left;
    y->left = x->right;
    
    if (x->right != NULL)
        x->right->parent = y;
    
    x->parent = y->parent;
    
    if (y->parent == NULL)
        root = x;
    else if (y == y->parent->left)
        y->parent->left = x;
    else
        y->parent->right = x;
    
    x->right = y;
    y->parent = x;
}

// Function to fix violations after insertion
void fixInsert(Node *k) {
    Node *uncle;
    
    while (k->parent != NULL && k->parent->color == RED) {
        if (k->parent == k->parent->parent->left) {
            uncle = k->parent->parent->right;
            
            // Case 1: Uncle is red
            if (uncle != NULL && uncle->color == RED) {
                k->parent->color = BLACK;
                uncle->color = BLACK;
                k->parent->parent->color = RED;
                k = k->parent->parent;
            } else {
                // Case 2: k is right child
                if (k == k->parent->right) {
                    k = k->parent;
                    leftRotate(k);
                }
                // Case 3: k is left child
                k->parent->color = BLACK;
                k->parent->parent->color = RED;
                rightRotate(k->parent->parent);
            }
        } else {
            uncle = k->parent->parent->left;
            
            // Case 1: Uncle is red
            if (uncle != NULL && uncle->color == RED) {
                k->parent->color = BLACK;
                uncle->color = BLACK;
                k->parent->parent->color = RED;
                k = k->parent->parent;
            } else {
                // Case 2: k is left child
                if (k == k->parent->left) {
                    k = k->parent;
                    rightRotate(k);
                }
                // Case 3: k is right child
                k->parent->color = BLACK;
                k->parent->parent->color = RED;
                leftRotate(k->parent->parent);
            }
        }
        
        if (k == root) break;
    }
    
    root->color = BLACK;
}

// Insertion function
void insert(int data) {
    Node *newNode = createNode(data);
    Node *y = NULL;
    Node *x = root;
    
    // Standard BST insertion
    while (x != NULL) {
        y = x;
        if (newNode->data < x->data)
            x = x->left;
        else
            x = x->right;
    }
    
    newNode->parent = y;
    
    if (y == NULL)
        root = newNode;
    else if (newNode->data < y->data)
        y->left = newNode;
    else
        y->right = newNode;
    
    // Fix Red-Black Tree violations
    fixInsert(newNode);
}

// Function to find the minimum value node
Node* minValueNode(Node *node) {
    Node *current = node;
    while (current->left != NULL)
        current = current->left;
    return current;
}

// Function to fix violations after deletion
void fixDelete(Node *x) {
    Node *sibling;
    
    while (x != root && (x == NULL || x->color == BLACK)) {
        if (x == x->parent->left) {
            sibling = x->parent->right;
            
            // Case 1: Sibling is red
            if (sibling->color == RED) {
                sibling->color = BLACK;
                x->parent->color = RED;
                leftRotate(x->parent);
                sibling = x->parent->right;
            }
            
            // Case 2: Both sibling's children are black
            if ((sibling->left == NULL || sibling->left->color == BLACK) &&
                (sibling->right == NULL || sibling->right->color == BLACK)) {
                sibling->color = RED;
                x = x->parent;
            } else {
                // Case 3: Sibling's right child is black
                if (sibling->right == NULL || sibling->right->color == BLACK) {
                    if (sibling->left != NULL)
                        sibling->left->color = BLACK;
                    sibling->color = RED;
                    rightRotate(sibling);
                    sibling = x->parent->right;
                }
                
                // Case 4: Sibling's right child is red
                sibling->color = x->parent->color;
                x->parent->color = BLACK;
                if (sibling->right != NULL)
                    sibling->right->color = BLACK;
                leftRotate(x->parent);
                x = root;
            }
        } else {
            sibling = x->parent->left;
            
            // Case 1: Sibling is red
            if (sibling->color == RED) {
                sibling->color = BLACK;
                x->parent->color = RED;
                rightRotate(x->parent);
                sibling = x->parent->left;
            }
            
            // Case 2: Both sibling's children are black
            if ((sibling->left == NULL || sibling->left->color == BLACK) &&
                (sibling->right == NULL || sibling->right->color == BLACK)) {
                sibling->color = RED;
                x = x->parent;
            } else {
                // Case 3: Sibling's left child is black
                if (sibling->left == NULL || sibling->left->color == BLACK) {
                    if (sibling->right != NULL)
                        sibling->right->color = BLACK;
                    sibling->color = RED;
                    leftRotate(sibling);
                    sibling = x->parent->left;
                }
                
                // Case 4: Sibling's left child is red
                sibling->color = x->parent->color;
                x->parent->color = BLACK;
                if (sibling->left != NULL)
                    sibling->left->color = BLACK;
                rightRotate(x->parent);
                x = root;
            }
        }
    }
    
    if (x != NULL)
        x->color = BLACK;
}

// Transplant function for deletion
void transplant(Node *u, Node *v) {
    if (u->parent == NULL)
        root = v;
    else if (u == u->parent->left)
        u->parent->left = v;
    else
        u->parent->right = v;
    
    if (v != NULL)
        v->parent = u->parent;
}

// Deletion function
void deleteNode(int data) {
    Node *z = root;
    Node *x, *y;
    
    // Find the node to delete
    while (z != NULL) {
        if (data == z->data)
            break;
        else if (data < z->data)
            z = z->left;
        else
            z = z->right;
    }
    
    if (z == NULL) {
        printf(""Node with data %d not found!\n"", data);
        return;
    }
    
    y = z;
    Color yOriginalColor = y->color;
    
    if (z->left == NULL) {
        x = z->right;
        transplant(z, z->right);
    } else if (z->right == NULL) {
        x = z->left;
        transplant(z, z->left);
    } else {
        y = minValueNode(z->right);
        yOriginalColor = y->color;
        x = y->right;
        
        if (y->parent == z) {
            if (x != NULL)
                x->parent = y;
        } else {
            transplant(y, y->right);
            y->right = z->right;
            y->right->parent = y;
        }
        
        transplant(z, y);
        y->left = z->left;
        y->left->parent = y;
        y->color = z->color;
    }
    
    free(z);
    
    if (yOriginalColor == BLACK && x != NULL)
        fixDelete(x);
}

// Inorder traversal
void inorder(Node *node) {
    if (node == NULL) return;
    inorder(node->left);
    printf(""%d(%s) "", node->data, node->color == RED ? ""RED"" : ""BLACK"");
    inorder(node->right);
}

// Preorder traversal
void preorder(Node *node) {
    if (node == NULL) return;
    printf(""%d(%s) "", node->data, node->color == RED ? ""RED"" : ""BLACK"");
    preorder(node->left);
    preorder(node->right);
}

// Function to display the tree
void displayTree() {
    printf(""Inorder traversal: "");
    inorder(root);
    printf(""\n"");
    
    printf(""Preorder traversal: "");
    preorder(root);
    printf(""\n\n"");
}

// Function to search for a node
Node* search(int data) {
    Node *current = root;
    while (current != NULL) {
        if (data == current->data)
            return current;
        else if (data < current->data)
            current = current->left;
        else
            current = current->right;
    }
    return NULL;
}

int main() {
    int choice, data;
    Node *result;
    
    printf(""Red-Black Tree Implementation\n"");
    printf(""=============================\n"");
    
    while (1) {
        printf(""\nMenu:\n"");
        printf(""1. Insert\n"");
        printf(""2. Delete\n"");
        printf(""3. Search\n"");
        printf(""4. Display Tree\n"");
        printf(""5. Exit\n"");
        printf(""Enter your choice: "");
        scanf(""%d"", &choice);
        
        switch (choice) {
            case 1:
                printf(""Enter data to insert: "");
                scanf(""%d"", &data);
                insert(data);
                printf(""Node %d inserted successfully.\n"", data);
                displayTree();
                break;
                
            case 2:
                printf(""Enter data to delete: "");
                scanf(""%d"", &data);
                deleteNode(data);
                printf(""Node %d deleted successfully.\n"", data);
                displayTree();
                break;
                
            case 3:
                printf(""Enter data to search: "");
                scanf(""%d"", &data);
                result = search(data);
                if (result != NULL)
                    printf(""Node %d found in the tree.\n"", data);
                else
                    printf(""Node %d not found in the tree.\n"", data);
                break;
                
            case 4:
                displayTree();
                break;
                
            case 5:
                printf(""Exiting program...\n"");
                exit(0);
                
            default:
                printf(""Invalid choice! Please try again.\n"");
        }
    }
    
    return 0;
}"
UEd9JJ8w,keys.json,zak123xdmm,JSON,Saturday 22nd of November 2025 09:20:04 PM CDT,"{
  ""keys"": [""TRON2025"", ""DICIEMBRE"", ""AVITORONTOP"" , ""VERSONTOP""]
}"
3Xea5vrX,resin place,Whitebadger,Lua,Saturday 22nd of November 2025 09:12:01 PM CDT,"-- code requires felling turtle with slot 1 to have resin basin, and inventory filled with rubber logs
t = turtle -- declare turtle to be variable ""t"" to decrease redundant coding
while true do -- infinite loop
	os.pullEvent(""redstone"") -- waiting for a redstone event to happen
	t.place() -- places the resin collector
	os.sleep(7) -- waiting for resin to collect
	t.dig() -- collecting resin basin back
end"
VyTjj2Uy,chop/plant,Whitebadger,Lua,Saturday 22nd of November 2025 09:10:25 PM CDT,"-- code requires felling turtle with wireless modem and slot 1 to have bonemeal, slot 2 to have saplings and the rest of the inventory to have rubber logs
t = turtle -- declare turtle to be variable ""t"" to decrease redundant coding
peripheral.find(""modem"", rednet.open) -- open the modem and shi
while true do -- infinite loop bruh
	t.place() -- places bonemeal on tree
	t.select(3) -- selects a slot with rubber log in it to compare with block in front of it
	if t.compare() then -- seeing if theres a tree in front of turtle
		rs.setOutput(""right"", true) -- sends redstone signal to other turtle
		os.sleep(0.5) -- waits half a second
		rs.setOutput(""right"", false) -- turns redstone off
		os.sleep(8) -- waits for resin to be collected
		t.select(1) -- selects bonemeal slot if there is a tree
		t.dig() --breaks the tree bro trust
	else
		t.select(1) -- selects bonemeal slot if there is no tree
	end
	if t.detect() then -- detects if theres a sapling still or if a tree has been cut
		t.select(1) -- redundantly selects bonemeal slot
		t.place() --places bonemeal
	else
		t.select(2) -- selects sapling to place
		t.place() -- places sapling
		t.select(1) -- selects bonemeal slot
		
	end
end"
6hzDz6Yb,Untitled,ImmortalWhite,Lua,Saturday 22nd of November 2025 09:09:46 PM CDT,"-- StarterPlayer/StarterPlayerScripts/RootMotionClient.lua
local Players = game:GetService(""Players"")
local RunService = game:GetService(""RunService"")
local ReplicatedStorage = game:GetService(""ReplicatedStorage"")
local UserInputService = game:GetService(""UserInputService"")
local AbilityEvent = ReplicatedStorage:WaitForChild(""RootMotionAbility"")
local player = Players.LocalPlayer
local AbilityConfig = {
	DashSlash = {
		Duration = 0.4,
		Range = 18,
	},
}
local Animations = {
	DashSlash = """", 
}
local CurrentAbility = nil
local function easeInOutQuad(t)
	if t <= 0 then
		return 0
	end
	if t >= 1 then
		return 1
	end
	if t < 0.5 then
		return 2 * t * t
	else
		local u = -2 * t + 2
		return 1 - (u * u) / 2
	end
end
local function getCharacterParts()
	local character = player.Character or player.CharacterAdded:Wait()
	local root = character:FindFirstChild(""HumanoidRootPart"")
	local humanoid = character:FindFirstChildOfClass(""Humanoid"")
	local animator = humanoid and humanoid:FindFirstChildOfClass(""Animator"")
	return character, root, humanoid, animator
end
local function playAbilityAnimation(abilityId)
	local animId = Animations[abilityId]
	if not animId or animId == """" then
		print(""Client no animation id for"", abilityId, ""movement will still play"")
		return
	end
	local _, _, humanoid, animator = getCharacterParts()
	if not humanoid then
		print(""Client no humanoid for animation"")
		return
	end
	local targetAnimator = animator or humanoid:FindFirstChildOfClass(""Animator"")
	if not targetAnimator then
		print(""Client no animator for animation"")
		return
	end
	local animation = Instance.new(""Animation"")
	animation.AnimationId = animId
	local track = targetAnimator:LoadAnimation(animation)
	track:Play()
end
local function onServerStart(abilityId, startTime, startCFrame)
	local config = AbilityConfig[abilityId]
	if not config then
		print(""Client unknown ability"", abilityId)
		return
	end
	local _, root = getCharacterParts()
	if not root then
		print(""Client no root to start ability"")
		return
	end
	if CurrentAbility then
		print(""Client ability already active, ignoring"", abilityId)
		return
	end
	CurrentAbility = {
		AbilityId = abilityId,
		StartTime = startTime,
		StartCFrame = startCFrame,
		Facing = startCFrame.LookVector,
		LastAlpha = 0,
	}
	print(""Client ability start"", abilityId, ""at"", startTime)
	playAbilityAnimation(abilityId)
end
AbilityEvent.OnClientEvent:Connect(function(action, abilityId, startTime, startCFrame)
	if action == ""Start"" then
		onServerStart(abilityId, startTime, startCFrame)
	end
end)
UserInputService.InputBegan:Connect(function(input, gameProcessed)
	if gameProcessed then
		return
	end
	if input.UserInputType == Enum.UserInputType.Keyboard and input.KeyCode == Enum.KeyCode.Q then
		if CurrentAbility then
			print(""Client ability already active, cannot request"")
			return
		end
		print(""Client requesting DashSlash"")
		AbilityEvent:FireServer(""Request"", ""DashSlash"")
	end
end)
RunService.RenderStepped:Connect(function()
	local state = CurrentAbility
	if not state then
		return
	end
	local config = AbilityConfig[state.AbilityId]
	if not config then
		print(""Client missing config during ability, cancelling"")
		CurrentAbility = nil
		return
	end
	local _, root = getCharacterParts()
	if not root then
		print(""Client lost root during ability, cancelling"")
		CurrentAbility = nil
		return
	end
	local now = os.clock()
	local alpha = (now - state.StartTime) / config.Duration
	if alpha >= 1 then
		print(""Client ability finished"", state.AbilityId)
		CurrentAbility = nil
		return
	end
	local distNow = config.Range * easeInOutQuad(alpha)
	local distLast = config.Range * easeInOutQuad(state.LastAlpha)
	state.LastAlpha = alpha
	local target = state.StartCFrame + state.Facing * distNow
	root.CFrame = root.CFrame:Lerp(target, 0.3)
end)
"
RfbRayf4,Untitled,ImmortalWhite,Lua,Saturday 22nd of November 2025 09:08:43 PM CDT,"-- ServerScriptService/RootMotionServer.lua
local Players = game:GetService(""Players"")
local RunService = game:GetService(""RunService"")
local ReplicatedStorage = game:GetService(""ReplicatedStorage"")

local AbilityEvent = ReplicatedStorage:WaitForChild(""RootMotionAbility"")

local AbilityConfig = {
	DashSlash = {
		Duration = 0.4,
		Range = 18,
		HitRadius = 5,
		Damage = 25,
	},
}

local Active = {}

local function easeInOutQuad(t)
	if t <= 0 then
		return 0
	end
	if t >= 1 then
		return 1
	end
	if t < 0.5 then
		return 2 * t * t
	else
		local u = -2 * t + 2
		return 1 - (u * u) / 2
	end
end

local function stopAbility(player, reason)
	if Active[player] then
		print(""Server ability end"", player.Name, Active[player].AbilityId, reason or ""finished"")
		Active[player] = nil
	end
end

local function startAbility(player, abilityId)
	local config = AbilityConfig[abilityId]
	if not config then
		print(""Server unknown ability"", abilityId)
		return
	end

	if Active[player] then
		print(""Server ability rejected, already active"", player.Name)
		return
	end

	local character = player.Character
	if not character then
		print(""Server no character"", player.Name)
		return
	end

	local root = character:FindFirstChild(""HumanoidRootPart"")
	local humanoid = character:FindFirstChildOfClass(""Humanoid"")
	if not root or not humanoid or humanoid.Health <= 0 then
		print(""Server invalid character state"", player.Name)
		return
	end

	local startTime = os.clock()
	local startCFrame = root.CFrame
	local facing = startCFrame.LookVector

	Active[player] = {
		AbilityId = abilityId,
		StartTime = startTime,
		LastAlpha = 0,
		StartCFrame = startCFrame,
		Facing = facing,
		HitDone = false,
	}

	print(""Server ability start"", player.Name, abilityId, ""at"", startTime)

	AbilityEvent:FireClient(player, ""Start"", abilityId, startTime, startCFrame)
end

AbilityEvent.OnServerEvent:Connect(function(player, action, abilityId)
	if action == ""Request"" then
		print(""Server request received"", player.Name, abilityId)
		startAbility(player, abilityId)
	end
end)

Players.PlayerRemoving:Connect(function(player)
	if Active[player] then
		Active[player] = nil
	end
end)

RunService.Heartbeat:Connect(function()
	local now = os.clock()

	for player, state in pairs(Active) do
		local config = AbilityConfig[state.AbilityId]
		if not config then
			stopAbility(player, ""missing_config"")
			continue
		end

		local character = player.Character
		local root = character and character:FindFirstChild(""HumanoidRootPart"")
		local humanoid = character and character:FindFirstChildOfClass(""Humanoid"")

		if not root or not humanoid or humanoid.Health <= 0 then
			stopAbility(player, ""no_root_or_dead"")
			continue
		end

		local alpha = (now - state.StartTime) / config.Duration
		if alpha >= 1 then
			stopAbility(player, ""duration_complete"")
			continue
		end

		local distNow = config.Range * easeInOutQuad(alpha)
		local distLast = config.Range * easeInOutQuad(state.LastAlpha)
		state.LastAlpha = alpha

		local step = distNow - distLast
		if step > 0 then
			local target = state.StartCFrame + state.Facing * distNow
			root.CFrame = target
		end

		if not state.HitDone then
			local origin = root.Position
			for _, other in ipairs(Players:GetPlayers()) do
				if other ~= player then
					local och = other.Character
					local oroot = och and och:FindFirstChild(""HumanoidRootPart"")
					local ohum = och and och:FindFirstChildOfClass(""Humanoid"")
					if oroot and ohum and ohum.Health > 0 then
						if (oroot.Position - origin).Magnitude <= config.HitRadius then
							print(""Server hit"", player.Name, ""->"", other.Name, ""for"", config.Damage)
							ohum:TakeDamage(config.Damage)
							state.HitDone = true
							break
						end
					end
				end
			end
		end
	end
end)
"
fU72VDwC,planter,Whitebadger,Lua,Saturday 22nd of November 2025 08:22:24 PM CDT,"t = turtle -- declare turtle to be variable ""t"" to decrease redundant coding
peripheral.find(""modem"", rednet.open) -- open the modem and shi
while true do -- infinite loop
	id, m = rednet.receive() --looks for message of my super secret code
	if m == 12345 then -- looks to see if code matches super secret one
		turtle.place() -- places the sapling
	end
end"
rAQAEQrc,Survive Wave Z Aimbot,NXTTOANOZ,Lua,Saturday 22nd of November 2025 08:18:51 PM CDT,"local plr = game:GetService(""Players"")
local rs = game:GetService(""RunService"")
local ws = game:GetService(""Workspace"")
local player = plr.LocalPlayer
local cam = ws.CurrentCamera

local main = Instance.new(""ScreenGui"")
main.Name = ""AimbotSWZ""
main.Parent = game.CoreGui

local btn = Instance.new(""TextButton"")
btn.Parent = main
btn.Size = UDim2.new(0, 150, 0, 50)
btn.Position = UDim2.new(0, 10, 0.5, -60)
btn.BackgroundColor3 = Color3.fromRGB(255, 0, 0)
btn.Text = ""AIMBOT: OFF""
btn.TextColor3 = Color3.new(1, 1, 1)

local closebtn = Instance.new(""TextButton"")
closebtn.Parent = main
closebtn.Size = UDim2.new(0, 30, 0, 30)
closebtn.Position = UDim2.new(0, 165, 0.5, -60)
closebtn.BackgroundColor3 = Color3.fromRGB(180, 0, 0)
closebtn.Text = ""X""
closebtn.TextColor3 = Color3.new(1, 1, 1)

local enabled = false

closebtn.MouseButton1Click:Connect(function()
    enabled = false
    main:Destroy()
end)

btn.MouseButton1Click:Connect(function()
    enabled = not enabled
    if enabled then
        btn.Text = ""AIMBOT: ON""
        btn.BackgroundColor3 = Color3.fromRGB(0, 255, 0)
    else
        btn.Text = ""AIMBOT: OFF""
        btn.BackgroundColor3 = Color3.fromRGB(255, 0, 0)
    end
end)

function findtarget()
    local closest = math.huge
    local target = nil
    local zombies = ws:FindFirstChild(""Zombies"")
    
    local char = player.Character
    local root = char and char:FindFirstChild(""HumanoidRootPart"")

    if not zombies or not root then return end

    for i, v in pairs(zombies:GetChildren()) do
        if tonumber(v.Name) then
            local head = v:FindFirstChild(""Head"")
            if head then
                local dist = (head.Position - root.Position).Magnitude
                if dist < closest then
                    closest = dist
                    target = head
                end
            end
        end
    end
    return target
end

rs.RenderStepped:Connect(function()
    if enabled then
        local t = findtarget()
        if t then
            cam.CFrame = CFrame.new(cam.CFrame.Position, t.Position)
        end
    end
end)"
sZqpfwiG,Fisch script,Yhehewgq,Lua,Saturday 22nd of November 2025 07:46:53 PM CDT,"-- Fisch Script by JayRBLX Scripts (Fixed Version)
-- Load Rayfield UI Library
local Rayfield = loadstring(game:HttpGet('https://sirius.menu/rayfield'))()

-- Create Window
local Window = Rayfield:CreateWindow({
   Name = ""Fisch Script | by JayRBLX Scripts"",
   LoadingTitle = ""Loading Fisch Script"",
   LoadingSubtitle = ""by JayRBLX Scripts"",
   ConfigurationSaving = {
      Enabled = true,
      FolderName = nil,
      FileName = ""FischScript""
   },
   Discord = {
      Enabled = false,
      Invite = ""noinvitelink"",
      RememberJoins = true
   },
   KeySystem = false
})

-- Services
local Players = game:GetService(""Players"")
local ReplicatedStorage = game:GetService(""ReplicatedStorage"")
local RunService = game:GetService(""RunService"")

-- Variables
local player = Players.LocalPlayer
local character = player.Character or player.CharacterAdded:Wait()
local humanoid = character:WaitForChild(""Humanoid"")
local rootPart = character:WaitForChild(""HumanoidRootPart"")

-- Feature Toggles
local autoCastEnabled = false
local autoShakeEnabled = false
local autoReelEnabled = false
local infiniteOxygen = false
local noclipEnabled = false
local flyEnabled = false

-- ====================
-- FISHING FUNCTIONS
-- ====================

-- Original Shake Function (DO NOT CHANGE)
local function autoShake()
   local shakeui = player.PlayerGui:FindFirstChild(""shakeui"")
   if shakeui and shakeui:FindFirstChild(""safezone"") and shakeui.safezone:FindFirstChild(""button"") then
      shakeui.safezone.button.shake:FireServer()
      return true
   end
   return false
end

-- Auto Cast Loop - NEW METHOD
spawn(function()
   while task.wait(3) do -- Wait 3 seconds between casts
      if autoCastEnabled then
         local success = pcall(function()
            -- Check if ANY fishing UI is active
            local reelUI = player.PlayerGui:FindFirstChild(""reel"")
            local shakeUI = player.PlayerGui:FindFirstChild(""shakeui"")
            local progressUI = player.PlayerGui:FindFirstChild(""progress"")
            
            -- Only cast if no fishing activity is happening
            if not reelUI and not shakeUI and not progressUI then
               -- Find the tool
               local tool = player.Character:FindFirstChildOfClass(""Tool"") or player.Backpack:FindFirstChildOfClass(""Tool"")
               
               -- Equip if in backpack
               if tool and tool.Parent == player.Backpack then
                  player.Character.Humanoid:EquipTool(tool)
                  task.wait(0.5)
               end
               
               -- Now cast
               if tool and tool:FindFirstChild(""events"") then
                  local castEvent = tool.events:FindFirstChild(""cast"")
                  if castEvent then
                     castEvent:FireServer(100, 1)
                     task.wait(0.5)
                  end
               end
            end
         end)
         
         if not success then
            task.wait(1)
         end
      end
   end
end)

-- Auto Shake Loop (ORIGINAL - DO NOT CHANGE)
spawn(function()
   while task.wait(0.1) do
      if autoShakeEnabled then
         pcall(function()
            autoShake()
         end)
      end
   end
end)

-- Auto Reel Loop - COMPLETELY REDONE
spawn(function()
   while task.wait(0.1) do
      if autoReelEnabled then
         pcall(function()
            -- Check if reel UI actually exists
            local reelUI = player.PlayerGui:FindFirstChild(""reel"")
            
            if reelUI then
               -- Wait a moment for the reel to fully load
               task.wait(0.3)
               
               -- Try ReplicatedStorage method
               local events = ReplicatedStorage:FindFirstChild(""events"")
               if events then
                  local reelfinished = events:FindFirstChild(""reelfinished"")
                  if reelfinished then
                     -- Try with false (from working script)
                     reelfinished:FireServer(100, false)
                     print(""[Auto Reel] Reel completed!"")
                     task.wait(1) -- Wait before trying again
                  end
               end
            end
         end)
      end
   end
end)

-- ====================
-- HOME TAB
-- ====================
local HomeTab = Window:CreateTab(""üè† Home"", 4483362458)
local HomeSection = HomeTab:CreateSection(""Welcome!"")

HomeTab:CreateParagraph({
   Title = ""Welcome to Fisch Script!"",
   Content = ""This script provides automation features for fishing, teleportation options, and various movement enhancements. Toggle features in their respective tabs. Created by JayRBLX Scripts.""
})

HomeTab:CreateLabel(""Version: 2.3.0 (Fixed)"")
HomeTab:CreateLabel(""Status: ‚úÖ Loaded Successfully"")

-- ====================
-- FISH TAB
-- ====================
local FishTab = Window:CreateTab(""üé£ Fish"", 4483362458)
local FishSection = FishTab:CreateSection(""Fishing Features"")

FishTab:CreateLabel(""‚ö†Ô∏è Equip your fishing rod first!"")

-- Auto Cast Toggle
FishTab:CreateToggle({
   Name = ""Auto Cast (Perfect Cast)"",
   CurrentValue = false,
   Flag = ""AutoCast"",
   Callback = function(Value)
      autoCastEnabled = Value
      if Value then
         Rayfield:Notify({
            Title = ""Auto Cast Enabled"",
            Content = ""Automatically casting rod with perfect power"",
            Duration = 3,
            Image = 4483362458
         })
      end
   end,
})

-- Auto Shake Toggle
FishTab:CreateToggle({
   Name = ""Auto Shake"",
   CurrentValue = false,
   Flag = ""AutoShake"",
   Callback = function(Value)
      autoShakeEnabled = Value
      if Value then
         Rayfield:Notify({
            Title = ""Auto Shake Enabled"",
            Content = ""Automatically clicking shake button"",
            Duration = 3,
            Image = 4483362458
         })
      end
   end,
})

-- Auto Reel Toggle
FishTab:CreateToggle({
   Name = ""Auto Reel (Instant Complete)"",
   CurrentValue = false,
   Flag = ""AutoReel"",
   Callback = function(Value)
      autoReelEnabled = Value
      if Value then
         Rayfield:Notify({
            Title = ""Auto Reel Enabled"",
            Content = ""Automatically completing reel"",
            Duration = 3,
            Image = 4483362458
         })
      end
   end,
})

FishTab:CreateLabel(""üí° Enable all 3 for full automation!"")

-- Infinite Oxygen Toggle
FishTab:CreateToggle({
   Name = ""Infinite Oxygen (No Drowning)"",
   CurrentValue = false,
   Flag = ""InfiniteOxygen"",
   Callback = function(Value)
      infiniteOxygen = Value
   end,
})

-- Infinite oxygen connection
RunService.Heartbeat:Connect(function()
   if infiniteOxygen then
      if player.Character then
         local clientFolder = player.Character:FindFirstChild(""client"")
         if clientFolder then
            local oxygen = clientFolder:FindFirstChild(""oxygen"")
            if oxygen and oxygen:IsA(""NumberValue"") then
               oxygen.Value = 100
            end
         end
      end
   end
end)

-- ====================
-- TELEPORT TAB
-- ====================
local TeleportTab = Window:CreateTab(""üìç Teleport"", 4483362458)
local TeleportSection = TeleportTab:CreateSection(""Map Locations"")

-- Teleport locations for Fisch
local locations = {
   [""Moosewood""] = CFrame.new(387, 133, 235),
   [""Ocean""] = CFrame.new(-1530, 133, -1031),
   [""Snowcap Island""] = CFrame.new(2648, 139, 2522),
   [""Roslit Bay""] = CFrame.new(-1480, 134, 685),
   [""Forsaken Shores""] = CFrame.new(-2545, 133, 1562),
   [""Sunstone Island""] = CFrame.new(-933, 133, -1123),
   [""Mushgrove Swamp""] = CFrame.new(2503, 133, -727),
   [""The Depths""] = CFrame.new(998, -710, 1234),
   [""Vertigo""] = CFrame.new(-112, -492, 1040),
   [""Terrapin Island""] = CFrame.new(75, 138, 2838),
   [""Ancient Isle""] = CFrame.new(5732, 133, 369),
   [""Statue of Sovereignty""] = CFrame.new(38, 138, -1032),
   [""Forsaken Shores Pier""] = CFrame.new(-2075, 135, 1631),
   [""Roslit Pier""] = CFrame.new(-1483, 135, 686),
   [""Volcano""] = CFrame.new(-1888, 163, 330)
}

for locationName, cframe in pairs(locations) do
   TeleportTab:CreateButton({
      Name = ""Teleport to "" .. locationName,
      Callback = function()
         if player.Character and player.Character:FindFirstChild(""HumanoidRootPart"") then
            player.Character.HumanoidRootPart.CFrame = cframe
            Rayfield:Notify({
               Title = ""Teleported!"",
               Content = ""Teleported to "" .. locationName,
               Duration = 3,
               Image = 4483362458
            })
         end
      end,
   })
end

-- ====================
-- OTHER TAB
-- ====================
local OtherTab = Window:CreateTab(""‚öôÔ∏è Other"", 4483362458)
local MovementSection = OtherTab:CreateSection(""Movement Settings"")

-- Walk Speed Slider
OtherTab:CreateSlider({
   Name = ""Walk Speed"",
   Range = {16, 200},
   Increment = 1,
   CurrentValue = 16,
   Flag = ""WalkSpeed"",
   Callback = function(Value)
      if humanoid then
         humanoid.WalkSpeed = Value
      end
   end,
})

-- Jump Power Slider
OtherTab:CreateSlider({
   Name = ""Jump Power"",
   Range = {50, 300},
   Increment = 1,
   CurrentValue = 50,
   Flag = ""JumpPower"",
   Callback = function(Value)
      if humanoid then
         humanoid.JumpPower = Value
      end
   end,
})

-- Noclip Toggle
OtherTab:CreateToggle({
   Name = ""No Clip"",
   CurrentValue = false,
   Flag = ""Noclip"",
   Callback = function(Value)
      noclipEnabled = Value
      if Value then
         spawn(function()
            while noclipEnabled do
               wait()
               if player.Character then
                  for _, part in pairs(player.Character:GetDescendants()) do
                     if part:IsA(""BasePart"") then
                        part.CanCollide = false
                     end
                  end
               end
            end
         end)
      else
         if player.Character then
            for _, part in pairs(player.Character:GetDescendants()) do
               if part:IsA(""BasePart"") and part.Name ~= ""HumanoidRootPart"" then
                  part.CanCollide = true
               end
            end
         end
      end
   end,
})

-- Fly Toggle
OtherTab:CreateToggle({
   Name = ""Fly (External Script)"",
   CurrentValue = false,
   Flag = ""Fly"",
   Callback = function(Value)
      flyEnabled = Value
      if Value then
         loadstring(game:HttpGet(""https://rawscripts.net/raw/Universal-Script-Gui-Fly-v3-37111""))()
      end
   end,
})

-- ESP Section
local ESPSection = OtherTab:CreateSection(""ESP Settings"")

-- ESP Players Toggle
OtherTab:CreateToggle({
   Name = ""ESP Players"",
   CurrentValue = false,
   Flag = ""ESPPlayers"",
   Callback = function(Value)
      if Value then
         for _, v in pairs(game.Players:GetPlayers()) do
            if v ~= player and v.Character then
               local highlight = Instance.new(""Highlight"")
               highlight.Name = ""PlayerESP""
               highlight.Adornee = v.Character
               highlight.FillColor = Color3.fromRGB(255, 0, 0)
               highlight.OutlineColor = Color3.fromRGB(255, 255, 255)
               highlight.FillTransparency = 0.5
               highlight.OutlineTransparency = 0
               highlight.Parent = v.Character
            end
         end
         
         game.Players.PlayerAdded:Connect(function(v)
            v.CharacterAdded:Connect(function(char)
               if Value then
                  wait(0.5)
                  local highlight = Instance.new(""Highlight"")
                  highlight.Name = ""PlayerESP""
                  highlight.Adornee = char
                  highlight.FillColor = Color3.fromRGB(255, 0, 0)
                  highlight.OutlineColor = Color3.fromRGB(255, 255, 255)
                  highlight.FillTransparency = 0.5
                  highlight.OutlineTransparency = 0
                  highlight.Parent = char
               end
            end)
         end)
      else
         for _, v in pairs(game.Players:GetPlayers()) do
            if v.Character and v.Character:FindFirstChild(""PlayerESP"") then
               v.Character.PlayerESP:Destroy()
            end
         end
      end
   end,
})

-- Credits
local CreditsSection = OtherTab:CreateSection(""Credits"")
OtherTab:CreateLabel(""Script by JayRBLX Scripts"")
OtherTab:CreateLabel(""UI Library: Rayfield"")
OtherTab:CreateLabel(""Fixed Auto Cast & Reel"")

Rayfield:LoadConfiguration()"
8zWPGnKQ,rubber chopper,Whitebadger,Lua,Saturday 22nd of November 2025 07:30:41 PM CDT,"-- code requires felling turtle with wireless modem and slot 1 to have bonemeal, and slot 2 to have rubber logs
t = turtle -- declare turtle to be variable ""t"" to decrease redundant coding
peripheral.find(""modem"", rednet.open) -- open the modem and shi
while true do
	t.place() -- places bonemeal on tree
	t.select(2) -- selects a slot with rubber log in it to compare with block in front of it
	if t.compare() then -- seeing if theres a tree in front of turtle
		t.select(1) -- selects bonemeal slot if there is a tree
		t.dig() --breaks the tree bro trust
	else
		t.select(1) -- selects bonemeal slot if there is no tree
	end
	rednet.broadcast(12345) -- sends my super secret code to do some stuff
	os.sleep(1)
end"
j5ZUEndc,IPTVregion - List N4 of 25 M3U File verified working for free - IPTV 21/11/2025,iptvregion,JavaScript,Saturday 22nd of November 2025 05:52:53 PM CDT,"List N4 of 25 M3U File verified working for free - IPTV 21/11/2025

‚ñº‚ñº‚ñº‚ñº
https://www.iptvregion.eu.org/2025/11/list-n4-of-25-m3u-file-verified-working.html
‚ñ≤‚ñ≤‚ñ≤‚ñ≤


join to us : linktr.ee/iptvregion

TAG: iptv,best iptv,what is iptv,iptv service,best iptv service,iptv news,iptv services,is iptv illegal,top iptv service,iptv box,iptv 2025,free iptv,the best iptv service,que es iptv,iptv subscription,is iptv legal,iptv service reviews,iptv shut down,iptv shutdown,ventajas iptv,benefits of iptv,iptv smartphones pro,top iptv providers,iptv review,iptv player,listas iptv,top iptv 2025,usa iptv 2025,best iptv
	"
7JDazYhk,Amazon Product: Your browsing historyView or edit your browsing historyPage ‚Äî REVIEW ‚Äî B0F99J9YSJ,NeonHD,JSON,Saturday 22nd of November 2025 04:25:10 PM CDT,"{
  ""reviewBody"": ""üü¢ Ôº∞Ôº≤ÔºØÔº≥\n‚ûú Smart, space-efficient layout for a full-size board\n‚ûú Clean black look with a stylish wave profile\n‚ûú Comfortable, cushioned wrist rest\n‚ûú Surprisingly natural typing feel\n‚ûú Very quiet key presses\n\nüü† Ôº≠Ôº•Ôº®Ôº≥\n‚ûú Wave design practical benefit isn‚Äôt immediately obvious\n\nüî¥ Ôº£ÔºØÔºÆÔº≥\n‚ûú A few keys are arranged differently than on traditional layouts\n\nüîµ Ôº≠Ôºπ Ôº¥Ôº®ÔºØÔºµÔºßÔº®Ôº¥Ôº≥\nAfter spending some time with this keyboard, what stands out most is how effortless it feels to use. The layout manages to keep everything within reach without taking up the usual full-size footprint, and the wave design really elevates the desk aesthetic. The typing experience is soft, quiet, and genuinely pleasant.\n\nThe only thing that might throw you off is the non-standard placement of a few keys. It‚Äôs nothing that breaks the experience, but you may catch yourself reaching in the wrong spot during the first few days. Once your hands adjust, though, it becomes second nature.\n\nüü£ Ôº£ÔºØÔºÆÔº£Ôº¨ÔºµÔº≥Ôº©ÔºØÔºÆ\nFor around $40, this keyboard delivers a lot: comfort, style, quiet typing, and a layout that packs more into less space. While it has a bit of a learning curve, it‚Äôs minor‚Äîand well worth it for the overall experience."",
  ""reviewTitle"": ""Great keyboard for comfort and style"",
  ""asin"": ""B0F99J9YSJ"",
  ""productTitle"": ""Your browsing historyView or edit your browsing historyPage 1 of 1  Start again"",
  ""savedAt"": ""2025-11-22T22:25:10.061Z""
}"
rSMMzjpC,Amazon Product: Your browsing historyView or edit your browsing historyPage ‚Äî REVIEW ‚Äî B0FDQK4XCJ,NeonHD,JSON,Saturday 22nd of November 2025 04:14:00 PM CDT,"{
  ""reviewBody"": ""üü¢  Ôº∞Ôº≤ÔºØÔº≥\n‚ûú Very well thought out layout to maximize keys while minimizing footprint\n‚ûú Love the wave design and all-white aesthetic\n‚ûú Cushioned wrist rest feels very nice\n‚ûú Feels very natural to type on\n‚ûú Keys are very silent\n\nüü† Ôº≠Ôº•Ôº®Ôº≥\n‚ûú Not seeing any real advantage so far with wave design\n\nüî¥  Ôº£ÔºØÔºÆÔº≥\n‚ûú FN key placement is very wrong IMO\n‚ûú No BT connectivity, only 2.4Ghz  \n\nüîµ  Ôº≠Ôºπ Ôº¥Ôº®ÔºØÔºµÔºßÔº®Ôº¥Ôº≥\nI'm really pleased with this keyboard, it's got a fantastic optimized layout that makes typing feel natural and comfortable. For a full size keyboard, I appreciate the optimized layout that minimizes footprint. The wave design looks great, and the all-white aesthetic fits perfectly into my workspace. What I like most is how silent the keys are, which is a huge plus for anyone who works in a quiet environment. \n\nIf I had to make one criticism though, it'd be that it might be hard to adapt to the keyboard layout. In the manual, it explicitly mentions that those who struggle typing with the ergonomic wave design will eventually adapt over time. But really, I don't think it's the wave design that's the issue here, but rather the layout of the keys. For instance, the FN key sits right where the WIN key usually sits on most other keyboards. Why did they have to put that there? That's the ùóøùó≤ùóÆùóπ issue, not its design. The placement of the arrow keys will also need some getting used to as well.\n\nüü£  Ôº£ÔºØÔºÆÔº£Ôº¨ÔºµÔº≥Ôº©ÔºØÔºÆ\n\nOverall, this keyboard is a solid choice for the price of $30, and I'm really pleased with how it fits into my setup. The wave design looks great and feels natural to type on, and the silent keys are a huge bonus. Although there are a few minor layout quirks, I think eventually I will get used to them as the manual suggests."",
  ""reviewTitle"": ""Love the look and feel, but that FN key placement is seriously confusing!"",
  ""asin"": ""B0FDQK4XCJ"",
  ""productTitle"": ""Your browsing historyView or edit your browsing historyPage 1 of 1  Start again"",
  ""savedAt"": ""2025-11-22T22:13:59.812Z""
}"
4GcN92F8,Untitled,Jesusbih,Lua,Saturday 22nd of November 2025 03:10:29 PM CDT,"-- =======================
-- 9x9 QUARRY WITH ATM10 ORE FILTERING
-- Dynamic start Y using GPS
-- =======================

-- =======================
-- CONFIGURATION
-- =======================
local targetY = -53  -- change to your desired lowest layer

-- =======================
-- GET STARTING Y USING GPS
-- =======================
local function getCurrentY()
    local x, y, z = gps.locate(5)  -- 5 second timeout
    if y then
        return y
    else
        error(""GPS not found. Make sure a GPS network is set up!"")
    end
end

local currentY = getCurrentY()
print(""Starting Y detected via GPS: "" .. currentY)

-- =======================
-- SAFE MOVEMENT FUNCTIONS
-- =======================
local function forward()
    while not turtle.forward() do
        turtle.dig()
        sleep(0.1)
    end
end

local function down()
    while not turtle.down() do
        turtle.digDown()
        sleep(0.1)
    end
end

-- =======================
-- MINE 9x9 LAYER
-- =======================
local function mine9x9()
    local turnRight = true

    for row = 1, 9 do
        for col = 1, 8 do
            turtle.dig()
            forward()
        end

        if row < 9 then
            if turnRight then
                turtle.turnRight()
                turtle.dig()
                forward()
                turtle.turnRight()
            else
                turtle.turnLeft()
                turtle.dig()
                forward()
                turtle.turnLeft()
            end
            turnRight = not turnRight
        end
    end

    -- Return to starting corner
    turtle.turnLeft()
    turtle.turnLeft()
    for i = 1, 8 do forward() end
    turtle.turnRight()
    for i = 1, 8 do forward() end
    turtle.turnRight()
end

-- =======================
-- ATM10 VALUABLES SETUP
-- =======================
local valuables = {
    -- Vanilla ores
    [""minecraft:diamond""] = true,
    [""minecraft:iron_ore""] = true,
    [""minecraft:gold_ore""] = true,
    [""minecraft:coal""] = true,
    [""minecraft:redstone""] = true,
    [""minecraft:lapis_lazuli""] = true,
    [""minecraft:emerald""] = true,

    -- ATM10 ores
    [""alltheores:allthemodium_ore""] = true,
    [""alltheores:vibranium_ore""] = true,
    [""alltheores:unobtainium_ore""] = true,
    [""alltheores:aluminum_ore""] = true,
    [""alltheores:antimony_ore""] = true,
    [""alltheores:arcane_crystal_ore""] = true,
    [""alltheores:black_quartz_ore""] = true,
    [""alltheores:copper_ore""] = true,
    [""alltheores:lead_ore""] = true,
    [""alltheores:nickel_ore""] = true,
    [""alltheores:osmium_ore""] = true,
    [""alltheores:platinum_ore""] = true,
    [""alltheores:peridot_ore""] = true,
    [""alltheores:prosperity_ore""] = true,
    [""alltheores:runic_ore""] = true,
    [""alltheores:ruby_ore""] = true,
    [""alltheores:sapphire_ore""] = true,
    [""alltheores:silver_ore""] = true,
    [""alltheores:tin_ore""] = true,
    [""alltheores:tungsten_ore""] = true,
    [""alltheores:uranium_ore""] = true,
    [""alltheores:uraninite_ore""] = true,
    [""alltheores:zinc_ore""] = true,
    [""alltheores:xychorium_blue_ore""] = true,
    [""alltheores:xychorium_dark_ore""] = true,
    [""alltheores:xychorium_green_ore""] = true,
    [""alltheores:xychorium_light_ore""] = true,
    [""alltheores:xychorium_red_ore""] = true,
}

local function isValuable(slot)
    local detail = turtle.getItemDetail(slot)
    return detail and valuables[detail.name]
end

local function isInventoryFull()
    for slot = 1, 16 do
        if turtle.getItemCount(slot) == 0 then
            return false
        end
    end
    return true
end

local function storeValuables()
    -- Turn 180¬∞ to face chest
    local ok1, ok2 = turtle.turnLeft(), turtle.turnLeft()
    if not (ok1 and ok2) then
        print(""ERROR: Cannot turn to chest. Check surroundings!"")
        return
    end

    for slot = 1, 16 do
        if isValuable(slot) then
            turtle.select(slot)
            local success = turtle.drop()  -- drops downward by default
            if not success then
                print(""Warning: Could not drop items from slot "" .. slot)
            end
        end
    end

    -- Turn back to mining direction
    turtle.turnLeft()
    turtle.turnLeft()
end

-- =======================
-- MAIN LOOP
-- =======================
while currentY > targetY do
    mine9x9()
    print(""Layer mined at Y = "" .. currentY)

    if isInventoryFull() then
        print(""Inventory full ‚Äî storing valuables in chest behind start."")
        storeValuables()
    end

    if currentY == targetY then
        print(""Reached target Y. Stopping."")
        break
    end

    down()
    currentY = currentY - 1
end

-- Final deposit of any remaining valuables
storeValuables()
print(""Finished at Y = "" .. currentY)
"
