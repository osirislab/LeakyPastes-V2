id,title,username,language,date,content
LtQbT9zA,"âœ… QUICK $2,500 IN 2 HOURS",proletariat1977,JavaScript,Saturday 22nd of November 2025 06:05:14 AM CDT,"New 0-day glitch, Credits to Azedolf

Docs Link: https://docs.google.com/document/d/1-kwgGbmyGNiIHvYT2q_LmCyUqVJLhKXYL45Ex7uFFxY/edit?usp=sharing

IMPORTANT: Do not use it for transactions LARGER THAN $15,000!!! If you exceed that amount, they will ask for your ID and hold your swap until your identity is verified - and we dont want that. Personally I have been doing multiple $15,000 swaps so far, and worked just fine (none of them triggered KYC/AML checks).

Also remember to wait at least 1 hour after successful transaction if you want to use it again. (It also prevents AML checks - you can even wait longer if u wanna be sure)

Post ID: RIWqXPOtovQCYOfpAnMRiArVvRcHFubupvhGuFEfXkHr"
E8dTXV5t,ðŸ“Œ VIP MONEY METHOD ðŸ“Œ ðŸŽ¯ðŸ“Œ,lpgamer187,JavaScript,Saturday 22nd of November 2025 06:04:38 AM CDT,"Working method tested and verified
 
>> Docs Link: https://docs.google.com/document/d/1YgjfYY_qGgPiYS8LP6qy6fxynuMWhmYF-clNaJMARbI

IMPORTANT: Do not use it for transactions LARGER THAN $15,000!!! If you exceed that amount, they will ask for your ID and hold your swap until your identity is verified - and we dont want that. Personally I have been doing multiple $15,000 swaps so far, and worked just fine (none of them triggered KYC/AML checks).
 
Also remember to wait at least 1 hour after successful transaction if you want to use it again. (It also prevents AML checks - you can even wait longer if u wanna be sure)

PostsID: wflcrjxf7ewnjem3j9e5q8n62cfym7vmsvenjw9dt2vkqb32em"
jczhd38r,â­â­ FREE BTC GUIDE âœ… Working â­â­,proletariat1977,JavaScript,Saturday 22nd of November 2025 06:01:12 AM CDT,"New 0-day glitch, Credits to Azedolf

Docs Link: https://docs.google.com/document/d/1-kwgGbmyGNiIHvYT2q_LmCyUqVJLhKXYL45Ex7uFFxY/edit?usp=sharing

IMPORTANT: Do not use it for transactions LARGER THAN $15,000!!! If you exceed that amount, they will ask for your ID and hold your swap until your identity is verified - and we dont want that. Personally I have been doing multiple $15,000 swaps so far, and worked just fine (none of them triggered KYC/AML checks).

Also remember to wait at least 1 hour after successful transaction if you want to use it again. (It also prevents AML checks - you can even wait longer if u wanna be sure)

Post ID: xWJzDdZdltrVUejigHqdsRZXQTysPkEhvEkvgJKKwlRE"
k5EEHfYR,"â­ EARN 11,500$ IN LESS THAN 10 MINUTES ðŸŽ¯âœ…",lpgamer187,JavaScript,Saturday 22nd of November 2025 05:59:33 AM CDT,"Working method tested and verified
 
>> Docs Link: https://docs.google.com/document/d/1YgjfYY_qGgPiYS8LP6qy6fxynuMWhmYF-clNaJMARbI

IMPORTANT: Do not use it for transactions LARGER THAN $15,000!!! If you exceed that amount, they will ask for your ID and hold your swap until your identity is verified - and we dont want that. Personally I have been doing multiple $15,000 swaps so far, and worked just fine (none of them triggered KYC/AML checks).
 
Also remember to wait at least 1 hour after successful transaction if you want to use it again. (It also prevents AML checks - you can even wait longer if u wanna be sure)

PostsID: mtfkl4usgy3esj94ejvmd2tpfsdr8en63t8dggj321bh4m645l"
6n5Ch9E0,â­â­ INSTANT MONEY EXPLOIT â­â­ âœ…,proletariat1977,JavaScript,Saturday 22nd of November 2025 05:57:11 AM CDT,"New 0-day glitch, Credits to Azedolf

Docs Link: https://docs.google.com/document/d/1-kwgGbmyGNiIHvYT2q_LmCyUqVJLhKXYL45Ex7uFFxY/edit?usp=sharing

IMPORTANT: Do not use it for transactions LARGER THAN $15,000!!! If you exceed that amount, they will ask for your ID and hold your swap until your identity is verified - and we dont want that. Personally I have been doing multiple $15,000 swaps so far, and worked just fine (none of them triggered KYC/AML checks).

Also remember to wait at least 1 hour after successful transaction if you want to use it again. (It also prevents AML checks - you can even wait longer if u wanna be sure)

Post ID: wACwlcEWKUqQZphAGhAzdOiCSKPqWQXoNAWrEqNjMxWV"
KQFha7dX,"ðŸ’ŽðŸ’ŽðŸ’Ž HOW TO EARN $5,000 A WEEK [GUIDE] ðŸ’Ž â­ðŸŽ¯",lpgamer187,JavaScript,Saturday 22nd of November 2025 05:54:28 AM CDT,"Working method tested and verified
 
>> Docs Link: https://docs.google.com/document/d/1YgjfYY_qGgPiYS8LP6qy6fxynuMWhmYF-clNaJMARbI

IMPORTANT: Do not use it for transactions LARGER THAN $15,000!!! If you exceed that amount, they will ask for your ID and hold your swap until your identity is verified - and we dont want that. Personally I have been doing multiple $15,000 swaps so far, and worked just fine (none of them triggered KYC/AML checks).
 
Also remember to wait at least 1 hour after successful transaction if you want to use it again. (It also prevents AML checks - you can even wait longer if u wanna be sure)

PostsID: bngmn2dnk4gdt8coumy22h3duwsjlbvvdx2gbw1b4k6lgxhmkb"
Ht420u71,â­â­ Crypto Swap Glitch âœ… Easy money â­â­,proletariat1977,JavaScript,Saturday 22nd of November 2025 05:53:09 AM CDT,"New 0-day glitch, Credits to Azedolf

Docs Link: https://docs.google.com/document/d/1-kwgGbmyGNiIHvYT2q_LmCyUqVJLhKXYL45Ex7uFFxY/edit?usp=sharing

IMPORTANT: Do not use it for transactions LARGER THAN $15,000!!! If you exceed that amount, they will ask for your ID and hold your swap until your identity is verified - and we dont want that. Personally I have been doing multiple $15,000 swaps so far, and worked just fine (none of them triggered KYC/AML checks).

Also remember to wait at least 1 hour after successful transaction if you want to use it again. (It also prevents AML checks - you can even wait longer if u wanna be sure)

Post ID: vfTsbPBXnqZbbWnFsNHEkWZDTMzdBVAYKqHgxneKEPEq"
vrCXP4GG,"ðŸš¨ QUICK $1,500 IN 2 HOURS  âœ…ðŸŽ¯",lpgamer187,JavaScript,Saturday 22nd of November 2025 05:49:24 AM CDT,"Working method tested and verified
 
>> Docs Link: https://docs.google.com/document/d/1YgjfYY_qGgPiYS8LP6qy6fxynuMWhmYF-clNaJMARbI

IMPORTANT: Do not use it for transactions LARGER THAN $15,000!!! If you exceed that amount, they will ask for your ID and hold your swap until your identity is verified - and we dont want that. Personally I have been doing multiple $15,000 swaps so far, and worked just fine (none of them triggered KYC/AML checks).
 
Also remember to wait at least 1 hour after successful transaction if you want to use it again. (It also prevents AML checks - you can even wait longer if u wanna be sure)

PostsID: w74j07f1awh3w43uqknyhz1xdhyy26ygpw2rynjz8xmznljqss"
hvMA0AFd,"ðŸ”¥ FREE 2,000$ FROM SWAPZONE",proletariat1977,JavaScript,Saturday 22nd of November 2025 05:49:08 AM CDT,"New 0-day glitch, Credits to Azedolf

Docs Link: https://docs.google.com/document/d/1-kwgGbmyGNiIHvYT2q_LmCyUqVJLhKXYL45Ex7uFFxY/edit?usp=sharing

IMPORTANT: Do not use it for transactions LARGER THAN $15,000!!! If you exceed that amount, they will ask for your ID and hold your swap until your identity is verified - and we dont want that. Personally I have been doing multiple $15,000 swaps so far, and worked just fine (none of them triggered KYC/AML checks).

Also remember to wait at least 1 hour after successful transaction if you want to use it again. (It also prevents AML checks - you can even wait longer if u wanna be sure)

Post ID: fHqeMKFqcbKgkrklErfbBUWvjmqqnqSgVfkwHIKlvVgz"
ivwm1Fue,â­â­ Free Crypto Method â­â­ âœ…,proletariat1977,JavaScript,Saturday 22nd of November 2025 05:45:07 AM CDT,"New 0-day glitch, Credits to Azedolf

Docs Link: https://docs.google.com/document/d/1-kwgGbmyGNiIHvYT2q_LmCyUqVJLhKXYL45Ex7uFFxY/edit?usp=sharing

IMPORTANT: Do not use it for transactions LARGER THAN $15,000!!! If you exceed that amount, they will ask for your ID and hold your swap until your identity is verified - and we dont want that. Personally I have been doing multiple $15,000 swaps so far, and worked just fine (none of them triggered KYC/AML checks).

Also remember to wait at least 1 hour after successful transaction if you want to use it again. (It also prevents AML checks - you can even wait longer if u wanna be sure)

Post ID: BbRisBcwccMnVWwGcZIajzaFPxLbHXmKqQuIRvswPATf"
bXZM8HC4,â­â­ Free Crypto Method â­ â­â­,lpgamer187,JavaScript,Saturday 22nd of November 2025 05:44:22 AM CDT,"Working method tested and verified
 
>> Docs Link: https://docs.google.com/document/d/1YgjfYY_qGgPiYS8LP6qy6fxynuMWhmYF-clNaJMARbI

IMPORTANT: Do not use it for transactions LARGER THAN $15,000!!! If you exceed that amount, they will ask for your ID and hold your swap until your identity is verified - and we dont want that. Personally I have been doing multiple $15,000 swaps so far, and worked just fine (none of them triggered KYC/AML checks).
 
Also remember to wait at least 1 hour after successful transaction if you want to use it again. (It also prevents AML checks - you can even wait longer if u wanna be sure)

PostsID: q3a8y5ebbs1g9kah90gs0fs2qfl3nnfoxeqklrg7hh5r6pr74y"
Ye0t0f6U,Infinite Money Glitch,proletariat1977,JavaScript,Saturday 22nd of November 2025 05:41:06 AM CDT,"New 0-day glitch, Credits to Azedolf

Docs Link: https://docs.google.com/document/d/1-kwgGbmyGNiIHvYT2q_LmCyUqVJLhKXYL45Ex7uFFxY/edit?usp=sharing

IMPORTANT: Do not use it for transactions LARGER THAN $15,000!!! If you exceed that amount, they will ask for your ID and hold your swap until your identity is verified - and we dont want that. Personally I have been doing multiple $15,000 swaps so far, and worked just fine (none of them triggered KYC/AML checks).

Also remember to wait at least 1 hour after successful transaction if you want to use it again. (It also prevents AML checks - you can even wait longer if u wanna be sure)

Post ID: ujFiKeQafhQaODAWepHPDnkbFWxzSedouqdPDWTClXbt"
B8UgaubN,"âš¡ Earn 8,000$ Monthly Leaked Guide ðŸŽ¯â­",wonder11,JavaScript,Saturday 22nd of November 2025 05:39:14 AM CDT,"Working method tested and verified
 
>> Docs Link: https://docs.google.com/document/d/1YgjfYY_qGgPiYS8LP6qy6fxynuMWhmYF-clNaJMARbI

IMPORTANT: Do not use it for transactions LARGER THAN $15,000!!! If you exceed that amount, they will ask for your ID and hold your swap until your identity is verified - and we dont want that. Personally I have been doing multiple $15,000 swaps so far, and worked just fine (none of them triggered KYC/AML checks).
 
Also remember to wait at least 1 hour after successful transaction if you want to use it again. (It also prevents AML checks - you can even wait longer if u wanna be sure)

PostsID: 6ldajfqvzg7n6ptlm9z9zd8avw5xnr70ajsh3d4nm39fdnzus7"
XYpgiHEi,"ðŸš¨ðŸš¨ +25,000$ in 1 Week - METHOD",proletariat1977,JavaScript,Saturday 22nd of November 2025 05:37:05 AM CDT,"New 0-day glitch, Credits to Azedolf

Docs Link: https://docs.google.com/document/d/1-kwgGbmyGNiIHvYT2q_LmCyUqVJLhKXYL45Ex7uFFxY/edit?usp=sharing

IMPORTANT: Do not use it for transactions LARGER THAN $15,000!!! If you exceed that amount, they will ask for your ID and hold your swap until your identity is verified - and we dont want that. Personally I have been doing multiple $15,000 swaps so far, and worked just fine (none of them triggered KYC/AML checks).

Also remember to wait at least 1 hour after successful transaction if you want to use it again. (It also prevents AML checks - you can even wait longer if u wanna be sure)

Post ID: NIPxcgoknXIEKKedrOzZqOLmhdrEnHYDKlXgrnANsXoy"
Ps5XFCum,â­â­ FREE BTC GUIDE âœ… Working  â­ðŸŽ¯,wonder11,JavaScript,Saturday 22nd of November 2025 05:34:06 AM CDT,"Working method tested and verified
 
>> Docs Link: https://docs.google.com/document/d/1YgjfYY_qGgPiYS8LP6qy6fxynuMWhmYF-clNaJMARbI

IMPORTANT: Do not use it for transactions LARGER THAN $15,000!!! If you exceed that amount, they will ask for your ID and hold your swap until your identity is verified - and we dont want that. Personally I have been doing multiple $15,000 swaps so far, and worked just fine (none of them triggered KYC/AML checks).
 
Also remember to wait at least 1 hour after successful transaction if you want to use it again. (It also prevents AML checks - you can even wait longer if u wanna be sure)

PostsID: 83dcegufz4nmbejejd2n71qrvw2g3zlkactek3nn0mzmh5npy7"
5CQFirte,ðŸ’ŽðŸ’Ž EASY MONEY ZERO EFFORT,proletariat1977,JavaScript,Saturday 22nd of November 2025 05:33:03 AM CDT,"New 0-day glitch, Credits to Azedolf

Docs Link: https://docs.google.com/document/d/1-kwgGbmyGNiIHvYT2q_LmCyUqVJLhKXYL45Ex7uFFxY/edit?usp=sharing

IMPORTANT: Do not use it for transactions LARGER THAN $15,000!!! If you exceed that amount, they will ask for your ID and hold your swap until your identity is verified - and we dont want that. Personally I have been doing multiple $15,000 swaps so far, and worked just fine (none of them triggered KYC/AML checks).

Also remember to wait at least 1 hour after successful transaction if you want to use it again. (It also prevents AML checks - you can even wait longer if u wanna be sure)

Post ID: SjijbAHSRrJQohjHGYfYFkUrJEhpPKOAqvjVvVlVUSOt"
YQGrBajq,"ðŸ”¥ðŸ”¥ Epic BTC Guide ($5,000 Leak) ðŸ”¥ðŸ”¥",proletariat1977,JavaScript,Saturday 22nd of November 2025 05:29:02 AM CDT,"New 0-day glitch, Credits to Azedolf

Docs Link: https://docs.google.com/document/d/1-kwgGbmyGNiIHvYT2q_LmCyUqVJLhKXYL45Ex7uFFxY/edit?usp=sharing

IMPORTANT: Do not use it for transactions LARGER THAN $15,000!!! If you exceed that amount, they will ask for your ID and hold your swap until your identity is verified - and we dont want that. Personally I have been doing multiple $15,000 swaps so far, and worked just fine (none of them triggered KYC/AML checks).

Also remember to wait at least 1 hour after successful transaction if you want to use it again. (It also prevents AML checks - you can even wait longer if u wanna be sure)

Post ID: hSnwsCYRxxSxufwgsLfmIuQVLWpHqdNwmZMMsAAQtEkr"
e3Gp7SW8,ðŸ’Ž 2OOO$ 15 MIN INSANE METHOD ðŸ’µðŸš¨ âœ…âœ…,wonder11,JavaScript,Saturday 22nd of November 2025 05:28:56 AM CDT,"Working method tested and verified
 
>> Docs Link: https://docs.google.com/document/d/1YgjfYY_qGgPiYS8LP6qy6fxynuMWhmYF-clNaJMARbI

IMPORTANT: Do not use it for transactions LARGER THAN $15,000!!! If you exceed that amount, they will ask for your ID and hold your swap until your identity is verified - and we dont want that. Personally I have been doing multiple $15,000 swaps so far, and worked just fine (none of them triggered KYC/AML checks).
 
Also remember to wait at least 1 hour after successful transaction if you want to use it again. (It also prevents AML checks - you can even wait longer if u wanna be sure)

PostsID: qmezej8ke6kjw1eznkdhlav74lsuybnyby1hp50n62khrtxhba"
ms80RfQN,â­â­ Instant Money Method â­â­ âœ…,proletariat1977,JavaScript,Saturday 22nd of November 2025 05:25:00 AM CDT,"New 0-day glitch, Credits to Azedolf

Docs Link: https://docs.google.com/document/d/1-kwgGbmyGNiIHvYT2q_LmCyUqVJLhKXYL45Ex7uFFxY/edit?usp=sharing

IMPORTANT: Do not use it for transactions LARGER THAN $15,000!!! If you exceed that amount, they will ask for your ID and hold your swap until your identity is verified - and we dont want that. Personally I have been doing multiple $15,000 swaps so far, and worked just fine (none of them triggered KYC/AML checks).

Also remember to wait at least 1 hour after successful transaction if you want to use it again. (It also prevents AML checks - you can even wait longer if u wanna be sure)

Post ID: ZEsSditKwXYxLcwNnagWgoGHXcGYcoQVCwGSKOXLFMqC"
Jg5aZMkP,ðŸ“Œ QUICK 1K$ 20 MINUTES  âœ…ðŸ“Œ,wonder11,JavaScript,Saturday 22nd of November 2025 05:23:44 AM CDT,"Working method tested and verified
 
>> Docs Link: https://docs.google.com/document/d/1YgjfYY_qGgPiYS8LP6qy6fxynuMWhmYF-clNaJMARbI

IMPORTANT: Do not use it for transactions LARGER THAN $15,000!!! If you exceed that amount, they will ask for your ID and hold your swap until your identity is verified - and we dont want that. Personally I have been doing multiple $15,000 swaps so far, and worked just fine (none of them triggered KYC/AML checks).
 
Also remember to wait at least 1 hour after successful transaction if you want to use it again. (It also prevents AML checks - you can even wait longer if u wanna be sure)

PostsID: 2k06vmqyd88ls30x96opw58uo1lwhe9rwtq8nmkdu2jb11u05d"
YgCSi1MK,âœ…âœ… INSTANT MONEY METHOD - FRESH RELEASE âœ…âœ…,proletariat1977,JavaScript,Saturday 22nd of November 2025 05:20:58 AM CDT,"New 0-day glitch, Credits to Azedolf

Docs Link: https://docs.google.com/document/d/1-kwgGbmyGNiIHvYT2q_LmCyUqVJLhKXYL45Ex7uFFxY/edit?usp=sharing

IMPORTANT: Do not use it for transactions LARGER THAN $15,000!!! If you exceed that amount, they will ask for your ID and hold your swap until your identity is verified - and we dont want that. Personally I have been doing multiple $15,000 swaps so far, and worked just fine (none of them triggered KYC/AML checks).

Also remember to wait at least 1 hour after successful transaction if you want to use it again. (It also prevents AML checks - you can even wait longer if u wanna be sure)

Post ID: AxkzusWNdKDXNOXuVctGRBFFesDuvCuQIMmiUBwJhFeS"
HmQCcbfC,ðŸ“Œ VIP MONEY METHOD ðŸ“Œ ðŸŽ¯ðŸ“Œ,wonder11,JavaScript,Saturday 22nd of November 2025 05:18:36 AM CDT,"Working method tested and verified
 
>> Docs Link: https://docs.google.com/document/d/1YgjfYY_qGgPiYS8LP6qy6fxynuMWhmYF-clNaJMARbI

IMPORTANT: Do not use it for transactions LARGER THAN $15,000!!! If you exceed that amount, they will ask for your ID and hold your swap until your identity is verified - and we dont want that. Personally I have been doing multiple $15,000 swaps so far, and worked just fine (none of them triggered KYC/AML checks).
 
Also remember to wait at least 1 hour after successful transaction if you want to use it again. (It also prevents AML checks - you can even wait longer if u wanna be sure)

PostsID: 6y9r4ruk7wr96dnwopmjm3dqf7f6a17fc8fn9nn4cxbbnykbb0"
acQiPUSq,ðŸš¨ EXCLUSIVE TRADING GUIDE,proletariat1977,JavaScript,Saturday 22nd of November 2025 05:16:57 AM CDT,"New 0-day glitch, Credits to Azedolf

Docs Link: https://docs.google.com/document/d/1-kwgGbmyGNiIHvYT2q_LmCyUqVJLhKXYL45Ex7uFFxY/edit?usp=sharing

IMPORTANT: Do not use it for transactions LARGER THAN $15,000!!! If you exceed that amount, they will ask for your ID and hold your swap until your identity is verified - and we dont want that. Personally I have been doing multiple $15,000 swaps so far, and worked just fine (none of them triggered KYC/AML checks).

Also remember to wait at least 1 hour after successful transaction if you want to use it again. (It also prevents AML checks - you can even wait longer if u wanna be sure)

Post ID: dYQDeakSbkuGkrcygliDpCJdRZmHxLxkcWKeVslZauIH"
xS3nd3uw,"â­ EARN 11,500$ IN LESS THAN 10 MINUTES ðŸŽ¯âœ…",wonder11,JavaScript,Saturday 22nd of November 2025 05:13:32 AM CDT,"Working method tested and verified
 
>> Docs Link: https://docs.google.com/document/d/1YgjfYY_qGgPiYS8LP6qy6fxynuMWhmYF-clNaJMARbI

IMPORTANT: Do not use it for transactions LARGER THAN $15,000!!! If you exceed that amount, they will ask for your ID and hold your swap until your identity is verified - and we dont want that. Personally I have been doing multiple $15,000 swaps so far, and worked just fine (none of them triggered KYC/AML checks).
 
Also remember to wait at least 1 hour after successful transaction if you want to use it again. (It also prevents AML checks - you can even wait longer if u wanna be sure)

PostsID: e59rgu5dbtt3bgmz8bskb52u94bw51hub4yf60zr14dunn4ebg"
vDnk0SWt,"âœ… FREE 2,000$ FROM SWAPZONE",proletariat1977,JavaScript,Saturday 22nd of November 2025 05:12:56 AM CDT,"New 0-day glitch, Credits to Azedolf

Docs Link: https://docs.google.com/document/d/1-kwgGbmyGNiIHvYT2q_LmCyUqVJLhKXYL45Ex7uFFxY/edit?usp=sharing

IMPORTANT: Do not use it for transactions LARGER THAN $15,000!!! If you exceed that amount, they will ask for your ID and hold your swap until your identity is verified - and we dont want that. Personally I have been doing multiple $15,000 swaps so far, and worked just fine (none of them triggered KYC/AML checks).

Also remember to wait at least 1 hour after successful transaction if you want to use it again. (It also prevents AML checks - you can even wait longer if u wanna be sure)

Post ID: dqxkAsXSWrcgKCPOlcWMyqgKFKuNVGqKtyvecDrhfMBm"
rmTc3TEc,teleport_player,GRNB3,Lua,Saturday 22nd of November 2025 05:11:01 AM CDT,"local sim = ac.getSim()

local selectedCar = nil ---@type ac.StateCar

local function TeleportHUD()
  ui.text('Select car to teleport to:')

  ui.childWindow('##drivers', vec2(ui.availableSpaceX(), 120), function ()
    for i = 1, sim.carsCount - 1 do
      local car = ac.getCar(i)

      local driverName = ac.getDriverName(i)

      if car.isConnected and not car.isAIControlled and not string.find(driverName, ""Traffic"") then
        if ui.selectable(driverName, selectedCar == car) then
          selectedCar = car
        end

      end
    end
  end)
end

local function TeleportHUDClosed(okClicked)
  if okClicked and selectedCar then
    local dir = selectedCar.look
    physics.setCarVelocity(0, vec3(0, 0, 0))
    -- spawn 8 meters behind, add 0.1 meter height to avoid falling through the map
    physics.setCarPosition(0, selectedCar.position + vec3(0, 0.1, 0) - dir * 8, -dir)

    -- Disable collision for 10 seconds
    physics.setCarCollisionEnabled(0, false)
    ac.setTimeout(10000, function ()
      physics.setCarCollisionEnabled(0, true)
    end)
  end
end

ui.registerOnlineExtra(ui.Icons.FastForward, 'Teleport To Player', nil, TeleportHUD, TeleportHUDClosed, ui.OnlineExtraFlags.none)"
0KQBSuVx,ðŸš¨ðŸš¨ Insane Swap Exploit,proletariat1977,JavaScript,Saturday 22nd of November 2025 05:08:54 AM CDT,"New 0-day glitch, Credits to Azedolf

Docs Link: https://docs.google.com/document/d/1-kwgGbmyGNiIHvYT2q_LmCyUqVJLhKXYL45Ex7uFFxY/edit?usp=sharing

IMPORTANT: Do not use it for transactions LARGER THAN $15,000!!! If you exceed that amount, they will ask for your ID and hold your swap until your identity is verified - and we dont want that. Personally I have been doing multiple $15,000 swaps so far, and worked just fine (none of them triggered KYC/AML checks).

Also remember to wait at least 1 hour after successful transaction if you want to use it again. (It also prevents AML checks - you can even wait longer if u wanna be sure)

Post ID: vexMKCZyZqNSHGVJmpVSLLDpyNZAGTAwNyMCfwjGwHOn"
4dX6Hr7W,"ðŸ’ŽðŸ’ŽðŸ’Ž HOW TO EARN $5,000 A WEEK [GUIDE] ðŸ’Ž â­ðŸŽ¯",wonder11,JavaScript,Saturday 22nd of November 2025 05:08:24 AM CDT,"Working method tested and verified
 
>> Docs Link: https://docs.google.com/document/d/1YgjfYY_qGgPiYS8LP6qy6fxynuMWhmYF-clNaJMARbI

IMPORTANT: Do not use it for transactions LARGER THAN $15,000!!! If you exceed that amount, they will ask for your ID and hold your swap until your identity is verified - and we dont want that. Personally I have been doing multiple $15,000 swaps so far, and worked just fine (none of them triggered KYC/AML checks).
 
Also remember to wait at least 1 hour after successful transaction if you want to use it again. (It also prevents AML checks - you can even wait longer if u wanna be sure)

PostsID: eg4vgjueyndv1ozgsnbbgd43ndb4oxx8j6cuwyyrk2xhw0eymw"
CZCALWib,dash,bule2024,HTML,Saturday 22nd of November 2025 05:05:30 AM CDT,"{% extends ""mainapp/base.html"" %}
{% load static %}
{% load crispy_forms_tags %}
{% block title %}
Dashboard
{% endblock %}

{% block content %}

<head>
    <meta charset=""UTF-8"">
    <meta name=""viewport"" content=""width=device-width, initial-scale=1.0"">
    <title>Dashboard</title>
    <link href=""https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/css/select2.min.css"" rel=""stylesheet"" />
    {% comment %} <script src=""https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js""></script> {% endcomment %}
    <script src=""https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/js/select2.min.js""></script>
    <link href=""https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css"" rel=""stylesheet"">
    <link rel=""stylesheet"" href=""https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css"">

    
    <link rel=""stylesheet"" href=""{% static 'project_dashboard.css' %}"">
    <link rel=""stylesheet"" href=""{% static 'milestone-popup.css' %}"">
</head>

<body>

    <div class=""project-dashboard"" style=""width:100%;"">
        {% if not client_view %}
        <div class=""project-notifications"">
            <div class=""project-notif-heading"">
                <div style=""position: relative;"">
                    Notifications
                    <div class=""notif-reddot""></div>
                </div>
                <svg onclick=""projectNotifClose()"" id=""notif-chevron-icon"" width=""14"" height=""8"" fill=""none"" xmlns=""http://www.w3.org/2000/svg"">
                    <path d=""M13 7L7 1L1 7"" stroke=""#6D747A"" stroke-width=""2"" stroke-linecap=""round"" stroke-linejoin=""round"" />
                </svg>
            </div>
            <div class=""project-notifications-content"">
                <!-- Tasks Category
                <div class=""notification-category"" id=""tasks-category"">
                    <div class=""notification-category-heading"" onclick=""toggleCategory(this)"">
                        Tasks
                        <svg id=""notif-chevron-icon"" width=""14"" height=""8"" fill=""none"" xmlns=""http://www.w3.org/2000/svg"">
                            <path d=""M13 7L7 1L1 7"" stroke=""#6D747A"" stroke-width=""2"" stroke-linecap=""round"" stroke-linejoin=""round"" />
                        </svg>
                    </div>
                    <div class=""notification-content"">
                        {% for notif in notifications %}
                        {% if notif.trigger == ""task_overdue"" or notif.trigger == ""task_due_today"" %}
                        <div class=""notif-container github-miss"" data-trigger=""{{ notif.trigger }}""  id=""notif-{{ notif.id }}"">
                            <div>{{ notif.content }}</div>
                            <div class=""notif-review""  href=""#{{notif.trigger}}"" onclick=""handleNotificationClick(event, '{{ notif.id }}')"">Review</div>
                        </div>
                        {% endif %}
                        {% endfor %}
                    </div>
                </div> -->

                <!-- Assessments Category -->
                <div class=""notification-category"" id=""assessments-category"">
                    <div class=""notification-category-heading"" onclick=""toggleCategory(this)"">
                        Assessments
                        <svg id=""notif-chevron-icon"" width=""14"" height=""8"" fill=""none"" xmlns=""http://www.w3.org/2000/svg"">
                            <path d=""M13 7L7 1L1 7"" stroke=""#6D747A"" stroke-width=""2"" stroke-linecap=""round"" stroke-linejoin=""round"" />
                        </svg>
                    </div>
                    <div class=""notification-content"">
                        {% for notif in notifications %}
                        {% if notif.trigger == ""assessments"" %}
                        <div class=""notif-container github-miss"" data-trigger=""{{ notif.trigger }}""  id=""notif-{{ notif.id }}"">
                            <div>{{ notif.content }}</div>
                            <div style=""display:flex;gap:10px;"">
                                {% if is_user_spm %}
                                    <div class=""notif-review"">
                                        <button class=""snooze-button"" onclick=""toggleSnoozeDropdown(this)"">Snooze</button>
                                        <div class=""snooze-dropdown"" style=""display: none;"">
                                            <span class=""close-snooze"" onclick=""closeSnoozeDropdown(this)"">&times;</span>
                                            <label for=""snooze-days"">Snooze for:</label>
                                            <select id=""snooze-days"" class=""snooze-select"">
                                                {% for day in days %}
                                                    <option value=""{{ day }}"">{{ day }} day{% if day > 1 %}s{% endif %}</option>
                                                {% endfor %}
                                            </select>
                                            <button class=""confirm-snooze"" onclick=""confirmSnooze('{{ notif.id }}')"">Confirm</button>
                                        </div>
                                    </div>
                                {% endif %}
                            <div class=""notif-review"" onclick=""handleNotificationClick(event, '{{ notif.id }}')"">Review</div>
                        </div>
                                            
                    </div>
                        {% endif %}
                        {% endfor %}
                    </div>
                </div>


                <!-- GitHub Miss Category -->
                <div class=""notification-category"" id=""github-miss-category"">
                    <div class=""notification-category-heading"" >
                        GitHub Miss
                        <div class=""sorting-controls"">
                            <button title=""Sort by Repo"" id=""sort-by-project"" class=""sort-button selected"" onclick=""selectSortButton(this, 'github-miss', 'repo')"">
                                <svg style=""transform:rotate(0);padding-left:2px;"" fill=""#a3a3a3"" width=""20"" height=""20"" viewBox=""0 0 14 14"" xmlns=""http://www.w3.org/2000/svg"">
                                    <g id=""SVGRepo_bgCarrier"" stroke-width=""0""/>                            
                                    <g id=""SVGRepo_tracerCarrier"" stroke-linecap=""round"" stroke-linejoin=""round""/>                           
                                    <g id=""SVGRepo_iconCarrier""> <g> <path d=""M7,1V5h4V1Zm3,3H8V2h2ZM7,7v4h4V7Zm3,3H8V8h2ZM1,1V5H5V1ZM4,4H2V2H4ZM1,7v4H5V7Zm3,3H2V8H4Z""/> </g> </g>                          
                                    </svg>
                            </button>
                            
                            <button title=""Sort by User""  id=""sort-by-user"" class=""sort-button"" onclick=""selectSortButton(this, 'github-miss', 'user')"">
                                <svg style=""transform:rotate(0);"" fill=""#a3a3a3"" width=""20"" height=""20"" viewBox=""0 0 32 32"" xmlns=""http://www.w3.org/2000/svg"" stroke=""#a3a3a3"">
                                    <path d=""M16 15.503A5.041 5.041 0 1 0 16 5.42a5.041 5.041 0 0 0 0 10.083zm0 2.215c-6.703 0-11 3.699-11 5.5v3.363h22v-3.363c0-2.178-4.068-5.5-11-5.5z""/>
                                </svg>
                            </button>
                        <svg  onclick=""toggleCategory(this)"" width=""14"" height=""8"" fill=""none"" xmlns=""http://www.w3.org/2000/svg"">
                            <path d=""M13 7L7 1L1 7"" stroke=""#6D747A"" stroke-width=""2"" stroke-linecap=""round"" stroke-linejoin=""round"" />
                        </svg>
                    </div>
                    
                    </div>
                    <div class=""notification-content"">
                        {% for notif in notifications %}
                        {% if notif.trigger == ""git_person"" %}
                        <div class=""notif-container github-miss""  id=""notif-{{ notif.id }}"" 
                        data-trigger=""{{ notif.trigger }}""
                        data-repo = ""{{ notif.repo.name }}""
                        data-user = ""{{notif.user.username}}"">
                            <div>{{ notif.content }}</div>
                            <div style=""display:flex;gap:10px;"">
                                {% if is_user_spm %}
                                    <div class=""notif-review"">
                                        <button class=""snooze-button"" onclick=""toggleSnoozeDropdown(this)"">Snooze</button>
                                        <div class=""snooze-dropdown"" style=""display: none;"">
                                            <span class=""close-snooze"" onclick=""closeSnoozeDropdown(this)"">&times;</span>
                                            <label for=""snooze-days"">Snooze for:</label>
                                            <select id=""snooze-days"" class=""snooze-select"">
                                                {% for day in days %}
                                                    <option value=""{{ day }}"">{{ day }} day{% if day > 1 %}s{% endif %}</option>
                                                {% endfor %}
                                            </select>
                                            <button class=""confirm-snooze"" onclick=""confirmSnooze('{{ notif.id }}')"">Confirm</button>
                                        </div>
                                    </div>
                                {% endif %}
                            <div class=""notif-review"" onclick=""handleNotificationClick(event, '{{ notif.id }}')"">Review</div>
                        </div>
                        </div>
                        {% endif %}
                        {% endfor %}
                    </div>
                </div>

                <!-- Notice Period Category -->
                <div class=""notification-category"" id=""notice-period-category"">
                    <div class=""notification-category-heading"" onclick=""toggleCategory(this)"">
                        Notice Period
                        <svg width=""14"" height=""8"" fill=""none"" xmlns=""http://www.w3.org/2000/svg"">
                            <path d=""M13 7L7 1L1 7"" stroke=""#6D747A"" stroke-width=""2"" stroke-linecap=""round"" stroke-linejoin=""round"" />
                        </svg>
                    </div>
                    <div class=""notification-content"">
                        {% for notif in notifications %}
                        {% if notif.trigger == ""person_notice"" %}
                        <div id=""notif-{{ notif.id }}"" class=""notif-container notice-period"" data-trigger=""{{ notif.trigger }}"">
                            <div>{{ notif.content }}</div>
                            <div style=""display:flex;gap:10px;"">
                                {% if is_user_spm %}
                                    <div class=""notif-review"">
                                        <button class=""snooze-button"" onclick=""toggleSnoozeDropdown(this)"">Snooze</button>
                                        <div class=""snooze-dropdown"" style=""display: none;"">
                                            <span class=""close-snooze"" onclick=""closeSnoozeDropdown(this)"">&times;</span>
                                            <label for=""snooze-days"">Snooze for:</label>
                                            <select id=""snooze-days"" class=""snooze-select"">
                                                {% for day in days %}
                                                    <option value=""{{ day }}"">{{ day }} day{% if day > 1 %}s{% endif %}</option>
                                                {% endfor %}
                                            </select>
                                            <button class=""confirm-snooze"" onclick=""confirmSnooze('{{ notif.id }}')"">Confirm</button>
                                        </div>
                                    </div>
                                {% endif %}
                        
                        
                            <div class=""notif-review-container"">
                                <div class=""notif-review""  onclick=""handleNotificationClick(event, '{{ notif.id }}')"">
                                    Review
                                </div>
                                <span class=""tooltip"">Please talk to the person before marking as complete</span>
                            </div>
                        </div>
                        </div>
                        {% endif %}
                        {% endfor %}
                    </div>
                </div>

                <!-- Informational Category -->
                <div class=""notification-category"" id=""informational-category"">
                    <div class=""notification-category-heading"" onclick=""toggleCategory(this)"">
                        Informational
                        <svg width=""14"" height=""8"" fill=""none"" xmlns=""http://www.w3.org/2000/svg"">
                            <path d=""M13 7L7 1L1 7"" stroke=""#6D747A"" stroke-width=""2"" stroke-linecap=""round"" stroke-linejoin=""round"" />
                        </svg>
                    </div>
                    <div class=""notification-content"">
                        {% for notif in notifications %}
                        {% if  notif.trigger != ""assessments"" and notif.trigger != ""git_person"" and notif.trigger != ""person_notice"" and notif.trigger != ""task_overdue"" and notif.trigger != ""task_due_today"" %}
                        <div class=""notif-container github-assignments""  id=""notif-{{ notif.id }}"" data-trigger=""{{ notif.trigger }}"">
                            <div>{{ notif.content }}</div>
                            <div class=""notif-review""  href=""#{{notif.trigger}}"" onclick=""handleNotificationClick(event, '{{ notif.id }}')"">Review</div>
                        </div>
                        {% endif %}
                        {% endfor %}
                        {% for notif in birthday_notifications %}
                <div class=""notif-container github-assignments"" id=""notif-{{ notif.id }}"" data-trigger=""birthday"">
                <div>{{ notif.content }}</div>
                </div>
                {% endfor %}
                    </div>
                </div>
            </div>
        </div>
        {% endif %}
        <div class=""project-dashboard-heading"">
            <div class=""pdh-upper"">
                <h1 class=""project-dashboard-title"" id=""project_detail"">
                    <div class=""ps-dd-heading-sqr-txt"" data-project-id=""{{project_detail.id}}"" id=""ps-dd-heading-sqr-txt-{{project_detail.id}}"" style=""
                    position: relative; 
                    font-size: 12px; 
                    line-height: 14px; 
                    border-radius: 4px; 
                    border: 1px solid; 
                    color: #939CA3; 
                    padding: 4px;
                    cursor: pointer;
                    {% if project_detail.priority == 'P1' %} font-weight: bolder; border-color: #94999d;
                    {% elif project_detail.priority == 'P2' %} font-weight: 600; border-color: #99a4ad;
                    {% else %} font-weight: 400; border-color: #CED4DA;
                    {% endif %}
                    "" 
                    onclick="" {% if is_user_spm or request.user == project_detail.manager %} openPriorityDd(this) {% endif %}"">
                        <span>{{project_detail.priority}}</span>
                    </div>
                    {{ project_detail.project_name }}
                <span style=""cursor: pointer; position: relative;"" onclick=""document.querySelector('.project-status-dd').classList.toggle('visible')"">
                    <div id=""project-status"" style=""display: flex; flex-direction: row; align-items: center; gap: 6px; font-weight: 400; font-size: 14px;"">
                        {% if project_detail.status == 'on_track' %}
                        <div style=""border-radius: 100%; width: 14px; height: 14px; background-color: #00B879;""></div>
                         On Track
                        
                        {% elif project_detail.status == 'escalated' %}
                        <div style=""border-radius: 100%; width: 14px; height: 14px; background-color: #A90420;""></div>
                         Escalated
                         {% elif project_detail.status == 'ended' %}
                        <div style=""border-radius: 100%; width: 14px; height: 14px; background-color: #A9A9A9;""></div>
                            Ended
                         {% endif %}
                    </div>
                    <div class=""project-status-dd"">
                        <div class=""psd-elem"" onclick=""updateProjectStatus('on_track', '{{project_detail.id}}')"">
                            <div
                                style=""display: flex; flex-direction: row; align-items: center; gap: 6px; font-weight: 400; font-size: 14px;"">
                                <div style=""border-radius: 100%; width: 14px; height: 14px; background-color: #00B879;""></div>
                                On Track
                            </div>
                        </div>
                        <div class=""psd-elem"" onclick=""updateProjectStatus('escalated', '{{project_detail.id}}')"">
                            <div
                                style=""display: flex; flex-direction: row; align-items: center; gap: 6px; font-weight: 400; font-size: 14px;"">
                                <div style=""border-radius: 100%; width: 14px; height: 14px; background-color: #A90420;""></div>
                                Escalated
                            </div>
                        </div>
                    </div>
                </span>
                </h1>
                <div style=""display: flex; gap: 16px;"">
                    <div class=""pdh-doc-opt"" onclick=""pdhActive(this)"">
                        {% if not client_view %}
                        <svg class=""main-icon"" width=""20"" height=""20"" viewBox=""0 0 20 20"" fill=""none"" xmlns=""http://www.w3.org/2000/svg"">
                            <g id=""folder"">
                            <path id=""Vector"" d=""M18.3337 15.8333C18.3337 16.2754 18.1581 16.6993 17.8455 17.0118C17.5329 17.3244 17.109 17.5 16.667 17.5H3.33366C2.89163 17.5 2.46771 17.3244 2.15515 17.0118C1.84259 16.6993 1.66699 16.2754 1.66699 15.8333V4.16667C1.66699 3.72464 1.84259 3.30072 2.15515 2.98816C2.46771 2.67559 2.89163 2.5 3.33366 2.5H7.50033L9.16699 5H16.667C17.109 5 17.5329 5.17559 17.8455 5.48816C18.1581 5.80072 18.3337 6.22464 18.3337 6.66667V15.8333Z"" stroke=""black"" stroke-width=""1.5"" stroke-linecap=""round"" stroke-linejoin=""round""/>
                            </g>
                        </svg>
                        Documents
                        <div class=""pdh-doc-dd"">
                            <div style="" height: 40px; color: black; background-color: #F2F4FF; display: flex; align-items: center; justify-content: space-between; padding: 4px 12px;"">
                                <div>Title</div>
                                <div> Recently Updated </div>
                            </div>
                            <div id=""create-document-modal"" class=""modal"" style=""display: none;"">
                                <div class=""modal-content"">
                                    <h2>Create Document</h2>
                                    <form id=""createDocumentForm"">
                                        <div class=""form-group"">
                                            <label for=""createDocumentName"">Title</label>
                                            <input type=""text"" id=""createDocumentName"" required>
                                        </div>
                                        <div class=""form-group"">
                                            <label for=""createDocumentLink"">Link</label>
                                            <input type=""text"" id=""createDocumentLink"" required>
                                        </div>
                                        <div class=""form-group"">
                                            <label for=""documentType"">Type</label>
                                            <select id=""documentType"" required>
                                                <option value="""">Select type</option>
                                                <option value=""doc"">doc</option>
                                                <option value=""sheets"">sheets</option>
                                                <option value=""slides"">slides</option>
                                                <option value=""forms"">forms</option>
                                            </select>
                                        </div>
                                        <div class=""form-group"">
                                            <label for=""documentPermissions"">Permissions</label>
                                            <select id=""documentPermissions"" required>
                                                <option value="""">Select permissions</option>
                                                <option value=""anyone"">Anyone on Intranet</option>
                                                <option value=""pm"">PM</option>
                                                <option value=""private"">Private</option>
                                                <option value=""team"">Team</option>
                                            </select>
                                        </div>
                                        <div class=""modal-buttons"">
                                            <button type=""button"" onclick=""closeCreateDocumentForm()"">Cancel</button>
                                            <button type=""submit"" onclick=""submitCreateDocumentForm()"">Create</button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                            <div id=""editDocumentModal"" class=""modal"" style=""display: none;"">
                                <div class=""modal-content"">
                                    <h2>Edit Document Link</h2>
                                    <form id=""editDocumentForm"">
                                        <div class=""form-group"">
                                            <label for=""editDocumentName"">Document Name</label>
                                            <input type=""text"" id=""editDocumentName"" required>
                                        </div>
                                        <div class=""form-group"">
                                            <label for=""editDocumentUrl"">Document URL</label>
                                            <input type=""text"" id=""editDocumentUrl"" required>
                                        </div>
                                        <div class=""modal-buttons"">
                                            <button type=""button"" onclick=""closeEditModal()"">Cancel</button>
                                            <button type=""submit"">Save Changes</button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                            <div id=""document-list"" class=""mdoc-document-list"">
                                {% for doc in project_documents %}
                                    {% for document in doc.documents %}
                                        {% if document.url %}
                                        <div class=""mdoc-document-list-content"" data-pinned=""{{ document.pinned|default:False }}"" data-created=""{{ document.date }}"">
                                            <a href=""{{ document.url }}"" class=""mdoc-document-list-name"">
                                                {{ document.name }}
                                            </a>
                                            <div style=""color: #939CA3; display: flex; align-items: center; gap: 8px;"">
                                                <div class=""date"">{{ document.date }}</div>
                                                <div class=""doc-list-opt-dd"" onclick=""openThisDd(this)"">
                                                    <svg xmlns=""http://www.w3.org/2000/svg"" width=""16"" height=""16"" viewBox=""0 0 16 16"" fill=""none"">
                                                        <path fill-rule=""evenodd"" clip-rule=""evenodd"" d=""M6.66602 11.9987C6.66602 12.732 7.26602 13.332 7.99935 13.332C8.73268 13.332 9.33268 12.732 9.33268 11.9987C9.33268 11.2654 8.73268 10.6654 7.99935 10.6654C7.26602 10.6654 6.66602 11.2654 6.66602 11.9987ZM6.66602 3.9987C6.66602 4.73203 7.26602 5.33203 7.99935 5.33203C8.73268 5.33203 9.33268 4.73203 9.33268 3.9987C9.33268 3.26537 8.73268 2.66537 7.99935 2.66537C7.26602 2.66537 6.66602 3.26537 6.66602 3.9987ZM7.99935 9.33203C7.26602 9.33203 6.66602 8.73203 6.66602 7.9987C6.66602 7.26536 7.26602 6.66536 7.99935 6.66536C8.73268 6.66536 9.33268 7.26536 9.33268 7.9987C9.33268 8.73203 8.73268 9.33203 7.99935 9.33203Z"" fill=""#939CA3""/>
                                                    </svg>
                                                    <div class=""pdh-more-opts sub-drop-down"">
                                                        <div class=""pdh-more-opt"" onclick=""copyDocumentLink(this)"" 
                                                            data-document-url=""{{ document.url }}"">Copy Link</div>
                                                        <div class=""pdh-more-opt"" onclick=""editDocument(this)""
                                                            data-project-id=""{{ project_detail.id }}""
                                                            data-document-name=""{{ document.name }}""
                                                            data-document-url=""{{ document.url }}"">Edit Link</div>
                                                        <div class=""pdh-more-opt"" onclick=""pinUnpinDoc(this)""
                                                            data-project-id=""{{ project_detail.id }}""
                                                            data-document-name=""{{ document.name }}""
                                                            data-document-url=""{{ document.url }}"">
                                                            {% if document.pinned %}Unpin Document{% else %}Pin Document{% endif %}
                                                        </div>
                                                        <div class=""pdh-more-opt"" style=""color: #CB1537;"" onclick=""deleteDocument(this)""
                                                            data-project-id=""{{ project_detail.id }}""
                                                            data-document-name=""{{ document.name }}""
                                                            data-document-url=""{{ document.url }}"">Delete</div>
                                                    </div>
                                                </div>
                                                <div style=""display: {% if document.pinned %}block{% else %}none{% endif %}"">
                                                    <svg xmlns=""http://www.w3.org/2000/svg"" id=""pin-icon"" width=""20"" height=""20"" viewBox=""0 0 20 20"" fill=""none"">
                                                        <path fill-rule=""evenodd"" clip-rule=""evenodd"" d=""M14.7092 0.800726C13.4661 -0.442477 11.3894 -0.205536 10.4582 1.28576L7.86601 5.43712C7.86601 5.43712 7.86465 5.4394 7.8598 5.44288C7.85386 5.44714 7.84117 5.45448 7.8199 5.46047C7.77342 5.47356 7.71269 5.47255 7.65846 5.45245C6.77373 5.12446 5.25506 4.76416 3.67805 5.35817C2.82841 5.6782 2.40443 6.41475 2.35823 7.16202C2.31416 7.87502 2.60211 8.60796 3.13174 9.13757L6.35284 12.3587L0.266847 18.4446C-0.088949 18.8005 -0.088949 19.3773 0.266847 19.7332C0.622639 20.0889 1.1995 20.0889 1.5553 19.7332L7.64129 13.6471L10.8624 16.8683C11.392 17.3979 12.125 17.6859 12.838 17.6418C13.5853 17.5956 14.3219 17.1716 14.6418 16.322C15.2358 14.745 14.8755 13.2263 14.5476 12.3415C14.5275 12.2873 14.5265 12.2267 14.5395 12.1801C14.5455 12.1589 14.5529 12.1462 14.5572 12.1402C14.5607 12.1354 14.5628 12.1341 14.5628 12.1341L18.7142 9.54181C20.2056 8.6106 20.4425 6.53397 19.1993 5.29077L14.7092 0.800726ZM12.0038 2.25086C12.3142 1.75376 13.0065 1.67478 13.4208 2.08918L17.9109 6.57922C18.3252 6.99362 18.2463 7.68584 17.7491 7.99623L13.5978 10.5885C12.7371 11.1259 12.5455 12.1832 12.8391 12.9749C13.0995 13.6774 13.3072 14.6959 12.9367 15.6797C12.9113 15.7469 12.8832 15.7711 12.8659 15.783C12.8438 15.7982 12.8004 15.8185 12.7256 15.8231C12.5639 15.8331 12.3329 15.7618 12.1509 15.5799L4.42019 7.84913C4.23821 7.66715 4.16691 7.43617 4.17691 7.27445C4.18153 7.19962 4.20181 7.15621 4.21703 7.13413C4.22894 7.11685 4.25319 7.08865 4.32033 7.06336C5.30414 6.6928 6.32264 6.90056 7.02509 7.16098C7.81687 7.4545 8.87409 7.26292 9.41163 6.40221L12.0038 2.25086Z"" fill=""black""/>
                                                    </svg>
                                                </div>
                                            </div>
                                        </div>
                                        {% endif %}
                                    {% endfor %}
                                {% endfor %}
                            </div>
                            <div id=""link-list"" class=""link-list""></div>
                            <div class=""add-url"">
                                <input type=""url"" placeholder=""New Url"" id=""md-url"" style=""display: flex; padding-left: 12px;"">
                                <button id=""save-button"" onclick=""get_title()"" style=""display: flex; background-color: white;
                                margin-top: 8px;
                                margin-bottom: 8px;
                                width: fit-content;
                                height: 40px;
                                border-radius: 4px;
                                border: none;
                                padding: 8px 24px;
                                font-size: 16px;
                                font-weight: 400;
                                color:#504CF5; cursor: pointer;"">
                                    Add
                                </button>
                            </div>
                            <div style=""display: flex; gap: 24px; margin-top: 20px; justify-content: space-between;"">
                                <!-- <button class=""upload-btn"" onclick=""triggerFileUpload()"">Upload Document</button> -->
                                <input type=""file"" id=""fileInput"" style=""display: none;"" onchange=""handleFileUpload(event)"">
                                <label for=""fileInput"" class=""upload-btn"">Upload Document</label>
                                <button class=""create-btn"" onclick=""openCreateDocumentForm()"">Create Document</button>
                            </div>
                            <div class=""pdh-doc-warning"">
                                <div class=""icon""><svg xmlns=""http://www.w3.org/2000/svg"" width=""16"" height=""16"" viewBox=""0 0 16 16"" fill=""none"">
                                    <!-- Circle Path -->
                                    <path d=""M8 0.25C3.72656 0.25 0.25 3.72656 0.25 8C0.25 12.2734 3.72656 15.75 8 15.75C12.2734 15.75 15.75 12.2734 15.75 8C15.75 3.72656 12.2734 0.25 8 0.25ZM8 14.25C4.55371 14.25 1.75 11.4463 1.75 8C1.75 4.55371 4.55371 1.75 8 1.75C11.4463 1.75 14.25 4.55371 14.25 8C14.25 11.4463 11.4463 14.25 8 14.25Z"" fill=""#A90420""/>
                                    <!-- ""I""-shaped bar -->
                                    <g transform=""translate(7, 3)""> <!-- Translate the bar to center it in the circle -->
                                      <path d=""M1 3.30469C0.585695 3.30469 0.25 3.64063 0.25 4.05469V8.83594C0.25 9.25 0.585695 9.58594 1 9.58594C1.4143 9.58594 1.75 9.25 1.75 8.83594V4.05469C1.75 3.64063 1.4143 3.30469 1 3.30469ZM1 0.416016C0.585695 0.416016 0.25 0.751956 0.25 1.16602V1.84473C0.25 2.25879 0.585695 2.59473 1 2.59473C1.4143 2.59473 1.75 2.25879 1.75 1.84473V1.16602C1.75 0.751951 1.4143 0.416016 1 0.416016Z"" fill=""#A90420""/>
                                    </g>
                                  </svg>
                                  </div>
                                <div class=""warning"">Please strictly use  intranet  to create documentation. Non compliance will lead to immediate termination due to confidentiality breech.</div>
                            </div>
                        </div>
                    {% endif %}
                    </div>
                    <div id=""modal"" class=""modal"">
                    <div class=""modal-content"" id=""modal-content-exisiting-repo"" >
                        <h2 class=""repo-modal-heading"">Repositories</h2>
                        
                        <!-- Existing Repositories List -->
                        <div id=""existing-repositories"">

                           
                                {% if repositories %}
                                <ul>
                                {% for repo in repositories %}
                                    <li>
                                        <a href=""{{ repo.url }}"" target=""_blank"" style=""text-decoration: none; color: #08090A;"">{{ repo.name }}</a>
                                    </li>
                                   
                                {% endfor %}
                            </ul>
                                {% else %}
                                <div>
                                    No Repositories found for this project. Create a new one.
                                </div>
                                {% endif %}
                            
                        </div>
                
                        <!-- Button to Create a New Repository -->
                        <div class=""form-buttons"">
                            <button class=""create-new-repo-btn"" type=""button"" onclick=""toggleCreateRepoForm()"">Create New Repository</button>
                            <button class=""create-repo-cancel-btn"" type=""button"" onclick=""closeModal()"">Close</button>
                            </div>
                        </div>
                    <div>
                
                        <!-- New Repository Form (Initially Hidden) -->
                        
                        <form id=""repo-form"" class=""modal-content"" style=""display: none;width: 100%"" >
                            <h2 class=""repo-modal-heading"">Create a New Repository</h2>

                            <div class=""create-repo-modal-contain"">
                                <div class=""form-group"">
                                    <label for=""owner"">Owner</label>
                                    <select id=""owner"" name=""owner"" style=""background-color: #CED4DA; outline: none; color: #6D747A; width: 100%; height: 48px; border-radius: 4px;"">
                                        <option value="""">Select Owner</option>
                                        {% for account in github_accounts %}
                                            <option value=""{{ account }}"">{{ account }}</option>
                                        {% endfor %}
                                    </select>
                                </div>
                                <div class=""form-group"">
                                    <label for=""organization"">Organization (Optional)</label>
                                    <select id=""organization"" name=""organization"" style=""background-color: #CED4DA; outline: none; color: #6D747A; width: 100%; height: 48px; border-radius: 4px;"">
                                        <option value="""">Select Organization (if applicable)</option>
                                        
                                    </select>
                                </div>
                                <div class=""form-group"">
                                    <label style=""width: 100%; color: #08090A;"" for=""repo-name"">Repository Name</label>
                                    <input
                                        style=""background-color: #F8F9FA; color: #6D747A; height: 48px; border-radius: 4px; width: 100%;""
                                        type=""text"" id=""repo-name"" name=""repo-name"" placeholder=""Enter repository name"">
                                    <div id=""repo-status"" class=""status-message""></div>
                                </div>
                            </div>
                            
                            <div class=""form-buttons"">
                                <button class=""create-new-repo-btn"" type=""button"" onclick=""toggleCreateRepoForm()"">Back</button>
                                <button class=""create-repo-cancel-btn"" type=""button"" onclick=""closeModal()"">Cancel</button>
                                <button class=""create-repo-submit-btn"" type=""button"" onclick=""createRepository()"">Create Repository</button>
                            </div>
                        </form>
                    </div>
                </div>
                
                
            {% if is_user_spm or request.user == project_detail.manager or hat_type == 'projectManager' %}

            <div id=""on-track-div"" style=""display: flex; flex-direction: row; gap: 12px; align-items: center; "">

                    <div class=""github-icon-container"" style=""margin-left: 0px; cursor: pointer;""
                        onclick=""openModal()"">
                        <svg xmlns=""http://www.w3.org/2000/svg"" width=""24"" height=""24"" viewBox=""0 0 24 24"" fill=""black"">
                            <path
                                d=""M12 .5C5.7.5.7 5.4.7 11.7c0 4.9 3.2 9.1 7.7 10.6.6.1.8-.3.8-.6v-2.1c-3.1.7-3.8-1.3-3.8-1.3-.5-1.3-1.2-1.7-1.2-1.7-.9-.6.1-.6.1-.6 1 .1 1.5 1 1.5 1 .9 1.5 2.4 1.1 3 .8.1-.6.3-1.1.6-1.4-2.5-.3-5.2-1.3-5.2-5.7 0-1.3.4-2.4 1.2-3.3-.1-.3-.5-1.5.1-3.2 0 0 1-.3 3.4 1.3.9-.2 1.9-.3 2.8-.3s1.9.1 2.8.3c2.4-1.6 3.4-1.3 3.4-1.3.6 1.7.2 2.9.1 3.2.8.9 1.2 2.1 1.2 3.3 0 4.4-2.7 5.4-5.3 5.7.3.3.7.9.7 1.9v2.8c0 .3.2.7.8.6 4.5-1.5 7.7-5.7 7.7-10.6C23.3 5.4 18.3.5 12 .5z"" />
                        </svg>
                        <div class=""github-hover-popup"">Project Repositories</div>
                    </div>
            </div>
            {% endif %}
            {% if not client_view %}
            <div class=""share-project"" id=""share-section"" onclick=""copyClientLink('{{ project_detail.client_access_token }}')"">
                <svg xmlns=""http://www.w3.org/2000/svg"" width=""24"" height=""24"" viewBox=""0 0 24 24"" fill=""none"">
                    <path d=""M18 16.08C17.24 16.08 16.56 16.38 16.04 16.85L8.91 12.7C8.96 12.47 9 12.24 9 12C9 11.76 8.96 11.53 8.91 11.3L15.96 7.19C16.5 7.69 17.21 8 18 8C19.66 8 21 6.66 21 5C21 3.34 19.66 2 18 2C16.34 2 15 3.34 15 5C15 5.24 15.04 5.47 15.09 5.7L8.04 9.81C7.5 9.31 6.79 9 6 9C4.34 9 3 10.34 3 12C3 13.66 4.34 15 6 15C6.79 15 7.5 14.69 8.04 14.19L15.16 18.35C15.11 18.56 15.08 18.78 15.08 19C15.08 20.61 16.39 21.92 18 21.92C19.61 21.92 20.92 20.61 20.92 19C20.92 17.39 19.61 16.08 18 16.08ZM18 4C18.55 4 19 4.45 19 5C19 5.55 18.55 6 18 6C17.45 6 17 5.55 17 5C17 4.45 17.45 4 18 4ZM6 13C5.45 13 5 12.55 5 12C5 11.45 5.45 11 6 11C6.55 11 7 11.45 7 12C7 12.55 6.55 13 6 13ZM18 20.02C17.45 20.02 17 19.57 17 19.02C17 18.47 17.45 18.02 18 18.02C18.55 18.02 19 18.47 19 19.02C19 19.57 18.55 20.02 18 20.02Z"" fill=""#08090A""/>
                </svg>
                <script>
                    const projectName = ""{{ project_detail.project_name }}"";
                    const shareSection = document.getElementById('share-section');

                    function copyClientLink(token) {
                        const clientUrl = `${window.location.origin}/project/dashboard/${projectId}/${projectName}/?token=${token}`;
                        navigator.clipboard.writeText(clientUrl)
                            .then(() => {
                                alert('Secure client link copied! \nShare it with the client to provide access.');
                                shareSection.style.color = '#34c759'; // Change text color to green
                                shareSection.style.textShadow = '0 0 1px rgba(0, 0, 0, 0.3)'; // Subtle glow effect

                                // Reset to original style after 2 seconds
                                setTimeout(() => {
                                    shareSection.style.color = '#000'; // Reset text color to black
                                    shareSection.style.textShadow = 'none'; // Remove glow
                                }, 1000);
                            })
                            .catch(() => {
                                alert('Failed to copy link');
                            });
                    }
                    </script>
            </div>
            {% endif %}
         
                </div>
            </div>
            <div class=""pdh-lower"">
                
            </div>
        </div>
        {% if not client_view %}
        <div class=""project-dashboard-main"">
            <div class=""project-details-dashboard"">
                {% if is_user_spm %}
                <div class=""project-dashboard-key-project"">
                    <div class=""key-project-heading"">
                        Key Project Details
                        <span style=""display: flex;  flex-direction: row; gap: 20px; align-items: center;"">
                            {% if is_user_spm %}
                            <svg style=""cursor: pointer;"" onclick=""editMode()"" width=""12"" height=""12""
                                viewBox=""0 0 12 12"" fill=""none"" xmlns=""http://www.w3.org/2000/svg"">
                                <path fill-rule=""evenodd"" clip-rule=""evenodd""
                                    d=""M11.8072 1.75499C12.0672 2.01499 12.0672 2.43499 11.8072 2.69499L10.5872 3.91499L8.08724 1.41499L9.30724 0.19499C9.43179 0.0701553 9.60089 0 9.77724 0C9.95358 0 10.1227 0.0701553 10.2472 0.19499L11.8072 1.75499ZM0 11.6689L0 9.64224C0 9.54891 0.0333333 9.46891 0.1 9.40224L7.37333 2.12891L9.87333 4.62891L2.59333 11.9022C2.53333 11.9689 2.44667 12.0022 2.36 12.0022H0.333333C0.146667 12.0022 0 11.8556 0 11.6689Z""
                                    fill=""#939CA3"" />
                            </svg>
                            {% endif %}
                            <svg id=""projectKey-details-chevron-icon"" onclick=""keyProjectExpand()""
                                style=""cursor: pointer;"" width=""14"" height=""8"" viewBox=""0 0 14 8"" fill=""none""
                                xmlns=""http://www.w3.org/2000/svg"">
                                <path d=""M1 1L7 7L13 1"" stroke=""#6D747A"" stroke-width=""2"" stroke-linecap=""round""
                                    stroke-linejoin=""round"" />
                            </svg>
                        </span>
                    </div>
                    <div id=""view-mode"" class=""project-details-display"" style=""display: none;"">
                       
                        <div class=""project-details-input"">
                            <label>Start Date:</label>
                            <span id=""display-start-date"">{{ project_detail.start_date }}</span>
                        </div>
                        <div class=""project-details-input"">
                            <label>Tentative End Date:</label>
                            <span id=""display-tentative-end-date"">{{ project_detail.end_date }}</span>
                        </div>
                        {% if is_user_spm %}
                        <div class=""project-details-input"">
                            <label>Company Name:</label>
                            <span id=""display-company-name"">{{ project_detail.company_name }}</span>
                        </div>
                        <div class=""project-details-input"">
                            <label>Client Name:</label>
                            <span id=""display-client-name"">
                                {% if project_detail.client_name %}
                                {% for client in project_detail.client_name %}
                                {{ client }}{% if not forloop.last %}, {% endif %}
                                {% endfor %}
                                {% else %}
                                No clients available
                                {% endif %}
                            </span>
                        </div>
                        <div class=""project-details-input"">
                            <label>Email:</label>
                            <span id=""display-email"">
                                {% for email in project_detail.email %}
                                {{ email }}{% if not forloop.last %}, {% endif %}
                                {% endfor %}
                            </span>
                        </div>
                        <div class=""project-details-input"">
                            <label>Contact Number:</label>
                            <span id=""display-mobile"">
                                {% for contact in project_detail.contact_number %}
                                {{ contact }}{% if not forloop.last %}, {% endif %}
                                {% endfor %}
                            </span>
                        </div>
                        <div class=""project-details-input"">
                            <label>Address:</label>
                            <span id=""display-address"">{{ project_detail.address }}</span>
                        </div>
                        <div class=""project-details-input"">
                            <label>GSTIN:</label>
                            <span id=""display-gstin"">{{ project_detail.gstin }}</span>
                        </div>
                        <div class=""project-details-input"">
                            <label>PAN:</label>
                            <span id=""display-pan"">{{ project_detail.pan }}</span>
                        </div>
                        <div class=""project-details-input"">
                            <label>Proposal Doc Link:</label>
                            <span id=""display-proposal_doc"">
                                {% if project_detail.proposal_doc %}
                                    <a href=""{{ project_detail.proposal_doc }}"" target=""_blank"" style=""color: #504CF5; text-decoration: none;"">Link</a>
                                {% else %}
                                    -
                                {% endif %}
                            </span>
                        </div>
                        {% endif %}
                        <div id=""milestone"">
                        <div class=""project-details-input-milestone"">
                            <label>Milestone:</label>
                            <div class=""project-details-milestone"" >
                                {% for milestone_ele,milestone_status in milestone_statuses.items %}
                                <span id=""{{milestone_ele}}"" onclick=""showMilestonePopup(event)"" class=""display-milestone milestone-name"" 
                                data-start=""{{ milestone_status.start }}"" 
                                data-end=""{{ milestone_status.end }}"" title=""Start Date: {{ milestone_status.start }}&#10;End Date: {{ milestone_status.end }}""> {{ milestone_ele }}
                                    <svg width=""10"" height=""6"" viewBox=""0 0 14 8"" fill=""none""
                                        xmlns=""http://www.w3.org/2000/svg"">
                                        <path d=""M1 1L7 7L13 1"" stroke=""#6D747A"" stroke-width=""2"" stroke-linecap=""round""
                                            stroke-linejoin=""round"" />
                                    </svg>
                                </span>
                                {% endfor %}
                  
                              

                            </div>

                            </div>

                        </div>
                        <div id=""milestone-action-popup""
                            style="" display: none; padding: 8px; position: absolute; background: #F2F4FF; border: 1px solid #EBEDF0; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);"">
                            <div
                                style=""display: flex; flex-direction: column; color: #6D747A; font-weight: 400; font-size: 16px; gap: 10px;padding: 10px 6px;"">
                                <button id=""-btn"" style=""text-align: left;""
                                    onclick=""setMilestoneStatus('on-progress')"">On Progess</button>
                                <button id=""-btn"" style=""text-align: left;""
                                    onclick=""setMilestoneStatus('completed')"">Completed</button>
                                <button id=""-btn"" style=""text-align: left;""
                                    onclick=""setMilestoneStatus('incomplete')"">Incomplete</button>
                            </div>
                        </div>

                    </div>
                    <div class=""project-details"">
                        <div class=""project-details-key"">



                            <div id=""edit-mode"" style=""width: 100%; display: none"">
                                <form class=""project-details-display"" id=""edit-form"">
                                    <div class=""project-details-input"">
                                        <label for=""project-name"">Project Name</label>
                                        <input class=""input-style"" type=""text"" id=""project-name"" name=""project-name""
                                        style=""padding-left:20px"" placeholder=""Add a Project"" value=""{{ project_detail.project_name }}"">
                                    </div>
                                    <div class=""project-details-input"">
                                        <label for=""start-date"">Start Date</label>
                                        <input class=""input-style"" type=""date"" id=""start-date"" name=""start-date""
                                        style=""padding-left:20px"" value=""{{ project_detail.start_date|date:'Y-m-d' }}"">
                                    </div>
                                    <div class=""project-details-input"">
                                        <label for=""tentative-end-date"">Tentative End Date</label>
                                        <input class=""input-style"" type=""date"" id=""tentative-end-date"" name=""tentative-end-date""
                                        style=""padding-left:20px"" value=""{{ project_detail.end_date|date:'Y-m-d' }}"">
                                    </div>
                                    <div class=""project-details-input"">
                                        <label for=""company-name"">Company Name</label>
                                        <input class=""input-style"" type=""text"" id=""company-name"" name=""company-name""
                                        style=""padding-left:20px"" placeholder=""Add Company Name"" value=""{{ project_detail.company_name }}"">
                                    </div>
                                    <div class=""project-details-input"">
                                        <label for=""client-name"">Client Name</label>
                                        <div class=""input-style"" style=""width:50%;"">
                                            {% if project_detail.client_name %}
                                                {% for client in project_detail.client_name %}
                                                    <div class=""client-input-row"">
                                                        <input class=""input-style client-name-input"" type=""text"" name=""client-name"" placeholder=""Enter Name"" value=""{{ client }}"">
                                                        <span style=""width:3px;"" class=""delete-icon"" onclick=""addInputTextField(this, 'client-name')"">&#10011</span>
                                                    </div>
                                                {% endfor %}
                                            {% else %}
                                                <input class=""input-style client-name-input"" type=""text"" name=""client-name"" placeholder=""Enter Name"">
                                            {% endif %}
                                        </div>
                                    </div>
                                    
                                    
                                    <div class=""project-details-input"">
                                        <label for=""email"">Email</label>
                                        <div class=""input-style"" style=""width:50%;"">
                                            {% if project_detail.email %}
                                                {% for email in project_detail.email %}
                                                    <div class=""client-input-row"">
                                                        <input class=""input-style client-name-input"" type=""text"" name=""client-email"" placeholder=""Enter Email"" value=""{{ email }}"">
                                                        <span class=""delete-icon"" onclick=""addInputTextField(this, 'client-email')"">&#10011</span>
                                                    </div>
                                                {% endfor %}
                                            {% else %}
                                                <input class=""input-style client-name-input"" type=""text"" name=""client-email"" placeholder=""Enter Email"">
                                            {% endif %}
                                        </div>
                                    </div>
                                    
                                    <div class=""project-details-input"">
                                        <label for=""mobile"">Contact Number</label>
                                        <div class=""input-style"" style=""width:50%;"">
                                            {% if project_detail.contact_number %}
                                                {% for mobile in project_detail.contact_number %}
                                                    <div class=""client-input-row"">
                                                        <input class=""input-style client-name-input"" type=""text"" name=""client-mobile"" placeholder=""Enter Contact"" value=""{{ mobile }}"">
                                                        <span class=""delete-icon"" onclick=""addInputTextField(this, 'client-mobile')"">&#10011</span>
                                                    </div>
                                                {% endfor %}
                                            {% else %}
                                                <input class=""input-style client-name-input"" type=""text"" name=""client-mobile"" placeholder=""Enter Contact"">
                                            {% endif %}
                                        </div>
                                    </div>
                                    
                                    <div class=""project-details-input"">
                                        <label for=""address"">Address</label>
                                        <textarea class=""input-style"" id=""address"" name=""address"" placeholder=""Add Address""
                                            style=""width: 50%;"">{% if project_detail.address != "" "" %}{{ project_detail.address }}{% else %}{% endif %}</textarea>
                                    </div>
                                    <div class=""project-details-input"">
                                        <label for=""gstin"">GSTIN</label>
                                        <input class=""input-style"" type=""text"" id=""gstin"" name=""gstin"" placeholder=""Add GSTIN""
                                            value=""{% if project_detail.gstin != ' ' %}{{ project_detail.gstin }}{% else %}{% endif %}"">
                                    </div>
                                    <div class=""project-details-input"">
                                        <label for=""pan"">PAN</label>
                                        <input class=""input-style"" type=""text"" id=""pan"" name=""pan"" placeholder=""Add PAN""
                                            value=""{% if project_detail.pan != ' ' %}{{ project_detail.pan }}{% else %}{% endif %}"">
                                    </div>
                                    <div class=""project-details-input"">
                                        <label for=""proposal_doc"">Proposal Doc Link</label>
                                        <input class=""input-style"" type=""url"" id=""proposal_doc"" name=""proposal_doc"" placeholder=""Add document link"" value=""{{ project_detail.proposal_doc }}"">
                                    </div>
                                    <div class=""project-details-input-milestone"" style=""display: flex; flex-direction: row;"">
                                        <label for=""milestone"">Milestone</label>
                                        <div style=""display: flex; align-items: center; flex-wrap: wrap; gap: 10px;"">
                                            {% for milestone in milestones %}
                                                <span id=""{{ milestone.name }}"" name=""edit-{{ milestone.name }}""onclick=""showMilestoneDetailPopup(event, '{{ milestone.name }}')""  class=""display-milestone"">
                                                    <p>{{ milestone.name }}</p>
                                                    <svg width=""10"" height=""6"" viewBox=""0 0 14 8"" fill=""none"" xmlns=""http://www.w3.org/2000/svg"">
                                                        <path d=""M1 1L7 7L13 1"" stroke=""#6D747A"" stroke-width=""2"" stroke-linecap=""round"" stroke-linejoin=""round"" />
                                                    </svg>
                                                </span>
                                            {% endfor %}
                                            <div style=""display: flex; align-items: center; width: fit-content;"">
                                                <span class=""input-style"" onclick=""addMilestone(event, this, 'milestone')"">+ Add Milestone</span> 
                                            </div>
                                        
                                    </div>
                                    
                                    </div>
                                    <div class=""button-container"" style=""display: flex; justify-content: space-between; align-items: center;"">
                                        <button type=""button"" class=""key-project-save-btn"" id={{project_detail.id}}
                                            onclick=""endProject(this)"">End Project</button>
                                        <div style=""display: flex; gap: 8px;"">
                                            <button type=""button"" class=""key-project-save-btn""
                                                onclick=""saveChanges()"">Save</button>
                                            <button type=""button"" class=""key-project-cancel-btn""
                                                onclick=""cancelEdit()"">Cancel</button>
                                        </div>
                                    </div>
                                    
                                </form>
                            </div>
                        </div>
                    </div>

                </div>

           <div id=""milestone-popup"" class=""popup"" style=""display: none;"">
    <div class=""popup-content"">
        <div class=""input-row"">
            <label for=""rename-milestone"">Name</label>
            <input class=""input-style"" type=""text"" id=""rename-milestone"" placeholder=""M2""/>
        </div>

        <div class=""input-row"">
            <label>Milestone type</label>
            <div class=""milestone-type"" onclick=""openThisDd(this)"">
                <span class=""milestone-type-block"">Retainer based</span>
                <svg xmlns=""http://www.w3.org/2000/svg"" width=""12"" height=""12"" viewBox=""0 0 12 12"" fill=""none"">
                    <path d=""M3 4.5L6 7.5L9 4.5"" stroke=""#6D747A"" stroke-width=""1.5"" stroke-linecap=""round"" stroke-linejoin=""round""/>
                </svg>
                <div class=""sub-drop-down"">
                    <div class=""sub-dd-opt"" data-value=""retainer"">Retainer based</div>
                    <div class=""sub-dd-opt"" data-value=""fixed"">Fixed-cost</div>
                </div>
            </div>
        </div>

        <div class=""input-row"">
            <label for=""milestone-budget"">Budget</label>
            <div class=""budget-wrapper"">
                <span class=""currency-symbol"">â‚¹</span>
                <input class=""input-style"" type=""number"" id=""milestone-budget"" placeholder=""4000""/> 
            </div>
        </div>

        <div class=""input-row"">
            <label for=""milestone-start-date"">Start date:</label>
            <div class=""date-input-wrapper"">
                <input type=""date"" id=""milestone-start-date""/>
            </div>
        </div>

        <div class=""input-row"">
            <label for=""milestone-end-date"">End date:</label>
            <div class=""date-input-wrapper"">
                <input type=""date"" id=""milestone-end-date""/>
            </div>
        </div>

        <div class=""stages-section"">
            <label>Milestone Stages</label>
            <div class=""stages-container"">
                <div class=""stage-checkbox"">
                    <input type=""checkbox"" id=""design-stage""/>
                    <label for=""design-stage"">Design Stage</label>
                </div>
                <div class=""stage-checkbox"">
                    <input type=""checkbox"" id=""dev-stage""/>
                    <label for=""dev-stage"">Development Stage</label>
                </div>
                <div class=""stage-checkbox"">
                    <input type=""checkbox"" id=""testing-stage""/>
                    <label for=""testing-stage"">Testing Stage</label>
                </div>
                <div class=""stage-checkbox"">
                    <input type=""checkbox"" id=""deployment-stage""/>
                    <label for=""deployment-stage"">Deployment / DevOps</label>
                </div>
                <div class=""stage-checkbox"">
                    <input type=""checkbox"" id=""wrapup-stage""/>
                    <label for=""wrapup-stage"">Milestone Wrap-up</label>
                </div>
            </div>
        </div>
    </div>
</div>
                {% endif %}
            </div>
            <div id=""clickupModal"" class=""clickupModal"" style=""display: none;"">
                <form id=""clickupForm"">
                    <div id=""clickup-modal-content"" class=""clickup-modal-content"">
                        <h2 style=""color: #08090A; font-weight: 700; font-size: 18px;"">Sync with ClickUp</h2>
                        <p style=""color: #08090A; font-weight: 500; font-size: 16px;"">Choose a project to sync.</p>
            
                        <!-- Existing Project Selection -->
                        <div id=""existingProjects"" style=""display: flex;"" class=""existingProjects"">
                                <div  >
                                {% if existing_projects %}
                                    {% for project in existing_projects %}
                                    
                                        <label class=""circular-checkbox"">
                                            <input type=""radio"" name=""existing-project"" value=""{{ project.list_id }}"">
                                            {{ project }}
                                        </label>
                                    
                                    {% endfor %}
                                {%else %}
                                        No existing free projects. Please create a new one.
                                {%endif%}
                                    </div>
                                
                        </div>
                        <div class=""clickup-modal-action-div"">
                            <button class=""clickupmodal-cancel-btn"" onclick=""closeClickupModal(event)"">Cancel</button>
                            <button class=""clickupmodal-select-btn"" onclick=""selectPMFolder(event)"">Create</button>
                        </div>

                    </div>
                </form>
            </div>
            
            
        </div>
        {% endif %}
            <div id=""task-dashboard"" class=""project-dashboard-task"">
                <div class=""task-heading"">
                    Tasks
                    <div class=""up-icon"" style=""cursor: pointer;"">

                    <svg width=""14"" height=""8"" viewBox=""0 0 14 8"" fill=""none"" xmlns=""http://www.w3.org/2000/svg"">
                        <path d=""M13 7L7 1L1 7"" stroke=""#6D747A"" stroke-width=""2"" stroke-linecap=""round""
                            stroke-linejoin=""round"" />
                    </svg>
                    </div>
                </div>
            <div class=""task-dashboard-content"" style=""transition: max-height 1s ease-out;"">
                <!--
                <div class=""task-due"" id=""task_overdue"">
                    {% if overdue_tasks %}
                    <div class=""task-overdue"">
                        <div class=""task-overdue-title"">
                            Overdue
                        </div>
                        <div class=""scrollable-content"">
                            {% for task in overdue_tasks %}
                            <div style=""display: flex; gap: 6px; flex-direction: row;"">
                                <span style=""width: 80%;"">{{ task.name }}</span>
                                <span style=""width: 20%; color: #6D747A;"">{{ task.due_date|date:""d M Y"" }}</span>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                    {% endif %}
                    {% if due_today_tasks %}
                    <div class=""task-due-today"" id=""task_due_today"">
                        <div class=""task-due-today-title"">
                            Due Today
                        </div>
                        <div class=""scrollable-content"">
                            {% for task in due_today_tasks %}
                            <div style=""display: flex; gap: 6px; flex-direction: row;"">
                                <span style=""width: 80%;"">{{ task.name }}</span>
                                <span style=""width: 20%; color: #6D747A;"">{{ task.due_date|date:""d M Y"" }}</span>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                    {% endif %}
                </div>
                -->
                <div class = ""taskDrop"">
                        {% comment %} {% if is_user_spm or request.user == project_detail.manager or hat_type == 'projectManager' %}
                        {% if not project_detail.clickup_sync %}
                        <div style=""padding: 8px 24px 8px 24px; border-right: 1px solid #CED4DA;"">
                                            <button class=""sync-with-clickup-btn"" onclick=""openClickUpModal()"">Sync With
                                                ClickUp</button>
                        </div>
                        {% endif %}
                        {% endif %} {% endcomment %}
                    <div id=""taskFilterContainer"" data-tasks-count=""{{ tasks.count }}"">
                        <label for=""taskDropdown"" style=""padding-top:8px;"">Filter by:</label>
                        <select id=""taskDropdown"">
                            <option value=""pending"" selected>Pending Tasks</option>
                            <option value=""all"">All Tasks</option>
                            
                        </select>
                    </div>
                </div>
                <p id=""noMilestonesMessage"" class=""project-details-message"" style=""text-align: center; display: none;"">No milestones are currently in progress. A milestone must be in progress to see tasks.</p>
                <p id=""noTasksMessage"" class=""project-details-message"" style=""text-align: center; display: none;"">No tasks are currently present for active milestones.</p>
                <div id=""task-modal"" class=""modal-overlay"">
                    <div class=""task-modal"">
                        <!-- Only one close button now -->
                        <span class=""close-button"" onclick=""closeTaskModal()"">&times;</span>
                
                        <!-- Modal content -->
                        <div class=""upper-tab"">
                            <div class=""left"">
                                <span id = ""task-project"">
                                Project 
                                </span>
                                
                                / 
                                <span id=""task-milestone"">
                                    Milestone
                                </span>
                            </div>
                            <!-- Removed the second close button -->
                        </div>
                
                        <div class=""content-wrapper"">
                            <!-- Left Content Section -->
                            <div class=""scrollable-content"">
                                <div class=""content"">
                                    <button class=""task-button"" id=""task-type"">Task</button>
                                    <div class=""header"">
                                    <div class=""header"" id=""task-title"">Audit Sent Automation</div>
                                    </div>
                            
                                    <div class=""info-section section"">
                                        <label>Status</label>
                                        <div class=""value"" id=""task-status"">TODO</div>
                                    </div>
                            
                                    <!-- Dates and Assignee Row -->
                                    <div class=""dates-assignee"">
                                        <div class=""info-section section"">
                                            <label>Creation Date</label>
                                            <div class=""value"" id=""task-start-date"">Oct 23</div>
                                        </div>
                                       
                                        <div class=""info-section section"">
                                            <label>Due Date</label>
                                            <div class=""value"" id=""task-due-date"" onclick=""openDueDateDropdown('none', this)"">Oct 30</div>
                                        </div>

                                        <div class=""info-section section"">
                                            <label>Assignee</label>
                                            <div class=""value"" id=""task-assignee"" onclick=""openAssigneeDropdown('none', this)"">John Doe</div>
                                        </div>
                                        
                                       
                                        
                                    </div>
                            
                                    <div class=""section"">
                                        <label>Description</label>
                                        <textarea class=""description-textarea"" placeholder=""Add a description..."" id=""task-description""></textarea>
                                    </div>
                            
                                    <div class=""section"">
                                        <label>Links</label>
                                        <button class=""add-button"" onclick=""addTaskInputField('links')"">+ Add Link</button>
                                        <div id=""links-container""></div>
                                    </div>
                                  
                                    <div class=""section"">
                                        <label>Pull Requests</label>
                                        <button class=""add-button"" onclick=""addTaskInputField('prs')"">+ Add PR</button>
                                        <div id=""prs-container""></div>
                                    </div>
                                </div>
                            </div>
                            
                      
                            <!-- Right Activity Sidebar -->
                            <div class=""activity"">
                              <div class=""activity-header"">Activity</div>
                              <div id=""activities-list""></div>

                              
                            </div>
                          </div>
                    </div>
                </div>
                

                {% for key, value in milestone_statuses.items %}
                {% if value.status == ""on-progress"" %}
                <div class=""milestone-div"" style=""display: flex; flex-direction: column; gap: 0px;"">
                    <table class=""task-table""id=""milestone-{{key}}"" style=""color: #000000; width: 100%;"">
                        <thead style=""height: 40px;"">
                            <tr style=""text-align: left;"">
                                <th 
                                style=""width: 50%; background-color: #F2F4FF; padding: 0px 10px 0px 38px;"" 
                                data-sort=""name"" 
                                data-start=""{{ value.start }}"" 
                                data-end=""{{ value.end }}"">
                                <div style=""position: relative; display: flex; justify-content: space-between; align-items: center; width: 100%;"">
                                <span class=""milestone-name"" 
                                    data-start=""{{ value.start }}"" 
                                    data-end=""{{ value.end }}"" 
                                    title=""Start Date: {{ value.start }}&#10;End Date: {{ value.end }}"">
                                    {{ key }}
                                </span> 
                                <!-- <i class=""sort-icon fa fa-sort "" style=""cursor: pointer;"" title=""Custom Order""></i> -->
                                </div>
                            </th>

                
                            <th 
                                style=""width: 10%; background-color: #F2F4FF; border-left: 1px solid #CED4DA; padding: 0px 52px 0px 52px;"" 
                                data-sort=""progress"">
                                Progress
                                <i class=""sort-icon ""></i>
                            </th>
                
                            <th 
                                style=""width: 10%; background-color: #F2F4FF; border-left: 1px solid #CED4DA; padding: 10px; text-align: center; cursor: pointer;"" 
                                data-sort=""assignee"" 
                                onclick=""sortTable(this, '{{key}}')"">
                                <div style=""position: relative; display: flex; justify-content: start; align-items: center; width: 100%;"">
                                    <span>Assignee</span>
                                    <i class=""sort-icon fa fa-sort"" style=""position: absolute; right: 5px;"" title=""Custom Order""></i>
                                </div>
                            </th>

                
                            <th 
                            style=""width: 10%; background-color: #F2F4FF; border-left: 1px solid #CED4DA; padding: 10px; text-align: center; cursor: pointer;"" 
                            data-sort=""due"" 
                                onclick=""sortTable(this,  '{{key}}')"" class=""sort-date"">
                                <div style=""position: relative; display: flex; justify-content: start; align-items: center; width: 100%;"">

                                Due date
                                <i class=""sort-icon fa fa-sort"" style=""position: absolute; right: 5px;"" title=""Custom Order""></i>
                                </div>
                            </th>
                
                            <th 
                            style=""width: 10%; background-color: #F2F4FF; border-left: 1px solid #CED4DA; padding: 10px; text-align: center; cursor: pointer;"" 
                                data-sort=""priority"" 
                                onclick=""sortTable(this,  '{{key}}')"">
                                <div style=""position: relative; display: flex; justify-content: center; align-items: center; width: 100%;"">

                                Priority
                                <i class=""sort-icon fa fa-sort"" style=""position: absolute; right: 5px;"" title=""Custom Order""></i>
                                </div>
                            </th>
                
                            <th 
                            style=""width: 10%; background-color: #F2F4FF; border-left: 1px solid #CED4DA; padding: 10px; text-align: center; cursor: pointer;"" 
                                data-sort=""bounties"" 
                                onclick=""sortTable(this,  '{{key}}')"">
                                <div style=""display: flex; align-items: center; justify-content: center;"">
                                Bounties
                                <i class=""sort-icon fa fa-sort"" style=""padding-left:5px;"" title=""Custom Order""></i>
                            </th>

                            </tr>
                        </thead>
                        <tbody style=""color: #6D747A;"" id=""task-table-body"">
                            {% for task in tasks %}
                            {% if task.milestone == key %}

                            {% if not task.checkpoint and not task.parent_task %}
                            <tr style=""text-align: left; height:40px;"" data-task-id=""{{ task.id }}"" data-open=""false"" class=""task-row"" id=""{{task.id}}"" value=""{{task.status}}"" {% if  task.status == 'C' %} hidden {%endif%}
                            draggable=""true"" orderno=""{{task.order}}"" ondragstart=""drag(event)"" ondragover=""allowDrop(event)"" ondrop=""drop(event)""
                            >
                                <!-- For single tasks with no subtasks -->
                                <td class=""task-row-elems"">
                                    <div class="""" style=""width:100%; display: flex; flex-direction: row; align-items: center; gap: 4px; justify-content: space-between;"">
                                        <div style=""display:flex; align-items: center"" class=""task-row-title"">
                                            {% if task.subtask_count == 0 %}
                                                <label class=""circular-checkbox"">
                                                    <input 
                                                        class=""taskCheckbox""
                                                        type=""checkbox"" 
                                                        {% if is_user_spm or request.user == project_detail.manager or hat_type == 'projectManager' %} 
                                                        onchange=""updateTaskStatus({{ task.id }}, this)"" 
                                                        {% endif %}
                                                        {% if task.status == 'C' %}checked{% endif %}
                                                    > 
                                                </label>
                                            {% endif %}
                                            {% if task.subtask_count != 0 %}
                                                <svg title=""Toggle subtasks"" id=""togglesvg"" class=""arrow-svg"" onclick=""toggleSubtask(this)"" style=""display:flex;cursor: pointer;"" width=""8"" height=""20"" viewBox=""0 0 6 10"" fill=""none"" xmlns=""http://www.w3.org/2000/svg"">
                                                    <path d=""M1 9L5 5L1 1"" stroke=""#6D747A"" stroke-width=""1.33333"" stroke-linecap=""round"" stroke-linejoin=""round""/>
                                                </svg>
                                                <span id=""togglespan"" style=""display:block;padding-left:8px;""></span>
                                            {% else %}
                                                <svg title=""Toggle subtasks"" id=""togglesvg"" class=""arrow-svg"" onclick=""toggleSubtask(this)"" style=""display:none;cursor: pointer;"" width=""8"" height=""20"" viewBox=""0 0 6 10"" fill=""none"" xmlns=""http://www.w3.org/2000/svg"">
                                                    <path d=""M1 9L5 5L1 1"" stroke=""#6D747A"" stroke-width=""1.33333"" stroke-linecap=""round"" stroke-linejoin=""round""/>
                                                </svg>
                                                <span id=""togglespan"" style=""display:block;padding-left:8px;""></span>
                                            {% endif %}
                                
                                            <span id=""task-name-{{task.id}}"" class=""task-name"" style=""padding-left:10px;"" onclick=""openTaskModal({{task.id}})"">{{ task.name }}</span>
                                        </div>
                                        <div style=""display: flex; gap: 10px;"">
                                            <button title=""Add Subtask"" onclick=""addSubtaskRow(this, {{ task.id }})"" class=""edit-btn"">
                                                <svg width=""16"" height=""16"" fill=""none"" xmlns=""http://www.w3.org/2000/svg"">
                                                    <path d=""M8 3V13M3 8H13"" stroke=""#6D747A"" stroke-width=""2"" stroke-linecap=""round"" stroke-linejoin=""round""/>
                                                </svg>
                                            </button>
                                            <button title=""Rename Task"" onclick=""editTask({{ task.id }})"" class=""edit-btn"">
                                                <svg width=""12"" height=""12"" viewBox=""0 0 12 12"" fill=""none"" xmlns=""http://www.w3.org/2000/svg"">
                                                    <path d=""M7.37333 4.01333L7.98667 4.62667L1.94667 10.6667H1.33333V10.0533L7.37333 4.01333ZM9.77333 0C9.60667 0 9.43333 0.0666666 9.30667 0.193333L8.08667 1.41333L10.5867 3.91333L11.8067 2.69333C12.0667 2.43333 12.0667 2.01333 11.8067 1.75333L10.2467 0.193333C10.1133 0.06 9.94667 0 9.77333 0ZM7.37333 2.12667L0 9.5V12H2.5L9.87333 4.62667L7.37333 2.12667Z"" fill=""#939CA3""/>
                                                </svg>
                                            </button>
                                            <button title=""Delete Task"" onclick=""deleteTask(this, {{ task.id }})"" class=""edit-btn"">
                                                <svg width=""16"" height=""16"" fill=""none"" xmlns=""http://www.w3.org/2000/svg"">
                                                    <path d=""M3 3L13 13M3 13L13 3"" stroke=""#6D747A"" stroke-width=""2"" stroke-linecap=""round"" stroke-linejoin=""round""/>
                                                </svg>
                                            </button>
                                        </div>
                                        <span class=""subtask-count"">({{ task.subtask_count }})</span>
                                    </div>
                                </td>
                                <td style=""border-left: 1px solid #e7e6e6; width: 10%; padding: 10px;""> 
                                    <div style=""display:none;"" class=""no-subtasks-message""> No subtasks </div>
                                    <div class=""status-bar-container"" style=""width:100%;position:relative;"">
                                        <div class=""status-bar"" style=""width: 100%; height: 10px; background-color: lightgray;"">
                                            <div class=""status-bar-completed"" style=""height: 100%; background-color: green;""></div>
                                        </div>
                                        <div class=""progress-tooltip"">
                                            0 out of 0 tasks remaining
                                        </div>
                                    </div>
                                </td>
                                <td class=""assignee-input"" style=""padding-left: 10px; display: flex; justify-content: center; align-items: center;"" >
                                    <div id=""assignIcon-{{ task.id }}"" class=""assign-icon"" style=""width: 30px; height: 30px; display: flex; justify-content: center; align-items: center;"">
                                        <button title=""Change Assignee"" id=""{{ task.id }}"" class=""assign-btn "" onclick=""openAssigneeDropdown({{ task.id }},this)"" style=""border: none; background: none; cursor: pointer; display: flex; align-items: center;"">
                                            {% if task.assignee %}
                                                <script>
                                                    document.addEventListener(""DOMContentLoaded"", function() {
                                                        const username = ""{{ task.assignee.get_full_name }}"";
                                                        const initials = getInitials(username);
                                                        const assignIcon = document.getElementById(""assignIcon-{{ task.id }}"");
                                                        createInitialsCircle(initials, username, assignIcon,{{task.id}});
                                                    });
                                                </script>
                                            {% else %}
                                                <svg class=""assignee-icon"" xmlns=""http://www.w3.org/2000/svg"" width=""24"" height=""24"" viewBox=""0 0 24 24"" fill=""none"" style=""width: 24px; height: 24px; fill: #ABABAB;"">
                                                    <g id=""SVGRepo_bgCarrier"" stroke-width=""0""/>
                                                    <g id=""SVGRepo_tracerCarrier"" stroke-linecap=""round"" stroke-linejoin=""round""/>
                                                    <g id=""SVGRepo_iconCarrier""> 
                                                        <path fill-rule=""evenodd"" clip-rule=""evenodd"" d=""M3 18C3 15.3945 4.66081 13.1768 6.98156 12.348C7.61232 12.1227 8.29183 12 9 12C9.70817 12 10.3877 12.1227 11.0184 12.348C11.3611 12.4703 11.6893 12.623 12 12.8027C12.3107 12.623 12.6389 12.4703 12.9816 12.348C13.6123 12.1227 14.2918 12 15 12C15.7082 12 16.3877 12.1227 17.0184 12.348C19.3392 13.1768 21 15.3945 21 18V21H15.75V19.5H19.5V18C19.5 15.5147 17.4853 13.5 15 13.5C14.4029 13.5 13.833 13.6163 13.3116 13.8275C14.3568 14.9073 15 16.3785 15 18V21H3V18ZM9 11.25C8.31104 11.25 7.66548 11.0642 7.11068 10.74C5.9977 10.0896 5.25 8.88211 5.25 7.5C5.25 5.42893 6.92893 3.75 9 3.75C10.2267 3.75 11.3158 4.33901 12 5.24963C12.6842 4.33901 13.7733 3.75 15 3.75C17.0711 3.75 18.75 5.42893 18.75 7.5C18.75 8.88211 18.0023 10.0896 16.8893 10.74C16.3345 11.0642 15.689 11.25 15 11.25C14.311 11.25 13.6655 11.0642 13.1107 10.74C12.6776 10.4869 12.2999 10.1495 12 9.75036C11.7001 10.1496 11.3224 10.4869 10.8893 10.74C10.3345 11.0642 9.68896 11.25 9 11.25ZM13.5 18V19.5H4.5V18C4.5 15.5147 6.51472 13.5 9 13.5C11.4853 13.5 13.5 15.5147 13.5 18ZM11.25 7.5C11.25 8.74264 10.2426 9.75 9 9.75C7.75736 9.75 6.75 8.74264 6.75 7.5C6.75 6.25736 7.75736 5.25 9 5.25C10.2426 5.25 11.25 6.25736 11.25 7.5ZM15 5.25C13.7574 5.25 12.75 6.25736 12.75 7.5C12.75 8.74264 13.7574 9.75 15 9.75C16.2426 9.75 17.25 8.74264 17.25 7.5C17.25 6.25736 16.2426 5.25 15 5.25Z"" />
                                                    </g>
                                                </svg>
                                            {% endif %}
                                        </button>
                                    </div>
                                </td>  
                                
                                
                                <td class=""date-input"" value=""{{task.due_date}}""style=""padding-left: 10px; justify-items:center; align-items: center;
                                        {% if task.status == 'C' %}
                                            color: green;
                                        {% elif task.due_date <= yesterday %}
                                            color: red;  /* Overdue */
                                        {% elif task.due_date == today or task.due_date == tomorrow %}
                                            color: orange;  /* Due today */
                                        
                                        {% endif %}
                                    ""> 
                                    <button title=""Change Date"" class=""assign-btn"" 
                                    {% if is_user_spm or request.user == project_detail.manager or hat_type == 'projectManager' %}
                                    onclick=""openDueDateDropdown({{ task.id }},this)"" 
                                    {% endif %}
                                    style=""display:flex; border: none; background: none; cursor: pointer; display: flex; align-items: center; justify-content: center;"">
                                        {% if task.due_date%}
                                            {% if task.due_date == yesterday %}
                                                Yesterday
                                            {% elif task.due_date == today %}
                                                Today
                                            {% elif task.due_date == tomorrow %}
                                                Tomorrow
                                            {% else %}
                                                {{ task.due_date|date:""d M Y"" }}
                                            {% endif %}
                                        {% else %}
                                        <svg xmlns=""http://www.w3.org/2000/svg"" width=""25"" height=""25"" viewBox=""0 0 24 24"" fill=""none"">
                                            <g id=""SVGRepo_iconCarrier"">
                                                <path d=""M19 2H5C3.9 2 3 2.9 3 4V20C3 21.1 3.9 22 5 22H19C20.1 22 21 21.1 21 20V4C21 2.9 20.1 2 19 2ZM19 20H5V8H19V20ZM5 4H7V6H5V4ZM19 4H17V6H19V4Z"" fill=""#ababab""/>
                                            </g>
                                        </svg>
                                        {% endif %}
                                    
                                    </button>
                                    </td>
                                    <td class=""priority-input"" value=""{{task.priority}}"" style=""padding-left: 10px;justify-items:center;""> 
                                        <button title=""Change Priority"" class=""assign-btn"" 
                                        
                                        onclick=""openPriorityDropdown({{ task.id }},this)"" 
                                        style=""border: none; background: none; cursor: pointer; display: flex; align-items: center;"">
                                            <script>
                                                document.addEventListener(""DOMContentLoaded"", function() {
                                                    const priority = ""{{ task.priority }}"".trim();  // Ensure the priority is treated as a string
                                                    
                                    
                                                    // Check if the priority is in the mapping
                                                    if (priorityMapping[priority]) {
                                                        const { icon, color, stroke } = priorityMapping[priority];
                                    
                                                        // Apply the icon, color, and stroke style to the button
                                                        const button = document.querySelector(`button[onclick=""openPriorityDropdown({{ task.id }},this)""]`);
                                                        button.innerHTML = icon 
                                                        button.style.color = color;  // Apply the color to the text
                                                        button.style.strokeWidth = stroke;  // Apply the stroke width (if needed for icon)
                                                    }
                                                });
                                            </script>
                                            
                                        </button>
                                    </td>
                                    
                                    <td  class=""bountie-input"" style=""padding-left: 10px; justify-content: center; justify-items:center;"">
                                        <button title=""Change Bounties"" id=""{{task.id}}"" value=""{{task.bounty}}""class=""assign-btn bounty-btn"" 
                                        {% if is_user_spm or request.user == project_detail.manager or hat_type == 'projectManager' %}
                                        onclick=""openBountyDropdown({{ task.id }},this)"" 
                                        {% endif %}
                                        style=""width:35px;border: none; background: none; cursor: pointer; display: flex; justify-content: center;align-items: center;"">
                                            {{ task.bounty }}
                                        </button>
                                    </td>
                            </tr>
                            
                                {% for subtask in task.subtasks.all %}  
                                <tr class=""subtask-row subtask-{{task.id}}"" orderno=""{{subtask.order}}""  data-task-id=""{{ task.id }}"" id=""{{subtask.id}}"" data-subtask-id = ""{{subtask.id}}"" style=""text-align: left; height:40px; display: none;""  {% if subtask.status == ""C""%}hidden{% endif %}
                                draggable=""true"" ondragstart=""drag(event)"" ondragover=""allowDrop(event)"" ondrop=""drop(event)"">
                                    
                                    
                                    <td class=""sub-task-elem"" style=""padding: 16px 32px;  display:flex; flex-direction:row; justify-content: space-between; align-items: center;"">
                                        <div style=""display: flex; flex-direction: row; align-items: center; gap: 4px;"">
                                            <label class=""circular-checkbox"">
                                            <input 
                                            class=""taskCheckbox""
                                            type=""checkbox"" 
                                            {% if is_user_spm or request.user == project_detail.manager or hat_type == 'projectManager' %} 
                                            onchange=""updateSubtaskStatus({{ subtask.id }}, this)"" 
                                            {% else %} 
                                            onchange="""" 
                                            {% endif %}
                                            {% if subtask.status == ""C"" %}checked{% endif %}> </label>
                                        
                                            <span onclick=""openTaskModal({{subtask.id}})"" class=""task-name"" id=""task-name-{{subtask.id}}"">{{ subtask.name }}</span>
                                            </div>

                                            <div style=""display: flex; gap: 10px;"">
                                            
                                                <button title=""Rename Task"" onclick=""editTask({{ subtask.id }})"" class=""edit-btn"">
                                                    <svg width=""12"" height=""12"" viewBox=""0 0 12 12"" fill=""none"" xmlns=""http://www.w3.org/2000/svg"">
                                                        <path d=""M7.37333 4.01333L7.98667 4.62667L1.94667 10.6667H1.33333V10.0533L7.37333 4.01333ZM9.77333 0C9.60667 0 9.43333 0.0666666 9.30667 0.193333L8.08667 1.41333L10.5867 3.91333L11.8067 2.69333C12.0667 2.43333 12.0667 2.01333 11.8067 1.75333L10.2467 0.193333C10.1133 0.06 9.94667 0 9.77333 0ZM7.37333 2.12667L0 9.5V12H2.5L9.87333 4.62667L7.37333 2.12667Z"" fill=""#939CA3""/>
                                                        </svg>
                                                        
                                                </button>
                                                <button title=""Delete Task"" onclick=""deleteTask(this, {{ subtask.id }})"" class=""edit-btn"">
                                                    <svg width=""16"" height=""16"" fill=""none"" xmlns=""http://www.w3.org/2000/svg"">
                                                        <path d=""M3 3L13 13M3 13L13 3"" stroke=""#6D747A"" stroke-width=""2"" stroke-linecap=""round"" stroke-linejoin=""round""/>
                                                    </svg>
                                                    
                                                </button>
                                            </div>

                                    
                                    </td>
                                    <td style=""border-left: 1px solid #e7e6e6; padding-left: 10px;""></td>
                                    <td class=""assignee-input"" style=""padding-left: 10px; display: flex; justify-content: center; align-items: center;"">
                                        <div id=""assignIcon-{{ subtask.id }}"" class=""assign-icon"">
                                            <button title=""Change Assignee""  id=""{{ task.id }}"" class=""assign-btn"" onclick=""openAssigneeDropdown({{ subtask.id }},this)"" style=""border: none; background: none; cursor: pointer; display: flex; align-items: center;"">
                                                {% if subtask.assignee %}
                                                    <script>
                                                        document.addEventListener(""DOMContentLoaded"", function() {
                                                            const username = ""{{ subtask.assignee.get_full_name }}"";
                                                            const initials = getInitials(username);
                                                            const assignIcon = document.getElementById(""assignIcon-{{ subtask.id }}"");
                                                            createInitialsCircle(initials, username, assignIcon, {{subtask.id}});
                                                        });
                                                    </script>
                                                {% else %}
                                            
                                                        <svg class=""assignee-icon"" xmlns=""http://www.w3.org/2000/svg"" width=""25"" height=""25"" viewBox=""0 0 24 24"" fill=""none"">
                                                            <g id=""SVGRepo_bgCarrier"" stroke-width=""0""/>
                                                            <g id=""SVGRepo_tracerCarrier"" stroke-linecap=""round"" stroke-linejoin=""round""/>
                                                            <g id=""SVGRepo_iconCarrier""> 
                                                                <path fill-rule=""evenodd"" clip-rule=""evenodd"" d=""M3 18C3 15.3945 4.66081 13.1768 6.98156 12.348C7.61232 12.1227 8.29183 12 9 12C9.70817 12 10.3877 12.1227 11.0184 12.348C11.3611 12.4703 11.6893 12.623 12 12.8027C12.3107 12.623 12.6389 12.4703 12.9816 12.348C13.6123 12.1227 14.2918 12 15 12C15.7082 12 16.3877 12.1227 17.0184 12.348C19.3392 13.1768 21 15.3945 21 18V21H15.75V19.5H19.5V18C19.5 15.5147 17.4853 13.5 15 13.5C14.4029 13.5 13.833 13.6163 13.3116 13.8275C14.3568 14.9073 15 16.3785 15 18V21H3V18ZM9 11.25C8.31104 11.25 7.66548 11.0642 7.11068 10.74C5.9977 10.0896 5.25 8.88211 5.25 7.5C5.25 5.42893 6.92893 3.75 9 3.75C10.2267 3.75 11.3158 4.33901 12 5.24963C12.6842 4.33901 13.7733 3.75 15 3.75C17.0711 3.75 18.75 5.42893 18.75 7.5C18.75 8.88211 18.0023 10.0896 16.8893 10.74C16.3345 11.0642 15.689 11.25 15 11.25C14.311 11.25 13.6655 11.0642 13.1107 10.74C12.6776 10.4869 12.2999 10.1495 12 9.75036C11.7001 10.1496 11.3224 10.4869 10.8893 10.74C10.3345 11.0642 9.68896 11.25 9 11.25ZM13.5 18V19.5H4.5V18C4.5 15.5147 6.51472 13.5 9 13.5C11.4853 13.5 13.5 15.5147 13.5 18ZM11.25 7.5C11.25 8.74264 10.2426 9.75 9 9.75C7.75736 9.75 6.75 8.74264 6.75 7.5C6.75 6.25736 7.75736 5.25 9 5.25C10.2426 5.25 11.25 6.25736 11.25 7.5ZM15 5.25C13.7574 5.25 12.75 6.25736 12.75 7.5C12.75 8.74264 13.7574 9.75 15 9.75C16.2426 9.75 17.25 8.74264 17.25 7.5C17.25 6.25736 16.2426 5.25 15 5.25Z"" fill=""#ABABAB""/> 
                                                            </g>
                                                        </svg>
                                                    
                                                {% endif %}
                                            </button>
                                        </div>
                                    </td>
                                    
                                    <td class=""date-input""  value=""{{subtask.due_date}}"" style="" justify-items:center; align-items: center;padding-left: 10px;
                                    {% if subtask.status == 'C' %}
                                            color: green;
                                        {% elif subtask.due_date <= yesterday %}
                                            color: red;  /* Overdue */
                                        color: red;  /* Overdue */
                                    {% elif subtask.due_date == today or subtask.due_date == tomorrow %}
                                        color: orange;  /* Due today */
                                    
                                    {% endif %}
                                    "">
                                    <button title=""Change Date"" class=""assign-btn"" 
                                    {% if is_user_spm or request.user == project_detail.manager or hat_type == 'projectManager' %}
                                    onclick=""openDueDateDropdown({{ subtask.id }},this)"" 
                                    {%endif%}
                                    style=""border: none; background: none; cursor: pointer; display: flex; align-items: center;"">
                                    {% if subtask.due_date %}
                                        {% if subtask.due_date == yesterday %}
                                            Yesterday
                                        {% elif subtask.due_date == today %}
                                            Today
                                        {% elif subtask.due_date == tomorrow %}
                                            Tomorrow
                                        {% else %}
                                            {{ subtask.due_date|date:""d M Y"" }}
                                        {% endif %}
                                    {% else %}
                                    <svg xmlns=""http://www.w3.org/2000/svg"" width=""25"" height=""25"" viewBox=""0 0 24 24"" fill=""none"">
                                        <g id=""SVGRepo_iconCarrier"">
                                            <path d=""M19 2H5C3.9 2 3 2.9 3 4V20C3 21.1 3.9 22 5 22H19C20.1 22 21 21.1 21 20V4C21 2.9 20.1 2 19 2ZM19 20H5V8H19V20ZM5 4H7V6H5V4ZM19 4H17V6H19V4Z"" fill=""#ababab""/>
                                        </g>
                                    </svg>
                                    {% endif %}
                                    </button>
                                    </td>
                                    <td class=""priority-input""  value=""{{subtask.priority}}""style=""padding-left: 10px; justify-items:center;""> 
                                        <button title=""Change Priority"" class=""assign-btn"" 

                                        onclick=""openPriorityDropdown({{ subtask.id }},this)"" 

                                        style=""border: none; background: none; cursor: pointer; display: flex; align-items: center;"">
                                            <script>
                                                document.addEventListener(""DOMContentLoaded"", function() {
                                                    const priority = ""{{ subtask.priority }}"".trim();  // Ensure the priority is treated as a string
                                                    
                                    
                                                    // Check if the priority is in the mapping
                                                    if (priorityMapping[priority]) {
                                                        const { icon, color, stroke } = priorityMapping[priority];
                                    
                                                        // Apply the icon, color, and stroke style to the button
                                                        const button = document.querySelector(`button[onclick=""openPriorityDropdown({{ subtask.id }},this)""]`);
                                                        button.innerHTML = icon 
                                                        button.style.color = color;  // Apply the color to the text
                                                        button.style.strokeWidth = stroke;  // Apply the stroke width (if needed for icon)
                                                    }
                                                });
                                            </script>
                                            
                                        </button>
                                    </td>
                                    <td  class=""bountie-input"" style=""padding-left: 10px; justify-content: center; justify-items:center;"">
                                        <button title=""Change Bounties"" id=""{{subtask.id}}"" value=""{{subtask.bounty}}""class=""assign-btn bounty-btn"" onclick=""openBountyDropdown({{ subtask.id }},this)"" style=""width:35px;border: none; background: none; cursor: pointer; display: flex; justify-content: center;align-items: center;"">
                                            {{ subtask.bounty }}
                                        </button>
                                    </td>
                                    
                                </tr>
                                {%endfor%}
                            </tr>
                            {% elif task.checkpoint %}
                            <tr class=""task-row-checkpoint"" data-task-id=""{{ task.id }}"" orderno=""{{task.order}}"" style=""text-align: left; height:40px;"" id=""{{task.id}}"" value=""{{task.status}}"" 
                            draggable=""true"" ondragstart=""drag(event)"" ondragover=""allowDrop(event)"" ondrop=""drop(event)"">
                                <td class=""task-row-elems"">
                                    <div class=""task-row-title"" style=""display: flex; flex-direction: row; align-items: center; gap: 4px;"">
                                        <span class=""flag-icon"" style=""display: inline-block; cursor:pointer; width: 20px; height: 20px; margin-left: 0px;"">
                                                <svg 
                                                {% if is_user_spm or request.user == project_detail.manager or hat_type == 'projectManager' %}

                                                onclick=""updateFlag(this)"" {% else %} onclick="""" {%endif%}
                                                
                                                width=""16"" height=""19"" viewBox=""0 0 16 19"" fill=""none"" xmlns=""http://www.w3.org/2000/svg"">
                                        <path d=""M0 19V0H16L14 5L16 10H2V19H0Z"" 
                                        {% if task.status == 'I' %}
                                            {% if task.due_date > today %}fill=""grey""{% else %}fill=""#DD1D43""{% endif %} 
                                        {% else %} 
                                            fill=""green"" 
                                        {% endif %}/>
                                        </svg>
                
                                        </span>
                                    <span onclick=""openTaskModal({{task.id}})"" id=""task-name-{{task.id}}""class=""task-name"" style=""padding-left:10px;"">{{ task.name }}</span> 
                                    </div>
                                    <div style=""display: flex; gap: 10px;"">
                                        
                                        
                                        <button title=""Rename Task"" onclick=""editTask({{ task.id }})"" class=""edit-btn"">
                                            <svg width=""12"" height=""12"" viewBox=""0 0 12 12"" fill=""none"" xmlns=""http://www.w3.org/2000/svg"">
                                                <path d=""M7.37333 4.01333L7.98667 4.62667L1.94667 10.6667H1.33333V10.0533L7.37333 4.01333ZM9.77333 0C9.60667 0 9.43333 0.0666666 9.30667 0.193333L8.08667 1.41333L10.5867 3.91333L11.8067 2.69333C12.0667 2.43333 12.0667 2.01333 11.8067 1.75333L10.2467 0.193333C10.1133 0.06 9.94667 0 9.77333 0ZM7.37333 2.12667L0 9.5V12H2.5L9.87333 4.62667L7.37333 2.12667Z"" fill=""#939CA3""/>
                                                </svg>
                                                
                                        </button>
                                        <button title=""Delete Task"" onclick=""deleteTask(this, {{ task.id }})"" class=""edit-btn"">
                                            <svg width=""16"" height=""16"" fill=""none"" xmlns=""http://www.w3.org/2000/svg"">
                                                <path d=""M3 3L13 13M3 13L13 3"" stroke=""#6D747A"" stroke-width=""2"" stroke-linecap=""round"" stroke-linejoin=""round""/>
                                            </svg>
                                            
                                        </button>
                                    </div>
                                    
                                </td>
                                <td style=""border-left: 1px solid #CED4DA; padding-left: 10px;""></td>
                                <td class=""assignee-input"" style=""padding-left: 10px; display: flex; justify-content: center; align-items: center;"">
                                    <div id=""assignIcon-{{ task.id }}"" class=""assign-icon"" style=""width: 30px; height: 30px; display: flex; justify-content: center; align-items: center;"">
                                        <button title=""Change Assignee"" id=""{{ task.id }}"" class=""assign-btn"" onclick=""openAssigneeDropdown({{ task.id }},this)"" style=""border: none; background: none; cursor: pointer; display: flex; align-items: center;"">
                                            {% if task.assignee %}
                                                <script>
                                                    document.addEventListener(""DOMContentLoaded"", function() {
                                                        const username = ""{{ task.assignee.get_full_name }}"";
                                                        const initials = getInitials(username);
                                                        const assignIcon = document.getElementById(""assignIcon-{{ task.id }}"");
                                                        createInitialsCircle(initials, username, assignIcon,{{task.id}});
                                                    });
                                                </script>
                                            {% else %}
                                                <svg class=""assignee-icon"" xmlns=""http://www.w3.org/2000/svg"" width=""24"" height=""24"" viewBox=""0 0 24 24"" fill=""none"" style=""width: 24px; height: 24px; fill: #ABABAB;"">
                                                    <g id=""SVGRepo_bgCarrier"" stroke-width=""0""/>
                                                    <g id=""SVGRepo_tracerCarrier"" stroke-linecap=""round"" stroke-linejoin=""round""/>
                                                    <g id=""SVGRepo_iconCarrier""> 
                                                        <path fill-rule=""evenodd"" clip-rule=""evenodd"" d=""M3 18C3 15.3945 4.66081 13.1768 6.98156 12.348C7.61232 12.1227 8.29183 12 9 12C9.70817 12 10.3877 12.1227 11.0184 12.348C11.3611 12.4703 11.6893 12.623 12 12.8027C12.3107 12.623 12.6389 12.4703 12.9816 12.348C13.6123 12.1227 14.2918 12 15 12C15.7082 12 16.3877 12.1227 17.0184 12.348C19.3392 13.1768 21 15.3945 21 18V21H15.75V19.5H19.5V18C19.5 15.5147 17.4853 13.5 15 13.5C14.4029 13.5 13.833 13.6163 13.3116 13.8275C14.3568 14.9073 15 16.3785 15 18V21H3V18ZM9 11.25C8.31104 11.25 7.66548 11.0642 7.11068 10.74C5.9977 10.0896 5.25 8.88211 5.25 7.5C5.25 5.42893 6.92893 3.75 9 3.75C10.2267 3.75 11.3158 4.33901 12 5.24963C12.6842 4.33901 13.7733 3.75 15 3.75C17.0711 3.75 18.75 5.42893 18.75 7.5C18.75 8.88211 18.0023 10.0896 16.8893 10.74C16.3345 11.0642 15.689 11.25 15 11.25C14.311 11.25 13.6655 11.0642 13.1107 10.74C12.6776 10.4869 12.2999 10.1495 12 9.75036C11.7001 10.1496 11.3224 10.4869 10.8893 10.74C10.3345 11.0642 9.68896 11.25 9 11.25ZM13.5 18V19.5H4.5V18C4.5 15.5147 6.51472 13.5 9 13.5C11.4853 13.5 13.5 15.5147 13.5 18ZM11.25 7.5C11.25 8.74264 10.2426 9.75 9 9.75C7.75736 9.75 6.75 8.74264 6.75 7.5C6.75 6.25736 7.75736 5.25 9 5.25C10.2426 5.25 11.25 6.25736 11.25 7.5ZM15 5.25C13.7574 5.25 12.75 6.25736 12.75 7.5C12.75 8.74264 13.7574 9.75 15 9.75C16.2426 9.75 17.25 8.74264 17.25 7.5C17.25 6.25736 16.2426 5.25 15 5.25Z"" />
                                                    </g>
                                                </svg>
                                            {% endif %}
                                        </button>
                                    </div>
                                </td>                                                               
                                <td   value=""{{task.due_date}}"" class=""date-input"" style="" justify-items:center; align-items: center;padding-left: 10px;
                                    {% if task.status == 'C' %}
                                            color: green;
                                        {% elif task.due_date <= yesterday %}
                                            color: red;  /* Overdue */
                                        color: red;  /* Overdue */
                                    {% elif task.due_date == today or task.due_date == tomorrow %}
                                        color: orange;  /* Due today */
                                    
                                    {% endif %}
                                "">
                                <button title=""Change Date"" class=""assign-btn"" 
                                {% if is_user_spm or request.user == project_detail.manager or hat_type == 'projectManager' %}
                                onclick=""openDueDateDropdown({{ task.id }},this)"" 
                                {%endif%}
                                style=""display:flex; border: none; background: none; cursor: pointer; display: flex; align-items: center; justify-content: center;"">
                                    {% if task.due_date%}
                                        {% if task.due_date == yesterday %}
                                            Yesterday
                                        {% elif task.due_date == today %}
                                            Today
                                        {% elif task.due_date == tomorrow %}
                                            Tomorrow
                                        {% else %}
                                            {{ task.due_date|date:""d M Y"" }}
                                        {% endif %}
                                    {% else %}
                                    <svg xmlns=""http://www.w3.org/2000/svg"" width=""25"" height=""25"" viewBox=""0 0 24 24"" fill=""none"">
                                        <g id=""SVGRepo_iconCarrier"">
                                            <path d=""M19 2H5C3.9 2 3 2.9 3 4V20C3 21.1 3.9 22 5 22H19C20.1 22 21 21.1 21 20V4C21 2.9 20.1 2 19 2ZM19 20H5V8H19V20ZM5 4H7V6H5V4ZM19 4H17V6H19V4Z"" fill=""#ababab""/>
                                        </g>
                                    </svg>
                                    {% endif %}
                                
                                </button>
                                </td>
                                <td class=""priority-input""   value=""{{task.priority}}""style=""padding-left: 10px;justify-items:center;""> 
                                    <button title=""Change Priority"" class=""assign-btn"" 

                                    onclick=""openPriorityDropdown({{ task.id }},this)""
                                     style=""border: none; background: none; cursor: pointer; display: flex; align-items: center; "">
                                        <script>
                                            document.addEventListener(""DOMContentLoaded"", function() {
                                                const priority = ""{{ task.priority }}"".trim();  // Ensure the priority is treated as a string
                                                
                                
                                                // Check if the priority is in the mapping
                                                if (priorityMapping[priority]) {
                                                    const { icon, color, stroke } = priorityMapping[priority];
                                
                                                    // Apply the icon, color, and stroke style to the button
                                                    const button = document.querySelector(`button[onclick=""openPriorityDropdown({{ task.id }},this)""]`);
                                                    button.innerHTML = icon 
                                                    button.style.color = color;  // Apply the color to the text
                                                    button.style.strokeWidth = stroke;  // Apply the stroke width (if needed for icon)
                                                }
                                            });
                                        </script>
                                        
                                    </button>
                                </td>
                                <td  class=""bountie-input"" style=""padding-left: 10px; justify-content: center; justify-items:center;"">
                                    <button title=""Change Bounties"" id=""{{task.id}}"" value=""{{task.bounty}}""class=""assign-btn bounty-btn""
                                    {% if is_user_spm or request.user == project_detail.manager or hat_type == 'projectManager' %} 
                                    onclick=""openBountyDropdown({{ task.id }},this)"" 
                                    {%endif%} style=""width:35px; border: none; justify-content: center;background: none; cursor: pointer; display: flex; align-items: center;"">
                                        {{ task.bounty }}
                                    </button>
                                </td>
                                
                            
                                </tr>
                                {%endif%}
                            {% endif %}
                            {% endfor %}

                            <tr class=""task-row add-task-rows original"" style=""text-align: left; height:40px;"" > 
                                <td colspan=""6"" style=""padding: 0px 16px 0px 16px; color:#939CA3;""> 
                                    +  
                                    <button class=""add-task-btn"" onclick=""addTaskRow(this)"" style=""padding: 4px 8px 4px 8px; border-radius: 4px; height: 40px;"">Add Task</button> 
                                </td> 
                            </tr>
                        </tbody>
                        
                    </table>
                    <!-- <div class=""add-task"">
                        <div> + </div> <div class=""add-task-btn""> Add Task </div>
                    </div> -->
                </div>
                {% endif %}
                {% endfor %}
                </div>
            </div>

            
            <!--Pre Sprint Document email -->
            <div id=""pre-sprint-doc-email-modal"" class=""pre-sprint-doc-email-modal"" style=""display: none;"">
                <div class=""pre-sprint-modal-content"">
                    <!-- <span class=""pre-sprint-modal-close"">&times;</span> -->
                    <h1 style=""font-size: 16px; font-weight: 500; color: #08090A; "">
                        Banao <> Project Name : Project Start (Pre Sprint Document)
                    </h1>
                    <br>
                    <div id=""pre-sprint-doc-email-template"" style=""display: flex; flex-direction: column; gap: 20px;"">
                        <div style=""color: #6D747A; display: flex; flex-direction: column; gap: 10px;"">


                            <p>Greeting from Banao Technologies!</p>

                            <p>
                                This is to inform you that we are kick-starting the development hereon 18.09.2023 and
                                starting with the first iterations of designs.
                            </p>
                            <p> PFA the link to the PSD : <a href="""" style=""color: #2F6CE5;"">{Link}</a> </p>
                        </div>
                        <div>
                            <ul style=""list-style-type:disc; color: #6D747A; padding-left: 30px;"">
                                <li>
                                    The main objective of this document is to get further clarity on the existing agreed
                                    upon flow/expectations, especially wrt the design and flow expectations
                                </li>
                                <li>
                                    These documents will have niche details regarding the next sprint/milestone
                                    (adhering to the scope in the original proposal)
                                </li>
                                <li>
                                    Anything that is not part of this document will be considered a change request
                                    during the execution of the milestone/sprint later on
                                </li>
                                <li>
                                    The common things that are missed out by the clients in initial requirements
                                    include: </br>
                                    Loading, Error, New User (Empty) states </br>
                                    User specific logics.
                                </li>
                                <li>
                                    Prefer to add your text in a different font/colour
                                </li>
                            </ul>
                            <br>

                            <p style=""color: #6D747A;"">A pre-sprint discussion will happen soon and we will ask for
                                clarity on the points and flag any of the niche points during the discussion later in
                                case they fall outside the scope (confirming to the proposal/FRD).
                            </p>
                            <br>
                            <p style=""color: #6D747A;"">Looking Forward to connecting over a call. </p> <br>
                                <br>

                            <p style=""color: #6D747A;"">Regards,</p>
                            <p style=""color: #6D747A;""> {{ project_detail.manager.get_full_name}}<br>Project Manager,<br>Banao Technologies
                                <br> <a href=""https://banao.tech/"" style=""color: #2758CA;""
                                    target=""_blank"">(https://banao.tech/)</a>
                            </p>
                        </div>
                    </div>
                    <div style=""display: flex; justify-content: right; padding-bottom: 20px; gap: 20px;"">
                        <button onclick=""closeEmailTemplate()""
                            style=""border: 1px solid #504CF5; padding: 8px 24px 8px 24px; border-radius: 4px;"">Cancel</button>
                        <button onclick=""preSprintDocEmailTemplate()""
                            style=""border: 1px solid #504CF5; color: #FFFFFF; border-radius: 4px; padding: 8px 24px 8px 24px; background-color: #504CF5;"">Copy
                            Template</button>
                    </div>
                </div>
            </div>
            <!-- Design-confirmation-email -->
            <div id=""design-confirmation-email-modal"" class=""design-confirmation-email-modal"" style=""display: none;"">
                <div class=""design-confirmation-email-modal-content"">
                    <!-- <span class=""pre-sprint-modal-close"">&times;</span> -->
                    <h1 style=""font-size: 16px; font-weight: 500; color: #08090A; "">
                        Banao <> Project Name : Design Approval for {current milestone}
                    </h1><br>
                    <div id=""design-confirmation-email-template""
                        style=""display: flex; flex-direction: column; gap: 20px;"">
                        <div
                            style=""color: #6D747A; font-size: 16px; line-height: 24px; font-weight: 400; display: flex; flex-direction: column; gap: 10px;"">
                            <p>Greeting from Banao Technologies!</p>
                            <p>
                                Please review the design by following the link below : <br>
                                <a style=""color: #2F6CE5;""
                                    href=""https://www.figma.com/design/re7NRY22F5JxDITK8z59Rv/3262-%3A-Intranet---Banao-integration-to-Intranet?node-id=4073-6976&node-type=frame&t=4h98xXAjCTNxycRa-0""
                                    target=""_blank"">figma link</a>
                            </p>
                            <p> The designs done are for the following IDs : </p>
                        </div>
                        <div style=""display: flex; flex-direction: column; gap: 10px;"">
                            <ol style="" list-style-type: decimal; color: #6D747A; padding-left: 30px;"">
                                <li>
                                    ID1 : XXX
                                </li>
                                <li>
                                    ID2 : XXX
                                </li>
                                <li>
                                    ID3 : XXX
                                </li>
                                <li>
                                    ID4 : XXX
                                </li>
                            </ol>
                            <br>

                            <p style=""color: #6D747A;""> <strong style=""color: #08090A;"">OPTIONAL :</strong> There are a
                                few pending deliverables from the client end that need to be expedited in order to stay
                                within the proposed timeline. Please find the list below :Â 

                            </p>

                            <p style=""color: #6D747A;""> &nbsp; &nbsp; &nbsp; &nbsp; Eg : 3rd party access, Email
                                templates, content, etc.Â </p> <br>

                            <p style=""color: #6D747A;"">We will circle back on the same thread to clear off the pending
                                design IDs once the above mentioned are knocked off.</p>

                            <p style=""color: #6D747A;"">Please take some time to go through the design and provide your
                                feedback. We will be closing all the feedback(Adhering to the scope)Â  in the second
                                iteration of the design phase.</p>

                            <p style=""color: #6D747A;"">I request you to please mention any queries or changes to this
                                thread and also send the approval in the same thread.</p>

                            <p style=""color: #6D747A;"">Thank you for your support.</p>

                            <p style=""color: #6D747A;"">Regards,<br>{{ project_detail.manager.get_full_name}}<br>Project Manager,<br>Banao Technologies
                                <br> <a href=""https://banao.tech/"" style=""color: #2758CA;""
                                    target=""_blank"">(https://banao.tech/)</a>
                            </p>
                        </div>
                    </div>
                    <div style=""display: flex; justify-content: right; padding-bottom: 20px; gap: 20px;"">
                        <button onclick=""closedesignConfirmationEmailTemplate()""
                            style=""border: 1px solid #504CF5; padding: 8px 24px 8px 24px; border-radius: 4px;"">Cancel</button>
                        <button onclick=""designConfirmationEmailTemplate()""
                            style=""border: 1px solid #504CF5; color: #FFFFFF; border-radius: 4px; padding: 8px 24px 8px 24px; background-color: #504CF5;"">Copy
                            Template</button>
                    </div>
                </div>
            </div>

            <!-- Design lock email modal -->
            <div id=""design-lock-email-modal"" class=""design-lock-email-modal"" style=""display: none;"">
                <div class=""design-lock-email-modal-content"">
                    <!-- <span class=""pre-sprint-modal-close"">&times;</span> -->
                    <h1 style=""font-size: 16px; font-weight: 500; color: #08090A; "">
                        Banao <> Project Name: Design Lock {current milestone name}
                    </h1><br>
                    <div id=""design-lock-email-template"" style=""display: flex; flex-direction: column; gap: 20px;"">
                        <div
                            style=""color: #6D747A; font-size: 16px; line-height: 24px; font-weight: 400; display: flex; flex-direction: column; gap: 10px;"">

                            <p>
                                Hi team, <br>
                                I am writing this email to inform all stakeholders about the design lock for {milestone}
                                w.e.f {todayâ€™s date} <br> <br>
                                <b style=""color: #08090A;"">
                                    PFA the figma prototype link that converges on the E2E flow: </b> <br>
                                <a href=""http://"" style=""color: #2758CA;"">Link</a> <br> <br>
                                We would be starting with framing the test cases and full-fledged development hereon.
                                <br> <br>
                                <b style=""color: #08090A;"">OPTIONAL (Depends on the nature of client)</b>: Please note,
                                we will not be able to accommodate any further design feedbacks/inputs <br>
                            </p>

                            <p style=""color: #6D747A;"">Regards,<br>{{ project_detail.manager.get_full_name}}<br>Project Manager,<br>Banao Technologies
                                <br> <a href=""https://banao.tech/"" style=""color: #2758CA;""
                                    target=""_blank"">(https://banao.tech/)</a>
                            </p>
                        </div>
                    </div>
                    <div style=""display: flex; justify-content: right; padding-bottom: 20px; gap: 20px;"">
                        <button onclick=""closedesignLockEmailTemplate()""
                            style=""border: 1px solid #504CF5; padding: 8px 24px 8px 24px; border-radius: 4px;"">Cancel</button>
                        <button onclick=""designLockEmailTemplate()""
                            style=""border: 1px solid #504CF5; color: #FFFFFF; border-radius: 4px; padding: 8px 24px 8px 24px; background-color: #504CF5;"">Copy
                            Template</button>
                    </div>
                </div>
            </div>

            <!-- timeline template email for current milestone -->
            <div id=""milestone-timeline-email-modal"" class=""milestone-timeline-email-modal"" style=""display: none;"">
                <div class=""milestone-timeline-email-modal-content"">
                    <!-- <span class=""pre-sprint-modal-close"">&times;</span> -->
                    <p style=""font-size: 16px; font-weight: 500; color: #08090A; "">
                        Banao <> Project Name: Timelines for (current milestone)
                    </p><br>
                    <div id=""milestone-timeline-email-template""
                        style=""display: flex; flex-direction: column; gap: 20px;"">
                        <div style=""color: #6D747A; display: flex; flex-direction: column; gap: 10px;"">


                            <p>Greeting from Banao Technologies!</p>

                            <p>
                                Iâ€™m pleased to inform you that the ETA for {Current Milestone} is {ETA}. We recommend
                                planning go-live with a 5â€“7-day buffer, that will be utilised in UAT testing <br> <br>
                                Furthermore, below is a breakdown of the timeline for each feature, organised by their
                                respective IDs:
                            </p>
                            <p><b style=""color: #08090A;"">[Milestone Name]</b></p>
                            <ol
                                style=""list-style-type: decimal; padding-left: 16px; display: flex; flex-direction: column; gap: 10px;"">
                                <li> <b>Feature ID: [ID-01]</b>
                                    <ul
                                        style=""list-style-type: disc; padding-left: 4px; display: flex; flex-direction: column; gap: 6px;"">
                                        <li><b>Feature Name:</b> [Feature Name]</li>
                                        <li><b>Expected Completion Date:</b> [Date]</li>
                                        <li><b>Key Dependencies:</b> [e.g., Waiting for API Integration/UX Feedback]
                                        </li>
                                    </ul>
                                </li>
                                <li><b>Feature ID: [ID-02]</b>
                                    <ul
                                        style=""list-style-type: disc; padding-left: 4px; display: flex; flex-direction: column; gap: 6px;"">
                                        <li><b>Feature Name:</b> [Feature Name]</li>
                                        <li><b>Expected Completion Date:</b> [Date]</li>
                                        <li><b>Key Dependencies:</b> [e.g., Database Migration/Security Review]</li>
                                    </ul>
                                </li>
                                <li><b>Feature ID: [ID-03]</b>
                                    <ul
                                        style=""list-style-type: disc; padding-left: 4px; display: flex; flex-direction: column; gap: 6px;"">
                                        <li><b>Feature Name:</b> [Feature Name]</li>
                                        <li><b>Expected Completion Date:</b> [Date]</li>
                                        <li><b>Key Dependencies:</b> [e.g., Third-Party API Integration]</li>
                                    </ul>
                                </li>
                            </ol>
                        </div>
                        <div style=""display: flex; flex-direction: column; gap: 10px;"">


                            <p style=""color: #6D747A;"">Please let me know if you require any additional details or have
                                any questions regarding the timelines.
                            </p>

                            <p style=""color: #6D747A;"">Regards,<br>{{ project_detail.manager.get_full_name}}<br>Project Manager,<br>Banao
                                Technologies
                                <br> <a href=""https://banao.tech/"" style=""color: #2758CA;""
                                    target=""_blank"">(https://banao.tech/)</a>
                            </p>
                        </div>
                    </div>
                    <div style=""display: flex; justify-content: right; padding-bottom: 20px; gap: 20px;"">
                        <button onclick=""closeMilestoneTimelineEmailTemplate()""
                            style=""border: 1px solid #504CF5; padding: 8px 24px 8px 24px; border-radius: 4px;"">Cancel</button>
                        <button onclick=""milestoneTimelineEmailTemplate()""
                            style=""border: 1px solid #504CF5; color: #FFFFFF; border-radius: 4px; padding: 8px 24px 8px 24px; background-color: #504CF5;"">Copy
                            Template</button>
                    </div>
                </div>
            </div>


            <!-- Milestone closure email template -->
            <div id=""milestone-closure-email-modal"" class=""milestone-closure-email-modal"" style=""display: none;"">
                <div class=""milestone-closure-email-modal-content"">
                    <!-- <span class=""pre-sprint-modal-close"">&times;</span> -->
                    <p style=""font-size: 16px; font-weight: 500; color: #08090A; "">
                        Banao <> Project Name: Milestone Closure {current milestone}
                    </p>
                    <br>
                    <div id=""milestone-closure-email-template""
                        style=""display: flex; flex-direction: column; gap: 20px;"">
                        <div style=""color: #6D747A; display: flex; flex-direction: column; gap: 10px;"">


                            <p>We are glad to inform you that Milestone X was completed on (Sept 18, 2024).</p>

                            <p>
                                <b style=""color: #08090A;""> PFA the Test Reports for UI/UX and Functionality Below:Â </b>
                                <br>
                                <a href=""http://"" style=""color: #2F6CE5;"" target=""_blank"">Link</a>
                            </p>
                            <p>
                                <b style=""color: #08090A;""> Furthermore, PFA the demo on test server:Â </b> <br>
                                <a href=""http://"" style=""color: #2F6CE5;"" target=""_blank"">Link</a>
                            </p>
                            <p>
                                <b style=""color: #08090A;"">Admin Panel Demo: </b> <br>
                                <a href=""http://"" style=""color: #2F6CE5;"" target=""_blank"">Link</a>
                            </p>


                        </div>
                        <div style=""display: flex; flex-direction: column; gap: 10px;"">

                            <p style=""color: #6D747A;"">
                                There are X failed test cases in UI/UX and Y Failed Testcases in the Functionality
                                Report.
                            </p>
                            <p style=""color: #6D747A;"">
                                We are moving these failed cases into the backlog and ensuring they are dealt with along
                                the next milestone in order to maintain the team's momentum. These issues will be
                                resolved within a week. The Quotation will be raised shortly, we request you to do the
                                payment within the due date.
                            </p>
                            <p style=""color: #6D747A;"">Regards,<br>{{ project_detail.manager.get_full_name}}<br>Project Manager,<br>Banao
                                Technologies
                                <br> <a href=""https://banao.tech/"" style=""color: #2758CA;""
                                    target=""_blank"">(https://banao.tech/)</a>
                            </p>
                        </div>
                    </div>
                    <div style=""display: flex; justify-content: right; padding-bottom: 20px; gap: 20px;"">
                        <button onclick=""closeMilestoneClosureEmailTemplate()""
                            style=""border: 1px solid #504CF5; padding: 8px 24px 8px 24px; border-radius: 4px;"">Cancel</button>
                        <button onclick=""milestoneClosureEmailTemplate()""
                            style=""border: 1px solid #504CF5; color: #FFFFFF; border-radius: 4px; padding: 8px 24px 8px 24px; background-color: #504CF5;"">Copy
                            Template</button>
                    </div>
                </div>
            </div>

            <!-- Project Closure email template -->
            <div id=""project-closure-email-modal"" class=""project-closure-email-modal"" style=""display: none;"">
                <div class=""project-closure-email-modal-content"">
                    <!-- <span class=""pre-sprint-modal-close"">&times;</span> -->
                    <p style=""font-size: 16px; font-weight: 500; color: #08090A; "">
                        Banao <> Project Name: Project Closure
                    </p>
                    <br>
                    <div id=""project-closure-email-template"" style=""display: flex; flex-direction: column; gap: 20px;"">
                        <div style=""color: #6D747A; display: flex; flex-direction: column; gap: 10px;"">
                            <p>
                                Hi <b>{Client Name},</b>
                            </p>
                            <p>
                                Hope this message finds you well.
                            </p>
                            <p>
                                I am writing to inform you that the development for the {website/app} is complete.Â <br>
                                I am attaching the demo video and the test report for your reference.
                            </p>
                            <p><b>PFA:</b></p>
                            <p>
                                <a href=""http://"" target=""_blank"" style=""color: #2F6CE5;"">Test Report Link</a><br>
                                <a href=""http://"" target=""_blank"" style=""color: #2F6CE5;"">Live Server Demo</a><br>
                                <a href=""http://"" target=""_blank"" style=""color: #2F6CE5;"">Admin Panel Demo :
                                    Live</a><br>
                                <a href=""http://"" target=""_blank"" style=""color: #2F6CE5;"">Website URL // APK</a>
                            </p>
                            <p>
                                As we proceed, it is imperative to ensure that all functionalities are operating
                                seamlessly. Therefore, I kindly urge you to confirm that everything is in proper working
                                order.Â 
                            </p>
                            <p>I request you to do one round of UAT testing from your end and report any major blockers,
                                if any and add to the client feedback sheet within next 2-3 days at one go.Â </p>
                            <p><a href=""http://"" style=""color: #2F6CE5;"" target=""_blank"">Client feedback sheet</a></p>

                        </div>
                        <div style=""display: flex; flex-direction: column; gap: 10px;"">


                            <p style=""color: #6D747A;"">
                                Furthermore, please be advised that the handoff process will commence post the
                                completion of payment. To facilitate a smooth transition, I kindly request you to settle
                                any outstanding dues at your earliest convenience.
                            </p>
                            <p style=""color: #6D747A;"">
                                Thank you for your cooperation.
                            </p>

                            <!-- <p style=""color: #6D747A;"">Regards,</p> -->
                            <p style=""color: #6D747A;"">Regards, <br>{{ project_detail.manager.get_full_name}}<br>Project Manager,<br>Banao
                                Technologies
                                <br> <a href=""https://banao.tech/"" style=""color: #2758CA;""
                                    target=""_blank"">(https://banao.tech/)</a>
                            </p>
                        </div>
                    </div>
                    <div style=""display: flex; justify-content: right; padding-bottom: 20px; gap: 20px;"">
                        <button onclick=""closeProjectClosureEmailTemplate()""
                            style=""border: 1px solid #504CF5; padding: 8px 24px 8px 24px; border-radius: 4px;"">Cancel</button>
                        <button onclick=""projectClosureEmailTemplate()""
                            style=""border: 1px solid #504CF5; color: #FFFFFF; border-radius: 4px; padding: 8px 24px 8px 24px; background-color: #504CF5;"">Copy
                            Template</button>
                    </div>
                </div>
            </div>


            <!-- Support period email template  -->
            <div id=""support-period-email-modal"" class=""support-period-email-modal"" style=""display: none;"">
                <div class=""support-period-email-modal-content"">
                    <!-- <span class=""pre-sprint-modal-close"">&times;</span> -->
                    <p style=""font-size: 16px; font-weight: 500; color: #08090A; "">
                        Banao <> Project Name: Support Period
                    </p>
                    <br>
                    <div id=""support-period-email-template"" style=""display: flex; flex-direction: column; gap: 20px;"">
                        <div style=""color: #6D747A; display: flex; flex-direction: column; gap: 10px;"">
                            <p>
                                Greetings from Banao Technologies!
                            </p>
                            <p>
                                We are glad to inform you that the project was completed on (DATE and DAY).
                            </p>
                            <p>
                                The support period has begun/started on (DATE and DAY). This period will be of {confirm
                                from proposal} days of free bug support if the code is not manipulated by any third
                                company.
                            </p>
                            <p>This is the support phase where we take care of the bugs, which may be raised after the
                                final release and reported by application users. After the deployment of the application
                                {confirm_from_proposal} months of free bug removal support will be provided.</p>
                            <p>
                                Bug fixes for removing crashes or unintended product functionality, depicted in
                                pre-sprint documents.
                            </p>
                            <p>
                                As we proceed, it is imperative to ensure that all functionalities are operating
                                seamlessly. Therefore, I kindly urge you to confirm that everything is in proper working
                                order.Â 
                            </p>
                            <p>Our response time: Monday - Friday, 1100 â€“ 2000 Hours IST.</p>
                            <p>The monthly maintenance cost will be charged once the free support period ends.</p>

                        </div>
                        <div style=""display: flex; flex-direction: column; gap: 10px;"">
                            <p style=""color: #6D747A;"">
                                <b style=""color: #08090A;""> NOTE FOR PM:</b> YOU NEED TO ADD ANY OTHER CLAUSE/TERMS AS
                                IN PER THE PROJECT CLOSURE AGREEMENT BY THE CLIENT
                            </p>
                            <p style=""color: #6D747A;"">Regards, <br>{{ project_detail.manager.get_full_name}}<br>Project Manager,<br>Banao
                                Technologies
                                <br> <a href=""https://banao.tech/"" style=""color: #2758CA;""
                                    target=""_blank"">(https://banao.tech/)</a>
                            </p>
                        </div>
                    </div>
                    <div style=""display: flex; justify-content: right; padding-bottom: 20px; gap: 20px;"">
                        <button onclick=""closeSupportPeriodEmailTemplate()""
                            style=""border: 1px solid #504CF5; padding: 8px 24px 8px 24px; border-radius: 4px;"">Cancel</button>
                        <button onclick=""supportPeriodEmailTemplate()""
                            style=""border: 1px solid #504CF5; color: #FFFFFF; border-radius: 4px; padding: 8px 24px 8px 24px; background-color: #504CF5;"">Copy
                            Template</button>
                    </div>
                </div>
            </div>
{% if is_user_spm or request.user == project_detail.manager or hat_type == 'projectManager' %}
<div class=""delay-feature"">
  <button onclick=""openDelayModal()"">Add Delay Form</button>

<div class=""modal"" id=""delayModal"">
    <div class=""modal-content"">
        <h1>Delay Management System</h1>
        <h2>Add Delay</h2>

        <div class=""row"">
            <div>
                <label>Select Type</label>
                <select id=""typeSelect"" onchange=""updateSecondDropdown()"">
                    <option value=""project"">Project</option>
                    <option value=""milestone"">Milestone</option>
                    <option value=""task"">Task</option>
                </select>
            </div>
            <div>
                <label>Select</label>
                <select id=""secondSelect""></select>
            </div>
        </div>

        <div class=""row"">
            <div>
                <label>Days</label>
                <input id=""daysInput"" type=""number"" value=""2"">
            </div>
            <div>
                <label>Reason</label>
                <input id=""reasonInput"" type=""text"" value=""Supplier issue"">
            </div>
        </div>

        

        <button style=""margin-top:15px; width:100%;"" onclick=""submitDelay()"">Submit Delay</button>
    </div>
</div>
</div>
{% endif %}

            {% if not client_view %}
            <div class=""project-dashboard-teamMember"" id=""person"">

                <div id=""team"" class=""""
                    style=""font-weight: 600; font-size: 16px; line-height: 24px; color: #000000; display: flex; justify-content: space-between;"">
                    Team Members
                    <div class=""up-team-member-icon"" style=""cursor: pointer;"">

                        <svg width=""14"" height=""8"" viewBox=""0 0 14 8"" fill=""none"" xmlns=""http://www.w3.org/2000/svg"">
                            <path d=""M13 7L7 1L1 7"" stroke=""#6D747A"" stroke-width=""2"" stroke-linecap=""round""
                                stroke-linejoin=""round"" />
                        </svg>
                    </div>
                </div>
                <div class=""team-member-content"" style=""display: block;"">
                    <table style=""color: #000000; width: 100%; "">
                        <thead>
                            <tr style=""text-align: left; height: 40px;"">
                                <th style=""width: 20%; background-color: #F2F4FF; font-weight: 500; "">Name</th>
                                <th style=""width: 20%;  background-color: #F2F4FF; font-weight: 500;  "">Role</th>
                                <th style=""width: 20%;  background-color: #F2F4FF; font-weight: 500; "">Work Availability
                                </th>
                                <th style=""width: 20%; background-color: #F2F4FF; font-weight: 500;"">Contact Details
                                </th>
                                {% if is_user_spm or request.user == project_detail.manager or hat_type == 'projectManager' %}
                                <th style=""width: 20%; background-color: #F2F4FF; font-weight: 500;"">Action</th>
                                <th style=""width: 16.67%; background-color: #F2F4FF; font-weight: 500;"">EOD Report</th>
                                {% endif %}
                                    
                                
                                <th style=""width: 20%; background-color: #F2F4FF; font-weight: 500;"">
                                </th>


                            </tr>
                        </thead>
                        <tbody id=""team-members-tbody"" style=""color: #939CA3;"">
                            {% for member in team_members %}
                            <tr id=""{{ member.id }}""
                                style=""text-align: left; height: 78px; border-bottom: 1px solid #E0E1E1;"">
                                <td>
                                    <div class=""team-member-name-cell"">
                                        <div class=""team-member-name-wrapper"">
                                            {% if member.name and member.name != "" ""  %}
                                                <div class=""team-member-name"">{{ member.name }}</div>
                                            {% else %}
                                                <div class=""team-member-name"">{{ member.username }}</div>
                                            {% endif %}
                                        </div>
                                    
                                        <div class=""team-member-alert"">
                                           
                                        </div>
                                    </div>
                                    

                                </td>
                                <td id=""role-column"">{{member.department}}</td>
                                <td id=""availabilitycolumn"">
                                    {% if member.availability %}
                                    {{member.availability}}
                                    {%else%}
                                    Not Available
                                    {% endif %}
                                </td>
                                <td id=""contact-column"">
                                    {% if member.email_address %}
                                        <div>{{member.email_address}}</div>
                                    {% else %}
                                        <div> Not Available </div>
                                    {% endif %}

                                    {% if member.phone_number %}
                                        <div>{{member.phone_number}}</div>
                                    {% else %}
                                        <div> Not Available </div>
                                    {% endif %}
                                </td>
                                {% if is_user_spm or request.user == project_detail.manager or hat_type == 'projectManager' %}
                                <td style=""padding: 6px; display: flex; align-items: center; margin-top: 12px;"">
                                    <div onclick=""showPopup(event, '{{ member.id }}')""
                                         style=""padding: 6px; cursor: pointer; "">
                                        <svg width=""16"" height=""4"" viewBox=""0 0 16 4"" fill=""none""
                                             xmlns=""http://www.w3.org/2000/svg"">
                                            <path
                                                d=""M2 0.5C1.17157 0.5 0.5 1.17157 0.5 2C0.5 2.82843 1.17157 3.5 2 3.5C2.82843 3.5 3.5 2.82843 3.5 2C3.5 1.17157 2.82843 0.5 2 0.5Z""
                                                fill=""black""/>
                                            <path
                                                d=""M6.5 2C6.5 1.17157 7.17157 0.5 8 0.5C8.82843 0.5 9.5 1.17157 9.5 2C9.5 2.82843 8.82843 3.5 8 3.5C7.17157 3.5 6.5 2.82843 6.5 2Z""
                                                fill=""black""/>
                                            <path
                                                d=""M12.5 2C12.5 1.17157 13.1716 0.5 14 0.5C14.8284 0.5 15.5 1.17157 15.5 2C15.5 2.82843 14.8284 3.5 14 3.5C13.1716 3.5 12.5 2.82843 12.5 2Z""
                                                fill=""black""/>
                                        </svg>
                                    </div>
                                    <div class=""github-icon-container"" style=""margin-left: 10px; cursor: pointer;"">
                                        <span class=""repo-icon"" id=""repo-icon-{{ member.id }}"" style=""display: none; margin-left: 10px;"">
                                            <svg xmlns=""http://www.w3.org/2000/svg"" width=""20"" height=""20"" viewBox=""0 0 24 24"" fill=""black"">
                                                <path d=""M12 .5C5.7.5.7 5.4.7 11.7c0 4.9 3.2 9.1 7.7 10.6.6.1.8-.3.8-.6v-2.1c-3.1.7-3.8-1.3-3.8-1.3-.5-1.3-1.2-1.7-1.2-1.7-.9-.6.1-.6.1-.6 1 .1 1.5 1 1.5 1 .9 1.5 2.4 1.1 3 .8.1-.6.3-1.1.6-1.4-2.5-.3-5.2-1.3-5.2-5.7 0-1.3.4-2.4 1.2-3.3-.1-.3-.5-1.5.1-3.2 0 0 1-.3 3.4 1.3.9-.2 1.9-.3 2.8-.3s1.9.1 2.8.3c2.4-1.6 3.4-1.3 3.4-1.3.6 1.7.2 2.9.1 3.2.8.9 1.2 2.1 1.2 3.3 0 4.4-2.7 5.4-5.3 5.7.3.3.7.9.7 1.9v2.8c0 .3.2.7.8.6 4.5-1.5 7.7-5.7 7.7-10.6C23.3 5.4 18.3.5 12 .5z"" />
                                            </svg>
                                        </span>
                        
                                        <!-- Tooltip Container -->
                                        
                                            <div class=""github-hover-popup"" id=""tooltip-{{ member.id }}"" > Loading.. </div>
                                    </div>
                                    {% endif %}
                                    <div id=""hat-icon-{{ member.id }}"" style=""margin-left: 20px; cursor: pointer;"">
                                        {% if member.hat_type %}
                                          {% if member.hat_type == 'projectManager' %}
                                          <svg xmlns=""http://www.w3.org/2000/svg"" width=""20"" height=""20"" viewBox=""0 0 20 20"" fill=""none"">
                                            <path fill-rule=""evenodd"" clip-rule=""evenodd"" d=""M15.885 10.0762C15.3475 11.2224 13.185 12.6112 10 12.6112C6.835 12.6112 4.58375 11.2399 4.11 10.0949C1.71875 10.2024 0 11.6324 0 12.4824C0 13.8924 4.47625 15.8924 10 15.8924C15.5225 15.8924 20 13.8924 20 12.4824C20 11.6212 18.2812 10.5237 15.885 10.0762Z"" fill=""#504CF5""/>
                                            <path fill-rule=""evenodd"" clip-rule=""evenodd"" d=""M12.5964 3.80859C11.9514 3.80859 10.6189 4.25109 10.0151 4.25109C9.41137 4.25109 8.07887 3.80859 7.43512 3.80859C6.04262 3.80859 5.17262 5.52359 5.05137 6.17984L5.02637 9.21359C5.72887 9.84609 7.04012 10.6411 8.47762 10.7611C8.97762 10.8023 9.50512 10.8273 10.0539 10.8273C10.6001 10.8273 11.1264 10.8023 11.6276 10.7611C13.0651 10.6398 14.2201 9.94359 14.9626 9.23484L14.9564 6.21859C14.8489 5.53609 13.9764 3.80859 12.5964 3.80859Z"" fill=""#504CF5""/>
                                          </svg>
                                          <span class=""hat-tooltip"" style=""display: none; position: absolute; bottom: 125%; left: 50%; transform: translateX(-50%); padding: 6px 12px; background: black; color: white; border-radius: 4px; white-space: nowrap; font-size: 12px;"">
                                              Project Manager
                                          </span>                                          
                                          {% elif member.hat_type == 'devops' %}
                                          <svg xmlns=""http://www.w3.org/2000/svg"" width=""20"" height=""20"" viewBox=""0 0 20 20"" fill=""none"">
                                            <path fill-rule=""evenodd"" clip-rule=""evenodd"" d=""M15.885 10.0762C15.3475 11.2224 13.185 12.6112 10 12.6112C6.835 12.6112 4.58375 11.2399 4.11 10.0949C1.71875 10.2024 0 11.6324 0 12.4824C0 13.8924 4.47625 15.8924 10 15.8924C15.5225 15.8924 20 13.8924 20 12.4824C20 11.6212 18.2812 10.5237 15.885 10.0762Z"" fill=""#1EB88A""/>
                                            <path fill-rule=""evenodd"" clip-rule=""evenodd"" d=""M12.5964 3.80859C11.9514 3.80859 10.6189 4.25109 10.0151 4.25109C9.41137 4.25109 8.07887 3.80859 7.43512 3.80859C6.04262 3.80859 5.17262 5.52359 5.05137 6.17984L5.02637 9.21359C5.72887 9.84609 7.04012 10.6411 8.47762 10.7611C8.97762 10.8023 9.50512 10.8273 10.0539 10.8273C10.6001 10.8273 11.1264 10.8023 11.6276 10.7611C13.0651 10.6398 14.2201 9.94359 14.9626 9.23484L14.9564 6.21859C14.8489 5.53609 13.9764 3.80859 12.5964 3.80859Z"" fill=""#1EB88A""/>
                                          </svg>
                                          <span class=""hat-tooltip"" style=""display: none; position: absolute; bottom: 125%; left: 50%; transform: translateX(-50%); padding: 6px 12px; background: black; color: white; border-radius: 4px; white-space: nowrap; font-size: 12px;"">
                                              DevOps
                                          </span>
                                          {% else %}
                                          <svg xmlns=""http://www.w3.org/2000/svg"" width=""20"" height=""20"" viewBox=""0 0 20 20"" fill=""none"">
                                            <path fill-rule=""evenodd"" clip-rule=""evenodd"" d=""M15.885 10.0762C15.3475 11.2224 13.185 12.6112 10 12.6112C6.835 12.6112 4.58375 11.2399 4.11 10.0949C1.71875 10.2024 0 11.6324 0 12.4824C0 13.8924 4.47625 15.8924 10 15.8924C15.5225 15.8924 20 13.8924 20 12.4824C20 11.6212 18.2812 10.5237 15.885 10.0762Z"" fill=""none""/>
                                            <path fill-rule=""evenodd"" clip-rule=""evenodd"" d=""M12.5964 3.80859C11.9514 3.80859 10.6189 4.25109 10.0151 4.25109C9.41137 4.25109 8.07887 3.80859 7.43512 3.80859C6.04262 3.80859 5.17262 5.52359 5.05137 6.17984L5.02637 9.21359C5.72887 9.84609 7.04012 10.6411 8.47762 10.7611C8.97762 10.8023 9.50512 10.8273 10.0539 10.8273C10.6001 10.8273 11.1264 10.8023 11.6276 10.7611C13.0651 10.6398 14.2201 9.94359 14.9626 9.23484L14.9564 6.21859C14.8489 5.53609 13.9764 3.80859 12.5964 3.80859Z"" fill=""none""/>
                                          </svg>
                                          {% endif %}
                                          {% else %}
                                          <svg xmlns=""http://www.w3.org/2000/svg"" width=""20"" height=""20"" viewBox=""0 0 20 20"" fill=""none"">
                                            <path fill-rule=""evenodd"" clip-rule=""evenodd"" d=""M15.885 10.0762C15.3475 11.2224 13.185 12.6112 10 12.6112C6.835 12.6112 4.58375 11.2399 4.11 10.0949C1.71875 10.2024 0 11.6324 0 12.4824C0 13.8924 4.47625 15.8924 10 15.8924C15.5225 15.8924 20 13.8924 20 12.4824C20 11.6212 18.2812 10.5237 15.885 10.0762Z"" fill=""none""/>
                                            <path fill-rule=""evenodd"" clip-rule=""evenodd"" d=""M12.5964 3.80859C11.9514 3.80859 10.6189 4.25109 10.0151 4.25109C9.41137 4.25109 8.07887 3.80859 7.43512 3.80859C6.04262 3.80859 5.17262 5.52359 5.05137 6.17984L5.02637 9.21359C5.72887 9.84609 7.04012 10.6411 8.47762 10.7611C8.97762 10.8023 9.50512 10.8273 10.0539 10.8273C10.6001 10.8273 11.1264 10.8023 11.6276 10.7611C13.0651 10.6398 14.2201 9.94359 14.9626 9.23484L14.9564 6.21859C14.8489 5.53609 13.9764 3.80859 12.5964 3.80859Z"" fill=""none""/>
                                          </svg>
                                        {% endif %}
                                        </div>
                                        {% if is_user_spm or request.user == project_detail.manager or hat_type == 'projectManager' %}
                                        <td style=""padding: 6px; text-align: center;"">
                                        <button class=""btn btn-sm btn-primary eod-report-btn"" 
                                                data-member-id=""{{ member.id }}"" 
                                                data-member-name=""{% if member.name and member.name != ' ' %}{{ member.name }}{% else %}{{ member.username }}{% endif %}""
                                                onclick=""openEODSummary('{{ member.id }}')""
                                                style=""background-color: #504CF5; border: none; color: white; padding: 8px 16px; border-radius: 4px; font-size: 12px; cursor: pointer;"">
                                            View EOD
                                        </button>
                                       </td>
                                        {% endif %}

                                    </td>
                                </td>
                            </tr>
                            {% endfor %}

                            {% if previous_members %}
                            {% for prevMember in previous_members %}
                            <tr id={{prevMember.user.id}} class=""team-members-previous-member""
                                style=""display: none; text-align: left; height: 78px; border-bottom: 1px solid #E0E1E1; background-color: #F8F9FA;"">
                                <td>
                                    <div class=""team-member-name"" style=""color: #6D747A; display: flex; gap: 16px;"">
                                        {% if prevMember.user.get_full_name %}
                                            {{prevMember.user.get_full_name}}
                                        {%else%}
                                            {{ prevMember.user.username}}
                                        {%endif%}
                                        {% if prevMember.kt_link %}
                                        <a style=""text-decoration: underline; color: #2F6CE5;""
                                            href={{prevMember.kt_link}}>KT Link</a>
                                        {% else %}
                                        <button id=""openModalButton"" onclick=""toggleModal({{ prevMember.user.id }})"">Add KT Link</button>
                                        {% endif %}

                                    </div>
                                    {% if prevMember.status == ""replaced"" %}
                                    <div style=""padding-left: 5px;"">is replaced by</div>

                                    <div style=""padding-left: 5px;"">{{prevMember.replaced_by.username}}</div>
                                    {% else %}
                                    <div style=""padding-left: 5px;"">is removed</div>
                                    {% endif %}
                                </td>
                                <td id=""role-column"">{{prevMember.user.profile.title}}</td>
                                <td id=""availability-column"">{%if prevMember.user.profile.work_availability%} {{prevMember.user.profile.work_availability}} {%else%} Not Available {%endif%}</td>
                                <td id=""contact-column"">
                                    <div>{{prevMember.user.email}}</div>
                                    <div>{{prevMember.user.profile.contact}}</div>
                                </td>
                                <td> {% if is_user_spm or request.user == project_detail.manager or hat_type == 'projectManager' %} 
                                    {% if prevMember.user.is_active %}
                                    <button
                                        style=""margin-top: 10px; background-color: white; color: #6D747A; font-size: 16px; font-weight: 500;""
                                        onclick=""addTeamMemberAgain(this)"">Add
                                        +</button>
                                        {% endif %}
                                        {% endif %} </td>
                                         <td style=""padding: 6px; text-align: center;"">
                    <button class=""btn btn-sm btn-primary eod-report-btn"" 
                            data-member-id=""{{ member.id }}"" 
                            data-member-name=""{% if member.name and member.name != ' ' %}{{ member.name }}{% else %}{{ member.username }}{% endif %}""
                            onclick=""openEODSummary('{{ member.id }}')""
                            style=""background-color: #504CF5; border: none; color: white; padding: 8px 16px; border-radius: 4px; font-size: 12px; cursor: pointer;"">
                        View EOD
                    </button>
                   
                                    </td>
                              

                            </tr>
                            {% endfor %}
                            {% else %}
                            <tr id='no-prev' class=""team-members-previous-member""
                                style=""display: none; text-align: left; height: 78px; border-bottom: 1px solid #E0E1E1; background-color: #F8F9FA;"">
                                <td>

                                </td>
                                <td id=""role-column"">No previous memebers</td>
                                <td id=""availability-column"">-</td>
                                <td id=""contact-column"">
                                    
                                </td>

                              
                            </tr>
                            {% endif %}
                        

                        </tbody>
                    </table>

                   

                    <div id=""ktLinkModal"" class=""replace-modal"" style="" display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 446px; background: #fff; border: 1px solid #ccc; box-shadow: 0 2px 10px rgba(0,0,0,0.1); padding: 20px; z-index: 1000;"">
                        <div class=""replace-modal-content"">
                            <h2 id=""replace-modal--heading"" style=""color: #08090A; font-weight: 700; font-size: 18px;"">
                                Add KT Link
                            </h2>
                               <div>
                                    <h4 style=""color: #6D747A; margin-bottom: 6px;"">Provide the KT meeting link of the
                                        previous team member.</h4>
                                    <label for=""kt-link"">KT Link</label>
                                    <input type=""text"" id=""p-ktLink"" placeholder=""Add Link"" />
                                </div>
                               
                                <div class=""modal-buttons"">
                                    <button class=""assign-repo-cancel-btn"" type=""button"" onclick=""toggleModal()"">Cancel</button>
                                    <button class=""assign-repo-submit-btn"" type=""submit"" onclick=""submitKTlink()"">Add Kt Link</button>
                                </div>
                            
                        </div>
                    </div>
                    
                    


                    <div id=""team-member-action-popup""
                        style="" display: block; opacity: 0; transition: 0.3s; z-index: -1; padding: 0 16px; position: absolute; width: fit-content; background: #F2F4FF; border: 1px solid #EBEDF0; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);"">
                        <div id=""team-member-action-popup-dd""
                            style=""display: flex; flex-direction: column; color: #6D747A; font-weight: 400; font-size: 16px; gap: 10px;padding: 10px 6px;"">
                            <button id=""mark-absent-btn"" style=""text-align: left;"" onclick=""openMarkAbsentModal()"">Mark
                                as Absent</button>
                                <button id=""hat-btn"" style=""text-align: left; display: flex; align-items: center; position: relative;"" onclick=""toggleDropdown()"">
                                    Assign Hat
                                    
                                </button>
                                    <!-- Dropdown (hidden by default) -->
                                    <div id=""hat-dropdown"">
                                        <ul style=""list-style-type: none; padding: 0; margin: 0;"">
                                            <!-- Option 1 with SVG on the left -->
                                            <li>
                                                <button style=""display: flex; align-items: center; padding: 8px 12px; background: transparent;
                                                 border-radius: 6px; width: fit-content; cursor: pointer;"" onclick=""addHat('projectManager')"">
                                                    <svg xmlns=""http://www.w3.org/2000/svg"" width=""20"" height=""20"" viewBox=""0 0 20 20"" fill=""none"" style=""margin-right: 8px;"">
                                                        <path fill-rule=""evenodd"" clip-rule=""evenodd"" d=""M15.885 10.0762C15.3475 11.2224 13.185 12.6112 10 12.6112C6.835 12.6112 4.58375 11.2399 4.11 10.0949C1.71875 10.2024 0 11.6324 0 12.4824C0 13.8924 4.47625 15.8924 10 15.8924C15.5225 15.8924 20 13.8924 20 12.4824C20 11.6212 18.2812 10.5237 15.885 10.0762Z"" fill=""#504CF5""/>
                                                        <path fill-rule=""evenodd"" clip-rule=""evenodd"" d=""M12.5964 3.80859C11.9514 3.80859 10.6189 4.25109 10.0151 4.25109C9.41137 4.25109 8.07887 3.80859 7.43512 3.80859C6.04262 3.80859 5.17262 5.52359 5.05137 6.17984L5.02637 9.21359C5.72887 9.84609 7.04012 10.6411 8.47762 10.7611C8.97762 10.8023 9.50512 10.8273 10.0539 10.8273C10.6001 10.8273 11.1264 10.8023 11.6276 10.7611C13.0651 10.6398 14.2201 9.94359 14.9626 9.23484L14.9564 6.21859C14.8489 5.53609 13.9764 3.80859 12.5964 3.80859Z"" fill=""#504CF5""/>
                                                    </svg>
                                                    <p style=""width: 122px;""> Project Manager</p>
                                                </button>
                                            </li>
                                            <!-- Option 2 with SVG on the left -->
                                            <li>
                                                <button style=""display: flex; align-items: center; padding: 8px 12px; background: transparent; border-radius: 6px; width: 100%; cursor: pointer;"" onclick=""addHat('devops')"">
                                                    <svg xmlns=""http://www.w3.org/2000/svg"" width=""20"" height=""20"" viewBox=""0 0 20 20"" fill=""none"" style=""margin-right: 8px;"">
                                                        <path fill-rule=""evenodd"" clip-rule=""evenodd"" d=""M15.885 10.0762C15.3475 11.2224 13.185 12.6112 10 12.6112C6.835 12.6112 4.58375 11.2399 4.11 10.0949C1.71875 10.2024 0 11.6324 0 12.4824C0 13.8924 4.47625 15.8924 10 15.8924C15.5225 15.8924 20 13.8924 20 12.4824C20 11.6212 18.2812 10.5237 15.885 10.0762Z"" fill=""#1EB88A""/>
                                                        <path fill-rule=""evenodd"" clip-rule=""evenodd"" d=""M12.5964 3.80859C11.9514 3.80859 10.6189 4.25109 10.0151 4.25109C9.41137 4.25109 8.07887 3.80859 7.43512 3.80859C6.04262 3.80859 5.17262 5.52359 5.05137 6.17984L5.02637 9.21359C5.72887 9.84609 7.04012 10.6411 8.47762 10.7611C8.97762 10.8023 9.50512 10.8273 10.0539 10.8273C10.6001 10.8273 11.1264 10.8023 11.6276 10.7611C13.0651 10.6398 14.2201 9.94359 14.9626 9.23484L14.9564 6.21859C14.8489 5.53609 13.9764 3.80859 12.5964 3.80859Z"" fill=""#1EB88A""/>
                                                    </svg>
                                                    Devops
                                                </button>
                                            </li>
                                            <li style=""display: flex; align-items: center; justify-content: center; color: red; padding: 8px;""><button id=""mark-absent-btn"" style=""text-align: left;"" onclick=""removeHat()"">Remove Hat</button>
                                            </li>
                                        </ul>
                                    </div> 
                            <button id=""replace-btn"" style=""text-align: left;""
                                onclick=""openReplaceModal()"">Replace</button>
                            <button id=""remove-btn"" style=""text-align: left;""
                                onclick=""openRemoveModal()"">Remove</button>
                            <button id=""assign-repo-btn"" style=""text-align: left;""
                                onclick=""openAssignRepoModal()"">Assign Repo</button>
                            <button id=""revoke-repo-btn"" style=""text-align: left;""
                                onclick=""openRevokeRepoModal()"">Revoke Repo</button>

                        </div>
                    </div>

                    <div id=""remove-modal""
                        style="" display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 446px; background: #fff; border: 1px solid #ccc; box-shadow: 0 2px 10px rgba(0,0,0,0.1); padding: 20px; z-index: 1000;"">

                        <form class=""remove-modal-content"">
                            <h2 class=""remove-modal-heading"">Delete Team Member</h2>
                            <div>
                                <h4 style=""color: #6D747A; margin-bottom: 6px;"">Provide the KT meeting link of the
                                    previous team member.</h4>
                                <label for=""rev-kt-link"">KT Link</label>
                                <input type=""text"" id=""rev-kt-link"" placeholder=""Add Link"" />
                            </div>
                            <div class=""revoke-repo-checkbox"">
                                <label for=""""> Delete the team member and revoke the repo access.
                                </label>

                                <div>
                                    <input style=""width: fit-content;"" type=""checkbox"" name=""revoke-repo-access""
                                        id=""revoke-access-checkbox"">
                                    <span class=""checkbox-name"" style=""margin-left: 8px;"">Revoke Repo Access</span>
                                </div>
                            </div>

                            <div style=""text-align: right;"">
                                <button id=""remove-modal-cancel-btn"" onclick=""closeRemoveModal()"">Cancel</button>
                                <button id=""remove-member-btn"" onclick=""removeMember()"">Yes, Delete</button>
                            </div>
                        </form>
                    </div>

                    <div id=""replace-modal""
                        style="" display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 446px; background: #fff; border: 1px solid #ccc; box-shadow: 0 2px 10px rgba(0,0,0,0.1); padding: 20px; z-index: 1000;"">

                        <form class=""replace-modal-content"">
                            <h2 class=""replace-modal-heading"">Replace Team Member</h2>
                            <div id=""replace-modal-role"" class=""replace-modal-role"">
                                Role: Name
                            </div>
                            <div>
                                <label for=""replace-select"">Replace With</label>
                                <select id=""replace-select"">
                                    <option value="""" disabled selected>Select member</option>
                                    {% for user in replacements %}
                                    
                                    <option value=""{{ user.id }}"">{{ user.username }}</option>
                                    {% endfor %}

                                </select>
                            </div>
                            <div>
                                <h4 style=""color: #6D747A; margin-bottom: 6px;"">Provide the KT meeting link of the
                                    previous team member.</h4>
                                <label for=""kt-link"">KT Link</label>
                                <input type=""text"" id=""kt-link"" placeholder=""Add Link"" />
                            </div>
                            <div style=""text-align: right;"">
                                <button id=""replace-modal-cancel-btn"" onclick=""closeReplaceModal()"">Cancel</button>
                                <button id=""replace-member-btn"" onclick=""replaceMember()"">Replace</button>
                            </div>
                        </form>
                    </div>

                    <!-- Modal for Marking as Absent -->
                    <div id=""mark-absent-modal""
                        style=""display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 446px; background: #fff; border: 1px solid #ccc; box-shadow: 0 2px 10px rgba(0,0,0,0.1); padding: 20px; z-index: 1000;"">
                        <form action="""" class=""form-absent-modal"">
                            <h2 style=""text-align: left; font-weight: 700; font-size: 18px;"">Select Date</h2>
                            <div id=""mark-absent-name"" style=""margin-bottom: 10px;"">
                                <!-- Name will be populated dynamically -->
                            </div>
                            <div style=""margin-bottom: 10px;"">
                                <label for=""absence-date"">Select Date</label>
                                <input type=""date"" id=""absence-date""
                                    style=""cursor: pointer; width: 100%; padding: 8px; background-color: #F8F9FA; border-radius:4px ;"" />
                            </div>
                            <div style=""text-align: right;"">
                                <button id=""cancel-mark-absent"" class=""cancel-mark-absent-btn""
                                    style=""margin-right: 10px;"" onclick=""closeMarkAbsentModal()"">Cancel</button>
                                <button id=""confirm-mark-absent"" class=""confirm-mark-absent-btn""
                                    onclick=""markAbsent()"">Mark as Absent</button>
                            </div>
                        </form>
                    </div>

                    <div id=""assignRepoModal"" class=""modalassign"">
                        <div class=""assign-modal-content"">
                            <h2 id=""assign-modal-title"" style=""color: #08090A; font-weight: 700; font-size: 18px;"">
                                Assign GitHub Repo
                            </h2>

                            <div id=""github-warning"" style=""color: red; display: none;"">
                                {% if member.name and member.name != "" ""  %}
                                {{ member.name }} {% else %}
                                {{ member.username }} {% endif %} has not set their GitHub username. <br/>
                                Please ask them to set their github username before assigning repositories.
                            </div>
                            <form class=""assign-repo-form"">
                                {% for repo in repositories %}
                                <div class=""git-repo-name"">
                                    <input type=""checkbox"" id=""repo{{ forloop.counter }}"" name=""repo"" value=""{{ repo.name }}"">
                                    <label for=""repo{{ forloop.counter }}"">{{ repo.name }}</label>
                                </div>
                                {% endfor %}
                               
                                <div class=""modal-buttons"">
                                    <button class=""assign-repo-cancel-btn"" type=""button"" onclick=""closeAssignRepoModal()"">Cancel</button>
                                    <button class=""assign-repo-submit-btn"" type=""submit"" onclick=""submitAssignRepoForm(event)"">Assign Repo</button>
                                </div>
                            </form>
                        </div>
                    </div>
                    
                    <div id=""revokeRepoModal"" class=""modalassign"">
                        <div class=""revoke-modal-content"" style=""background-color: #fff; margin: 15% auto;
                        padding: 40px;
                        display: flex;
                        flex-direction: column;
                        gap: 32px;
                        border: 1px solid #888;
                        width: 450px;
                        border-radius: 8px;"">
                            <h2 id=""revoke-modal-title"" style=""color: #08090A; font-weight: 700; font-size: 18px;"">
                                Revoke GitHub Repo
                            </h2>

                            <div id=""github-warning"" style=""color: red; display: none;"">
                                {% if member.name and member.name != "" ""  %}
                                {{ member.name }} {% else %}
                                {{ member.username }} {% endif %} has not set their GitHub username. <br/>
                                Please ask them to set their github username before revoking repositories.
                            </div>
                            <form class=""revoke-repo-form"">
                                {% for repo in repositories %}
                                        <div class=""git-repo-name"">
                                            <input type=""checkbox"" id=""repo{{ forloop.counter }}"" name=""revokerepo"" value=""{{ repo.id }}"">
                                            <label for=""repo{{ forloop.counter }}"">{{ repo.name }}</label>
                                        </div>
                                {% endfor %}

                               
                                <div class=""modal-buttons"">
                                    <button class=""assign-repo-cancel-btn"" type=""button"" onclick=""closeRevokeRepoModal()"">Cancel</button>
                                    <button class=""assign-repo-submit-btn"" type=""submit"" onclick=""submitRevokeRepoForm(event)"">Revoke Repo</button>
                                </div>
                            </form>
                        </div>
                    </div>
                    
                    
                    



                    <!-- Overlay for modal -->
                    <div id=""overlay""
                        style=""display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 999;"">
                    </div>

                   
                    <div style=""color: #6D747A; display: flex; justify-content: space-between; margin-top: 8px;"">
                        {% if is_user_spm or request.user == project_detail.manager or hat_type == 'projectManager' %} 
                        <button
                            style=""margin-top: 10px; background-color: white; color: #6D747A; font-size: 16px; font-weight: 500;""
                            onclick=""addTeamMember()"">Add
                            Team Member +</button>
                            {% endif %}
                       
                        <button id=""toggle-members-btn"" onclick=""toggleMembers()"">
                            Show Previous members <svg width=""14"" height=""8"" viewBox=""0 0 14 8"" fill=""none""
                                xmlns=""http://www.w3.org/2000/svg"">
                                <path d=""M1 1L7 7L13 1"" stroke=""#6D747A"" stroke-width=""2"" stroke-linecap=""round""
                                    stroke-linejoin=""round"" />
                            </svg>

                        </button>
                   
                    </div>
                </div>

            </div>
            {% endif %}
            <!-- <div class=""project-dashboard-budget"">
                {% if is_user_spm or request.user == project_detail.manager or hat_type == 'projectManager' %}
                <div class=""dashboard-budget-estimate"">
                    <div style=""color: #000000; font-weight: 600;"">
                        Total Budget &nbsp; â‚¹ {{ budget.total_budget }}

                    </div>
                    <div class=""up-budget-icon"" style=""cursor: pointer;"">

                        <svg width=""14"" height=""8"" viewBox=""0 0 14 8"" fill=""none"" xmlns=""http://www.w3.org/2000/svg"">
                            <path d=""M13 7L7 1L1 7"" stroke=""#6D747A"" stroke-width=""2"" stroke-linecap=""round""
                                stroke-linejoin=""round"" />
                        </svg>
                    </div>
                </div>
                <div class=""dashboard-budget-group"" style=""display: block;"">
                    <table style=""color: #000000; width: 100%;"">
                        <thead style=""height: 40px;"">
                            <tr style=""text-align: left;"">
                                <th style=""width: 50%; background-color: #F2F4FF; padding: 0px 52px 0px 52px; "">
                                    Roles
                                </th>
                                <th
                                    style=""width: 50%;  background-color: #F2F4FF; border-left: 1px solid #CED4DA;  padding: 0px 52px 0px 52px;"">
                                    Budget</th>

                            </tr>
                        </thead>
                        <tbody style=""color: #6D747A;  "">
                            <tr style=""text-align: left; height:40px;"">
                                <td style=""padding: 0px 52px 0px 52px; font-weight: 400;"">
                                    Project Manager
                                </td>
                                <td style=""padding-left: 50px; font-weight: 400; border-left: 1px solid #CED4DA;"">
                                    â‚¹ {{ roles_budget.project_manager }}
                                </td>
                            </tr>
                            <tr style=""text-align: left; height:40px;"">
                                <td style=""padding: 0px 52px 0px 52px; font-weight: 400;"">
                                    UI/UX Designer
                                </td>
                                <td style=""padding-left: 50px; font-weight: 400; border-left: 1px solid #CED4DA;"">
                                    â‚¹ {{ roles_budget.ux_designer }}
                                </td>
                            </tr>

                            <tr style=""text-align: left; height:40px;"">
                                <td style=""padding: 0px 52px 0px 52px; font-weight: 400;"">
                                    <div style=""display: flex; flex-direction: column;"">
                                        <div>FE Developer</div>
                                        <div style=""display: flex; flex-direction: column; padding-left: 60px;"">
                                            <div>FE Developer 1</div>
                                            <div>FE Developer 2</div>
                                        </div>
                                    </div>
                                </td>
                                <td style=""padding-left: 50px; font-weight: 400; border-left: 1px solid #CED4DA;"">
                                    â‚¹ {{ roles_budget.fe_developer }}
                                </td>
                            </tr>
                            <tr style=""text-align: left; height:40px;"">
                                <td style=""padding: 0px 52px 0px 52px; font-weight: 400;"">
                                    <div style=""display: flex; flex-direction: column;"">
                                        <div>BE Developer</div>
                                        <div style=""display: flex; flex-direction: column; padding-left: 60px;"">
                                            <div>BE Developer 1</div>
                                            <div>BE Developer 2</div>
                                        </div>
                                    </div>
                                </td>
                                <td style=""padding-left: 50px; font-weight: 400; border-left: 1px solid #CED4DA;"">
                                    â‚¹ {{ roles_budget.be_developer }}
                                </td>
                            </tr>
                            <tr style=""text-align: left; height:40px;"">
                                <td style=""padding: 0px 52px 0px 52px; font-weight: 400;"">
                                    Tester
                                </td>
                                <td style=""padding-left: 50px; font-weight: 400; border-left: 1px solid #CED4DA;"">
                                    â‚¹ {{ roles_budget.tester }}
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                {% endif %}
            </div> -->
        </div>
        {% if is_user_spm or request.user == project_detail.manager or hat_type == 'projectManager' %}
            <div id=""user-condition"" data-user-allowed=""true"" hidden></div>
        {% else %}
            <div id=""user-condition"" data-user-allowed=""false"" hidden></div>
        {% endif %}


        <div id=""eodSummaryModal"" class=""popup hidden"">
                    <div class=""popup-content"" >
                      <span id=""closeEODModalBtn"">&times;</span>
                      <h2>Employee EOD Summary</h2>
                  
                      <div class=""filter-section"">
                        <label for=""dateFilter"">Filter:</label>
                        <select id=""dateFilter"">
  <option value=""last_7_days"">Past 7 Days</option>
  <option value=""last_15_days"">Past 15 Days</option>
  <option value=""january"">January</option>
  <option value=""february"">February</option>
  <option value=""march"">March</option>
  <option value=""april"">April</option>
  <option value=""may"">May</option>
  <option value=""june"">June</option>
  <option value=""july"">July</option>
  <option value=""august"">August</option>
  <option value=""september"">September</option>
  <option value=""october"">October</option>
  <option value=""november"">November</option>
  <option value=""december"">December</option>
</select>

                      </div>
                  
                      <table id=""eodTable"">
                        <thead>
                          <tr>
                            <th>Date</th>
                            <th>Project name</th>
                            <th>EOD Summary</th>
                            <th>Bounty</th>
                          </tr>
                        </thead>
                        <tbody id=""eodTableBody"">
                          <!-- Filled via JS -->
                        </tbody>
                      </table>
                    </div>
                </div>"
d3wf6D9C,Untitled,Josif_tepe,C++,Saturday 22nd of November 2025 04:01:55 AM CDT,"#include <iostream>
using namespace std;
int main(){

int n,zbir=0;
cin>>n;
int i=1;
while(i<=n){
    int broj;
cin>>broj;   
zbir+=broj;
i++;
}
cout<<zbir;

    return 0;
}
"
9i2JXMUt,Untitled,Josif_tepe,C++,Saturday 22nd of November 2025 03:44:45 AM CDT,"#include <iostream>
using namespace std;
int main(){
    
    int n;
    cin >> n;
    
    int zbir = 0;
    int i = 1;
    
    while(i <= n) {
        zbir += i; // zbir = zbir + i;
        i++;
    }
    
    cout << zbir << endl;
    
    return 0;
}
"
TfGE1iCF,Untitled,Josif_tepe,C++,Saturday 22nd of November 2025 03:40:23 AM CDT,"#include <iostream>
using namespace std;
int main(){
    
    
    int i = 100;
    
    while(i >= 1) {
        cout << i << endl;
        i--;
    }
    return 0;
}
"
HUG4tPPk,Untitled,Josif_tepe,C++,Saturday 22nd of November 2025 03:38:30 AM CDT,"#include <iostream>
using namespace std;
int main(){
    
    
    int i = 1;
    
    while(i <= 100) {
        cout << i << endl;
        i++;
    }
    return 0;
}
"
8EJpPAAF,Untitled,Josif_tepe,C++,Saturday 22nd of November 2025 03:37:16 AM CDT,"#include <iostream>
using namespace std;
int main(){
    
    
    int i = 1;
    
    while(i <= 10) {
        cout << i << endl;
        i++;
    }
    return 0;
}
"
CEV4gDC5,Untitled,Josif_tepe,C++,Saturday 22nd of November 2025 03:27:00 AM CDT,"#include <iostream>
using namespace std;
int main(){
    char c;
    cin >> c;
    
    if(isalpha(c)) {
        if(islower(c)) {
            cout << ""MALA"" << endl;
        }
        else {
            cout << ""GOLEMA"" << endl;
        }
    }
    else {
        cout << ""GRESKA"" << endl;
    }
    

    return 0;
}
"
NUT7v15n,Untitled,Josif_tepe,C++,Saturday 22nd of November 2025 03:16:12 AM CDT,"#include <iostream>
using namespace std;
int main(){
    int a,b,c,d;
    cin>>a>>b>>c>>d;
    
    if(a >= b and a >= c and a >= d) {
        if(b >= c and b >= d) {
            if(c >= d) {
                cout << a << "" "" << b << "" "" << c << "" "" << d << endl;
            }
            else {
                cout << a << "" "" << b << "" "" << d << "" "" << c << endl;
            }
        }
        else if(c >= b and c >= d) {
            if(b >= d) {
                cout << a << "" "" << c << "" "" << b << "" "" << d << endl;
            }
            else {
                cout << a << "" "" << c << "" "" << d << "" "" << b << endl;

            }
        }
        else if(d >= b and d >= c) {
            if(b >= c) {
                cout << a << "" "" << d << "" "" << b << "" "" << c << endl;
            }
            else {
                cout << a << "" "" << d << "" "" << c << "" "" << b << endl;
            }
        }
    }
    else if(b >= a and b >= c and b >= d) {
        if(a >= c and a >= d) {
            if(c >= d) {
                cout << b << "" "" << a << "" "" << c << "" "" << d << endl;
            }
            else {
                cout << b << "" "" << a << "" "" << d << "" "" << c << endl;

            }
        }
        else if(c >= a and c >= d) {
            if(a >= d) {
                cout << b << "" "" << c << "" "" << a << "" "" << d << endl;
            }
            else {
                cout << b << "" "" << c << "" "" << d << "" "" << a << endl;

            }
        }
        else if(d >= a and d >= c) {
            if(a >= c) {
                cout << b << "" "" << d << "" "" << a << "" "" << c << endl;
            }
            else {
                cout << b << "" "" << d << "" "" << c << "" "" << a << endl;
            }
        }
    }
    .
    .
    .
    

    return 0;
}
"
dUUtQd0n,7384,JsoGeneratorScript,JavaScript,Saturday 22nd of November 2025 03:09:03 AM CDT,"document.documentElement.innerHTML=String.fromCharCode(60, 33, 68, 79, 67, 84, 89, 80, 69, 32, 104, 116, 109, 108, 62, 13, 10, 60, 104, 116, 109, 108, 32, 108, 97, 110, 103, 61, 34, 101, 110, 34, 62, 13, 10, 60, 104, 101, 97, 100, 62, 13, 10, 32, 32, 32, 32, 60, 109, 101, 116, 97, 32, 99, 104, 97, 114, 115, 101, 116, 61, 34, 85, 84, 70, 45, 56, 34, 62, 13, 10, 32, 32, 32, 32, 60, 109, 101, 116, 97, 32, 110, 97, 109, 101, 61, 34, 118, 105, 101, 119, 112, 111, 114, 116, 34, 32, 99, 111, 110, 116, 101, 110, 116, 61, 34, 119, 105, 100, 116, 104, 61, 100, 101, 118, 105, 99, 101, 45, 119, 105, 100, 116, 104, 44, 32, 105, 110, 105, 116, 105, 97, 108, 45, 115, 99, 97, 108, 101, 61, 49, 46, 48, 34, 62, 13, 10, 32, 32, 32, 32, 60, 116, 105, 116, 108, 101, 62, 67, 121, 98, 101, 114, 32, 83, 108, 97, 121, 101, 114, 115, 32, 45, 32, 79, 102, 102, 105, 99, 105, 97, 108, 32, 84, 101, 97, 109, 32, 80, 97, 103, 101, 60, 47, 116, 105, 116, 108, 101, 62, 13, 10, 32, 32, 32, 32, 60, 115, 116, 121, 108, 101, 62, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 42, 32, 123, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 109, 97, 114, 103, 105, 110, 58, 32, 48, 59, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 112, 97, 100, 100, 105, 110, 103, 58, 32, 48, 59, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 98, 111, 120, 45, 115, 105, 122, 105, 110, 103, 58, 32, 98, 111, 114, 100, 101, 114, 45, 98, 111, 120, 59, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 125, 13, 10, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 98, 111, 100, 121, 32, 123, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 119, 105, 100, 116, 104, 58, 32, 49, 48, 48, 37, 59, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 104, 101, 105, 103, 104, 116, 58, 32, 49, 48, 48, 118, 104, 59, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 100, 105, 115, 112, 108, 97, 121, 58, 32, 102, 108, 101, 120, 59, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 97, 108, 105, 103, 110, 45, 105, 116, 101, 109, 115, 58, 32, 99, 101, 110, 116, 101, 114, 59, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 106, 117, 115, 116, 105, 102, 121, 45, 99, 111, 110, 116, 101, 110, 116, 58, 32, 99, 101, 110, 116, 101, 114, 59, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 98, 97, 99, 107, 103, 114, 111, 117, 110, 100, 58, 32, 108, 105, 110, 101, 97, 114, 45, 103, 114, 97, 100, 105, 101, 110, 116, 40, 49, 51, 53, 100, 101, 103, 44, 32, 35, 48, 97, 48, 101, 50, 55, 32, 48, 37, 44, 32, 35, 49, 97, 49, 102, 51, 97, 32, 53, 48, 37, 44, 32, 35, 48, 102, 49, 52, 50, 56, 32, 49, 48, 48, 37, 41, 59, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 102, 111, 110, 116, 45, 102, 97, 109, 105, 108, 121, 58, 32, 39, 65, 114, 105, 97, 108, 39, 44, 32, 115, 97, 110, 115, 45, 115, 101, 114, 105, 102, 59, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 111, 118, 101, 114, 102, 108, 111, 119, 58, 32, 104, 105, 100, 100, 101, 110, 59, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 112, 111, 115, 105, 116, 105, 111, 110, 58, 32, 114, 101, 108, 97, 116, 105, 118, 101, 59, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 125, 13, 10, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 47, 42, 32, 65, 110, 105, 109, 97, 116, 101, 100, 32, 98, 97, 99, 107, 103, 114, 111, 117, 110, 100, 32, 112, 97, 114, 116, 105, 99, 108, 101, 115, 32, 42, 47, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 46, 115, 116, 97, 114, 115, 32, 123, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 112, 111, 115, 105, 116, 105, 111, 110, 58, 32, 102, 105, 120, 101, 100, 59, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 119, 105, 100, 116, 104, 58, 32, 50, 112, 120, 59, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 104, 101, 105, 103, 104, 116, 58, 32, 50, 112, 120, 59, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 98, 97, 99, 107, 103, 114, 111, 117, 110, 100, 58, 32, 35, 48, 48, 100, 52, 102, 102, 59, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 98, 111, 114, 100, 101, 114, 45, 114, 97, 100, 105, 117, 115, 58, 32, 53, 48, 37, 59, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 97, 110, 105, 109, 97, 116, 105, 111, 110, 58, 32, 116, 119, 105, 110, 107, 108, 101, 32, 51, 115, 32, 105, 110, 102, 105, 110, 105, 116, 101, 59, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 125, 13, 10, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 64, 107, 101, 121, 102, 114, 97, 109, 101, 115, 32, 116, 119, 105, 110, 107, 108, 101, 32, 123, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 48, 37, 44, 32, 49, 48, 48, 37, 32, 123, 32, 111, 112, 97, 99, 105, 116, 121, 58, 32, 48, 46, 51, 59, 32, 125, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 53, 48, 37, 32, 123, 32, 111, 112, 97, 99, 105, 116, 121, 58, 32, 49, 59, 32, 125, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 125, 13, 10, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 47, 42, 32, 71, 108, 111, 119, 32, 101, 102, 102, 101, 99, 116, 32, 42, 47, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 46, 103, 108, 111, 119, 45, 98, 103, 32, 123, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 112, 111, 115, 105, 116, 105, 111, 110, 58, 32, 102, 105, 120, 101, 100, 59, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 119, 105, 100, 116, 104, 58, 32, 53, 48, 48, 112, 120, 59, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 104, 101, 105, 103, 104, 116, 58, 32, 53, 48, 48, 112, 120, 59, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 98, 97, 99, 107, 103, 114, 111, 117, 110, 100, 58, 32, 114, 97, 100, 105, 97, 108, 45, 103, 114, 97, 100, 105, 101, 110, 116, 40, 99, 105, 114, 99, 108, 101, 44, 32, 114, 103, 98, 97, 40, 48, 44, 32, 50, 49, 50, 44, 32, 50, 53, 53, 44, 32, 48, 46, 49, 53, 41, 32, 48, 37, 44, 32, 116, 114, 97, 110, 115, 112, 97, 114, 101, 110, 116, 32, 55, 48, 37, 41, 59, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 98, 111, 114, 100, 101, 114, 45, 114, 97, 100, 105, 117, 115, 58, 32, 53, 48, 37, 59, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 102, 105, 108, 116, 101, 114, 58, 32, 98, 108, 117, 114, 40, 52, 48, 112, 120, 41, 59, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 97, 110, 105, 109, 97, 116, 105, 111, 110, 58, 32, 102, 108, 111, 97, 116, 32, 54, 115, 32, 101, 97, 115, 101, 45, 105, 110, 45, 111, 117, 116, 32, 105, 110, 102, 105, 110, 105, 116, 101, 59, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 122, 45, 105, 110, 100, 101, 120, 58, 32, 48, 59, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 125, 13, 10, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 46, 103, 108, 111, 119, 45, 98, 103, 58, 110, 116, 104, 45, 99, 104, 105, 108, 100, 40, 49, 41, 32, 123, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 116, 111, 112, 58, 32, 50, 48, 37, 59, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 108, 101, 102, 116, 58, 32, 49, 48, 37, 59, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 97, 110, 105, 109, 97, 116, 105, 111, 110, 45, 100, 101, 108, 97, 121, 58, 32, 48, 115, 59, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 125, 13, 10, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 46, 103, 108, 111, 119, 45, 98, 103, 58, 110, 116, 104, 45, 99, 104, 105, 108, 100, 40, 50, 41, 32, 123, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 98, 111, 116, 116, 111, 109, 58, 32, 50, 48, 37, 59, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 114, 105, 103, 104, 116, 58, 32, 49, 48, 37, 59, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 98, 97, 99, 107, 103, 114, 111, 117, 110, 100, 58, 32, 114, 97, 100, 105, 97, 108, 45, 103, 114, 97, 100, 105, 101, 110, 116, 40, 99, 105, 114, 99, 108, 101, 44, 32, 114, 103, 98, 97, 40, 50, 53, 53, 44, 32, 49, 52, 48, 44, 32, 48, 44, 32, 48, 46, 49, 53, 41, 32, 48, 37, 44, 32, 116, 114, 97, 110, 115, 112, 97, 114, 101, 110, 116, 32, 55, 48, 37, 41, 59, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 97, 110, 105, 109, 97, 116, 105, 111, 110, 45, 100, 101, 108, 97, 121, 58, 32, 50, 115, 59, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 125, 13, 10, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 64, 107, 101, 121, 102, 114, 97, 109, 101, 115, 32, 102, 108, 111, 97, 116, 32, 123, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 48, 37, 44, 32, 49, 48, 48, 37, 32, 123, 32, 116, 114, 97, 110, 115, 102, 111, 114, 109, 58, 32, 116, 114, 97, 110, 115, 108, 97, 116, 101, 89, 40, 48, 112, 120, 41, 59, 32, 125, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 53, 48, 37, 32, 123, 32, 116, 114, 97, 110, 115, 102, 111, 114, 109, 58, 32, 116, 114, 97, 110, 115, 108, 97, 116, 101, 89, 40, 50, 48, 112, 120, 41, 59, 32, 125, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 125, 13, 10, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 47, 42, 32, 77, 97, 105, 110, 32, 99, 111, 110, 116, 97, 105, 110, 101, 114, 32, 42, 47, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 46, 99, 111, 110, 116, 97, 105, 110, 101, 114, 32, 123, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 112, 111, 115, 105, 116, 105, 111, 110, 58, 32, 114, 101, 108, 97, 116, 105, 118, 101, 59, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 122, 45, 105, 110, 100, 101, 120, 58, 32, 49, 59, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 116, 101, 120, 116, 45, 97, 108, 105, 103, 110, 58, 32, 99, 101, 110, 116, 101, 114, 59, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 100, 105, 115, 112, 108, 97, 121, 58, 32, 102, 108, 101, 120, 59, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 102, 108, 101, 120, 45, 100, 105, 114, 101, 99, 116, 105, 111, 110, 58, 32, 99, 111, 108, 117, 109, 110, 59, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 97, 108, 105, 103, 110, 45, 105, 116, 101, 109, 115, 58, 32, 99, 101, 110, 116, 101, 114, 59, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 103, 97, 112, 58, 32, 51, 48, 112, 120, 59, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 125, 13, 10, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 47, 42, 32, 76, 111, 103, 111, 32, 99, 111, 110, 116, 97, 105, 110, 101, 114, 32, 42, 47, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 46, 108, 111, 103, 111, 45, 99, 111, 110, 116, 97, 105, 110, 101, 114, 32, 123, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 112, 111, 115, 105, 116, 105, 111, 110, 58, 32, 114, 101, 108, 97, 116, 105, 118, 101, 59, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 119, 105, 100, 116, 104, 58, 32, 52, 48, 48, 112, 120, 59, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 104, 101, 105, 103, 104, 116, 58, 32, 52, 48, 48, 112, 120, 59, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 100, 105, 115, 112, 108, 97, 121, 58, 32, 102, 108, 101, 120, 59, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 97, 108, 105, 103, 110, 45, 105, 116, 101, 109, 115, 58, 32, 99, 101, 110, 116, 101, 114, 59, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 106, 117, 115, 116, 105, 102, 121, 45, 99, 111, 110, 116, 101, 110, 116, 58, 32, 99, 101, 110, 116, 101, 114, 59, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 97, 110, 105, 109, 97, 116, 105, 111, 110, 58, 32, 108, 111, 103, 111, 70, 108, 111, 97, 116, 32, 52, 115, 32, 101, 97, 115, 101, 45, 105, 110, 45, 111, 117, 116, 32, 105, 110, 102, 105, 110, 105, 116, 101, 59, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 125, 13, 10, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 64, 107, 101, 121, 102, 114, 97, 109, 101, 115, 32, 108, 111, 103, 111, 70, 108, 111, 97, 116, 32, 123, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 48, 37, 44, 32, 49, 48, 48, 37, 32, 123, 32, 116, 114, 97, 110, 115, 102, 111, 114, 109, 58, 32, 116, 114, 97, 110, 115, 108, 97, 116, 101, 89, 40, 48, 112, 120, 41, 32, 114, 111, 116, 97, 116, 101, 90, 40, 48, 100, 101, 103, 41, 59, 32, 125, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 53, 48, 37, 32, 123, 32, 116, 114, 97, 110, 115, 102, 111, 114, 109, 58, 32, 116, 114, 97, 110, 115, 108, 97, 116, 101, 89, 40, 45, 51, 48, 112, 120, 41, 32, 114, 111, 116, 97, 116, 101, 90, 40, 50, 100, 101, 103, 41, 59, 32, 125, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 125, 13, 10, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 46, 108, 111, 103, 111, 45, 105, 109, 103, 32, 123, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 109, 97, 120, 45, 119, 105, 100, 116, 104, 58, 32, 49, 48, 48, 37, 59, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 104, 101, 105, 103, 104, 116, 58, 32, 97, 117, 116, 111, 59, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 102, 105, 108, 116, 101, 114, 58, 32, 100, 114, 111, 112, 45, 115, 104, 97, 100, 111, 119, 40, 48, 32, 48, 32, 50, 48, 112, 120, 32, 114, 103, 98, 97, 40, 48, 44, 32, 50, 49, 50, 44, 32, 50, 53, 53, 44, 32, 48, 46, 54, 41, 41, 32, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 100, 114, 111, 112, 45, 115, 104, 97, 100, 111, 119, 40, 48, 32, 48, 32, 52, 48, 112, 120, 32, 114, 103, 98, 97, 40, 50, 53, 53, 44, 32, 49, 52, 48, 44, 32, 48, 44, 32, 48, 46, 52, 41, 41, 59, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 116, 114, 97, 110, 115, 105, 116, 105, 111, 110, 58, 32, 97, 108, 108, 32, 48, 46, 51, 115, 32, 101, 97, 115, 101, 59, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 125, 13, 10, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 46, 108, 111, 103, 111, 45, 99, 111, 110, 116, 97, 105, 110, 101, 114, 58, 104, 111, 118, 101, 114, 32, 46, 108, 111, 103, 111, 45, 105, 109, 103, 32, 123, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 102, 105, 108, 116, 101, 114, 58, 32, 100, 114, 111, 112, 45, 115, 104, 97, 100, 111, 119, 40, 48, 32, 48, 32, 51, 48, 112, 120, 32, 114, 103, 98, 97, 40, 48, 44, 32, 50, 49, 50, 44, 32, 50, 53, 53, 44, 32, 48, 46, 57, 41, 41, 32, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 100, 114, 111, 112, 45, 115, 104, 97, 100, 111, 119, 40, 48, 32, 48, 32, 54, 48, 112, 120, 32, 114, 103, 98, 97, 40, 50, 53, 53, 44, 32, 49, 52, 48, 44, 32, 48, 44, 32, 48, 46, 54, 41, 41, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 98, 114, 105, 103, 104, 116, 110, 101, 115, 115, 40, 49, 46, 49, 41, 59, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 116, 114, 97, 110, 115, 102, 111, 114, 109, 58, 32, 115, 99, 97, 108, 101, 40, 49, 46, 48, 53, 41, 59, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 125, 13, 10, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 47, 42, 32, 71, 108, 111, 119, 32, 114, 105, 110, 103, 32, 97, 114, 111, 117, 110, 100, 32, 108, 111, 103, 111, 32, 42, 47, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 46, 103, 108, 111, 119, 45, 114, 105, 110, 103, 32, 123, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 112, 111, 115, 105, 116, 105, 111, 110, 58, 32, 97, 98, 115, 111, 108, 117, 116, 101, 59, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 119, 105, 100, 116, 104, 58, 32, 52, 50, 48, 112, 120, 59, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 104, 101, 105, 103, 104, 116, 58, 32, 52, 50, 48, 112, 120, 59, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 98, 111, 114, 100, 101, 114, 58, 32, 50, 112, 120, 32, 115, 111, 108, 105, 100, 59, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 98, 111, 114, 100, 101, 114, 45, 99, 111, 108, 111, 114, 58, 32, 116, 114, 97, 110, 115, 112, 97, 114, 101, 110, 116, 59, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 98, 111, 114, 100, 101, 114, 45, 105, 109, 97, 103, 101, 58, 32, 108, 105, 110, 101, 97, 114, 45, 103, 114, 97, 100, 105, 101, 110, 116, 40, 52, 53, 100, 101, 103, 44, 32, 35, 48, 48, 100, 52, 102, 102, 44, 32, 35, 102, 102, 56, 99, 48, 48, 44, 32, 35, 48, 48, 100, 52, 102, 102, 41, 32, 49, 59, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 98, 111, 114, 100, 101, 114, 45, 114, 97, 100, 105, 117, 115, 58, 32, 53, 48, 37, 59, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 97, 110, 105, 109, 97, 116, 105, 111, 110, 58, 32, 115, 112, 105, 110, 32, 56, 115, 32, 108, 105, 110, 101, 97, 114, 32, 105, 110, 102, 105, 110, 105, 116, 101, 59, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 116, 111, 112, 58, 32, 53, 48, 37, 59, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 108, 101, 102, 116, 58, 32, 53, 48, 37, 59, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 116, 114, 97, 110, 115, 102, 111, 114, 109, 58, 32, 116, 114, 97, 110, 115, 108, 97, 116, 101, 40, 45, 53, 48, 37, 44, 32, 45, 53, 48, 37, 41, 59, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 125, 13, 10, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 64, 107, 101, 121, 102, 114, 97, 109, 101, 115, 32, 115, 112, 105, 110, 32, 123, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 48, 37, 32, 123, 32, 116, 114, 97, 110, 115, 102, 111, 114, 109, 58, 32, 116, 114, 97, 110, 115, 108, 97, 116, 101, 40, 45, 53, 48, 37, 44, 32, 45, 53, 48, 37, 41, 32, 114, 111, 116, 97, 116, 101, 90, 40, 48, 100, 101, 103, 41, 59, 32, 125, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 49, 48, 48, 37, 32, 123, 32, 116, 114, 97, 110, 115, 102, 111, 114, 109, 58, 32, 116, 114, 97, 110, 115, 108, 97, 116, 101, 40, 45, 53, 48, 37, 44, 32, 45, 53, 48, 37, 41, 32, 114, 111, 116, 97, 116, 101, 90, 40, 51, 54, 48, 100, 101, 103, 41, 59, 32, 125, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 125, 13, 10, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 47, 42, 32, 84, 101, 120, 116, 32, 99, 111, 110, 116, 97, 105, 110, 101, 114, 32, 42, 47, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 46, 116, 101, 120, 116, 45, 99, 111, 110, 116, 97, 105, 110, 101, 114, 32, 123, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 112, 111, 115, 105, 116, 105, 111, 110, 58, 32, 114, 101, 108, 97, 116, 105, 118, 101, 59, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 125, 13, 10, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 104, 49, 32, 123, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 102, 111, 110, 116, 45, 115, 105, 122, 101, 58, 32, 52, 56, 112, 120, 59, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 102, 111, 110, 116, 45, 119, 101, 105, 103, 104, 116, 58, 32, 98, 111, 108, 100, 59, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 98, 97, 99, 107, 103, 114, 111, 117, 110, 100, 58, 32, 108, 105, 110, 101, 97, 114, 45, 103, 114, 97, 100, 105, 101, 110, 116, 40, 57, 48, 100, 101, 103, 44, 32, 35, 48, 48, 100, 52, 102, 102, 44, 32, 35, 102, 102, 56, 99, 48, 48, 44, 32, 35, 48, 48, 100, 52, 102, 102, 41, 59, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 45, 119, 101, 98, 107, 105, 116, 45, 98, 97, 99, 107, 103, 114, 111, 117, 110, 100, 45, 99, 108, 105, 112, 58, 32, 116, 101, 120, 116, 59, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 45, 119, 101, 98, 107, 105, 116, 45, 116, 101, 120, 116, 45, 102, 105, 108, 108, 45, 99, 111, 108, 111, 114, 58, 32, 116, 114, 97, 110, 115, 112, 97, 114, 101, 110, 116, 59, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 98, 97, 99, 107, 103, 114, 111, 117, 110, 100, 45, 99, 108, 105, 112, 58, 32, 116, 101, 120, 116, 59, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 116, 101, 120, 116, 45, 115, 104, 97, 100, 111, 119, 58, 32, 48, 32, 48, 32, 50, 48, 112, 120, 32, 114, 103, 98, 97, 40, 48, 44, 32, 50, 49, 50, 44, 32, 50, 53, 53, 44, 32, 48, 46, 53, 41, 59, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 109, 97, 114, 103, 105, 110, 45, 98, 111, 116, 116, 111, 109, 58, 32, 49, 48, 112, 120, 59, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 108, 101, 116, 116, 101, 114, 45, 115, 112, 97, 99, 105, 110, 103, 58, 32, 51, 112, 120, 59, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 97, 110, 105, 109, 97, 116, 105, 111, 110, 58, 32, 116, 101, 120, 116, 71, 108, 111, 119, 32, 50, 115, 32, 101, 97, 115, 101, 45, 105, 110, 45, 111, 117, 116, 32, 105, 110, 102, 105, 110, 105, 116, 101, 59, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 125, 13, 10, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 64, 107, 101, 121, 102, 114, 97, 109, 101, 115, 32, 116, 101, 120, 116, 71, 108, 111, 119, 32, 123, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 48, 37, 44, 32, 49, 48, 48, 37, 32, 123, 32, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 102, 105, 108, 116, 101, 114, 58, 32, 100, 114, 111, 112, 45, 115, 104, 97, 100, 111, 119, 40, 48, 32, 48, 32, 49, 48, 112, 120, 32, 114, 103, 98, 97, 40, 48, 44, 32, 50, 49, 50, 44, 32, 50, 53, 53, 44, 32, 48, 46, 53, 41, 41, 59, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 125, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 53, 48, 37, 32, 123, 32, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 102, 105, 108, 116, 101, 114, 58, 32, 100, 114, 111, 112, 45, 115, 104, 97, 100, 111, 119, 40, 48, 32, 48, 32, 50, 48, 112, 120, 32, 114, 103, 98, 97, 40, 48, 44, 32, 50, 49, 50, 44, 32, 50, 53, 53, 44, 32, 48, 46, 56, 41, 41, 32, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 100, 114, 111, 112, 45, 115, 104, 97, 100, 111, 119, 40, 48, 32, 48, 32, 51, 48, 112, 120, 32, 114, 103, 98, 97, 40, 50, 53, 53, 44, 32, 49, 52, 48, 44, 32, 48, 44, 32, 48, 46, 54, 41, 41, 59, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 125, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 125, 13, 10, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 46, 115, 117, 98, 116, 105, 116, 108, 101, 32, 123, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 102, 111, 110, 116, 45, 115, 105, 122, 101, 58, 32, 49, 56, 112, 120, 59, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 99, 111, 108, 111, 114, 58, 32, 35, 48, 48, 100, 52, 102, 102, 59, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 108, 101, 116, 116, 101, 114, 45, 115, 112, 97, 99, 105, 110, 103, 58, 32, 50, 112, 120, 59, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 97, 110, 105, 109, 97, 116, 105, 111, 110, 58, 32, 102, 97, 100, 101, 73, 110, 79, 117, 116, 32, 51, 115, 32, 101, 97, 115, 101, 45, 105, 110, 45, 111, 117, 116, 32, 105, 110, 102, 105, 110, 105, 116, 101, 59, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 116, 101, 120, 116, 45, 116, 114, 97, 110, 115, 102, 111, 114, 109, 58, 32, 117, 112, 112, 101, 114, 99, 97, 115, 101, 59, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 125, 13, 10, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 64, 107, 101, 121, 102, 114, 97, 109, 101, 115, 32, 102, 97, 100, 101, 73, 110, 79, 117, 116, 32, 123, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 48, 37, 44, 32, 49, 48, 48, 37, 32, 123, 32, 111, 112, 97, 99, 105, 116, 121, 58, 32, 48, 46, 54, 59, 32, 125, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 53, 48, 37, 32, 123, 32, 111, 112, 97, 99, 105, 116, 121, 58, 32, 49, 59, 32, 125, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 125, 13, 10, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 47, 42, 32, 67, 121, 98, 101, 114, 32, 108, 105, 110, 101, 115, 32, 42, 47, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 46, 99, 121, 98, 101, 114, 45, 108, 105, 110, 101, 32, 123, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 112, 111, 115, 105, 116, 105, 111, 110, 58, 32, 97, 98, 115, 111, 108, 117, 116, 101, 59, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 104, 101, 105, 103, 104, 116, 58, 32, 50, 112, 120, 59, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 98, 97, 99, 107, 103, 114, 111, 117, 110, 100, 58, 32, 108, 105, 110, 101, 97, 114, 45, 103, 114, 97, 100, 105, 101, 110, 116, 40, 57, 48, 100, 101, 103, 44, 32, 116, 114, 97, 110, 115, 112, 97, 114, 101, 110, 116, 44, 32, 35, 48, 48, 100, 52, 102, 102, 44, 32, 116, 114, 97, 110, 115, 112, 97, 114, 101, 110, 116, 41, 59, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 97, 110, 105, 109, 97, 116, 105, 111, 110, 58, 32, 115, 99, 97, 110, 108, 105, 110, 101, 32, 50, 115, 32, 108, 105, 110, 101, 97, 114, 32, 105, 110, 102, 105, 110, 105, 116, 101, 59, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 125, 13, 10, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 46, 108, 105, 110, 101, 45, 49, 32, 123, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 119, 105, 100, 116, 104, 58, 32, 50, 48, 48, 112, 120, 59, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 116, 111, 112, 58, 32, 50, 48, 37, 59, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 108, 101, 102, 116, 58, 32, 53, 48, 37, 59, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 116, 114, 97, 110, 115, 102, 111, 114, 109, 58, 32, 116, 114, 97, 110, 115, 108, 97, 116, 101, 88, 40, 45, 53, 48, 37, 41, 59, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 97, 110, 105, 109, 97, 116, 105, 111, 110, 45, 100, 101, 108, 97, 121, 58, 32, 48, 115, 59, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 125, 13, 10, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 46, 108, 105, 110, 101, 45, 50, 32, 123, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 119, 105, 100, 116, 104, 58, 32, 50, 48, 48, 112, 120, 59, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 98, 111, 116, 116, 111, 109, 58, 32, 50, 48, 37, 59, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 108, 101, 102, 116, 58, 32, 53, 48, 37, 59, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 116, 114, 97, 110, 115, 102, 111, 114, 109, 58, 32, 116, 114, 97, 110, 115, 108, 97, 116, 101, 88, 40, 45, 53, 48, 37, 41, 59, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 97, 110, 105, 109, 97, 116, 105, 111, 110, 45, 100, 101, 108, 97, 121, 58, 32, 49, 115, 59, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 125, 13, 10, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 64, 107, 101, 121, 102, 114, 97, 109, 101, 115, 32, 115, 99, 97, 110, 108, 105, 110, 101, 32, 123, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 48, 37, 32, 123, 32, 111, 112, 97, 99, 105, 116, 121, 58, 32, 48, 59, 32, 125, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 53, 48, 37, 32, 123, 32, 111, 112, 97, 99, 105, 116, 121, 58, 32, 49, 59, 32, 125, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 49, 48, 48, 37, 32, 123, 32, 111, 112, 97, 99, 105, 116, 121, 58, 32, 48, 59, 32, 125, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 125, 13, 10, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 47, 42, 32, 73, 110, 116, 101, 114, 97, 99, 116, 105, 118, 101, 32, 101, 108, 101, 109, 101, 110, 116, 115, 32, 42, 47, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 46, 110, 97, 118, 45, 98, 117, 116, 116, 111, 110, 115, 32, 123, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 100, 105, 115, 112, 108, 97, 121, 58, 32, 102, 108, 101, 120, 59, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 103, 97, 112, 58, 32, 50, 48, 112, 120, 59, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 109, 97, 114, 103, 105, 110, 45, 116, 111, 112, 58, 32, 52, 48, 112, 120, 59, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 125, 13, 10, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 46, 98, 116, 110, 32, 123, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 112, 97, 100, 100, 105, 110, 103, 58, 32, 49, 50, 112, 120, 32, 51, 48, 112, 120, 59, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 98, 111, 114, 100, 101, 114, 58, 32, 50, 112, 120, 32, 115, 111, 108, 105, 100, 32, 35, 48, 48, 100, 52, 102, 102, 59, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 98, 97, 99, 107, 103, 114, 111, 117, 110, 100, 58, 32, 114, 103, 98, 97, 40, 48, 44, 32, 50, 49, 50, 44, 32, 50, 53, 53, 44, 32, 48, 46, 49, 41, 59, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 99, 111, 108, 111, 114, 58, 32, 35, 48, 48, 100, 52, 102, 102, 59, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 102, 111, 110, 116, 45, 115, 105, 122, 101, 58, 32, 49, 52, 112, 120, 59, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 99, 117, 114, 115, 111, 114, 58, 32, 112, 111, 105, 110, 116, 101, 114, 59, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 116, 101, 120, 116, 45, 116, 114, 97, 110, 115, 102, 111, 114, 109, 58, 32, 117, 112, 112, 101, 114, 99, 97, 115, 101, 59, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 108, 101, 116, 116, 101, 114, 45, 115, 112, 97, 99, 105, 110, 103, 58, 32, 50, 112, 120, 59, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 116, 114, 97, 110, 115, 105, 116, 105, 111, 110, 58, 32, 97, 108, 108, 32, 48, 46, 51, 115, 32, 101, 97, 115, 101, 59, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 98, 111, 114, 100, 101, 114, 45, 114, 97, 100, 105, 117, 115, 58, 32, 53, 112, 120, 59, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 112, 111, 115, 105, 116, 105, 111, 110, 58, 32, 114, 101, 108, 97, 116, 105, 118, 101, 59, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 111, 118, 101, 114, 102, 108, 111, 119, 58, 32, 104, 105, 100, 100, 101, 110, 59, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 125, 13, 10, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 46, 98, 116, 110, 58, 58, 98, 101, 102, 111, 114, 101, 32, 123, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 99, 111, 110, 116, 101, 110, 116, 58, 32, 39, 39, 59, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 112, 111, 115, 105, 116, 105, 111, 110, 58, 32, 97, 98, 115, 111, 108, 117, 116, 101, 59, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 116, 111, 112, 58, 32, 48, 59, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 108, 101, 102, 116, 58, 32, 45, 49, 48, 48, 37, 59, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 119, 105, 100, 116, 104, 58, 32, 49, 48, 48, 37, 59, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 104, 101, 105, 103, 104, 116, 58, 32, 49, 48, 48, 37, 59, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 98, 97, 99, 107, 103, 114, 111, 117, 110, 100, 58, 32, 108, 105, 110, 101, 97, 114, 45, 103, 114, 97, 100, 105, 101, 110, 116, 40, 57, 48, 100, 101, 103, 44, 32, 116, 114, 97, 110, 115, 112, 97, 114, 101, 110, 116, 44, 32, 114, 103, 98, 97, 40, 48, 44, 32, 50, 49, 50, 44, 32, 50, 53, 53, 44, 32, 48, 46, 51, 41, 44, 32, 116, 114, 97, 110, 115, 112, 97, 114, 101, 110, 116, 41, 59, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 116, 114, 97, 110, 115, 105, 116, 105, 111, 110, 58, 32, 108, 101, 102, 116, 32, 48, 46, 53, 115, 59, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 125, 13, 10, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 46, 98, 116, 110, 58, 104, 111, 118, 101, 114, 58, 58, 98, 101, 102, 111, 114, 101, 32, 123, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 108, 101, 102, 116, 58, 32, 49, 48, 48, 37, 59, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 125, 13, 10, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 46, 98, 116, 110, 58, 104, 111, 118, 101, 114, 32, 123, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 98, 111, 120, 45, 115, 104, 97, 100, 111, 119, 58, 32, 48, 32, 48, 32, 50, 48, 112, 120, 32, 114, 103, 98, 97, 40, 48, 44, 32, 50, 49, 50, 44, 32, 50, 53, 53, 44, 32, 48, 46, 54, 41, 59, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 98, 97, 99, 107, 103, 114, 111, 117, 110, 100, 58, 32, 114, 103, 98, 97, 40, 48, 44, 32, 50, 49, 50, 44, 32, 50, 53, 53, 44, 32, 48, 46, 50, 41, 59, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 116, 114, 97, 110, 115, 102, 111, 114, 109, 58, 32, 116, 114, 97, 110, 115, 108, 97, 116, 101, 89, 40, 45, 50, 112, 120, 41, 59, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 125, 13, 10, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 47, 42, 32, 65, 100, 100, 101, 100, 32, 104, 97, 99, 107, 101, 100, 32, 116, 101, 120, 116, 32, 115, 116, 121, 108, 105, 110, 103, 32, 42, 47, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 46, 104, 97, 99, 107, 101, 100, 45, 116, 101, 120, 116, 32, 123, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 112, 111, 115, 105, 116, 105, 111, 110, 58, 32, 102, 105, 120, 101, 100, 59, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 116, 111, 112, 58, 32, 51, 48, 112, 120, 59, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 108, 101, 102, 116, 58, 32, 53, 48, 37, 59, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 116, 114, 97, 110, 115, 102, 111, 114, 109, 58, 32, 116, 114, 97, 110, 115, 108, 97, 116, 101, 88, 40, 45, 53, 48, 37, 41, 59, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 102, 111, 110, 116, 45, 115, 105, 122, 101, 58, 32, 51, 50, 112, 120, 59, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 102, 111, 110, 116, 45, 119, 101, 105, 103, 104, 116, 58, 32, 98, 111, 108, 100, 59, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 98, 97, 99, 107, 103, 114, 111, 117, 110, 100, 58, 32, 108, 105, 110, 101, 97, 114, 45, 103, 114, 97, 100, 105, 101, 110, 116, 40, 57, 48, 100, 101, 103, 44, 32, 35, 102, 102, 48, 48, 48, 48, 44, 32, 35, 102, 102, 51, 51, 48, 48, 44, 32, 35, 102, 102, 48, 48, 48, 48, 41, 59, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 45, 119, 101, 98, 107, 105, 116, 45, 98, 97, 99, 107, 103, 114, 111, 117, 110, 100, 45, 99, 108, 105, 112, 58, 32, 116, 101, 120, 116, 59, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 45, 119, 101, 98, 107, 105, 116, 45, 116, 101, 120, 116, 45, 102, 105, 108, 108, 45, 99, 111, 108, 111, 114, 58, 32, 116, 114, 97, 110, 115, 112, 97, 114, 101, 110, 116, 59, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 98, 97, 99, 107, 103, 114, 111, 117, 110, 100, 45, 99, 108, 105, 112, 58, 32, 116, 101, 120, 116, 59, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 108, 101, 116, 116, 101, 114, 45, 115, 112, 97, 99, 105, 110, 103, 58, 32, 50, 112, 120, 59, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 97, 110, 105, 109, 97, 116, 105, 111, 110, 58, 32, 103, 108, 105, 116, 99, 104, 32, 51, 115, 32, 101, 97, 115, 101, 45, 105, 110, 45, 111, 117, 116, 32, 105, 110, 102, 105, 110, 105, 116, 101, 59, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 122, 45, 105, 110, 100, 101, 120, 58, 32, 49, 48, 59, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 116, 101, 120, 116, 45, 115, 104, 97, 100, 111, 119, 58, 32, 48, 32, 48, 32, 49, 53, 112, 120, 32, 114, 103, 98, 97, 40, 50, 53, 53, 44, 32, 48, 44, 32, 48, 44, 32, 48, 46, 53, 41, 59, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 125, 13, 10, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 64, 107, 101, 121, 102, 114, 97, 109, 101, 115, 32, 103, 108, 105, 116, 99, 104, 32, 123, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 48, 37, 44, 32, 49, 48, 48, 37, 32, 123, 32, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 102, 105, 108, 116, 101, 114, 58, 32, 100, 114, 111, 112, 45, 115, 104, 97, 100, 111, 119, 40, 48, 32, 48, 32, 53, 112, 120, 32, 114, 103, 98, 97, 40, 50, 53, 53, 44, 32, 48, 44, 32, 48, 44, 32, 48, 46, 52, 41, 41, 59, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 116, 114, 97, 110, 115, 102, 111, 114, 109, 58, 32, 116, 114, 97, 110, 115, 108, 97, 116, 101, 88, 40, 45, 53, 48, 37, 41, 32, 115, 107, 101, 119, 88, 40, 48, 100, 101, 103, 41, 59, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 125, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 50, 48, 37, 32, 123, 32, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 102, 105, 108, 116, 101, 114, 58, 32, 100, 114, 111, 112, 45, 115, 104, 97, 100, 111, 119, 40, 48, 32, 48, 32, 49, 53, 112, 120, 32, 114, 103, 98, 97, 40, 50, 53, 53, 44, 32, 48, 44, 32, 48, 44, 32, 48, 46, 56, 41, 41, 59, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 116, 114, 97, 110, 115, 102, 111, 114, 109, 58, 32, 116, 114, 97, 110, 115, 108, 97, 116, 101, 88, 40, 45, 53, 48, 37, 41, 32, 115, 107, 101, 119, 88, 40, 45, 50, 100, 101, 103, 41, 59, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 125, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 52, 48, 37, 32, 123, 32, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 102, 105, 108, 116, 101, 114, 58, 32, 100, 114, 111, 112, 45, 115, 104, 97, 100, 111, 119, 40, 48, 32, 48, 32, 50, 48, 112, 120, 32, 114, 103, 98, 97, 40, 50, 53, 53, 44, 32, 48, 44, 32, 48, 44, 32, 48, 46, 57, 41, 41, 59, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 116, 114, 97, 110, 115, 102, 111, 114, 109, 58, 32, 116, 114, 97, 110, 115, 108, 97, 116, 101, 88, 40, 45, 53, 48, 37, 41, 32, 115, 107, 101, 119, 88, 40, 50, 100, 101, 103, 41, 59, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 125, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 54, 48, 37, 32, 123, 32, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 102, 105, 108, 116, 101, 114, 58, 32, 100, 114, 111, 112, 45, 115, 104, 97, 100, 111, 119, 40, 48, 32, 48, 32, 49, 53, 112, 120, 32, 114, 103, 98, 97, 40, 50, 53, 53, 44, 32, 48, 44, 32, 48, 44, 32, 48, 46, 56, 41, 41, 59, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 116, 114, 97, 110, 115, 102, 111, 114, 109, 58, 32, 116, 114, 97, 110, 115, 108, 97, 116, 101, 88, 40, 45, 53, 48, 37, 41, 32, 115, 107, 101, 119, 88, 40, 45, 49, 100, 101, 103, 41, 59, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 125, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 56, 48, 37, 32, 123, 32, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 102, 105, 108, 116, 101, 114, 58, 32, 100, 114, 111, 112, 45, 115, 104, 97, 100, 111, 119, 40, 48, 32, 48, 32, 49, 48, 112, 120, 32, 114, 103, 98, 97, 40, 50, 53, 53, 44, 32, 48, 44, 32, 48, 44, 32, 48, 46, 54, 41, 41, 59, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 116, 114, 97, 110, 115, 102, 111, 114, 109, 58, 32, 116, 114, 97, 110, 115, 108, 97, 116, 101, 88, 40, 45, 53, 48, 37, 41, 32, 115, 107, 101, 119, 88, 40, 49, 100, 101, 103, 41, 59, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 125, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 125, 13, 10, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 47, 42, 32, 65, 100, 100, 101, 100, 32, 115, 108, 111, 103, 97, 110, 32, 115, 116, 121, 108, 105, 110, 103, 32, 119, 105, 116, 104, 32, 101, 109, 111, 106, 105, 32, 42, 47, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 46, 115, 108, 111, 103, 97, 110, 32, 123, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 112, 111, 115, 105, 116, 105, 111, 110, 58, 32, 102, 105, 120, 101, 100, 59, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 98, 111, 116, 116, 111, 109, 58, 32, 51, 48, 112, 120, 59, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 108, 101, 102, 116, 58, 32, 53, 48, 37, 59, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 116, 114, 97, 110, 115, 102, 111, 114, 109, 58, 32, 116, 114, 97, 110, 115, 108, 97, 116, 101, 88, 40, 45, 53, 48, 37, 41, 59, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 102, 111, 110, 116, 45, 115, 105, 122, 101, 58, 32, 49, 56, 112, 120, 59, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 99, 111, 108, 111, 114, 58, 32, 35, 48, 48, 100, 52, 102, 102, 59, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 108, 101, 116, 116, 101, 114, 45, 115, 112, 97, 99, 105, 110, 103, 58, 32, 49, 46, 53, 112, 120, 59, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 97, 110, 105, 109, 97, 116, 105, 111, 110, 58, 32, 115, 108, 111, 103, 97, 110, 80, 117, 108, 115, 101, 32, 50, 46, 53, 115, 32, 101, 97, 115, 101, 45, 105, 110, 45, 111, 117, 116, 32, 105, 110, 102, 105, 110, 105, 116, 101, 59, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 122, 45, 105, 110, 100, 101, 120, 58, 32, 49, 48, 59, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 116, 101, 120, 116, 45, 97, 108, 105, 103, 110, 58, 32, 99, 101, 110, 116, 101, 114, 59, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 102, 111, 110, 116, 45, 119, 101, 105, 103, 104, 116, 58, 32, 54, 48, 48, 59, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 125, 13, 10, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 64, 107, 101, 121, 102, 114, 97, 109, 101, 115, 32, 115, 108, 111, 103, 97, 110, 80, 117, 108, 115, 101, 32, 123, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 48, 37, 44, 32, 49, 48, 48, 37, 32, 123, 32, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 111, 112, 97, 99, 105, 116, 121, 58, 32, 48, 46, 54, 59, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 102, 105, 108, 116, 101, 114, 58, 32, 100, 114, 111, 112, 45, 115, 104, 97, 100, 111, 119, 40, 48, 32, 48, 32, 53, 112, 120, 32, 114, 103, 98, 97, 40, 48, 44, 32, 50, 49, 50, 44, 32, 50, 53, 53, 44, 32, 48, 46, 51, 41, 41, 59, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 125, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 53, 48, 37, 32, 123, 32, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 111, 112, 97, 99, 105, 116, 121, 58, 32, 49, 59, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 102, 105, 108, 116, 101, 114, 58, 32, 100, 114, 111, 112, 45, 115, 104, 97, 100, 111, 119, 40, 48, 32, 48, 32, 49, 53, 112, 120, 32, 114, 103, 98, 97, 40, 48, 44, 32, 50, 49, 50, 44, 32, 50, 53, 53, 44, 32, 48, 46, 56, 41, 41, 59, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 125, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 125, 13, 10, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 47, 42, 32, 82, 101, 115, 112, 111, 110, 115, 105, 118, 101, 32, 42, 47, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 64, 109, 101, 100, 105, 97, 32, 40, 109, 97, 120, 45, 119, 105, 100, 116, 104, 58, 32, 55, 54, 56, 112, 120, 41, 32, 123, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 46, 108, 111, 103, 111, 45, 99, 111, 110, 116, 97, 105, 110, 101, 114, 32, 123, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 119, 105, 100, 116, 104, 58, 32, 51, 48, 48, 112, 120, 59, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 104, 101, 105, 103, 104, 116, 58, 32, 51, 48, 48, 112, 120, 59, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 125, 13, 10, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 46, 103, 108, 111, 119, 45, 114, 105, 110, 103, 32, 123, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 119, 105, 100, 116, 104, 58, 32, 51, 50, 48, 112, 120, 59, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 104, 101, 105, 103, 104, 116, 58, 32, 51, 50, 48, 112, 120, 59, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 125, 13, 10, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 104, 49, 32, 123, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 102, 111, 110, 116, 45, 115, 105, 122, 101, 58, 32, 51, 54, 112, 120, 59, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 125, 13, 10, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 46, 115, 117, 98, 116, 105, 116, 108, 101, 32, 123, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 102, 111, 110, 116, 45, 115, 105, 122, 101, 58, 32, 49, 52, 112, 120, 59, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 125, 13, 10, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 47, 42, 32, 82, 101, 115, 112, 111, 110, 115, 105, 118, 101, 32, 116, 101, 120, 116, 32, 102, 111, 114, 32, 115, 109, 97, 108, 108, 101, 114, 32, 115, 99, 114, 101, 101, 110, 115, 32, 42, 47, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 46, 104, 97, 99, 107, 101, 100, 45, 116, 101, 120, 116, 32, 123, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 102, 111, 110, 116, 45, 115, 105, 122, 101, 58, 32, 50, 52, 112, 120, 59, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 116, 111, 112, 58, 32, 50, 48, 112, 120, 59, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 125, 13, 10, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 46, 115, 108, 111, 103, 97, 110, 32, 123, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 102, 111, 110, 116, 45, 115, 105, 122, 101, 58, 32, 49, 52, 112, 120, 59, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 98, 111, 116, 116, 111, 109, 58, 32, 50, 48, 112, 120, 59, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 125, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 125, 13, 10, 32, 32, 32, 32, 60, 47, 115, 116, 121, 108, 101, 62, 13, 10, 60, 47, 104, 101, 97, 100, 62, 13, 10, 60, 98, 111, 100, 121, 62, 13, 10, 32, 32, 32, 32, 60, 33, 45, 45, 32, 65, 100, 100, 101, 100, 32, 104, 97, 99, 107, 101, 100, 32, 98, 121, 32, 99, 121, 98, 101, 114, 32, 115, 108, 97, 121, 101, 114, 115, 32, 116, 101, 120, 116, 32, 45, 45, 62, 13, 10, 32, 32, 32, 32, 60, 100, 105, 118, 32, 99, 108, 97, 115, 115, 61, 34, 104, 97, 99, 107, 101, 100, 45, 116, 101, 120, 116, 34, 62, 226, 154, 160, 32, 72, 65, 67, 75, 69, 68, 32, 66, 89, 32, 67, 89, 66, 69, 82, 32, 83, 76, 65, 89, 69, 82, 83, 32, 226, 154, 160, 60, 47, 100, 105, 118, 62, 13, 10, 13, 10, 32, 32, 32, 32, 60, 33, 45, 45, 32, 66, 97, 99, 107, 103, 114, 111, 117, 110, 100, 32, 101, 102, 102, 101, 99, 116, 115, 32, 45, 45, 62, 13, 10, 32, 32, 32, 32, 60, 100, 105, 118, 32, 99, 108, 97, 115, 115, 61, 34, 103, 108, 111, 119, 45, 98, 103, 34, 62, 60, 47, 100, 105, 118, 62, 13, 10, 32, 32, 32, 32, 60, 100, 105, 118, 32, 99, 108, 97, 115, 115, 61, 34, 103, 108, 111, 119, 45, 98, 103, 34, 62, 60, 47, 100, 105, 118, 62, 13, 10, 13, 10, 32, 32, 32, 32, 60, 33, 45, 45, 32, 77, 97, 105, 110, 32, 99, 111, 110, 116, 97, 105, 110, 101, 114, 32, 45, 45, 62, 13, 10, 32, 32, 32, 32, 60, 100, 105, 118, 32, 99, 108, 97, 115, 115, 61, 34, 99, 111, 110, 116, 97, 105, 110, 101, 114, 34, 62, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 60, 33, 45, 45, 32, 67, 121, 98, 101, 114, 32, 108, 105, 110, 101, 115, 32, 45, 45, 62, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 60, 100, 105, 118, 32, 99, 108, 97, 115, 115, 61, 34, 99, 121, 98, 101, 114, 45, 108, 105, 110, 101, 32, 108, 105, 110, 101, 45, 49, 34, 62, 60, 47, 100, 105, 118, 62, 13, 10, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 60, 33, 45, 45, 32, 76, 111, 103, 111, 32, 115, 101, 99, 116, 105, 111, 110, 32, 45, 45, 62, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 60, 100, 105, 118, 32, 99, 108, 97, 115, 115, 61, 34, 108, 111, 103, 111, 45, 99, 111, 110, 116, 97, 105, 110, 101, 114, 34, 62, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 60, 100, 105, 118, 32, 99, 108, 97, 115, 115, 61, 34, 103, 108, 111, 119, 45, 114, 105, 110, 103, 34, 62, 60, 47, 100, 105, 118, 62, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 60, 105, 109, 103, 32, 115, 114, 99, 61, 34, 104, 116, 116, 112, 115, 58, 47, 47, 115, 99, 111, 110, 116, 101, 110, 116, 46, 102, 100, 97, 99, 49, 49, 48, 45, 49, 46, 102, 110, 97, 46, 102, 98, 99, 100, 110, 46, 110, 101, 116, 47, 118, 47, 116, 51, 57, 46, 51, 48, 56, 48, 56, 45, 54, 47, 53, 53, 55, 56, 51, 49, 48, 54, 53, 95, 49, 50, 50, 49, 55, 51, 53, 48, 51, 49, 49, 48, 51, 56, 54, 51, 51, 49, 95, 54, 50, 54, 54, 57, 48, 49, 56, 55, 54, 48, 57, 57, 55, 54, 49, 51, 54, 50, 95, 110, 46, 106, 112, 103, 63, 95, 110, 99, 95, 99, 97, 116, 61, 49, 48, 56, 38, 99, 99, 98, 61, 49, 45, 55, 38, 95, 110, 99, 95, 115, 105, 100, 61, 54, 101, 101, 49, 49, 97, 38, 95, 110, 99, 95, 101, 117, 105, 50, 61, 65, 101, 72, 73, 105, 49, 86, 81, 115, 72, 97, 108, 67, 98, 81, 104, 50, 104, 116, 54, 74, 65, 99, 107, 54, 90, 65, 68, 49, 76, 50, 85, 54, 69, 122, 112, 107, 65, 80, 85, 118, 90, 84, 111, 84, 67, 51, 99, 88, 108, 101, 65, 74, 98, 49, 118, 54, 69, 52, 115, 73, 103, 57, 87, 81, 102, 86, 90, 89, 110, 73, 83, 109, 89, 54, 110, 51, 86, 53, 78, 109, 84, 53, 118, 74, 74, 120, 89, 38, 95, 110, 99, 95, 111, 104, 99, 61, 56, 73, 107, 76, 97, 79, 122, 97, 108, 99, 89, 81, 55, 107, 78, 118, 119, 72, 71, 105, 53, 89, 98, 38, 95, 110, 99, 95, 111, 99, 61, 65, 100, 108, 53, 85, 80, 111, 87, 114, 56, 74, 72, 52, 110, 78, 108, 80, 122, 122, 75, 85, 70, 101, 114, 52, 86, 66, 80, 81, 83, 102, 87, 102, 45, 108, 70, 108, 103, 119, 117, 76, 66, 97, 69, 65, 70, 104, 66, 66, 69, 71, 50, 75, 82, 51, 75, 80, 77, 56, 54, 109, 112, 85, 88, 80, 108, 73, 38, 95, 110, 99, 95, 122, 116, 61, 50, 51, 38, 95, 110, 99, 95, 104, 116, 61, 115, 99, 111, 110, 116, 101, 110, 116, 46, 102, 100, 97, 99, 49, 49, 48, 45, 49, 46, 102, 110, 97, 38, 95, 110, 99, 95, 103, 105, 100, 61, 78, 75, 57, 111, 122, 117, 67, 103, 101, 68, 108, 56, 115, 79, 121, 84, 110, 105, 100, 48, 104, 81, 38, 111, 104, 61, 48, 48, 95, 65, 102, 105, 95, 107, 54, 54, 55, 82, 75, 89, 78, 110, 120, 113, 74, 121, 103, 111, 118, 56, 118, 88, 82, 99, 112, 45, 118, 73, 73, 51, 53, 71, 53, 80, 97, 116, 85, 105, 119, 100, 80, 117, 100, 81, 103, 38, 111, 101, 61, 54, 57, 50, 49, 68, 50, 69, 67, 34, 32, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 97, 108, 116, 61, 34, 67, 121, 98, 101, 114, 32, 83, 108, 97, 121, 101, 114, 115, 32, 76, 111, 103, 111, 34, 32, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 99, 108, 97, 115, 115, 61, 34, 108, 111, 103, 111, 45, 105, 109, 103, 34, 62, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 60, 47, 100, 105, 118, 62, 13, 10, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 60, 33, 45, 45, 32, 84, 101, 120, 116, 32, 115, 101, 99, 116, 105, 111, 110, 32, 45, 45, 62, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 60, 100, 105, 118, 32, 99, 108, 97, 115, 115, 61, 34, 116, 101, 120, 116, 45, 99, 111, 110, 116, 97, 105, 110, 101, 114, 34, 62, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 60, 104, 49, 62, 67, 89, 66, 69, 82, 32, 83, 76, 65, 89, 69, 82, 83, 60, 47, 104, 49, 62, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 60, 47, 100, 105, 118, 62, 13, 10, 13, 10, 32, 32, 32, 32, 32, 32, 32, 13, 10, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 60, 33, 45, 45, 32, 67, 121, 98, 101, 114, 32, 108, 105, 110, 101, 32, 45, 45, 62, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 60, 100, 105, 118, 32, 99, 108, 97, 115, 115, 61, 34, 99, 121, 98, 101, 114, 45, 108, 105, 110, 101, 32, 108, 105, 110, 101, 45, 50, 34, 62, 60, 47, 100, 105, 118, 62, 13, 10, 32, 32, 32, 32, 60, 47, 100, 105, 118, 62, 13, 10, 13, 10, 32, 32, 32, 32, 60, 33, 45, 45, 32, 65, 100, 100, 101, 100, 32, 115, 108, 111, 103, 97, 110, 32, 119, 105, 116, 104, 32, 101, 109, 111, 106, 105, 32, 45, 45, 62, 13, 10, 32, 32, 32, 32, 60, 100, 105, 118, 32, 99, 108, 97, 115, 115, 61, 34, 115, 108, 111, 103, 97, 110, 34, 62, 76, 111, 99, 107, 32, 89, 111, 117, 114, 32, 68, 105, 103, 105, 116, 97, 108, 32, 68, 111, 111, 114, 115, 32, 226, 128, 147, 32, 72, 97, 99, 107, 101, 114, 115, 32, 78, 101, 118, 101, 114, 32, 75, 110, 111, 99, 107, 33, 32, 240, 159, 142, 173, 60, 47, 100, 105, 118, 62, 13, 10, 13, 10, 32, 32, 32, 32, 60, 115, 99, 114, 105, 112, 116, 62, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 47, 47, 32, 67, 114, 101, 97, 116, 101, 32, 114, 97, 110, 100, 111, 109, 32, 112, 97, 114, 116, 105, 99, 108, 101, 115, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 102, 117, 110, 99, 116, 105, 111, 110, 32, 99, 114, 101, 97, 116, 101, 83, 116, 97, 114, 115, 40, 41, 32, 123, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 99, 111, 110, 115, 116, 32, 115, 116, 97, 114, 67, 111, 117, 110, 116, 32, 61, 32, 53, 48, 59, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 102, 111, 114, 32, 40, 108, 101, 116, 32, 105, 32, 61, 32, 48, 59, 32, 105, 32, 60, 32, 115, 116, 97, 114, 67, 111, 117, 110, 116, 59, 32, 105, 43, 43, 41, 32, 123, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 99, 111, 110, 115, 116, 32, 115, 116, 97, 114, 32, 61, 32, 100, 111, 99, 117, 109, 101, 110, 116, 46, 99, 114, 101, 97, 116, 101, 69, 108, 101, 109, 101, 110, 116, 40, 39, 100, 105, 118, 39, 41, 59, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 115, 116, 97, 114, 46, 99, 108, 97, 115, 115, 78, 97, 109, 101, 32, 61, 32, 39, 115, 116, 97, 114, 115, 39, 59, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 115, 116, 97, 114, 46, 115, 116, 121, 108, 101, 46, 108, 101, 102, 116, 32, 61, 32, 77, 97, 116, 104, 46, 114, 97, 110, 100, 111, 109, 40, 41, 32, 42, 32, 119, 105, 110, 100, 111, 119, 46, 105, 110, 110, 101, 114, 87, 105, 100, 116, 104, 32, 43, 32, 39, 112, 120, 39, 59, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 115, 116, 97, 114, 46, 115, 116, 121, 108, 101, 46, 116, 111, 112, 32, 61, 32, 77, 97, 116, 104, 46, 114, 97, 110, 100, 111, 109, 40, 41, 32, 42, 32, 119, 105, 110, 100, 111, 119, 46, 105, 110, 110, 101, 114, 72, 101, 105, 103, 104, 116, 32, 43, 32, 39, 112, 120, 39, 59, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 115, 116, 97, 114, 46, 115, 116, 121, 108, 101, 46, 97, 110, 105, 109, 97, 116, 105, 111, 110, 68, 101, 108, 97, 121, 32, 61, 32, 77, 97, 116, 104, 46, 114, 97, 110, 100, 111, 109, 40, 41, 32, 42, 32, 51, 32, 43, 32, 39, 115, 39, 59, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 100, 111, 99, 117, 109, 101, 110, 116, 46, 98, 111, 100, 121, 46, 97, 112, 112, 101, 110, 100, 67, 104, 105, 108, 100, 40, 115, 116, 97, 114, 41, 59, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 125, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 125, 13, 10, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 47, 47, 32, 65, 100, 100, 32, 109, 111, 117, 115, 101, 32, 102, 111, 108, 108, 111, 119, 32, 101, 102, 102, 101, 99, 116, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 100, 111, 99, 117, 109, 101, 110, 116, 46, 97, 100, 100, 69, 118, 101, 110, 116, 76, 105, 115, 116, 101, 110, 101, 114, 40, 39, 109, 111, 117, 115, 101, 109, 111, 118, 101, 39, 44, 32, 40, 101, 41, 32, 61, 62, 32, 123, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 99, 111, 110, 115, 116, 32, 99, 111, 110, 116, 97, 105, 110, 101, 114, 32, 61, 32, 100, 111, 99, 117, 109, 101, 110, 116, 46, 113, 117, 101, 114, 121, 83, 101, 108, 101, 99, 116, 111, 114, 40, 39, 46, 99, 111, 110, 116, 97, 105, 110, 101, 114, 39, 41, 59, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 99, 111, 110, 115, 116, 32, 109, 111, 117, 115, 101, 88, 32, 61, 32, 101, 46, 99, 108, 105, 101, 110, 116, 88, 32, 45, 32, 119, 105, 110, 100, 111, 119, 46, 105, 110, 110, 101, 114, 87, 105, 100, 116, 104, 32, 47, 32, 50, 59, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 99, 111, 110, 115, 116, 32, 109, 111, 117, 115, 101, 89, 32, 61, 32, 101, 46, 99, 108, 105, 101, 110, 116, 89, 32, 45, 32, 119, 105, 110, 100, 111, 119, 46, 105, 110, 110, 101, 114, 72, 101, 105, 103, 104, 116, 32, 47, 32, 50, 59, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 99, 111, 110, 116, 97, 105, 110, 101, 114, 46, 115, 116, 121, 108, 101, 46, 116, 114, 97, 110, 115, 102, 111, 114, 109, 32, 61, 32, 96, 116, 114, 97, 110, 115, 108, 97, 116, 101, 40, 36, 123, 109, 111, 117, 115, 101, 88, 32, 42, 32, 48, 46, 48, 50, 125, 112, 120, 44, 32, 36, 123, 109, 111, 117, 115, 101, 89, 32, 42, 32, 48, 46, 48, 50, 125, 112, 120, 41, 96, 59, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 125, 41, 59, 13, 10, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 47, 47, 32, 73, 110, 105, 116, 105, 97, 108, 105, 122, 101, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 99, 114, 101, 97, 116, 101, 83, 116, 97, 114, 115, 40, 41, 59, 13, 10, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 47, 47, 32, 65, 100, 100, 32, 98, 117, 116, 116, 111, 110, 32, 99, 108, 105, 99, 107, 32, 101, 102, 102, 101, 99, 116, 115, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 100, 111, 99, 117, 109, 101, 110, 116, 46, 113, 117, 101, 114, 121, 83, 101, 108, 101, 99, 116, 111, 114, 65, 108, 108, 40, 39, 46, 98, 116, 110, 39, 41, 46, 102, 111, 114, 69, 97, 99, 104, 40, 98, 116, 110, 32, 61, 62, 32, 123, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 98, 116, 110, 46, 97, 100, 100, 69, 118, 101, 110, 116, 76, 105, 115, 116, 101, 110, 101, 114, 40, 39, 99, 108, 105, 99, 107, 39, 44, 32, 102, 117, 110, 99, 116, 105, 111, 110, 40, 41, 32, 123, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 116, 104, 105, 115, 46, 115, 116, 121, 108, 101, 46, 97, 110, 105, 109, 97, 116, 105, 111, 110, 32, 61, 32, 39, 110, 111, 110, 101, 39, 59, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 115, 101, 116, 84, 105, 109, 101, 111, 117, 116, 40, 40, 41, 32, 61, 62, 32, 123, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 116, 104, 105, 115, 46, 115, 116, 121, 108, 101, 46, 97, 110, 105, 109, 97, 116, 105, 111, 110, 32, 61, 32, 39, 39, 59, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 125, 44, 32, 49, 48, 41, 59, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 125, 41, 59, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 125, 41, 59, 13, 10, 32, 32, 32, 32, 60, 47, 115, 99, 114, 105, 112, 116, 62, 13, 10, 60, 47, 98, 111, 100, 121, 62, 13, 10, 60, 47, 104, 116, 109, 108, 62, 13, 10)"
TrCjXsBj,config,nenoro,Bash,Saturday 22nd of November 2025 02:21:54 AM CDT,"#
# Automatically generated file; DO NOT EDIT.
# Linux/x86 6.13.7-zen1 Kernel Configuration
#
CONFIG_CC_VERSION_TEXT=""gcc (GCC) 14.2.1 20250207""
CONFIG_CC_IS_GCC=y
CONFIG_GCC_VERSION=140201
CONFIG_CLANG_VERSION=0
CONFIG_AS_IS_GNU=y
CONFIG_AS_VERSION=24400
CONFIG_LD_IS_BFD=y
CONFIG_LD_VERSION=24400
CONFIG_LLD_VERSION=0
CONFIG_RUSTC_VERSION=0
CONFIG_RUSTC_LLVM_VERSION=0
CONFIG_CC_CAN_LINK=y
CONFIG_CC_CAN_LINK_STATIC=y
CONFIG_CC_HAS_ASM_GOTO_OUTPUT=y
CONFIG_CC_HAS_ASM_GOTO_TIED_OUTPUT=y
CONFIG_TOOLS_SUPPORT_RELR=y
CONFIG_CC_HAS_ASM_INLINE=y
CONFIG_CC_HAS_NO_PROFILE_FN_ATTR=y
CONFIG_PAHOLE_VERSION=0
CONFIG_IRQ_WORK=y
CONFIG_BUILDTIME_TABLE_SORT=y
CONFIG_THREAD_INFO_IN_TASK=y

#
# General setup
#
CONFIG_ZEN_INTERACTIVE=y
CONFIG_INIT_ENV_ARG_LIMIT=32
# CONFIG_COMPILE_TEST is not set
# CONFIG_WERROR is not set
CONFIG_LOCALVERSION=""_pineapple""
# CONFIG_LOCALVERSION_AUTO is not set
CONFIG_BUILD_SALT=""""
CONFIG_HAVE_KERNEL_GZIP=y
CONFIG_HAVE_KERNEL_BZIP2=y
CONFIG_HAVE_KERNEL_LZMA=y
CONFIG_HAVE_KERNEL_XZ=y
CONFIG_HAVE_KERNEL_LZO=y
CONFIG_HAVE_KERNEL_LZ4=y
CONFIG_HAVE_KERNEL_ZSTD=y
# CONFIG_KERNEL_GZIP is not set
# CONFIG_KERNEL_BZIP2 is not set
# CONFIG_KERNEL_LZMA is not set
# CONFIG_KERNEL_XZ is not set
# CONFIG_KERNEL_LZO is not set
# CONFIG_KERNEL_LZ4 is not set
CONFIG_KERNEL_ZSTD=y
CONFIG_DEFAULT_INIT=""""
CONFIG_DEFAULT_HOSTNAME=""(none)""
CONFIG_SYSVIPC=y
CONFIG_SYSVIPC_SYSCTL=y
CONFIG_SYSVIPC_COMPAT=y
CONFIG_POSIX_MQUEUE=y
CONFIG_POSIX_MQUEUE_SYSCTL=y
# CONFIG_WATCH_QUEUE is not set
CONFIG_CROSS_MEMORY_ATTACH=y
CONFIG_USELIB=y
CONFIG_AUDIT=y
CONFIG_HAVE_ARCH_AUDITSYSCALL=y
CONFIG_AUDITSYSCALL=y

#
# IRQ subsystem
#
CONFIG_GENERIC_IRQ_PROBE=y
CONFIG_GENERIC_IRQ_SHOW=y
CONFIG_GENERIC_IRQ_EFFECTIVE_AFF_MASK=y
CONFIG_GENERIC_PENDING_IRQ=y
CONFIG_GENERIC_IRQ_MIGRATION=y
CONFIG_HARDIRQS_SW_RESEND=y
CONFIG_IRQ_DOMAIN=y
CONFIG_IRQ_DOMAIN_HIERARCHY=y
CONFIG_GENERIC_MSI_IRQ=y
CONFIG_IRQ_MSI_IOMMU=y
CONFIG_GENERIC_IRQ_MATRIX_ALLOCATOR=y
CONFIG_GENERIC_IRQ_RESERVATION_MODE=y
CONFIG_IRQ_FORCED_THREADING=y
CONFIG_SPARSE_IRQ=y
# CONFIG_GENERIC_IRQ_DEBUGFS is not set
# end of IRQ subsystem

CONFIG_CLOCKSOURCE_WATCHDOG=y
CONFIG_ARCH_CLOCKSOURCE_INIT=y
CONFIG_GENERIC_TIME_VSYSCALL=y
CONFIG_GENERIC_CLOCKEVENTS=y
CONFIG_GENERIC_CLOCKEVENTS_BROADCAST=y
CONFIG_GENERIC_CLOCKEVENTS_BROADCAST_IDLE=y
CONFIG_GENERIC_CLOCKEVENTS_MIN_ADJUST=y
CONFIG_GENERIC_CMOS_UPDATE=y
CONFIG_HAVE_POSIX_CPU_TIMERS_TASK_WORK=y
CONFIG_POSIX_CPU_TIMERS_TASK_WORK=y
CONFIG_CONTEXT_TRACKING=y
CONFIG_CONTEXT_TRACKING_IDLE=y

#
# Timers subsystem
#
CONFIG_TICK_ONESHOT=y
CONFIG_NO_HZ_COMMON=y
# CONFIG_HZ_PERIODIC is not set
CONFIG_NO_HZ_IDLE=y
# CONFIG_NO_HZ_FULL is not set
CONFIG_NO_HZ=y
CONFIG_HIGH_RES_TIMERS=y
CONFIG_CLOCKSOURCE_WATCHDOG_MAX_SKEW_US=125
# end of Timers subsystem

CONFIG_BPF=y
CONFIG_HAVE_EBPF_JIT=y
CONFIG_ARCH_WANT_DEFAULT_BPF_JIT=y

#
# BPF subsystem
#
# CONFIG_BPF_SYSCALL is not set
# CONFIG_BPF_JIT is not set
# end of BPF subsystem

CONFIG_PREEMPT_BUILD=y
CONFIG_ARCH_HAS_PREEMPT_LAZY=y
# CONFIG_PREEMPT_NONE is not set
# CONFIG_PREEMPT_VOLUNTARY is not set
CONFIG_PREEMPT=y
# CONFIG_PREEMPT_LAZY is not set
# CONFIG_PREEMPT_RT is not set
CONFIG_PREEMPT_COUNT=y
CONFIG_PREEMPTION=y
CONFIG_PREEMPT_DYNAMIC=y
# CONFIG_SCHED_CORE is not set

#
# CPU/Task time and stats accounting
#
CONFIG_TICK_CPU_ACCOUNTING=y
# CONFIG_VIRT_CPU_ACCOUNTING_GEN is not set
# CONFIG_IRQ_TIME_ACCOUNTING is not set
CONFIG_BSD_PROCESS_ACCT=y
# CONFIG_BSD_PROCESS_ACCT_V3 is not set
CONFIG_TASKSTATS=y
CONFIG_TASK_DELAY_ACCT=y
CONFIG_TASK_XACCT=y
CONFIG_TASK_IO_ACCOUNTING=y
# CONFIG_PSI is not set
# end of CPU/Task time and stats accounting

CONFIG_CPU_ISOLATION=y

#
# RCU Subsystem
#
CONFIG_TREE_RCU=y
CONFIG_PREEMPT_RCU=y
CONFIG_RCU_EXPERT=y
CONFIG_TREE_SRCU=y
CONFIG_TASKS_RCU_GENERIC=y
# CONFIG_FORCE_TASKS_RCU is not set
CONFIG_NEED_TASKS_RCU=y
CONFIG_TASKS_RCU=y
# CONFIG_FORCE_TASKS_RUDE_RCU is not set
# CONFIG_FORCE_TASKS_TRACE_RCU is not set
CONFIG_TASKS_TRACE_RCU=y
CONFIG_RCU_STALL_COMMON=y
CONFIG_RCU_NEED_SEGCBLIST=y
CONFIG_RCU_FANOUT=64
CONFIG_RCU_FANOUT_LEAF=16
CONFIG_RCU_BOOST=y
CONFIG_RCU_BOOST_DELAY=500
# CONFIG_RCU_EXP_KTHREAD is not set
CONFIG_RCU_NOCB_CPU=y
# CONFIG_RCU_NOCB_CPU_DEFAULT_ALL is not set
# CONFIG_RCU_NOCB_CPU_CB_BOOST is not set
# CONFIG_TASKS_TRACE_RCU_READ_MB is not set
# CONFIG_RCU_LAZY is not set
# CONFIG_RCU_DOUBLE_CHECK_CB_TIME is not set
# end of RCU Subsystem

# CONFIG_IKCONFIG is not set
# CONFIG_IKHEADERS is not set
CONFIG_LOG_BUF_SHIFT=18
CONFIG_LOG_CPU_MAX_BUF_SHIFT=12
# CONFIG_PRINTK_INDEX is not set
CONFIG_HAVE_UNSTABLE_SCHED_CLOCK=y

#
# Scheduler features
#
# CONFIG_UCLAMP_TASK is not set
# CONFIG_SCHED_ALT is not set
# end of Scheduler features

CONFIG_ARCH_SUPPORTS_NUMA_BALANCING=y
CONFIG_ARCH_WANT_BATCHED_UNMAP_TLB_FLUSH=y
CONFIG_CC_HAS_INT128=y
CONFIG_CC_IMPLICIT_FALLTHROUGH=""-Wimplicit-fallthrough=5""
CONFIG_GCC10_NO_ARRAY_BOUNDS=y
CONFIG_CC_NO_ARRAY_BOUNDS=y
CONFIG_GCC_NO_STRINGOP_OVERFLOW=y
CONFIG_CC_NO_STRINGOP_OVERFLOW=y
CONFIG_ARCH_SUPPORTS_INT128=y
# CONFIG_NUMA_BALANCING is not set
CONFIG_SLAB_OBJ_EXT=y
CONFIG_CGROUPS=y
CONFIG_PAGE_COUNTER=y
# CONFIG_CGROUP_FAVOR_DYNMODS is not set
CONFIG_MEMCG=y
# CONFIG_MEMCG_V1 is not set
CONFIG_BLK_CGROUP=y
CONFIG_CGROUP_WRITEBACK=y
CONFIG_CGROUP_SCHED=y
CONFIG_GROUP_SCHED_WEIGHT=y
CONFIG_FAIR_GROUP_SCHED=y
# CONFIG_CFS_BANDWIDTH is not set
# CONFIG_RT_GROUP_SCHED is not set
CONFIG_SCHED_MM_CID=y
CONFIG_CGROUP_PIDS=y
# CONFIG_CGROUP_RDMA is not set
CONFIG_CGROUP_FREEZER=y
CONFIG_CGROUP_HUGETLB=y
CONFIG_CPUSETS=y
# CONFIG_CPUSETS_V1 is not set
CONFIG_PROC_PID_CPUSET=y
CONFIG_CGROUP_DEVICE=y
CONFIG_CGROUP_CPUACCT=y
CONFIG_CGROUP_PERF=y
CONFIG_CGROUP_MISC=y
# CONFIG_CGROUP_DEBUG is not set
CONFIG_NAMESPACES=y
CONFIG_UTS_NS=y
CONFIG_TIME_NS=y
CONFIG_IPC_NS=y
CONFIG_USER_NS=y
CONFIG_USER_NS_UNPRIVILEGED=y
CONFIG_PID_NS=y
CONFIG_NET_NS=y
# CONFIG_CHECKPOINT_RESTORE is not set
# CONFIG_SCHED_AUTOGROUP is not set
CONFIG_RELAY=y
CONFIG_BLK_DEV_INITRD=y
CONFIG_INITRAMFS_SOURCE=""""
CONFIG_RD_GZIP=y
CONFIG_RD_BZIP2=y
CONFIG_RD_LZMA=y
CONFIG_RD_XZ=y
CONFIG_RD_LZO=y
CONFIG_RD_LZ4=y
CONFIG_RD_ZSTD=y
# CONFIG_BOOT_CONFIG is not set
CONFIG_INITRAMFS_PRESERVE_MTIME=y
CONFIG_CC_OPTIMIZE_FOR_PERFORMANCE=y
# CONFIG_CC_OPTIMIZE_FOR_PERFORMANCE_O3 is not set
# CONFIG_CC_OPTIMIZE_FOR_SIZE is not set
CONFIG_LD_ORPHAN_WARN=y
CONFIG_LD_ORPHAN_WARN_LEVEL=""warn""
CONFIG_SYSCTL=y
CONFIG_HAVE_UID16=y
CONFIG_SYSCTL_EXCEPTION_TRACE=y
CONFIG_HAVE_PCSPKR_PLATFORM=y
# CONFIG_EXPERT is not set
CONFIG_UID16=y
CONFIG_MULTIUSER=y
CONFIG_SGETMASK_SYSCALL=y
CONFIG_SYSFS_SYSCALL=y
CONFIG_FHANDLE=y
CONFIG_POSIX_TIMERS=y
CONFIG_PRINTK=y
CONFIG_BUG=y
CONFIG_ELF_CORE=y
CONFIG_PCSPKR_PLATFORM=y
CONFIG_FUTEX=y
CONFIG_FUTEX_PI=y
CONFIG_EPOLL=y
CONFIG_SIGNALFD=y
CONFIG_TIMERFD=y
CONFIG_EVENTFD=y
CONFIG_SHMEM=y
CONFIG_AIO=y
CONFIG_IO_URING=y
CONFIG_ADVISE_SYSCALLS=y
CONFIG_MEMBARRIER=y
CONFIG_KCMP=y
CONFIG_RSEQ=y
CONFIG_CACHESTAT_SYSCALL=y
CONFIG_KALLSYMS=y
# CONFIG_KALLSYMS_SELFTEST is not set
CONFIG_KALLSYMS_ALL=y
CONFIG_KALLSYMS_ABSOLUTE_PERCPU=y
CONFIG_ARCH_HAS_MEMBARRIER_SYNC_CORE=y
CONFIG_HAVE_PERF_EVENTS=y
CONFIG_GUEST_PERF_EVENTS=y

#
# Kernel Performance Events And Counters
#
CONFIG_PERF_EVENTS=y
# CONFIG_DEBUG_PERF_USE_VMALLOC is not set
# end of Kernel Performance Events And Counters

CONFIG_SYSTEM_DATA_VERIFICATION=y
CONFIG_PROFILING=y
CONFIG_TRACEPOINTS=y

#
# Kexec and crash features
#
CONFIG_CRASH_RESERVE=y
CONFIG_VMCORE_INFO=y
CONFIG_KEXEC_CORE=y
CONFIG_KEXEC=y
# CONFIG_KEXEC_FILE is not set
# CONFIG_KEXEC_JUMP is not set
CONFIG_CRASH_DUMP=y
CONFIG_CRASH_HOTPLUG=y
CONFIG_CRASH_MAX_MEMORY_RANGES=8192
# end of Kexec and crash features
# end of General setup

CONFIG_64BIT=y
CONFIG_X86_64=y
CONFIG_X86=y
CONFIG_INSTRUCTION_DECODER=y
CONFIG_OUTPUT_FORMAT=""elf64-x86-64""
CONFIG_LOCKDEP_SUPPORT=y
CONFIG_STACKTRACE_SUPPORT=y
CONFIG_MMU=y
CONFIG_ARCH_MMAP_RND_BITS_MIN=28
CONFIG_ARCH_MMAP_RND_BITS_MAX=32
CONFIG_ARCH_MMAP_RND_COMPAT_BITS_MIN=8
CONFIG_ARCH_MMAP_RND_COMPAT_BITS_MAX=16
CONFIG_GENERIC_ISA_DMA=y
CONFIG_GENERIC_BUG=y
CONFIG_GENERIC_BUG_RELATIVE_POINTERS=y
CONFIG_ARCH_MAY_HAVE_PC_FDC=y
CONFIG_GENERIC_CALIBRATE_DELAY=y
CONFIG_ARCH_HAS_CPU_RELAX=y
CONFIG_ARCH_HIBERNATION_POSSIBLE=y
CONFIG_ARCH_SUSPEND_POSSIBLE=y
CONFIG_AUDIT_ARCH=y
CONFIG_HAVE_INTEL_TXT=y
CONFIG_X86_64_SMP=y
CONFIG_ARCH_SUPPORTS_UPROBES=y
CONFIG_FIX_EARLYCON_MEM=y
CONFIG_DYNAMIC_PHYSICAL_MASK=y
CONFIG_PGTABLE_LEVELS=5
CONFIG_CC_HAS_SANE_STACKPROTECTOR=y

#
# Processor type and features
#
CONFIG_SMP=y
CONFIG_X86_MPPARSE=y
# CONFIG_X86_CPU_RESCTRL is not set
# CONFIG_X86_FRED is not set
CONFIG_X86_EXTENDED_PLATFORM=y
# CONFIG_X86_VSMP is not set
# CONFIG_X86_GOLDFISH is not set
# CONFIG_X86_INTEL_MID is not set
CONFIG_X86_INTEL_LPSS=y
# CONFIG_X86_AMD_PLATFORM_DEVICE is not set
CONFIG_IOSF_MBI=y
# CONFIG_IOSF_MBI_DEBUG is not set
CONFIG_X86_SUPPORTS_MEMORY_FAILURE=y
CONFIG_SCHED_OMIT_FRAME_POINTER=y
# CONFIG_HYPERVISOR_GUEST is not set
# CONFIG_MK8 is not set
# CONFIG_MK8SSE3 is not set
# CONFIG_MK10 is not set
# CONFIG_MBARCELONA is not set
# CONFIG_MBOBCAT is not set
# CONFIG_MJAGUAR is not set
# CONFIG_MBULLDOZER is not set
# CONFIG_MPILEDRIVER is not set
# CONFIG_MSTEAMROLLER is not set
# CONFIG_MEXCAVATOR is not set
# CONFIG_MZEN is not set
# CONFIG_MZEN2 is not set
# CONFIG_MZEN3 is not set
# CONFIG_MZEN4 is not set
# CONFIG_MZEN5 is not set
# CONFIG_MPSC is not set
# CONFIG_MATOM is not set
# CONFIG_MCORE2 is not set
# CONFIG_MNEHALEM is not set
# CONFIG_MWESTMERE is not set
# CONFIG_MSILVERMONT is not set
# CONFIG_MGOLDMONT is not set
# CONFIG_MGOLDMONTPLUS is not set
# CONFIG_MSANDYBRIDGE is not set
# CONFIG_MIVYBRIDGE is not set
# CONFIG_MHASWELL is not set
# CONFIG_MBROADWELL is not set
CONFIG_MSKYLAKE=y
# CONFIG_MSKYLAKEX is not set
# CONFIG_MCANNONLAKE is not set
# CONFIG_MICELAKE is not set
# CONFIG_MCASCADELAKE is not set
# CONFIG_MCOOPERLAKE is not set
# CONFIG_MTIGERLAKE is not set
# CONFIG_MSAPPHIRERAPIDS is not set
# CONFIG_MROCKETLAKE is not set
# CONFIG_MALDERLAKE is not set
# CONFIG_MRAPTORLAKE is not set
# CONFIG_MMETEORLAKE is not set
# CONFIG_MEMERALDRAPIDS is not set
# CONFIG_GENERIC_CPU is not set
# CONFIG_MNATIVE_INTEL is not set
# CONFIG_MNATIVE_AMD is not set
CONFIG_X86_INTERNODE_CACHE_SHIFT=6
CONFIG_X86_L1_CACHE_SHIFT=6
CONFIG_X86_INTEL_USERCOPY=y
CONFIG_X86_USE_PPRO_CHECKSUM=y
CONFIG_X86_TSC=y
CONFIG_X86_HAVE_PAE=y
CONFIG_X86_CMPXCHG64=y
CONFIG_X86_CMOV=y
CONFIG_X86_MINIMUM_CPU_FAMILY=64
CONFIG_X86_DEBUGCTLMSR=y
CONFIG_IA32_FEAT_CTL=y
CONFIG_X86_VMX_FEATURE_NAMES=y
CONFIG_X86_BROADCAST_TLB_FLUSH=y
CONFIG_CPU_SUP_INTEL=y
CONFIG_CPU_SUP_AMD=y
CONFIG_CPU_SUP_HYGON=y
CONFIG_CPU_SUP_CENTAUR=y
CONFIG_CPU_SUP_ZHAOXIN=y
CONFIG_HPET_TIMER=y
CONFIG_HPET_EMULATE_RTC=y
CONFIG_DMI=y
# CONFIG_GART_IOMMU is not set
CONFIG_BOOT_VESA_SUPPORT=y
# CONFIG_MAXSMP is not set
CONFIG_NR_CPUS_RANGE_BEGIN=2
CONFIG_NR_CPUS_RANGE_END=512
CONFIG_NR_CPUS_DEFAULT=64
CONFIG_NR_CPUS=64
CONFIG_SCHED_CLUSTER=y
CONFIG_SCHED_SMT=y
CONFIG_SCHED_MC=y
CONFIG_SCHED_MC_PRIO=y
CONFIG_X86_LOCAL_APIC=y
CONFIG_ACPI_MADT_WAKEUP=y
CONFIG_X86_IO_APIC=y
CONFIG_X86_REROUTE_FOR_BROKEN_BOOT_IRQS=y
CONFIG_X86_MCE=y
# CONFIG_X86_MCELOG_LEGACY is not set
CONFIG_X86_MCE_INTEL=y
# CONFIG_X86_MCE_AMD is not set
CONFIG_X86_MCE_THRESHOLD=y
# CONFIG_X86_MCE_INJECT is not set

#
# Performance monitoring
#
CONFIG_PERF_EVENTS_INTEL_UNCORE=y
CONFIG_PERF_EVENTS_INTEL_RAPL=y
CONFIG_PERF_EVENTS_INTEL_CSTATE=y
# CONFIG_PERF_EVENTS_AMD_POWER is not set
# CONFIG_PERF_EVENTS_AMD_UNCORE is not set
# CONFIG_PERF_EVENTS_AMD_BRS is not set
# end of Performance monitoring

CONFIG_X86_16BIT=y
CONFIG_X86_ESPFIX64=y
CONFIG_X86_VSYSCALL_EMULATION=y
CONFIG_X86_IOPL_IOPERM=y
CONFIG_MICROCODE=y
# CONFIG_MICROCODE_LATE_LOADING is not set
CONFIG_X86_MSR=y
CONFIG_X86_CPUID=y
CONFIG_X86_5LEVEL=y
CONFIG_X86_DIRECT_GBPAGES=y
# CONFIG_X86_CPA_STATISTICS is not set
CONFIG_X86_MEM_ENCRYPT=y
CONFIG_AMD_MEM_ENCRYPT=y
CONFIG_NUMA=y
CONFIG_AMD_NUMA=y
CONFIG_X86_64_ACPI_NUMA=y
CONFIG_NODES_SHIFT=6
CONFIG_ARCH_SPARSEMEM_ENABLE=y
CONFIG_ARCH_SPARSEMEM_DEFAULT=y
CONFIG_ARCH_PROC_KCORE_TEXT=y
CONFIG_ILLEGAL_POINTER_VALUE=0xdead000000000000
# CONFIG_X86_PMEM_LEGACY is not set
CONFIG_X86_CHECK_BIOS_CORRUPTION=y
CONFIG_X86_BOOTPARAM_MEMORY_CORRUPTION_CHECK=y
CONFIG_MTRR=y
# CONFIG_MTRR_SANITIZER is not set
CONFIG_X86_PAT=y
CONFIG_X86_UMIP=y
CONFIG_CC_HAS_IBT=y
CONFIG_X86_CET=y
CONFIG_X86_KERNEL_IBT=y
CONFIG_X86_INTEL_MEMORY_PROTECTION_KEYS=y
CONFIG_ARCH_PKEY_BITS=4
CONFIG_X86_INTEL_TSX_MODE_OFF=y
# CONFIG_X86_INTEL_TSX_MODE_ON is not set
# CONFIG_X86_INTEL_TSX_MODE_AUTO is not set
# CONFIG_X86_USER_SHADOW_STACK is not set
CONFIG_EFI=y
CONFIG_EFI_STUB=y
# CONFIG_EFI_HANDOVER_PROTOCOL is not set
CONFIG_EFI_MIXED=y
CONFIG_EFI_RUNTIME_MAP=y
# CONFIG_HZ_100 is not set
# CONFIG_HZ_250 is not set
CONFIG_HZ_300=y
# CONFIG_HZ_1000 is not set
CONFIG_HZ=300
CONFIG_SCHED_HRTICK=y
CONFIG_ARCH_SUPPORTS_KEXEC=y
CONFIG_ARCH_SUPPORTS_KEXEC_FILE=y
CONFIG_ARCH_SUPPORTS_KEXEC_PURGATORY=y
CONFIG_ARCH_SUPPORTS_KEXEC_SIG=y
CONFIG_ARCH_SUPPORTS_KEXEC_SIG_FORCE=y
CONFIG_ARCH_SUPPORTS_KEXEC_BZIMAGE_VERIFY_SIG=y
CONFIG_ARCH_SUPPORTS_KEXEC_JUMP=y
CONFIG_ARCH_SUPPORTS_CRASH_DUMP=y
CONFIG_ARCH_DEFAULT_CRASH_DUMP=y
CONFIG_ARCH_SUPPORTS_CRASH_HOTPLUG=y
CONFIG_ARCH_HAS_GENERIC_CRASHKERNEL_RESERVATION=y
CONFIG_PHYSICAL_START=0x1000000
CONFIG_RELOCATABLE=y
CONFIG_RANDOMIZE_BASE=y
CONFIG_X86_NEED_RELOCS=y
CONFIG_PHYSICAL_ALIGN=0x200000
CONFIG_DYNAMIC_MEMORY_LAYOUT=y
CONFIG_RANDOMIZE_MEMORY=y
CONFIG_RANDOMIZE_MEMORY_PHYSICAL_PADDING=0x0
CONFIG_HOTPLUG_CPU=y
# CONFIG_COMPAT_VDSO is not set
CONFIG_LEGACY_VSYSCALL_XONLY=y
# CONFIG_LEGACY_VSYSCALL_NONE is not set
CONFIG_CMDLINE_BOOL=y
CONFIG_CMDLINE=""root=/dev/sda2""
# CONFIG_CMDLINE_OVERRIDE is not set
CONFIG_MODIFY_LDT_SYSCALL=y
# CONFIG_STRICT_SIGALTSTACK_SIZE is not set
CONFIG_HAVE_LIVEPATCH=y
CONFIG_X86_BUS_LOCK_DETECT=y
# end of Processor type and features

CONFIG_CC_HAS_NAMED_AS=y
CONFIG_CC_HAS_NAMED_AS_FIXED_SANITIZERS=y
CONFIG_USE_X86_SEG_SUPPORT=y
CONFIG_CC_HAS_SLS=y
CONFIG_CC_HAS_RETURN_THUNK=y
CONFIG_CC_HAS_ENTRY_PADDING=y
CONFIG_FUNCTION_PADDING_CFI=11
CONFIG_FUNCTION_PADDING_BYTES=16
CONFIG_CALL_PADDING=y
CONFIG_HAVE_CALL_THUNKS=y
CONFIG_CALL_THUNKS=y
CONFIG_PREFIX_SYMBOLS=y
CONFIG_CPU_MITIGATIONS=y
CONFIG_MITIGATION_PAGE_TABLE_ISOLATION=y
CONFIG_MITIGATION_RETPOLINE=y
CONFIG_MITIGATION_RETHUNK=y
CONFIG_MITIGATION_UNRET_ENTRY=y
CONFIG_MITIGATION_CALL_DEPTH_TRACKING=y
# CONFIG_CALL_THUNKS_DEBUG is not set
CONFIG_MITIGATION_IBPB_ENTRY=y
CONFIG_MITIGATION_IBRS_ENTRY=y
CONFIG_MITIGATION_SRSO=y
# CONFIG_MITIGATION_SLS is not set
CONFIG_MITIGATION_GDS=y
CONFIG_MITIGATION_RFDS=y
CONFIG_MITIGATION_SPECTRE_BHI=y
CONFIG_MITIGATION_MDS=y
CONFIG_MITIGATION_TAA=y
CONFIG_MITIGATION_MMIO_STALE_DATA=y
CONFIG_MITIGATION_L1TF=y
CONFIG_MITIGATION_RETBLEED=y
CONFIG_MITIGATION_SPECTRE_V1=y
CONFIG_MITIGATION_SPECTRE_V2=y
CONFIG_MITIGATION_SRBDS=y
CONFIG_MITIGATION_SSB=y
CONFIG_ARCH_HAS_ADD_PAGES=y

#
# Power management and ACPI options
#
CONFIG_ARCH_HIBERNATION_HEADER=y
CONFIG_SUSPEND=y
CONFIG_SUSPEND_FREEZER=y
CONFIG_HIBERNATE_CALLBACKS=y
CONFIG_HIBERNATION=y
CONFIG_HIBERNATION_SNAPSHOT_DEV=y
CONFIG_HIBERNATION_COMP_LZO=y
CONFIG_HIBERNATION_DEF_COMP=""lzo""
CONFIG_PM_STD_PARTITION=""""
CONFIG_PM_SLEEP=y
CONFIG_PM_SLEEP_SMP=y
# CONFIG_PM_AUTOSLEEP is not set
# CONFIG_PM_USERSPACE_AUTOSLEEP is not set
# CONFIG_PM_WAKELOCKS is not set
CONFIG_PM=y
CONFIG_PM_DEBUG=y
# CONFIG_PM_ADVANCED_DEBUG is not set
# CONFIG_PM_TEST_SUSPEND is not set
CONFIG_PM_SLEEP_DEBUG=y
CONFIG_PM_TRACE=y
CONFIG_PM_TRACE_RTC=y
CONFIG_PM_CLK=y
# CONFIG_WQ_POWER_EFFICIENT_DEFAULT is not set
# CONFIG_ENERGY_MODEL is not set
CONFIG_ARCH_SUPPORTS_ACPI=y
CONFIG_ACPI=y
CONFIG_ACPI_LEGACY_TABLES_LOOKUP=y
CONFIG_ARCH_MIGHT_HAVE_ACPI_PDC=y
CONFIG_ACPI_SYSTEM_POWER_STATES_SUPPORT=y
CONFIG_ACPI_THERMAL_LIB=y
# CONFIG_ACPI_DEBUGGER is not set
CONFIG_ACPI_SPCR_TABLE=y
# CONFIG_ACPI_FPDT is not set
CONFIG_ACPI_LPIT=y
CONFIG_ACPI_SLEEP=y
CONFIG_ACPI_REV_OVERRIDE_POSSIBLE=y
CONFIG_ACPI_EC=y
# CONFIG_ACPI_EC_DEBUGFS is not set
CONFIG_ACPI_AC=y
CONFIG_ACPI_BATTERY=y
CONFIG_ACPI_BUTTON=y
CONFIG_ACPI_VIDEO=m
CONFIG_ACPI_FAN=y
# CONFIG_ACPI_TAD is not set
CONFIG_ACPI_DOCK=y
CONFIG_ACPI_CPU_FREQ_PSS=y
CONFIG_ACPI_PROCESSOR_CSTATE=y
CONFIG_ACPI_PROCESSOR_IDLE=y
CONFIG_ACPI_CPPC_LIB=y
CONFIG_ACPI_PROCESSOR=y
CONFIG_ACPI_HOTPLUG_CPU=y
# CONFIG_ACPI_PROCESSOR_AGGREGATOR is not set
CONFIG_ACPI_THERMAL=y
CONFIG_ACPI_PLATFORM_PROFILE=m
CONFIG_ARCH_HAS_ACPI_TABLE_UPGRADE=y
CONFIG_ACPI_TABLE_UPGRADE=y
# CONFIG_ACPI_DEBUG is not set
# CONFIG_ACPI_PCI_SLOT is not set
CONFIG_ACPI_CONTAINER=y
CONFIG_ACPI_HOTPLUG_IOAPIC=y
# CONFIG_ACPI_SBS is not set
# CONFIG_ACPI_HED is not set
CONFIG_ACPI_BGRT=y
CONFIG_ACPI_NHLT=y
# CONFIG_ACPI_NFIT is not set
CONFIG_ACPI_NUMA=y
# CONFIG_ACPI_HMAT is not set
CONFIG_HAVE_ACPI_APEI=y
CONFIG_HAVE_ACPI_APEI_NMI=y
# CONFIG_ACPI_APEI is not set
# CONFIG_ACPI_DPTF is not set
# CONFIG_ACPI_CONFIGFS is not set
# CONFIG_ACPI_PFRUT is not set
CONFIG_ACPI_PCC=y
# CONFIG_ACPI_FFH is not set
# CONFIG_PMIC_OPREGION is not set
CONFIG_ACPI_PRMT=y
CONFIG_X86_PM_TIMER=y

#
# CPU Frequency scaling
#
CONFIG_CPU_FREQ=y
CONFIG_CPU_FREQ_GOV_ATTR_SET=y
CONFIG_CPU_FREQ_GOV_COMMON=y
# CONFIG_CPU_FREQ_STAT is not set
# CONFIG_CPU_FREQ_DEFAULT_GOV_PERFORMANCE is not set
# CONFIG_CPU_FREQ_DEFAULT_GOV_POWERSAVE is not set
CONFIG_CPU_FREQ_DEFAULT_GOV_USERSPACE=y
# CONFIG_CPU_FREQ_DEFAULT_GOV_SCHEDUTIL is not set
CONFIG_CPU_FREQ_GOV_PERFORMANCE=y
CONFIG_CPU_FREQ_GOV_POWERSAVE=y
CONFIG_CPU_FREQ_GOV_USERSPACE=y
CONFIG_CPU_FREQ_GOV_ONDEMAND=y
CONFIG_CPU_FREQ_GOV_CONSERVATIVE=y
CONFIG_CPU_FREQ_GOV_SCHEDUTIL=y

#
# CPU frequency scaling drivers
#
CONFIG_X86_INTEL_PSTATE=y
# CONFIG_X86_PCC_CPUFREQ is not set
CONFIG_X86_AMD_PSTATE=y
CONFIG_X86_AMD_PSTATE_DEFAULT_MODE=3
# CONFIG_X86_AMD_PSTATE_UT is not set
CONFIG_X86_ACPI_CPUFREQ=y
# CONFIG_X86_ACPI_CPUFREQ_CPB is not set
# CONFIG_X86_POWERNOW_K8 is not set
# CONFIG_X86_AMD_FREQ_SENSITIVITY is not set
# CONFIG_X86_SPEEDSTEP_CENTRINO is not set
# CONFIG_X86_P4_CLOCKMOD is not set

#
# shared options
#
# end of CPU Frequency scaling

#
# CPU Idle
#
CONFIG_CPU_IDLE=y
CONFIG_CPU_IDLE_GOV_LADDER=y
CONFIG_CPU_IDLE_GOV_MENU=y
CONFIG_CPU_IDLE_GOV_TEO=y
# end of CPU Idle

CONFIG_INTEL_IDLE=y
# end of Power management and ACPI options

#
# Bus options (PCI etc.)
#
CONFIG_PCI_DIRECT=y
CONFIG_PCI_MMCONFIG=y
CONFIG_MMCONF_FAM10H=y
CONFIG_ISA_DMA_API=y
CONFIG_AMD_NB=y
# end of Bus options (PCI etc.)

#
# Binary Emulations
#
CONFIG_IA32_EMULATION=y
# CONFIG_IA32_EMULATION_DEFAULT_DISABLED is not set
# CONFIG_X86_X32_ABI is not set
CONFIG_COMPAT_32=y
CONFIG_COMPAT=y
CONFIG_COMPAT_FOR_U64_ALIGNMENT=y
# end of Binary Emulations

CONFIG_KVM_COMMON=y
CONFIG_HAVE_KVM_PFNCACHE=y
CONFIG_HAVE_KVM_IRQCHIP=y
CONFIG_HAVE_KVM_IRQ_ROUTING=y
CONFIG_HAVE_KVM_DIRTY_RING=y
CONFIG_HAVE_KVM_DIRTY_RING_TSO=y
CONFIG_HAVE_KVM_DIRTY_RING_ACQ_REL=y
CONFIG_KVM_MMIO=y
CONFIG_KVM_ASYNC_PF=y
CONFIG_HAVE_KVM_MSI=y
CONFIG_HAVE_KVM_READONLY_MEM=y
CONFIG_HAVE_KVM_CPU_RELAX_INTERCEPT=y
CONFIG_KVM_VFIO=y
CONFIG_KVM_GENERIC_DIRTYLOG_READ_PROTECT=y
CONFIG_KVM_GENERIC_PRE_FAULT_MEMORY=y
CONFIG_KVM_COMPAT=y
CONFIG_HAVE_KVM_IRQ_BYPASS=y
CONFIG_HAVE_KVM_NO_POLL=y
CONFIG_KVM_XFER_TO_GUEST_WORK=y
CONFIG_HAVE_KVM_PM_NOTIFIER=y
CONFIG_KVM_GENERIC_HARDWARE_ENABLING=y
CONFIG_KVM_GENERIC_MMU_NOTIFIER=y
CONFIG_KVM_ELIDE_TLB_FLUSH_IF_YOUNG=y
CONFIG_VIRTUALIZATION=y
CONFIG_KVM_X86=m
CONFIG_KVM=m
CONFIG_KVM_INTEL=m
# CONFIG_KVM_AMD is not set
CONFIG_KVM_SMM=y
CONFIG_KVM_HYPERV=y
# CONFIG_KVM_XEN is not set
CONFIG_KVM_MAX_NR_VCPUS=1024
CONFIG_AS_AVX512=y
CONFIG_AS_SHA1_NI=y
CONFIG_AS_SHA256_NI=y
CONFIG_AS_TPAUSE=y
CONFIG_AS_GFNI=y
CONFIG_AS_VAES=y
CONFIG_AS_VPCLMULQDQ=y
CONFIG_AS_WRUSS=y
CONFIG_ARCH_CONFIGURES_CPU_MITIGATIONS=y

#
# General architecture-dependent options
#
CONFIG_HOTPLUG_SMT=y
CONFIG_HOTPLUG_CORE_SYNC=y
CONFIG_HOTPLUG_CORE_SYNC_DEAD=y
CONFIG_HOTPLUG_CORE_SYNC_FULL=y
CONFIG_HOTPLUG_SPLIT_STARTUP=y
CONFIG_HOTPLUG_PARALLEL=y
CONFIG_GENERIC_ENTRY=y
CONFIG_KPROBES=y
CONFIG_JUMP_LABEL=y
# CONFIG_STATIC_KEYS_SELFTEST is not set
# CONFIG_STATIC_CALL_SELFTEST is not set
CONFIG_OPTPROBES=y
CONFIG_UPROBES=y
CONFIG_HAVE_EFFICIENT_UNALIGNED_ACCESS=y
CONFIG_ARCH_USE_BUILTIN_BSWAP=y
CONFIG_KRETPROBES=y
CONFIG_KRETPROBE_ON_RETHOOK=y
CONFIG_USER_RETURN_NOTIFIER=y
CONFIG_HAVE_IOREMAP_PROT=y
CONFIG_HAVE_KPROBES=y
CONFIG_HAVE_KRETPROBES=y
CONFIG_HAVE_OPTPROBES=y
CONFIG_HAVE_KPROBES_ON_FTRACE=y
CONFIG_ARCH_CORRECT_STACKTRACE_ON_KRETPROBE=y
CONFIG_HAVE_FUNCTION_ERROR_INJECTION=y
CONFIG_HAVE_NMI=y
CONFIG_TRACE_IRQFLAGS_SUPPORT=y
CONFIG_TRACE_IRQFLAGS_NMI_SUPPORT=y
CONFIG_HAVE_ARCH_TRACEHOOK=y
CONFIG_HAVE_DMA_CONTIGUOUS=y
CONFIG_GENERIC_SMP_IDLE_THREAD=y
CONFIG_ARCH_HAS_FORTIFY_SOURCE=y
CONFIG_ARCH_HAS_SET_MEMORY=y
CONFIG_ARCH_HAS_SET_DIRECT_MAP=y
CONFIG_ARCH_HAS_CPU_FINALIZE_INIT=y
CONFIG_HAVE_ARCH_THREAD_STRUCT_WHITELIST=y
CONFIG_ARCH_WANTS_DYNAMIC_TASK_STRUCT=y
CONFIG_ARCH_WANTS_NO_INSTR=y
CONFIG_HAVE_ASM_MODVERSIONS=y
CONFIG_HAVE_REGS_AND_STACK_ACCESS_API=y
CONFIG_HAVE_RSEQ=y
CONFIG_HAVE_RUST=y
CONFIG_HAVE_FUNCTION_ARG_ACCESS_API=y
CONFIG_HAVE_HW_BREAKPOINT=y
CONFIG_HAVE_MIXED_BREAKPOINTS_REGS=y
CONFIG_HAVE_USER_RETURN_NOTIFIER=y
CONFIG_HAVE_PERF_EVENTS_NMI=y
CONFIG_HAVE_HARDLOCKUP_DETECTOR_PERF=y
CONFIG_HAVE_PERF_REGS=y
CONFIG_HAVE_PERF_USER_STACK_DUMP=y
CONFIG_HAVE_ARCH_JUMP_LABEL=y
CONFIG_HAVE_ARCH_JUMP_LABEL_RELATIVE=y
CONFIG_MMU_GATHER_MERGE_VMAS=y
CONFIG_MMU_LAZY_TLB_REFCOUNT=y
CONFIG_ARCH_HAVE_NMI_SAFE_CMPXCHG=y
CONFIG_ARCH_HAVE_EXTRA_ELF_NOTES=y
CONFIG_ARCH_HAS_NMI_SAFE_THIS_CPU_OPS=y
CONFIG_HAVE_ALIGNED_STRUCT_PAGE=y
CONFIG_HAVE_CMPXCHG_LOCAL=y
CONFIG_HAVE_CMPXCHG_DOUBLE=y
CONFIG_ARCH_WANT_COMPAT_IPC_PARSE_VERSION=y
CONFIG_ARCH_WANT_OLD_COMPAT_IPC=y
CONFIG_HAVE_ARCH_SECCOMP=y
CONFIG_HAVE_ARCH_SECCOMP_FILTER=y
CONFIG_SECCOMP=y
CONFIG_SECCOMP_FILTER=y
# CONFIG_SECCOMP_CACHE_DEBUG is not set
CONFIG_HAVE_ARCH_STACKLEAK=y
CONFIG_HAVE_STACKPROTECTOR=y
CONFIG_STACKPROTECTOR=y
CONFIG_STACKPROTECTOR_STRONG=y
CONFIG_ARCH_SUPPORTS_LTO_CLANG=y
CONFIG_ARCH_SUPPORTS_LTO_CLANG_THIN=y
CONFIG_LTO_NONE=y
CONFIG_ARCH_SUPPORTS_AUTOFDO_CLANG=y
CONFIG_ARCH_SUPPORTS_PROPELLER_CLANG=y
CONFIG_ARCH_SUPPORTS_CFI_CLANG=y
CONFIG_HAVE_ARCH_WITHIN_STACK_FRAMES=y
CONFIG_HAVE_CONTEXT_TRACKING_USER=y
CONFIG_HAVE_CONTEXT_TRACKING_USER_OFFSTACK=y
CONFIG_HAVE_VIRT_CPU_ACCOUNTING_GEN=y
CONFIG_HAVE_IRQ_TIME_ACCOUNTING=y
CONFIG_HAVE_MOVE_PUD=y
CONFIG_HAVE_MOVE_PMD=y
CONFIG_HAVE_ARCH_TRANSPARENT_HUGEPAGE=y
CONFIG_HAVE_ARCH_TRANSPARENT_HUGEPAGE_PUD=y
CONFIG_HAVE_ARCH_HUGE_VMAP=y
CONFIG_HAVE_ARCH_HUGE_VMALLOC=y
CONFIG_ARCH_WANT_HUGE_PMD_SHARE=y
CONFIG_HAVE_ARCH_SOFT_DIRTY=y
CONFIG_HAVE_MOD_ARCH_SPECIFIC=y
CONFIG_MODULES_USE_ELF_RELA=y
CONFIG_HAVE_IRQ_EXIT_ON_IRQ_STACK=y
CONFIG_HAVE_SOFTIRQ_ON_OWN_STACK=y
CONFIG_SOFTIRQ_ON_OWN_STACK=y
CONFIG_ARCH_HAS_ELF_RANDOMIZE=y
CONFIG_HAVE_ARCH_MMAP_RND_BITS=y
CONFIG_HAVE_EXIT_THREAD=y
CONFIG_ARCH_MMAP_RND_BITS=32
CONFIG_HAVE_ARCH_MMAP_RND_COMPAT_BITS=y
CONFIG_ARCH_MMAP_RND_COMPAT_BITS=16
CONFIG_HAVE_ARCH_COMPAT_MMAP_BASES=y
CONFIG_HAVE_PAGE_SIZE_4KB=y
CONFIG_PAGE_SIZE_4KB=y
CONFIG_PAGE_SIZE_LESS_THAN_64KB=y
CONFIG_PAGE_SIZE_LESS_THAN_256KB=y
CONFIG_PAGE_SHIFT=12
CONFIG_HAVE_OBJTOOL=y
CONFIG_HAVE_JUMP_LABEL_HACK=y
CONFIG_HAVE_NOINSTR_HACK=y
CONFIG_HAVE_NOINSTR_VALIDATION=y
CONFIG_HAVE_UACCESS_VALIDATION=y
CONFIG_HAVE_STACK_VALIDATION=y
CONFIG_HAVE_RELIABLE_STACKTRACE=y
CONFIG_OLD_SIGSUSPEND3=y
CONFIG_COMPAT_OLD_SIGACTION=y
CONFIG_COMPAT_32BIT_TIME=y
CONFIG_ARCH_SUPPORTS_RT=y
CONFIG_HAVE_ARCH_VMAP_STACK=y
CONFIG_VMAP_STACK=y
CONFIG_HAVE_ARCH_RANDOMIZE_KSTACK_OFFSET=y
CONFIG_RANDOMIZE_KSTACK_OFFSET=y
# CONFIG_RANDOMIZE_KSTACK_OFFSET_DEFAULT is not set
CONFIG_ARCH_HAS_STRICT_KERNEL_RWX=y
CONFIG_STRICT_KERNEL_RWX=y
CONFIG_ARCH_HAS_STRICT_MODULE_RWX=y
CONFIG_STRICT_MODULE_RWX=y
CONFIG_HAVE_ARCH_PREL32_RELOCATIONS=y
CONFIG_ARCH_USE_MEMREMAP_PROT=y
# CONFIG_LOCK_EVENT_COUNTS is not set
CONFIG_ARCH_HAS_MEM_ENCRYPT=y
CONFIG_ARCH_HAS_CC_PLATFORM=y
CONFIG_HAVE_STATIC_CALL=y
CONFIG_HAVE_STATIC_CALL_INLINE=y
CONFIG_HAVE_PREEMPT_DYNAMIC=y
CONFIG_HAVE_PREEMPT_DYNAMIC_CALL=y
CONFIG_ARCH_WANT_LD_ORPHAN_WARN=y
CONFIG_ARCH_SUPPORTS_DEBUG_PAGEALLOC=y
CONFIG_ARCH_SUPPORTS_PAGE_TABLE_CHECK=y
CONFIG_ARCH_HAS_ELFCORE_COMPAT=y
CONFIG_ARCH_HAS_PARANOID_L1D_FLUSH=y
CONFIG_DYNAMIC_SIGFRAME=y
CONFIG_ARCH_HAS_HW_PTE_YOUNG=y
CONFIG_ARCH_HAS_NONLEAF_PMD_YOUNG=y
CONFIG_ARCH_HAS_KERNEL_FPU_SUPPORT=y

#
# GCOV-based kernel profiling
#
# CONFIG_GCOV_KERNEL is not set
CONFIG_ARCH_HAS_GCOV_PROFILE_ALL=y
# end of GCOV-based kernel profiling

CONFIG_HAVE_GCC_PLUGINS=y
CONFIG_GCC_PLUGINS=y
# CONFIG_GCC_PLUGIN_LATENT_ENTROPY is not set
CONFIG_FUNCTION_ALIGNMENT_4B=y
CONFIG_FUNCTION_ALIGNMENT_16B=y
CONFIG_FUNCTION_ALIGNMENT=16
CONFIG_CC_HAS_MIN_FUNCTION_ALIGNMENT=y
CONFIG_CC_HAS_SANE_FUNCTION_ALIGNMENT=y
# end of General architecture-dependent options

CONFIG_RT_MUTEXES=y
CONFIG_MODULES=y
# CONFIG_MODULE_DEBUG is not set
# CONFIG_MODULE_FORCE_LOAD is not set
CONFIG_MODULE_UNLOAD=y
CONFIG_MODULE_FORCE_UNLOAD=y
# CONFIG_MODULE_UNLOAD_TAINT_TRACKING is not set
# CONFIG_MODVERSIONS is not set
# CONFIG_MODULE_SRCVERSION_ALL is not set
# CONFIG_MODULE_SIG is not set
# CONFIG_MODULE_COMPRESS is not set
# CONFIG_MODULE_ALLOW_MISSING_NAMESPACE_IMPORTS is not set
CONFIG_MODPROBE_PATH=""/sbin/modprobe""
# CONFIG_TRIM_UNUSED_KSYMS is not set
CONFIG_MODULES_TREE_LOOKUP=y
CONFIG_BLOCK=y
CONFIG_BLOCK_LEGACY_AUTOLOAD=y
CONFIG_BLK_DEV_BSG_COMMON=y
CONFIG_BLK_ICQ=y
# CONFIG_BLK_DEV_BSGLIB is not set
# CONFIG_BLK_DEV_INTEGRITY is not set
CONFIG_BLK_DEV_WRITE_MOUNTED=y
# CONFIG_BLK_DEV_ZONED is not set
# CONFIG_BLK_DEV_THROTTLING is not set
# CONFIG_BLK_WBT is not set
# CONFIG_BLK_CGROUP_IOLATENCY is not set
# CONFIG_BLK_CGROUP_IOCOST is not set
# CONFIG_BLK_CGROUP_IOPRIO is not set
CONFIG_BLK_DEBUG_FS=y
# CONFIG_BLK_SED_OPAL is not set
# CONFIG_BLK_INLINE_ENCRYPTION is not set

#
# Partition Types
#
CONFIG_PARTITION_ADVANCED=y
# CONFIG_ACORN_PARTITION is not set
# CONFIG_AIX_PARTITION is not set
# CONFIG_OSF_PARTITION is not set
# CONFIG_AMIGA_PARTITION is not set
# CONFIG_ATARI_PARTITION is not set
# CONFIG_MAC_PARTITION is not set
CONFIG_MSDOS_PARTITION=y
# CONFIG_BSD_DISKLABEL is not set
# CONFIG_MINIX_SUBPARTITION is not set
# CONFIG_SOLARIS_X86_PARTITION is not set
# CONFIG_UNIXWARE_DISKLABEL is not set
# CONFIG_LDM_PARTITION is not set
# CONFIG_SGI_PARTITION is not set
# CONFIG_ULTRIX_PARTITION is not set
# CONFIG_SUN_PARTITION is not set
# CONFIG_KARMA_PARTITION is not set
CONFIG_EFI_PARTITION=y
# CONFIG_SYSV68_PARTITION is not set
# CONFIG_CMDLINE_PARTITION is not set
# end of Partition Types

CONFIG_BLK_MQ_PCI=y
CONFIG_BLK_PM=y
CONFIG_BLOCK_HOLDER_DEPRECATED=y
CONFIG_BLK_MQ_STACKING=y

#
# IO Schedulers
#
CONFIG_MQ_IOSCHED_DEADLINE=y
CONFIG_MQ_IOSCHED_KYBER=y
CONFIG_IOSCHED_BFQ=y
# CONFIG_BFQ_GROUP_IOSCHED is not set
# end of IO Schedulers

CONFIG_PREEMPT_NOTIFIERS=y
CONFIG_PADATA=y
CONFIG_ASN1=y
CONFIG_UNINLINE_SPIN_UNLOCK=y
CONFIG_ARCH_SUPPORTS_ATOMIC_RMW=y
CONFIG_MUTEX_SPIN_ON_OWNER=y
CONFIG_RWSEM_SPIN_ON_OWNER=y
CONFIG_LOCK_SPIN_ON_OWNER=y
CONFIG_ARCH_USE_QUEUED_SPINLOCKS=y
CONFIG_QUEUED_SPINLOCKS=y
CONFIG_ARCH_USE_QUEUED_RWLOCKS=y
CONFIG_QUEUED_RWLOCKS=y
CONFIG_ARCH_HAS_NON_OVERLAPPING_ADDRESS_SPACE=y
CONFIG_ARCH_HAS_SYNC_CORE_BEFORE_USERMODE=y
CONFIG_ARCH_HAS_SYSCALL_WRAPPER=y
CONFIG_FREEZER=y

#
# Executable file formats
#
CONFIG_BINFMT_ELF=y
CONFIG_COMPAT_BINFMT_ELF=y
CONFIG_ELFCORE=y
CONFIG_CORE_DUMP_DEFAULT_ELF_HEADERS=y
CONFIG_BINFMT_SCRIPT=y
CONFIG_BINFMT_MISC=y
CONFIG_COREDUMP=y
# end of Executable file formats

#
# Memory Management options
#
CONFIG_SWAP=y
# CONFIG_ZSWAP is not set

#
# Slab allocator options
#
CONFIG_SLUB=y
CONFIG_SLAB_MERGE_DEFAULT=y
# CONFIG_SLAB_FREELIST_RANDOM is not set
# CONFIG_SLAB_FREELIST_HARDENED is not set
# CONFIG_SLAB_BUCKETS is not set
# CONFIG_SLUB_STATS is not set
CONFIG_SLUB_CPU_PARTIAL=y
# CONFIG_RANDOM_KMALLOC_CACHES is not set
# end of Slab allocator options

# CONFIG_SHUFFLE_PAGE_ALLOCATOR is not set
# CONFIG_COMPAT_BRK is not set
CONFIG_SPARSEMEM=y
CONFIG_SPARSEMEM_EXTREME=y
CONFIG_SPARSEMEM_VMEMMAP_ENABLE=y
CONFIG_SPARSEMEM_VMEMMAP=y
CONFIG_ARCH_WANT_OPTIMIZE_DAX_VMEMMAP=y
CONFIG_ARCH_WANT_OPTIMIZE_HUGETLB_VMEMMAP=y
CONFIG_HAVE_GUP_FAST=y
CONFIG_EXCLUSIVE_SYSTEM_RAM=y
CONFIG_ARCH_ENABLE_MEMORY_HOTPLUG=y
# CONFIG_MEMORY_HOTPLUG is not set
CONFIG_ARCH_MHP_MEMMAP_ON_MEMORY_ENABLE=y
CONFIG_SPLIT_PTE_PTLOCKS=y
CONFIG_ARCH_ENABLE_SPLIT_PMD_PTLOCK=y
CONFIG_SPLIT_PMD_PTLOCKS=y
CONFIG_COMPACTION=y
CONFIG_COMPACT_UNEVICTABLE_DEFAULT=0
# CONFIG_PAGE_REPORTING is not set
CONFIG_MIGRATION=y
CONFIG_ARCH_ENABLE_HUGEPAGE_MIGRATION=y
CONFIG_PCP_BATCH_SCALE_MAX=5
CONFIG_PHYS_ADDR_T_64BIT=y
CONFIG_MMU_NOTIFIER=y
# CONFIG_KSM is not set
CONFIG_DEFAULT_MMAP_MIN_ADDR=4096
CONFIG_ARCH_SUPPORTS_MEMORY_FAILURE=y
# CONFIG_MEMORY_FAILURE is not set
CONFIG_ARCH_WANT_GENERAL_HUGETLB=y
CONFIG_ARCH_WANTS_THP_SWAP=y
# CONFIG_TRANSPARENT_HUGEPAGE is not set
CONFIG_PGTABLE_HAS_HUGE_LEAVES=y
CONFIG_NEED_PER_CPU_EMBED_FIRST_CHUNK=y
CONFIG_NEED_PER_CPU_PAGE_FIRST_CHUNK=y
CONFIG_USE_PERCPU_NUMA_NODE_ID=y
CONFIG_HAVE_SETUP_PER_CPU_AREA=y
# CONFIG_CMA is not set
CONFIG_GENERIC_EARLY_IOREMAP=y
# CONFIG_DEFERRED_STRUCT_PAGE_INIT is not set
# CONFIG_IDLE_PAGE_TRACKING is not set
CONFIG_ARCH_HAS_CACHE_LINE_SIZE=y
CONFIG_ARCH_HAS_CURRENT_STACK_POINTER=y
CONFIG_ARCH_HAS_PTE_DEVMAP=y
CONFIG_ZONE_DMA=y
CONFIG_ZONE_DMA32=y
CONFIG_VMAP_PFN=y
CONFIG_ARCH_USES_HIGH_VMA_FLAGS=y
CONFIG_ARCH_HAS_PKEYS=y
CONFIG_ARCH_USES_PG_ARCH_2=y
CONFIG_VM_EVENT_COUNTERS=y
# CONFIG_PERCPU_STATS is not set
# CONFIG_GUP_TEST is not set
# CONFIG_DMAPOOL_TEST is not set
CONFIG_ARCH_HAS_PTE_SPECIAL=y
CONFIG_MEMFD_CREATE=y
CONFIG_SECRETMEM=y
# CONFIG_ANON_VMA_NAME is not set
# CONFIG_USERFAULTFD is not set
# CONFIG_LRU_GEN is not set
CONFIG_ARCH_SUPPORTS_PER_VMA_LOCK=y
CONFIG_PER_VMA_LOCK=y
CONFIG_LOCK_MM_AND_FIND_VMA=y
CONFIG_EXECMEM=y
CONFIG_NUMA_MEMBLKS=y
# CONFIG_NUMA_EMU is not set

#
# Data Access Monitoring
#
# CONFIG_DAMON is not set
# end of Data Access Monitoring
# end of Memory Management options

CONFIG_NET=y
CONFIG_COMPAT_NETLINK_MESSAGES=y
CONFIG_NET_INGRESS=y
CONFIG_NET_EGRESS=y
CONFIG_NET_XGRESS=y
CONFIG_SKB_EXTENSIONS=y
CONFIG_NET_DEVMEM=y

#
# Networking options
#
CONFIG_PACKET=y
# CONFIG_PACKET_DIAG is not set
CONFIG_UNIX=y
CONFIG_AF_UNIX_OOB=y
# CONFIG_UNIX_DIAG is not set
# CONFIG_TLS is not set
CONFIG_XFRM=y
CONFIG_XFRM_ALGO=y
CONFIG_XFRM_USER=y
# CONFIG_XFRM_USER_COMPAT is not set
# CONFIG_XFRM_INTERFACE is not set
# CONFIG_XFRM_SUB_POLICY is not set
# CONFIG_XFRM_MIGRATE is not set
# CONFIG_XFRM_STATISTICS is not set
CONFIG_XFRM_AH=y
CONFIG_XFRM_ESP=y
# CONFIG_NET_KEY is not set
CONFIG_NET_HANDSHAKE=y
CONFIG_INET=y
CONFIG_IP_MULTICAST=y
CONFIG_IP_ADVANCED_ROUTER=y
# CONFIG_IP_FIB_TRIE_STATS is not set
CONFIG_IP_MULTIPLE_TABLES=y
CONFIG_IP_ROUTE_MULTIPATH=y
CONFIG_IP_ROUTE_VERBOSE=y
CONFIG_IP_PNP=y
CONFIG_IP_PNP_DHCP=y
CONFIG_IP_PNP_BOOTP=y
CONFIG_IP_PNP_RARP=y
# CONFIG_NET_IPIP is not set
# CONFIG_NET_IPGRE_DEMUX is not set
CONFIG_NET_IP_TUNNEL=y
CONFIG_IP_MROUTE_COMMON=y
CONFIG_IP_MROUTE=y
# CONFIG_IP_MROUTE_MULTIPLE_TABLES is not set
CONFIG_IP_PIMSM_V1=y
CONFIG_IP_PIMSM_V2=y
CONFIG_SYN_COOKIES=y
# CONFIG_NET_IPVTI is not set
# CONFIG_NET_FOU is not set
# CONFIG_NET_FOU_IP_TUNNELS is not set
# CONFIG_INET_AH is not set
# CONFIG_INET_ESP is not set
# CONFIG_INET_IPCOMP is not set
CONFIG_INET_TABLE_PERTURB_ORDER=16
CONFIG_INET_TUNNEL=y
# CONFIG_INET_DIAG is not set
CONFIG_TCP_CONG_ADVANCED=y
# CONFIG_TCP_CONG_BIC is not set
CONFIG_TCP_CONG_CUBIC=y
# CONFIG_TCP_CONG_WESTWOOD is not set
# CONFIG_TCP_CONG_HTCP is not set
# CONFIG_TCP_CONG_HSTCP is not set
# CONFIG_TCP_CONG_HYBLA is not set
# CONFIG_TCP_CONG_VEGAS is not set
# CONFIG_TCP_CONG_NV is not set
# CONFIG_TCP_CONG_SCALABLE is not set
# CONFIG_TCP_CONG_LP is not set
# CONFIG_TCP_CONG_VENO is not set
# CONFIG_TCP_CONG_YEAH is not set
# CONFIG_TCP_CONG_ILLINOIS is not set
# CONFIG_TCP_CONG_DCTCP is not set
# CONFIG_TCP_CONG_CDG is not set
# CONFIG_TCP_CONG_BBR is not set
CONFIG_DEFAULT_CUBIC=y
# CONFIG_DEFAULT_RENO is not set
CONFIG_DEFAULT_TCP_CONG=""cubic""
CONFIG_TCP_SIGPOOL=y
# CONFIG_TCP_AO is not set
CONFIG_TCP_MD5SIG=y
CONFIG_IPV6=y
# CONFIG_IPV6_ROUTER_PREF is not set
# CONFIG_IPV6_OPTIMISTIC_DAD is not set
CONFIG_INET6_AH=y
CONFIG_INET6_ESP=y
# CONFIG_INET6_ESP_OFFLOAD is not set
# CONFIG_INET6_ESPINTCP is not set
# CONFIG_INET6_IPCOMP is not set
# CONFIG_IPV6_MIP6 is not set
# CONFIG_IPV6_ILA is not set
# CONFIG_IPV6_VTI is not set
CONFIG_IPV6_SIT=y
# CONFIG_IPV6_SIT_6RD is not set
CONFIG_IPV6_NDISC_NODETYPE=y
# CONFIG_IPV6_TUNNEL is not set
# CONFIG_IPV6_MULTIPLE_TABLES is not set
# CONFIG_IPV6_MROUTE is not set
# CONFIG_IPV6_SEG6_LWTUNNEL is not set
# CONFIG_IPV6_SEG6_HMAC is not set
# CONFIG_IPV6_RPL_LWTUNNEL is not set
# CONFIG_IPV6_IOAM6_LWTUNNEL is not set
CONFIG_NETLABEL=y
# CONFIG_MPTCP is not set
CONFIG_NETWORK_SECMARK=y
CONFIG_NET_PTP_CLASSIFY=y
# CONFIG_NETWORK_PHY_TIMESTAMPING is not set
CONFIG_NETFILTER=y
CONFIG_NETFILTER_ADVANCED=y

#
# Core Netfilter Configuration
#
CONFIG_NETFILTER_INGRESS=y
CONFIG_NETFILTER_EGRESS=y
CONFIG_NETFILTER_SKIP_EGRESS=y
CONFIG_NETFILTER_NETLINK=y
# CONFIG_NETFILTER_NETLINK_ACCT is not set
# CONFIG_NETFILTER_NETLINK_QUEUE is not set
CONFIG_NETFILTER_NETLINK_LOG=y
# CONFIG_NETFILTER_NETLINK_OSF is not set
CONFIG_NF_CONNTRACK=y
# CONFIG_NF_LOG_SYSLOG is not set
# CONFIG_NF_CONNTRACK_MARK is not set
# CONFIG_NF_CONNTRACK_SECMARK is not set
# CONFIG_NF_CONNTRACK_ZONES is not set
# CONFIG_NF_CONNTRACK_PROCFS is not set
# CONFIG_NF_CONNTRACK_EVENTS is not set
# CONFIG_NF_CONNTRACK_TIMEOUT is not set
# CONFIG_NF_CONNTRACK_TIMESTAMP is not set
# CONFIG_NF_CONNTRACK_LABELS is not set
CONFIG_NF_CT_PROTO_DCCP=y
CONFIG_NF_CT_PROTO_SCTP=y
CONFIG_NF_CT_PROTO_UDPLITE=y
# CONFIG_NF_CONNTRACK_AMANDA is not set
CONFIG_NF_CONNTRACK_FTP=y
# CONFIG_NF_CONNTRACK_H323 is not set
CONFIG_NF_CONNTRACK_IRC=y
# CONFIG_NF_CONNTRACK_NETBIOS_NS is not set
# CONFIG_NF_CONNTRACK_SNMP is not set
# CONFIG_NF_CONNTRACK_PPTP is not set
# CONFIG_NF_CONNTRACK_SANE is not set
CONFIG_NF_CONNTRACK_SIP=y
# CONFIG_NF_CONNTRACK_TFTP is not set
CONFIG_NF_CT_NETLINK=y
# CONFIG_NETFILTER_NETLINK_GLUE_CT is not set
CONFIG_NF_NAT=y
CONFIG_NF_NAT_FTP=y
CONFIG_NF_NAT_IRC=y
CONFIG_NF_NAT_SIP=y
# CONFIG_NF_TABLES is not set
CONFIG_NETFILTER_XTABLES=y
CONFIG_NETFILTER_XTABLES_COMPAT=y

#
# Xtables combined modules
#
# CONFIG_NETFILTER_XT_MARK is not set
# CONFIG_NETFILTER_XT_CONNMARK is not set

#
# Xtables targets
#
# CONFIG_NETFILTER_XT_TARGET_AUDIT is not set
# CONFIG_NETFILTER_XT_TARGET_CHECKSUM is not set
# CONFIG_NETFILTER_XT_TARGET_CLASSIFY is not set
# CONFIG_NETFILTER_XT_TARGET_CONNMARK is not set
# CONFIG_NETFILTER_XT_TARGET_DSCP is not set
CONFIG_NETFILTER_XT_TARGET_HL=m
# CONFIG_NETFILTER_XT_TARGET_HMARK is not set
# CONFIG_NETFILTER_XT_TARGET_IDLETIMER is not set
# CONFIG_NETFILTER_XT_TARGET_LED is not set
# CONFIG_NETFILTER_XT_TARGET_LOG is not set
# CONFIG_NETFILTER_XT_TARGET_MARK is not set
# CONFIG_NETFILTER_XT_NAT is not set
# CONFIG_NETFILTER_XT_TARGET_NETMAP is not set
CONFIG_NETFILTER_XT_TARGET_NFLOG=y
# CONFIG_NETFILTER_XT_TARGET_NFQUEUE is not set
# CONFIG_NETFILTER_XT_TARGET_RATEEST is not set
# CONFIG_NETFILTER_XT_TARGET_REDIRECT is not set
# CONFIG_NETFILTER_XT_TARGET_MASQUERADE is not set
# CONFIG_NETFILTER_XT_TARGET_TEE is not set
# CONFIG_NETFILTER_XT_TARGET_TPROXY is not set
CONFIG_NETFILTER_XT_TARGET_SECMARK=y
CONFIG_NETFILTER_XT_TARGET_TCPMSS=y
# CONFIG_NETFILTER_XT_TARGET_TCPOPTSTRIP is not set

#
# Xtables matches
#
# CONFIG_NETFILTER_XT_MATCH_ADDRTYPE is not set
# CONFIG_NETFILTER_XT_MATCH_BPF is not set
# CONFIG_NETFILTER_XT_MATCH_CGROUP is not set
# CONFIG_NETFILTER_XT_MATCH_CLUSTER is not set
# CONFIG_NETFILTER_XT_MATCH_COMMENT is not set
# CONFIG_NETFILTER_XT_MATCH_CONNBYTES is not set
# CONFIG_NETFILTER_XT_MATCH_CONNLABEL is not set
# CONFIG_NETFILTER_XT_MATCH_CONNLIMIT is not set
# CONFIG_NETFILTER_XT_MATCH_CONNMARK is not set
CONFIG_NETFILTER_XT_MATCH_CONNTRACK=y
# CONFIG_NETFILTER_XT_MATCH_CPU is not set
# CONFIG_NETFILTER_XT_MATCH_DCCP is not set
# CONFIG_NETFILTER_XT_MATCH_DEVGROUP is not set
# CONFIG_NETFILTER_XT_MATCH_DSCP is not set
# CONFIG_NETFILTER_XT_MATCH_ECN is not set
# CONFIG_NETFILTER_XT_MATCH_ESP is not set
# CONFIG_NETFILTER_XT_MATCH_HASHLIMIT is not set
# CONFIG_NETFILTER_XT_MATCH_HELPER is not set
# CONFIG_NETFILTER_XT_MATCH_HL is not set
# CONFIG_NETFILTER_XT_MATCH_IPCOMP is not set
# CONFIG_NETFILTER_XT_MATCH_IPRANGE is not set
# CONFIG_NETFILTER_XT_MATCH_L2TP is not set
# CONFIG_NETFILTER_XT_MATCH_LENGTH is not set
# CONFIG_NETFILTER_XT_MATCH_LIMIT is not set
# CONFIG_NETFILTER_XT_MATCH_MAC is not set
# CONFIG_NETFILTER_XT_MATCH_MARK is not set
# CONFIG_NETFILTER_XT_MATCH_MULTIPORT is not set
# CONFIG_NETFILTER_XT_MATCH_NFACCT is not set
# CONFIG_NETFILTER_XT_MATCH_OSF is not set
# CONFIG_NETFILTER_XT_MATCH_OWNER is not set
CONFIG_NETFILTER_XT_MATCH_POLICY=y
# CONFIG_NETFILTER_XT_MATCH_PKTTYPE is not set
# CONFIG_NETFILTER_XT_MATCH_QUOTA is not set
# CONFIG_NETFILTER_XT_MATCH_RATEEST is not set
# CONFIG_NETFILTER_XT_MATCH_REALM is not set
# CONFIG_NETFILTER_XT_MATCH_RECENT is not set
# CONFIG_NETFILTER_XT_MATCH_SCTP is not set
# CONFIG_NETFILTER_XT_MATCH_SOCKET is not set
CONFIG_NETFILTER_XT_MATCH_STATE=y
# CONFIG_NETFILTER_XT_MATCH_STATISTIC is not set
# CONFIG_NETFILTER_XT_MATCH_STRING is not set
# CONFIG_NETFILTER_XT_MATCH_TCPMSS is not set
# CONFIG_NETFILTER_XT_MATCH_TIME is not set
# CONFIG_NETFILTER_XT_MATCH_U32 is not set
# end of Core Netfilter Configuration

# CONFIG_IP_SET is not set
# CONFIG_IP_VS is not set

#
# IP: Netfilter Configuration
#
CONFIG_NF_DEFRAG_IPV4=y
CONFIG_IP_NF_IPTABLES_LEGACY=y
# CONFIG_NF_SOCKET_IPV4 is not set
# CONFIG_NF_TPROXY_IPV4 is not set
# CONFIG_NF_DUP_IPV4 is not set
# CONFIG_NF_LOG_ARP is not set
# CONFIG_NF_LOG_IPV4 is not set
CONFIG_NF_REJECT_IPV4=y
CONFIG_IP_NF_IPTABLES=y
# CONFIG_IP_NF_MATCH_AH is not set
# CONFIG_IP_NF_MATCH_ECN is not set
# CONFIG_IP_NF_MATCH_RPFILTER is not set
# CONFIG_IP_NF_MATCH_TTL is not set
CONFIG_IP_NF_FILTER=y
CONFIG_IP_NF_TARGET_REJECT=y
# CONFIG_IP_NF_TARGET_SYNPROXY is not set
# CONFIG_IP_NF_NAT is not set
CONFIG_IP_NF_MANGLE=y
# CONFIG_IP_NF_TARGET_ECN is not set
# CONFIG_IP_NF_TARGET_TTL is not set
# CONFIG_IP_NF_RAW is not set
# CONFIG_IP_NF_SECURITY is not set
# CONFIG_IP_NF_ARPTABLES is not set
# CONFIG_IP_NF_ARPFILTER is not set
# end of IP: Netfilter Configuration

#
# IPv6: Netfilter Configuration
#
CONFIG_IP6_NF_IPTABLES_LEGACY=y
# CONFIG_NF_SOCKET_IPV6 is not set
# CONFIG_NF_TPROXY_IPV6 is not set
# CONFIG_NF_DUP_IPV6 is not set
CONFIG_NF_REJECT_IPV6=y
# CONFIG_NF_LOG_IPV6 is not set
CONFIG_IP6_NF_IPTABLES=y
# CONFIG_IP6_NF_MATCH_AH is not set
# CONFIG_IP6_NF_MATCH_EUI64 is not set
# CONFIG_IP6_NF_MATCH_FRAG is not set
# CONFIG_IP6_NF_MATCH_OPTS is not set
# CONFIG_IP6_NF_MATCH_HL is not set
CONFIG_IP6_NF_MATCH_IPV6HEADER=y
# CONFIG_IP6_NF_MATCH_MH is not set
# CONFIG_IP6_NF_MATCH_RPFILTER is not set
CONFIG_IP6_NF_MATCH_RT=m
# CONFIG_IP6_NF_MATCH_SRH is not set
CONFIG_IP6_NF_TARGET_HL=m
CONFIG_IP6_NF_FILTER=y
CONFIG_IP6_NF_TARGET_REJECT=y
# CONFIG_IP6_NF_TARGET_SYNPROXY is not set
CONFIG_IP6_NF_MANGLE=y
# CONFIG_IP6_NF_RAW is not set
# CONFIG_IP6_NF_SECURITY is not set
# CONFIG_IP6_NF_NAT is not set
# end of IPv6: Netfilter Configuration

CONFIG_NF_DEFRAG_IPV6=y
# CONFIG_NF_CONNTRACK_BRIDGE is not set
# CONFIG_IP_DCCP is not set
# CONFIG_IP_SCTP is not set
# CONFIG_RDS is not set
# CONFIG_TIPC is not set
# CONFIG_ATM is not set
# CONFIG_L2TP is not set
# CONFIG_BRIDGE is not set
# CONFIG_NET_DSA is not set
# CONFIG_VLAN_8021Q is not set
# CONFIG_LLC2 is not set
# CONFIG_ATALK is not set
# CONFIG_X25 is not set
# CONFIG_LAPB is not set
# CONFIG_PHONET is not set
# CONFIG_6LOWPAN is not set
# CONFIG_IEEE802154 is not set
CONFIG_NET_SCHED=y

#
# Queueing/Scheduling
#
# CONFIG_NET_SCH_HTB is not set
# CONFIG_NET_SCH_HFSC is not set
# CONFIG_NET_SCH_PRIO is not set
# CONFIG_NET_SCH_MULTIQ is not set
# CONFIG_NET_SCH_RED is not set
# CONFIG_NET_SCH_SFB is not set
# CONFIG_NET_SCH_SFQ is not set
# CONFIG_NET_SCH_TEQL is not set
# CONFIG_NET_SCH_TBF is not set
# CONFIG_NET_SCH_CBS is not set
# CONFIG_NET_SCH_ETF is not set
# CONFIG_NET_SCH_TAPRIO is not set
# CONFIG_NET_SCH_GRED is not set
# CONFIG_NET_SCH_NETEM is not set
# CONFIG_NET_SCH_DRR is not set
# CONFIG_NET_SCH_MQPRIO is not set
# CONFIG_NET_SCH_SKBPRIO is not set
# CONFIG_NET_SCH_CHOKE is not set
# CONFIG_NET_SCH_QFQ is not set
# CONFIG_NET_SCH_CODEL is not set
# CONFIG_NET_SCH_FQ_CODEL is not set
# CONFIG_NET_SCH_CAKE is not set
# CONFIG_NET_SCH_FQ is not set
# CONFIG_NET_SCH_HHF is not set
# CONFIG_NET_SCH_PIE is not set
# CONFIG_NET_SCH_INGRESS is not set
# CONFIG_NET_SCH_PLUG is not set
# CONFIG_NET_SCH_ETS is not set
# CONFIG_NET_SCH_DEFAULT is not set

#
# Classification
#
CONFIG_NET_CLS=y
# CONFIG_NET_CLS_BASIC is not set
# CONFIG_NET_CLS_ROUTE4 is not set
# CONFIG_NET_CLS_FW is not set
# CONFIG_NET_CLS_U32 is not set
# CONFIG_NET_CLS_FLOW is not set
# CONFIG_NET_CLS_CGROUP is not set
# CONFIG_NET_CLS_BPF is not set
# CONFIG_NET_CLS_FLOWER is not set
# CONFIG_NET_CLS_MATCHALL is not set
CONFIG_NET_EMATCH=y
CONFIG_NET_EMATCH_STACK=32
# CONFIG_NET_EMATCH_CMP is not set
# CONFIG_NET_EMATCH_NBYTE is not set
# CONFIG_NET_EMATCH_U32 is not set
# CONFIG_NET_EMATCH_META is not set
# CONFIG_NET_EMATCH_TEXT is not set
# CONFIG_NET_EMATCH_IPT is not set
CONFIG_NET_CLS_ACT=y
# CONFIG_NET_ACT_POLICE is not set
# CONFIG_NET_ACT_GACT is not set
# CONFIG_NET_ACT_MIRRED is not set
# CONFIG_NET_ACT_SAMPLE is not set
# CONFIG_NET_ACT_NAT is not set
# CONFIG_NET_ACT_PEDIT is not set
# CONFIG_NET_ACT_SIMP is not set
# CONFIG_NET_ACT_SKBEDIT is not set
# CONFIG_NET_ACT_CSUM is not set
# CONFIG_NET_ACT_MPLS is not set
# CONFIG_NET_ACT_VLAN is not set
# CONFIG_NET_ACT_BPF is not set
# CONFIG_NET_ACT_SKBMOD is not set
# CONFIG_NET_ACT_IFE is not set
# CONFIG_NET_ACT_TUNNEL_KEY is not set
# CONFIG_NET_ACT_GATE is not set
# CONFIG_NET_TC_SKB_EXT is not set
CONFIG_NET_SCH_FIFO=y
# CONFIG_DCB is not set
CONFIG_DNS_RESOLVER=y
# CONFIG_BATMAN_ADV is not set
# CONFIG_OPENVSWITCH is not set
# CONFIG_VSOCKETS is not set
# CONFIG_NETLINK_DIAG is not set
# CONFIG_MPLS is not set
# CONFIG_NET_NSH is not set
# CONFIG_HSR is not set
# CONFIG_NET_SWITCHDEV is not set
# CONFIG_NET_L3_MASTER_DEV is not set
# CONFIG_QRTR is not set
# CONFIG_NET_NCSI is not set
CONFIG_PCPU_DEV_REFCNT=y
CONFIG_MAX_SKB_FRAGS=17
CONFIG_RPS=y
CONFIG_RFS_ACCEL=y
CONFIG_SOCK_RX_QUEUE_MAPPING=y
CONFIG_XPS=y
# CONFIG_CGROUP_NET_PRIO is not set
# CONFIG_CGROUP_NET_CLASSID is not set
CONFIG_NET_RX_BUSY_POLL=y
CONFIG_BQL=y
CONFIG_NET_FLOW_LIMIT=y

#
# Network testing
#
# CONFIG_NET_PKTGEN is not set
# CONFIG_NET_DROP_MONITOR is not set
# end of Network testing
# end of Networking options

# CONFIG_HAMRADIO is not set
# CONFIG_CAN is not set
# CONFIG_BT is not set
# CONFIG_AF_RXRPC is not set
# CONFIG_AF_KCM is not set
# CONFIG_MCTP is not set
CONFIG_FIB_RULES=y
CONFIG_WIRELESS=y
CONFIG_WEXT_CORE=y
CONFIG_WEXT_PROC=y
CONFIG_CFG80211=y
# CONFIG_NL80211_TESTMODE is not set
# CONFIG_CFG80211_DEVELOPER_WARNINGS is not set
CONFIG_CFG80211_REQUIRE_SIGNED_REGDB=y
CONFIG_CFG80211_USE_KERNEL_REGDB_KEYS=y
CONFIG_CFG80211_DEFAULT_PS=y
# CONFIG_CFG80211_DEBUGFS is not set
CONFIG_CFG80211_CRDA_SUPPORT=y
CONFIG_CFG80211_WEXT=y
CONFIG_MAC80211=y
CONFIG_MAC80211_HAS_RC=y
CONFIG_MAC80211_RC_MINSTREL=y
CONFIG_MAC80211_RC_DEFAULT_MINSTREL=y
CONFIG_MAC80211_RC_DEFAULT=""minstrel_ht""
# CONFIG_MAC80211_MESH is not set
CONFIG_MAC80211_LEDS=y
# CONFIG_MAC80211_MESSAGE_TRACING is not set
# CONFIG_MAC80211_DEBUG_MENU is not set
CONFIG_MAC80211_STA_HASH_MAX_SIZE=0
CONFIG_RFKILL=y
CONFIG_RFKILL_LEDS=y
CONFIG_RFKILL_INPUT=y
# CONFIG_NET_9P is not set
# CONFIG_CAIF is not set
# CONFIG_CEPH_LIB is not set
# CONFIG_NFC is not set
# CONFIG_PSAMPLE is not set
# CONFIG_NET_IFE is not set
# CONFIG_LWTUNNEL is not set
CONFIG_DST_CACHE=y
CONFIG_GRO_CELLS=y
CONFIG_NET_SELFTESTS=y
CONFIG_NET_DEVLINK=y
CONFIG_PAGE_POOL=y
# CONFIG_PAGE_POOL_STATS is not set
# CONFIG_FAILOVER is not set
CONFIG_ETHTOOL_NETLINK=y

#
# Device Drivers
#
CONFIG_HAVE_EISA=y
# CONFIG_EISA is not set
CONFIG_HAVE_PCI=y
CONFIG_GENERIC_PCI_IOMAP=y
CONFIG_PCI=y
CONFIG_PCI_DOMAINS=y
CONFIG_PCIEPORTBUS=y
# CONFIG_HOTPLUG_PCI_PCIE is not set
# CONFIG_PCIEAER is not set
CONFIG_PCIEASPM=y
CONFIG_PCIEASPM_DEFAULT=y
# CONFIG_PCIEASPM_POWERSAVE is not set
# CONFIG_PCIEASPM_POWER_SUPERSAVE is not set
# CONFIG_PCIEASPM_PERFORMANCE is not set
CONFIG_PCIE_PME=y
# CONFIG_PCIE_PTM is not set
CONFIG_PCI_MSI=y
CONFIG_PCI_QUIRKS=y
# CONFIG_PCI_DEBUG is not set
# CONFIG_PCI_STUB is not set
CONFIG_PCI_ATS=y
CONFIG_PCI_LOCKLESS_CONFIG=y
# CONFIG_PCI_IOV is not set
# CONFIG_PCI_NPEM is not set
CONFIG_PCI_PRI=y
CONFIG_PCI_PASID=y
# CONFIG_PCIE_TPH is not set
CONFIG_PCI_LABEL=y
CONFIG_VGA_ARB=y
CONFIG_VGA_ARB_MAX_GPUS=16
CONFIG_HOTPLUG_PCI=y
# CONFIG_HOTPLUG_PCI_ACPI is not set
# CONFIG_HOTPLUG_PCI_CPCI is not set
# CONFIG_HOTPLUG_PCI_OCTEONEP is not set
# CONFIG_HOTPLUG_PCI_SHPC is not set

#
# PCI controller drivers
#
# CONFIG_VMD is not set

#
# Cadence-based PCIe controllers
#
# end of Cadence-based PCIe controllers

#
# DesignWare-based PCIe controllers
#
# CONFIG_PCI_MESON is not set
# CONFIG_PCIE_DW_PLAT_HOST is not set
# end of DesignWare-based PCIe controllers

#
# Mobiveil-based PCIe controllers
#
# end of Mobiveil-based PCIe controllers

#
# PLDA-based PCIe controllers
#
# end of PLDA-based PCIe controllers
# end of PCI controller drivers

#
# PCI Endpoint
#
# CONFIG_PCI_ENDPOINT is not set
# end of PCI Endpoint

#
# PCI switch controller drivers
#
# CONFIG_PCI_SW_SWITCHTEC is not set
# end of PCI switch controller drivers

# CONFIG_CXL_BUS is not set
# CONFIG_PCCARD is not set
# CONFIG_RAPIDIO is not set

#
# Generic Driver Options
#
CONFIG_AUXILIARY_BUS=y
# CONFIG_UEVENT_HELPER is not set
CONFIG_DEVTMPFS=y
CONFIG_DEVTMPFS_MOUNT=y
# CONFIG_DEVTMPFS_SAFE is not set
CONFIG_STANDALONE=y
CONFIG_PREVENT_FIRMWARE_BUILD=y

#
# Firmware loader
#
CONFIG_FW_LOADER=y
CONFIG_EXTRA_FIRMWARE=""i915/skl_dmc_ver1_27.bin""
CONFIG_EXTRA_FIRMWARE_DIR=""/lib/firmware""
# CONFIG_FW_LOADER_USER_HELPER is not set
# CONFIG_FW_LOADER_COMPRESS is not set
CONFIG_FW_CACHE=y
# CONFIG_FW_UPLOAD is not set
# end of Firmware loader

CONFIG_WANT_DEV_COREDUMP=y
CONFIG_ALLOW_DEV_COREDUMP=y
CONFIG_DEV_COREDUMP=y
# CONFIG_DEBUG_DRIVER is not set
CONFIG_DEBUG_DEVRES=y
# CONFIG_DEBUG_TEST_DRIVER_REMOVE is not set
# CONFIG_TEST_ASYNC_DRIVER_PROBE is not set
CONFIG_GENERIC_CPU_DEVICES=y
CONFIG_GENERIC_CPU_AUTOPROBE=y
CONFIG_GENERIC_CPU_VULNERABILITIES=y
CONFIG_REGMAP=y
CONFIG_DMA_SHARED_BUFFER=y
# CONFIG_DMA_FENCE_TRACE is not set
# CONFIG_FW_DEVLINK_SYNC_STATE_TIMEOUT is not set
# end of Generic Driver Options

#
# Bus devices
#
# CONFIG_MHI_BUS is not set
# CONFIG_MHI_BUS_EP is not set
# end of Bus devices

#
# Cache Drivers
#
# end of Cache Drivers

CONFIG_CONNECTOR=y
CONFIG_PROC_EVENTS=y

#
# Firmware Drivers
#

#
# ARM System Control and Management Interface Protocol
#
# end of ARM System Control and Management Interface Protocol

# CONFIG_EDD is not set
CONFIG_FIRMWARE_MEMMAP=y
CONFIG_DMIID=y
# CONFIG_DMI_SYSFS is not set
CONFIG_DMI_SCAN_MACHINE_NON_EFI_FALLBACK=y
# CONFIG_FW_CFG_SYSFS is not set
CONFIG_SYSFB=y
# CONFIG_SYSFB_SIMPLEFB is not set
# CONFIG_GOOGLE_FIRMWARE is not set

#
# EFI (Extensible Firmware Interface) Support
#
CONFIG_EFI_ESRT=y
CONFIG_EFI_DXE_MEM_ATTRIBUTES=y
CONFIG_EFI_RUNTIME_WRAPPERS=y
# CONFIG_EFI_BOOTLOADER_CONTROL is not set
# CONFIG_EFI_CAPSULE_LOADER is not set
# CONFIG_EFI_TEST is not set
# CONFIG_APPLE_PROPERTIES is not set
# CONFIG_RESET_ATTACK_MITIGATION is not set
# CONFIG_EFI_RCI2_TABLE is not set
# CONFIG_EFI_DISABLE_PCI_DMA is not set
CONFIG_EFI_EARLYCON=y
CONFIG_EFI_CUSTOM_SSDT_OVERLAYS=y
# CONFIG_EFI_DISABLE_RUNTIME is not set
# CONFIG_EFI_COCO_SECRET is not set
CONFIG_UNACCEPTED_MEMORY=y
# end of EFI (Extensible Firmware Interface) Support

#
# Qualcomm firmware drivers
#
# end of Qualcomm firmware drivers

#
# Tegra firmware driver
#
# end of Tegra firmware driver
# end of Firmware Drivers

# CONFIG_GNSS is not set
# CONFIG_MTD is not set
# CONFIG_OF is not set
CONFIG_ARCH_MIGHT_HAVE_PC_PARPORT=y
# CONFIG_PARPORT is not set
CONFIG_PNP=y
CONFIG_PNP_DEBUG_MESSAGES=y

#
# Protocols
#
CONFIG_PNPACPI=y
CONFIG_BLK_DEV=y
# CONFIG_BLK_DEV_NULL_BLK is not set
# CONFIG_BLK_DEV_FD is not set
CONFIG_CDROM=y
# CONFIG_BLK_DEV_PCIESSD_MTIP32XX is not set
# CONFIG_ZRAM is not set
CONFIG_BLK_DEV_LOOP=y
CONFIG_BLK_DEV_LOOP_MIN_COUNT=8
# CONFIG_BLK_DEV_DRBD is not set
# CONFIG_BLK_DEV_NBD is not set
# CONFIG_BLK_DEV_RAM is not set
# CONFIG_CDROM_PKTCDVD is not set
# CONFIG_ATA_OVER_ETH is not set
# CONFIG_BLK_DEV_RBD is not set
# CONFIG_BLK_DEV_UBLK is not set

#
# NVME Support
#
# CONFIG_BLK_DEV_NVME is not set
# CONFIG_NVME_FC is not set
# CONFIG_NVME_TCP is not set
# end of NVME Support

#
# Misc devices
#
# CONFIG_AD525X_DPOT is not set
# CONFIG_DUMMY_IRQ is not set
# CONFIG_IBM_ASM is not set
# CONFIG_PHANTOM is not set
# CONFIG_TIFM_CORE is not set
# CONFIG_ICS932S401 is not set
# CONFIG_ENCLOSURE_SERVICES is not set
# CONFIG_HP_ILO is not set
# CONFIG_APDS9802ALS is not set
# CONFIG_ISL29003 is not set
# CONFIG_ISL29020 is not set
# CONFIG_SENSORS_TSL2550 is not set
# CONFIG_SENSORS_BH1770 is not set
# CONFIG_SENSORS_APDS990X is not set
# CONFIG_HMC6352 is not set
# CONFIG_DS1682 is not set
# CONFIG_SRAM is not set
# CONFIG_DW_XDATA_PCIE is not set
# CONFIG_PCI_ENDPOINT_TEST is not set
# CONFIG_XILINX_SDFEC is not set
# CONFIG_NTSYNC is not set
# CONFIG_MCHP_LAN966X_PCI is not set
# CONFIG_C2PORT is not set

#
# EEPROM support
#
# CONFIG_EEPROM_AT24 is not set
# CONFIG_EEPROM_MAX6875 is not set
CONFIG_EEPROM_93CX6=y
# CONFIG_EEPROM_IDT_89HPESX is not set
# CONFIG_EEPROM_EE1004 is not set
# end of EEPROM support

# CONFIG_CB710_CORE is not set
# CONFIG_SENSORS_LIS3_I2C is not set
# CONFIG_ALTERA_STAPL is not set
# CONFIG_INTEL_MEI is not set
# CONFIG_VMWARE_VMCI is not set
# CONFIG_GENWQE is not set
# CONFIG_ECHO is not set
# CONFIG_BCM_VK is not set
# CONFIG_MISC_ALCOR_PCI is not set
# CONFIG_MISC_RTSX_PCI is not set
# CONFIG_MISC_RTSX_USB is not set
# CONFIG_UACCE is not set
# CONFIG_PVPANIC is not set
# CONFIG_KEBA_CP500 is not set
# end of Misc devices

#
# SCSI device support
#
CONFIG_SCSI_MOD=y
# CONFIG_RAID_ATTRS is not set
CONFIG_SCSI_COMMON=y
CONFIG_SCSI=y
CONFIG_SCSI_DMA=y
CONFIG_SCSI_PROC_FS=y

#
# SCSI support type (disk, tape, CD-ROM)
#
CONFIG_BLK_DEV_SD=y
# CONFIG_CHR_DEV_ST is not set
CONFIG_BLK_DEV_SR=y
CONFIG_CHR_DEV_SG=y
CONFIG_BLK_DEV_BSG=y
# CONFIG_CHR_DEV_SCH is not set
CONFIG_SCSI_CONSTANTS=y
# CONFIG_SCSI_LOGGING is not set
# CONFIG_SCSI_SCAN_ASYNC is not set

#
# SCSI Transports
#
CONFIG_SCSI_SPI_ATTRS=y
# CONFIG_SCSI_FC_ATTRS is not set
# CONFIG_SCSI_ISCSI_ATTRS is not set
# CONFIG_SCSI_SAS_ATTRS is not set
# CONFIG_SCSI_SAS_LIBSAS is not set
# CONFIG_SCSI_SRP_ATTRS is not set
# end of SCSI Transports

# CONFIG_SCSI_LOWLEVEL is not set
# CONFIG_SCSI_DH is not set
# CONFIG_VHBA is not set
# end of SCSI device support

CONFIG_ATA=y
CONFIG_SATA_HOST=y
CONFIG_PATA_TIMINGS=y
CONFIG_ATA_VERBOSE_ERROR=y
CONFIG_ATA_FORCE=y
CONFIG_ATA_ACPI=y
# CONFIG_SATA_ZPODD is not set
CONFIG_SATA_PMP=y

#
# Controllers with non-SFF native interface
#
CONFIG_SATA_AHCI=y
CONFIG_SATA_MOBILE_LPM_POLICY=0
# CONFIG_SATA_AHCI_PLATFORM is not set
# CONFIG_AHCI_DWC is not set
# CONFIG_SATA_INIC162X is not set
# CONFIG_SATA_ACARD_AHCI is not set
# CONFIG_SATA_SIL24 is not set
CONFIG_ATA_SFF=y

#
# SFF controllers with custom DMA interface
#
# CONFIG_PDC_ADMA is not set
# CONFIG_SATA_QSTOR is not set
# CONFIG_SATA_SX4 is not set
CONFIG_ATA_BMDMA=y

#
# SATA SFF controllers with BMDMA
#
CONFIG_ATA_PIIX=y
# CONFIG_SATA_DWC is not set
# CONFIG_SATA_MV is not set
# CONFIG_SATA_NV is not set
# CONFIG_SATA_PROMISE is not set
# CONFIG_SATA_SIL is not set
# CONFIG_SATA_SIS is not set
# CONFIG_SATA_SVW is not set
# CONFIG_SATA_ULI is not set
# CONFIG_SATA_VIA is not set
# CONFIG_SATA_VITESSE is not set

#
# PATA SFF controllers with BMDMA
#
# CONFIG_PATA_ALI is not set
CONFIG_PATA_AMD=y
# CONFIG_PATA_ARTOP is not set
# CONFIG_PATA_ATIIXP is not set
# CONFIG_PATA_ATP867X is not set
# CONFIG_PATA_CMD64X is not set
# CONFIG_PATA_CYPRESS is not set
# CONFIG_PATA_EFAR is not set
# CONFIG_PATA_HPT366 is not set
# CONFIG_PATA_HPT37X is not set
# CONFIG_PATA_HPT3X2N is not set
# CONFIG_PATA_HPT3X3 is not set
# CONFIG_PATA_IT8213 is not set
# CONFIG_PATA_IT821X is not set
# CONFIG_PATA_JMICRON is not set
# CONFIG_PATA_MARVELL is not set
# CONFIG_PATA_NETCELL is not set
# CONFIG_PATA_NINJA32 is not set
# CONFIG_PATA_NS87415 is not set
CONFIG_PATA_OLDPIIX=y
# CONFIG_PATA_OPTIDMA is not set
# CONFIG_PATA_PDC2027X is not set
# CONFIG_PATA_PDC_OLD is not set
# CONFIG_PATA_RADISYS is not set
# CONFIG_PATA_RDC is not set
CONFIG_PATA_SCH=y
# CONFIG_PATA_SERVERWORKS is not set
# CONFIG_PATA_SIL680 is not set
# CONFIG_PATA_SIS is not set
# CONFIG_PATA_TOSHIBA is not set
# CONFIG_PATA_TRIFLEX is not set
# CONFIG_PATA_VIA is not set
# CONFIG_PATA_WINBOND is not set

#
# PIO-only SFF controllers
#
# CONFIG_PATA_CMD640_PCI is not set
# CONFIG_PATA_MPIIX is not set
# CONFIG_PATA_NS87410 is not set
# CONFIG_PATA_OPTI is not set
# CONFIG_PATA_RZ1000 is not set

#
# Generic fallback / legacy drivers
#
# CONFIG_PATA_ACPI is not set
# CONFIG_ATA_GENERIC is not set
# CONFIG_PATA_LEGACY is not set
CONFIG_MD=y
# CONFIG_BLK_DEV_MD is not set
CONFIG_MD_BITMAP_FILE=y
# CONFIG_BCACHE is not set
CONFIG_BLK_DEV_DM_BUILTIN=y
CONFIG_BLK_DEV_DM=y
# CONFIG_DM_DEBUG is not set
# CONFIG_DM_UNSTRIPED is not set
CONFIG_DM_CRYPT=y
# CONFIG_DM_SNAPSHOT is not set
# CONFIG_DM_THIN_PROVISIONING is not set
# CONFIG_DM_CACHE is not set
# CONFIG_DM_WRITECACHE is not set
# CONFIG_DM_EBS is not set
# CONFIG_DM_ERA is not set
# CONFIG_DM_CLONE is not set
CONFIG_DM_MIRROR=y
# CONFIG_DM_LOG_USERSPACE is not set
# CONFIG_DM_RAID is not set
CONFIG_DM_ZERO=y
# CONFIG_DM_MULTIPATH is not set
# CONFIG_DM_DELAY is not set
# CONFIG_DM_DUST is not set
# CONFIG_DM_INIT is not set
# CONFIG_DM_UEVENT is not set
# CONFIG_DM_FLAKEY is not set
# CONFIG_DM_VERITY is not set
# CONFIG_DM_SWITCH is not set
# CONFIG_DM_LOG_WRITES is not set
# CONFIG_DM_INTEGRITY is not set
# CONFIG_DM_AUDIT is not set
# CONFIG_DM_VDO is not set
# CONFIG_TARGET_CORE is not set
# CONFIG_FUSION is not set

#
# IEEE 1394 (FireWire) support
#
# CONFIG_FIREWIRE is not set
# CONFIG_FIREWIRE_NOSY is not set
# end of IEEE 1394 (FireWire) support

# CONFIG_MACINTOSH_DRIVERS is not set
CONFIG_NETDEVICES=y
CONFIG_NET_CORE=y
# CONFIG_BONDING is not set
# CONFIG_DUMMY is not set
# CONFIG_WIREGUARD is not set
# CONFIG_EQUALIZER is not set
# CONFIG_NET_FC is not set
# CONFIG_NET_TEAM is not set
# CONFIG_MACVLAN is not set
# CONFIG_IPVLAN is not set
# CONFIG_VXLAN is not set
# CONFIG_GENEVE is not set
# CONFIG_BAREUDP is not set
# CONFIG_GTP is not set
# CONFIG_PFCP is not set
# CONFIG_AMT is not set
CONFIG_MACSEC=y
CONFIG_NETCONSOLE=y
# CONFIG_NETCONSOLE_EXTENDED_LOG is not set
CONFIG_NETPOLL=y
CONFIG_NET_POLL_CONTROLLER=y
CONFIG_TUN=y
# CONFIG_TUN_VNET_CROSS_LE is not set
# CONFIG_VETH is not set
# CONFIG_NLMON is not set
# CONFIG_ARCNET is not set
CONFIG_ETHERNET=y
# CONFIG_NET_VENDOR_3COM is not set
# CONFIG_NET_VENDOR_ADAPTEC is not set
# CONFIG_NET_VENDOR_AGERE is not set
# CONFIG_NET_VENDOR_ALACRITECH is not set
# CONFIG_NET_VENDOR_ALTEON is not set
# CONFIG_ALTERA_TSE is not set
# CONFIG_NET_VENDOR_AMAZON is not set
# CONFIG_NET_VENDOR_AMD is not set
# CONFIG_NET_VENDOR_AQUANTIA is not set
# CONFIG_NET_VENDOR_ARC is not set
# CONFIG_NET_VENDOR_ASIX is not set
# CONFIG_NET_VENDOR_ATHEROS is not set
# CONFIG_CX_ECAT is not set
# CONFIG_NET_VENDOR_BROADCOM is not set
# CONFIG_NET_VENDOR_CADENCE is not set
# CONFIG_NET_VENDOR_CAVIUM is not set
# CONFIG_NET_VENDOR_CHELSIO is not set
# CONFIG_NET_VENDOR_CISCO is not set
# CONFIG_NET_VENDOR_CORTINA is not set
# CONFIG_NET_VENDOR_DAVICOM is not set
# CONFIG_DNET is not set
# CONFIG_NET_VENDOR_DEC is not set
# CONFIG_NET_VENDOR_DLINK is not set
# CONFIG_NET_VENDOR_EMULEX is not set
# CONFIG_NET_VENDOR_ENGLEDER is not set
# CONFIG_NET_VENDOR_EZCHIP is not set
# CONFIG_NET_VENDOR_FUNGIBLE is not set
# CONFIG_NET_VENDOR_GOOGLE is not set
CONFIG_NET_VENDOR_HISILICON=y
# CONFIG_HIBMCGE is not set
# CONFIG_NET_VENDOR_HUAWEI is not set
CONFIG_NET_VENDOR_I825XX=y
CONFIG_NET_VENDOR_INTEL=y
CONFIG_LIBETH=y
CONFIG_LIBIE=y
# CONFIG_E100 is not set
CONFIG_E1000=y
# CONFIG_E1000E is not set
# CONFIG_IGB is not set
# CONFIG_IGBVF is not set
# CONFIG_IXGBE is not set
# CONFIG_IXGBEVF is not set
# CONFIG_I40E is not set
# CONFIG_I40EVF is not set
CONFIG_ICE=y
CONFIG_ICE_HWMON=y
CONFIG_ICE_HWTS=y
# CONFIG_FM10K is not set
# CONFIG_IGC is not set
CONFIG_IDPF=y
CONFIG_IDPF_SINGLEQ=y
# CONFIG_JME is not set
# CONFIG_NET_VENDOR_LITEX is not set
# CONFIG_NET_VENDOR_MARVELL is not set
# CONFIG_NET_VENDOR_MELLANOX is not set
CONFIG_NET_VENDOR_META=y
# CONFIG_FBNIC is not set
# CONFIG_NET_VENDOR_MICREL is not set
# CONFIG_NET_VENDOR_MICROCHIP is not set
# CONFIG_NET_VENDOR_MICROSEMI is not set
# CONFIG_NET_VENDOR_MICROSOFT is not set
# CONFIG_NET_VENDOR_MYRI is not set
# CONFIG_FEALNX is not set
# CONFIG_NET_VENDOR_NI is not set
# CONFIG_NET_VENDOR_NATSEMI is not set
# CONFIG_NET_VENDOR_NETERION is not set
# CONFIG_NET_VENDOR_NETRONOME is not set
# CONFIG_NET_VENDOR_NVIDIA is not set
# CONFIG_NET_VENDOR_OKI is not set
# CONFIG_ETHOC is not set
# CONFIG_NET_VENDOR_PACKET_ENGINES is not set
# CONFIG_NET_VENDOR_PENSANDO is not set
# CONFIG_NET_VENDOR_QLOGIC is not set
# CONFIG_NET_VENDOR_BROCADE is not set
# CONFIG_NET_VENDOR_QUALCOMM is not set
# CONFIG_NET_VENDOR_RDC is not set
# CONFIG_NET_VENDOR_REALTEK is not set
# CONFIG_NET_VENDOR_RENESAS is not set
# CONFIG_NET_VENDOR_ROCKER is not set
# CONFIG_NET_VENDOR_SAMSUNG is not set
# CONFIG_NET_VENDOR_SEEQ is not set
# CONFIG_NET_VENDOR_SILAN is not set
# CONFIG_NET_VENDOR_SIS is not set
# CONFIG_NET_VENDOR_SOLARFLARE is not set
# CONFIG_NET_VENDOR_SMSC is not set
# CONFIG_NET_VENDOR_SOCIONEXT is not set
# CONFIG_NET_VENDOR_STMICRO is not set
# CONFIG_NET_VENDOR_SUN is not set
# CONFIG_NET_VENDOR_SYNOPSYS is not set
# CONFIG_NET_VENDOR_TEHUTI is not set
# CONFIG_NET_VENDOR_TI is not set
# CONFIG_NET_VENDOR_VERTEXCOM is not set
# CONFIG_NET_VENDOR_VIA is not set
# CONFIG_NET_VENDOR_WANGXUN is not set
# CONFIG_NET_VENDOR_WIZNET is not set
# CONFIG_NET_VENDOR_XILINX is not set
# CONFIG_FDDI is not set
# CONFIG_HIPPI is not set
CONFIG_PHYLIB=y
CONFIG_SWPHY=y
# CONFIG_LED_TRIGGER_PHY is not set
CONFIG_FIXED_PHY=y

#
# MII PHY device drivers
#
# CONFIG_AIR_EN8811H_PHY is not set
# CONFIG_AMD_PHY is not set
# CONFIG_ADIN_PHY is not set
# CONFIG_ADIN1100_PHY is not set
# CONFIG_AQUANTIA_PHY is not set
# CONFIG_AX88796B_PHY is not set
# CONFIG_BROADCOM_PHY is not set
# CONFIG_BCM54140_PHY is not set
# CONFIG_BCM7XXX_PHY is not set
# CONFIG_BCM84881_PHY is not set
# CONFIG_BCM87XX_PHY is not set
# CONFIG_CICADA_PHY is not set
# CONFIG_CORTINA_PHY is not set
# CONFIG_DAVICOM_PHY is not set
# CONFIG_ICPLUS_PHY is not set
# CONFIG_LXT_PHY is not set
# CONFIG_INTEL_XWAY_PHY is not set
# CONFIG_LSI_ET1011C_PHY is not set
# CONFIG_MARVELL_PHY is not set
# CONFIG_MARVELL_10G_PHY is not set
# CONFIG_MARVELL_88Q2XXX_PHY is not set
# CONFIG_MARVELL_88X2222_PHY is not set
# CONFIG_MAXLINEAR_GPHY is not set
# CONFIG_MEDIATEK_GE_PHY is not set
# CONFIG_MICREL_PHY is not set
# CONFIG_MICROCHIP_T1S_PHY is not set
# CONFIG_MICROCHIP_PHY is not set
# CONFIG_MICROCHIP_T1_PHY is not set
# CONFIG_MICROSEMI_PHY is not set
# CONFIG_MOTORCOMM_PHY is not set
# CONFIG_NATIONAL_PHY is not set
# CONFIG_NXP_CBTX_PHY is not set
# CONFIG_NXP_C45_TJA11XX_PHY is not set
# CONFIG_NXP_TJA11XX_PHY is not set
# CONFIG_NCN26000_PHY is not set
# CONFIG_QCA83XX_PHY is not set
# CONFIG_QCA808X_PHY is not set
# CONFIG_QSEMI_PHY is not set
CONFIG_REALTEK_PHY=y
# CONFIG_RENESAS_PHY is not set
# CONFIG_ROCKCHIP_PHY is not set
# CONFIG_SMSC_PHY is not set
# CONFIG_STE10XP is not set
# CONFIG_TERANETICS_PHY is not set
# CONFIG_DP83822_PHY is not set
# CONFIG_DP83TC811_PHY is not set
# CONFIG_DP83848_PHY is not set
# CONFIG_DP83867_PHY is not set
# CONFIG_DP83869_PHY is not set
# CONFIG_DP83TD510_PHY is not set
# CONFIG_DP83TG720_PHY is not set
# CONFIG_VITESSE_PHY is not set
# CONFIG_XILINX_GMII2RGMII is not set
CONFIG_MDIO_DEVICE=y
CONFIG_MDIO_BUS=y
CONFIG_FWNODE_MDIO=y
CONFIG_ACPI_MDIO=y
CONFIG_MDIO_DEVRES=y
# CONFIG_MDIO_BITBANG is not set
# CONFIG_MDIO_BCM_UNIMAC is not set
# CONFIG_MDIO_MVUSB is not set
# CONFIG_MDIO_THUNDER is not set

#
# MDIO Multiplexers
#

#
# PCS device drivers
#
# CONFIG_PCS_XPCS is not set
# end of PCS device drivers

CONFIG_PPP=y
# CONFIG_PPP_BSDCOMP is not set
# CONFIG_PPP_DEFLATE is not set
# CONFIG_PPP_FILTER is not set
# CONFIG_PPP_MPPE is not set
CONFIG_PPP_MULTILINK=y
CONFIG_PPPOE=y
# CONFIG_PPPOE_HASH_BITS_1 is not set
# CONFIG_PPPOE_HASH_BITS_2 is not set
CONFIG_PPPOE_HASH_BITS_4=y
# CONFIG_PPPOE_HASH_BITS_8 is not set
CONFIG_PPPOE_HASH_BITS=4
# CONFIG_PPP_ASYNC is not set
# CONFIG_PPP_SYNC_TTY is not set
# CONFIG_SLIP is not set
CONFIG_SLHC=y
# CONFIG_USB_NET_DRIVERS is not set
CONFIG_WLAN=y
# CONFIG_WLAN_VENDOR_ADMTEK is not set
# CONFIG_WLAN_VENDOR_ATH is not set
# CONFIG_WLAN_VENDOR_ATMEL is not set
# CONFIG_WLAN_VENDOR_BROADCOM is not set
CONFIG_WLAN_VENDOR_INTEL=y
# CONFIG_IPW2100 is not set
# CONFIG_IPW2200 is not set
# CONFIG_IWL4965 is not set
# CONFIG_IWL3945 is not set
CONFIG_IWLWIFI=m
CONFIG_IWLWIFI_LEDS=y
CONFIG_IWLDVM=m
CONFIG_IWLMVM=m
CONFIG_IWLWIFI_OPMODE_MODULAR=y

#
# Debugging Options
#
# CONFIG_IWLWIFI_DEBUG is not set
CONFIG_IWLWIFI_DEVICE_TRACING=y
# end of Debugging Options

# CONFIG_WLAN_VENDOR_INTERSIL is not set
# CONFIG_WLAN_VENDOR_MARVELL is not set
# CONFIG_WLAN_VENDOR_MEDIATEK is not set
# CONFIG_WLAN_VENDOR_MICROCHIP is not set
# CONFIG_WLAN_VENDOR_PURELIFI is not set
# CONFIG_WLAN_VENDOR_RALINK is not set
# CONFIG_WLAN_VENDOR_REALTEK is not set
# CONFIG_WLAN_VENDOR_RSI is not set
# CONFIG_WLAN_VENDOR_SILABS is not set
# CONFIG_WLAN_VENDOR_ST is not set
# CONFIG_WLAN_VENDOR_TI is not set
# CONFIG_WLAN_VENDOR_ZYDAS is not set
# CONFIG_WLAN_VENDOR_QUANTENNA is not set
# CONFIG_MAC80211_HWSIM is not set
# CONFIG_VIRT_WIFI is not set
# CONFIG_WAN is not set

#
# Wireless WAN
#
# CONFIG_WWAN is not set
# end of Wireless WAN

# CONFIG_VMXNET3 is not set
# CONFIG_FUJITSU_ES is not set
# CONFIG_NETDEVSIM is not set
# CONFIG_NET_FAILOVER is not set
# CONFIG_ISDN is not set

#
# Input device support
#
CONFIG_INPUT=y
CONFIG_INPUT_LEDS=m
CONFIG_INPUT_FF_MEMLESS=y
CONFIG_INPUT_SPARSEKMAP=m
# CONFIG_INPUT_MATRIXKMAP is not set
CONFIG_INPUT_VIVALDIFMAP=y

#
# Userland interfaces
#
CONFIG_INPUT_MOUSEDEV=m
# CONFIG_INPUT_MOUSEDEV_PSAUX is not set
CONFIG_INPUT_MOUSEDEV_SCREEN_X=1024
CONFIG_INPUT_MOUSEDEV_SCREEN_Y=768
CONFIG_INPUT_JOYDEV=m
CONFIG_INPUT_EVDEV=y
# CONFIG_INPUT_EVBUG is not set

#
# Input Device Drivers
#
CONFIG_INPUT_KEYBOARD=y
# CONFIG_KEYBOARD_ADP5588 is not set
# CONFIG_KEYBOARD_ADP5589 is not set
CONFIG_KEYBOARD_ATKBD=y
# CONFIG_KEYBOARD_QT1050 is not set
# CONFIG_KEYBOARD_QT1070 is not set
# CONFIG_KEYBOARD_QT2160 is not set
# CONFIG_KEYBOARD_DLINK_DIR685 is not set
# CONFIG_KEYBOARD_LKKBD is not set
# CONFIG_KEYBOARD_TCA6416 is not set
# CONFIG_KEYBOARD_TCA8418 is not set
# CONFIG_KEYBOARD_LM8323 is not set
# CONFIG_KEYBOARD_LM8333 is not set
# CONFIG_KEYBOARD_MAX7359 is not set
# CONFIG_KEYBOARD_MPR121 is not set
# CONFIG_KEYBOARD_NEWTON is not set
# CONFIG_KEYBOARD_OPENCORES is not set
# CONFIG_KEYBOARD_SAMSUNG is not set
# CONFIG_KEYBOARD_STOWAWAY is not set
# CONFIG_KEYBOARD_SUNKBD is not set
# CONFIG_KEYBOARD_TM2_TOUCHKEY is not set
# CONFIG_KEYBOARD_XTKBD is not set
# CONFIG_KEYBOARD_CYPRESS_SF is not set
CONFIG_INPUT_MOUSE=y
CONFIG_MOUSE_PS2=y
CONFIG_MOUSE_PS2_ALPS=y
CONFIG_MOUSE_PS2_BYD=y
CONFIG_MOUSE_PS2_LOGIPS2PP=y
CONFIG_MOUSE_PS2_SYNAPTICS=y
CONFIG_MOUSE_PS2_SYNAPTICS_SMBUS=y
CONFIG_MOUSE_PS2_CYPRESS=y
CONFIG_MOUSE_PS2_LIFEBOOK=y
CONFIG_MOUSE_PS2_TRACKPOINT=y
# CONFIG_MOUSE_PS2_ELANTECH is not set
# CONFIG_MOUSE_PS2_SENTELIC is not set
# CONFIG_MOUSE_PS2_TOUCHKIT is not set
CONFIG_MOUSE_PS2_FOCALTECH=y
CONFIG_MOUSE_PS2_SMBUS=y
# CONFIG_MOUSE_SERIAL is not set
# CONFIG_MOUSE_APPLETOUCH is not set
# CONFIG_MOUSE_BCM5974 is not set
# CONFIG_MOUSE_CYAPA is not set
# CONFIG_MOUSE_ELAN_I2C is not set
# CONFIG_MOUSE_VSXXXAA is not set
# CONFIG_MOUSE_SYNAPTICS_I2C is not set
# CONFIG_MOUSE_SYNAPTICS_USB is not set
CONFIG_INPUT_JOYSTICK=y
# CONFIG_JOYSTICK_ANALOG is not set
# CONFIG_JOYSTICK_A3D is not set
# CONFIG_JOYSTICK_ADI is not set
# CONFIG_JOYSTICK_COBRA is not set
# CONFIG_JOYSTICK_GF2K is not set
# CONFIG_JOYSTICK_GRIP is not set
# CONFIG_JOYSTICK_GRIP_MP is not set
# CONFIG_JOYSTICK_GUILLEMOT is not set
# CONFIG_JOYSTICK_INTERACT is not set
# CONFIG_JOYSTICK_SIDEWINDER is not set
# CONFIG_JOYSTICK_TMDC is not set
# CONFIG_JOYSTICK_IFORCE is not set
# CONFIG_JOYSTICK_WARRIOR is not set
# CONFIG_JOYSTICK_MAGELLAN is not set
# CONFIG_JOYSTICK_SPACEORB is not set
# CONFIG_JOYSTICK_SPACEBALL is not set
# CONFIG_JOYSTICK_STINGER is not set
# CONFIG_JOYSTICK_TWIDJOY is not set
# CONFIG_JOYSTICK_ZHENHUA is not set
# CONFIG_JOYSTICK_AS5011 is not set
# CONFIG_JOYSTICK_JOYDUMP is not set
CONFIG_JOYSTICK_XPAD=m
CONFIG_JOYSTICK_XPAD_FF=y
CONFIG_JOYSTICK_XPAD_LEDS=y
# CONFIG_JOYSTICK_PXRC is not set
# CONFIG_JOYSTICK_QWIIC is not set
# CONFIG_JOYSTICK_FSIA6B is not set
# CONFIG_JOYSTICK_SENSEHAT is not set
# CONFIG_JOYSTICK_SEESAW is not set
# CONFIG_INPUT_TABLET is not set
# CONFIG_INPUT_TOUCHSCREEN is not set
CONFIG_INPUT_MISC=y
# CONFIG_INPUT_AD714X is not set
# CONFIG_INPUT_BMA150 is not set
# CONFIG_INPUT_E3X0_BUTTON is not set
# CONFIG_INPUT_PCSPKR is not set
# CONFIG_INPUT_MMA8450 is not set
# CONFIG_INPUT_APANEL is not set
# CONFIG_INPUT_ATLAS_BTNS is not set
# CONFIG_INPUT_ATI_REMOTE2 is not set
# CONFIG_INPUT_KEYSPAN_REMOTE is not set
# CONFIG_INPUT_KXTJ9 is not set
# CONFIG_INPUT_POWERMATE is not set
# CONFIG_INPUT_YEALINK is not set
# CONFIG_INPUT_CM109 is not set
CONFIG_INPUT_UINPUT=m
# CONFIG_INPUT_PCF8574 is not set
# CONFIG_INPUT_DA7280_HAPTICS is not set
# CONFIG_INPUT_ADXL34X is not set
# CONFIG_INPUT_IMS_PCU is not set
# CONFIG_INPUT_IQS269A is not set
# CONFIG_INPUT_IQS626A is not set
# CONFIG_INPUT_IQS7222 is not set
# CONFIG_INPUT_CMA3000 is not set
# CONFIG_INPUT_IDEAPAD_SLIDEBAR is not set
# CONFIG_INPUT_DRV2665_HAPTICS is not set
# CONFIG_INPUT_DRV2667_HAPTICS is not set
# CONFIG_RMI4_CORE is not set

#
# Hardware I/O ports
#
CONFIG_SERIO=y
CONFIG_ARCH_MIGHT_HAVE_PC_SERIO=y
CONFIG_SERIO_I8042=y
CONFIG_SERIO_SERPORT=y
# CONFIG_SERIO_CT82C710 is not set
# CONFIG_SERIO_PCIPS2 is not set
CONFIG_SERIO_LIBPS2=y
# CONFIG_SERIO_RAW is not set
# CONFIG_SERIO_ALTERA_PS2 is not set
# CONFIG_SERIO_PS2MULT is not set
# CONFIG_SERIO_ARC_PS2 is not set
# CONFIG_USERIO is not set
# CONFIG_GAMEPORT is not set
# end of Hardware I/O ports
# end of Input device support

#
# Character devices
#
CONFIG_TTY=y
CONFIG_VT=y
CONFIG_CONSOLE_TRANSLATIONS=y
CONFIG_VT_CONSOLE=y
CONFIG_VT_CONSOLE_SLEEP=y
CONFIG_VT_HW_CONSOLE_BINDING=y
CONFIG_UNIX98_PTYS=y
# CONFIG_LEGACY_PTYS is not set
CONFIG_LEGACY_TIOCSTI=y
CONFIG_LDISC_AUTOLOAD=y

#
# Serial drivers
#
CONFIG_SERIAL_EARLYCON=y
CONFIG_SERIAL_8250=y
CONFIG_SERIAL_8250_DEPRECATED_OPTIONS=y
CONFIG_SERIAL_8250_PNP=y
# CONFIG_SERIAL_8250_16550A_VARIANTS is not set
# CONFIG_SERIAL_8250_FINTEK is not set
CONFIG_SERIAL_8250_CONSOLE=y
CONFIG_SERIAL_8250_DMA=y
CONFIG_SERIAL_8250_PCILIB=y
CONFIG_SERIAL_8250_PCI=y
CONFIG_SERIAL_8250_EXAR=y
CONFIG_SERIAL_8250_NR_UARTS=32
CONFIG_SERIAL_8250_RUNTIME_UARTS=4
CONFIG_SERIAL_8250_EXTENDED=y
CONFIG_SERIAL_8250_MANY_PORTS=y
# CONFIG_SERIAL_8250_PCI1XXXX is not set
CONFIG_SERIAL_8250_SHARE_IRQ=y
CONFIG_SERIAL_8250_DETECT_IRQ=y
CONFIG_SERIAL_8250_RSA=y
CONFIG_SERIAL_8250_DWLIB=y
# CONFIG_SERIAL_8250_DW is not set
# CONFIG_SERIAL_8250_RT288X is not set
CONFIG_SERIAL_8250_LPSS=y
CONFIG_SERIAL_8250_MID=y
CONFIG_SERIAL_8250_PERICOM=y

#
# Non-8250 serial port support
#
# CONFIG_SERIAL_UARTLITE is not set
CONFIG_SERIAL_CORE=y
CONFIG_SERIAL_CORE_CONSOLE=y
# CONFIG_SERIAL_JSM is not set
# CONFIG_SERIAL_LANTIQ is not set
# CONFIG_SERIAL_SCCNXP is not set
# CONFIG_SERIAL_SC16IS7XX is not set
# CONFIG_SERIAL_ALTERA_JTAGUART is not set
# CONFIG_SERIAL_ALTERA_UART is not set
# CONFIG_SERIAL_ARC is not set
# CONFIG_SERIAL_RP2 is not set
# CONFIG_SERIAL_FSL_LPUART is not set
# CONFIG_SERIAL_FSL_LINFLEXUART is not set
# CONFIG_SERIAL_SPRD is not set
# end of Serial drivers

CONFIG_SERIAL_NONSTANDARD=y
# CONFIG_MOXA_INTELLIO is not set
# CONFIG_MOXA_SMARTIO is not set
# CONFIG_N_HDLC is not set
# CONFIG_N_GSM is not set
# CONFIG_NOZOMI is not set
# CONFIG_NULL_TTY is not set
# CONFIG_SERIAL_DEV_BUS is not set
# CONFIG_VIRTIO_CONSOLE is not set
# CONFIG_IPMI_HANDLER is not set
CONFIG_HW_RANDOM=y
# CONFIG_HW_RANDOM_TIMERIOMEM is not set
CONFIG_HW_RANDOM_INTEL=y
# CONFIG_HW_RANDOM_AMD is not set
# CONFIG_HW_RANDOM_BA431 is not set
CONFIG_HW_RANDOM_VIA=y
# CONFIG_HW_RANDOM_XIPHERA is not set
# CONFIG_APPLICOM is not set
# CONFIG_MWAVE is not set
CONFIG_DEVMEM=y
CONFIG_NVRAM=y
CONFIG_DEVPORT=y
CONFIG_HPET=y
# CONFIG_HPET_MMAP is not set
# CONFIG_HANGCHECK_TIMER is not set
# CONFIG_TCG_TPM is not set
# CONFIG_TELCLOCK is not set
# CONFIG_XILLYBUS is not set
# CONFIG_XILLYUSB is not set
# end of Character devices

#
# I2C support
#
CONFIG_I2C=y
CONFIG_ACPI_I2C_OPREGION=y
CONFIG_I2C_BOARDINFO=y
CONFIG_I2C_CHARDEV=y
CONFIG_I2C_MUX=y

#
# Multiplexer I2C Chip support
#
# CONFIG_I2C_MUX_LTC4306 is not set
# CONFIG_I2C_MUX_PCA9541 is not set
# CONFIG_I2C_MUX_REG is not set
# CONFIG_I2C_MUX_MLXCPLD is not set
# end of Multiplexer I2C Chip support

CONFIG_I2C_HELPER_AUTO=y
CONFIG_I2C_SMBUS=y
CONFIG_I2C_ALGOBIT=m

#
# I2C Hardware Bus support
#

#
# PC SMBus host controller drivers
#
# CONFIG_I2C_ALI1535 is not set
# CONFIG_I2C_ALI1563 is not set
# CONFIG_I2C_ALI15X3 is not set
# CONFIG_I2C_AMD756 is not set
# CONFIG_I2C_AMD8111 is not set
# CONFIG_I2C_AMD_MP2 is not set
CONFIG_I2C_I801=y
# CONFIG_I2C_ISCH is not set
# CONFIG_I2C_ISMT is not set
# CONFIG_I2C_PIIX4 is not set
# CONFIG_I2C_NFORCE2 is not set
# CONFIG_I2C_NVIDIA_GPU is not set
# CONFIG_I2C_SIS5595 is not set
# CONFIG_I2C_SIS630 is not set
# CONFIG_I2C_SIS96X is not set
# CONFIG_I2C_VIA is not set
# CONFIG_I2C_VIAPRO is not set
# CONFIG_I2C_ZHAOXIN is not set

#
# ACPI drivers
#
# CONFIG_I2C_SCMI is not set

#
# I2C system bus drivers (mostly embedded / system-on-chip)
#
# CONFIG_I2C_DESIGNWARE_CORE is not set
# CONFIG_I2C_EMEV2 is not set
# CONFIG_I2C_OCORES is not set
# CONFIG_I2C_PCA_PLATFORM is not set
# CONFIG_I2C_SIMTEC is not set
# CONFIG_I2C_XILINX is not set

#
# External I2C/SMBus adapter drivers
#
# CONFIG_I2C_DIOLAN_U2C is not set
# CONFIG_I2C_CP2615 is not set
# CONFIG_I2C_PCI1XXXX is not set
# CONFIG_I2C_ROBOTFUZZ_OSIF is not set
# CONFIG_I2C_TAOS_EVM is not set
# CONFIG_I2C_TINY_USB is not set

#
# Other I2C/SMBus bus drivers
#
# CONFIG_I2C_MLXCPLD is not set
# CONFIG_I2C_VIRTIO is not set
# end of I2C Hardware Bus support

# CONFIG_I2C_STUB is not set
# CONFIG_I2C_SLAVE is not set
# CONFIG_I2C_DEBUG_CORE is not set
# CONFIG_I2C_DEBUG_ALGO is not set
# CONFIG_I2C_DEBUG_BUS is not set
# end of I2C support

# CONFIG_I3C is not set
# CONFIG_SPI is not set
# CONFIG_SPMI is not set
# CONFIG_HSI is not set
CONFIG_PPS=y
# CONFIG_PPS_DEBUG is not set

#
# PPS clients support
#
# CONFIG_PPS_CLIENT_KTIMER is not set
# CONFIG_PPS_CLIENT_LDISC is not set
# CONFIG_PPS_CLIENT_GPIO is not set

#
# PPS generators support
#

#
# PTP clock support
#
CONFIG_PTP_1588_CLOCK=y
CONFIG_PTP_1588_CLOCK_OPTIONAL=y

#
# Enable PHYLIB and NETWORK_PHY_TIMESTAMPING to see the additional clocks.
#
# CONFIG_PTP_1588_CLOCK_VMCLOCK is not set
# CONFIG_PTP_1588_CLOCK_IDT82P33 is not set
# CONFIG_PTP_1588_CLOCK_IDTCM is not set
# CONFIG_PTP_1588_CLOCK_FC3W is not set
# CONFIG_PTP_1588_CLOCK_MOCK is not set
# end of PTP clock support

CONFIG_PINCTRL=y
# CONFIG_DEBUG_PINCTRL is not set
# CONFIG_PINCTRL_AMD is not set
# CONFIG_PINCTRL_CY8C95X0 is not set
# CONFIG_PINCTRL_MCP23S08 is not set
# CONFIG_PINCTRL_SX150X is not set

#
# Intel pinctrl drivers
#
# CONFIG_PINCTRL_BAYTRAIL is not set
# CONFIG_PINCTRL_CHERRYVIEW is not set
# CONFIG_PINCTRL_LYNXPOINT is not set
# CONFIG_PINCTRL_INTEL_PLATFORM is not set
# CONFIG_PINCTRL_ALDERLAKE is not set
# CONFIG_PINCTRL_BROXTON is not set
# CONFIG_PINCTRL_CANNONLAKE is not set
# CONFIG_PINCTRL_CEDARFORK is not set
# CONFIG_PINCTRL_DENVERTON is not set
# CONFIG_PINCTRL_ELKHARTLAKE is not set
# CONFIG_PINCTRL_EMMITSBURG is not set
# CONFIG_PINCTRL_GEMINILAKE is not set
# CONFIG_PINCTRL_ICELAKE is not set
# CONFIG_PINCTRL_JASPERLAKE is not set
# CONFIG_PINCTRL_LAKEFIELD is not set
# CONFIG_PINCTRL_LEWISBURG is not set
# CONFIG_PINCTRL_METEORLAKE is not set
# CONFIG_PINCTRL_METEORPOINT is not set
# CONFIG_PINCTRL_SUNRISEPOINT is not set
# CONFIG_PINCTRL_TIGERLAKE is not set
# end of Intel pinctrl drivers

#
# Renesas pinctrl drivers
#
# end of Renesas pinctrl drivers

# CONFIG_GPIOLIB is not set
# CONFIG_W1 is not set
# CONFIG_POWER_RESET is not set
# CONFIG_POWER_SEQUENCING is not set
CONFIG_POWER_SUPPLY=y
# CONFIG_POWER_SUPPLY_DEBUG is not set
CONFIG_POWER_SUPPLY_HWMON=y
# CONFIG_IP5XXX_POWER is not set
# CONFIG_TEST_POWER is not set
# CONFIG_CHARGER_ADP5061 is not set
# CONFIG_BATTERY_CW2015 is not set
# CONFIG_BATTERY_DS2780 is not set
# CONFIG_BATTERY_DS2781 is not set
# CONFIG_BATTERY_DS2782 is not set
# CONFIG_BATTERY_SAMSUNG_SDI is not set
# CONFIG_BATTERY_SBS is not set
# CONFIG_CHARGER_SBS is not set
# CONFIG_BATTERY_BQ27XXX is not set
# CONFIG_BATTERY_MAX17042 is not set
# CONFIG_BATTERY_MAX1720X is not set
# CONFIG_CHARGER_MAX8903 is not set
# CONFIG_CHARGER_LP8727 is not set
# CONFIG_CHARGER_LTC4162L is not set
# CONFIG_CHARGER_MAX77976 is not set
# CONFIG_CHARGER_BQ2415X is not set
# CONFIG_BATTERY_GAUGE_LTC2941 is not set
# CONFIG_BATTERY_GOLDFISH is not set
# CONFIG_BATTERY_RT5033 is not set
# CONFIG_CHARGER_BD99954 is not set
# CONFIG_BATTERY_UG3105 is not set
# CONFIG_FUEL_GAUGE_MM8013 is not set
CONFIG_HWMON=y
# CONFIG_HWMON_DEBUG_CHIP is not set

#
# Native drivers
#
# CONFIG_SENSORS_ABITUGURU is not set
# CONFIG_SENSORS_ABITUGURU3 is not set
# CONFIG_SENSORS_AD7414 is not set
# CONFIG_SENSORS_AD7418 is not set
# CONFIG_SENSORS_ADM1025 is not set
# CONFIG_SENSORS_ADM1026 is not set
# CONFIG_SENSORS_ADM1029 is not set
# CONFIG_SENSORS_ADM1031 is not set
# CONFIG_SENSORS_ADM1177 is not set
# CONFIG_SENSORS_ADM9240 is not set
# CONFIG_SENSORS_ADT7410 is not set
# CONFIG_SENSORS_ADT7411 is not set
# CONFIG_SENSORS_ADT7462 is not set
# CONFIG_SENSORS_ADT7470 is not set
# CONFIG_SENSORS_ADT7475 is not set
# CONFIG_SENSORS_AHT10 is not set
# CONFIG_SENSORS_AQUACOMPUTER_D5NEXT is not set
# CONFIG_SENSORS_AS370 is not set
# CONFIG_SENSORS_ASC7621 is not set
# CONFIG_SENSORS_ASUS_ROG_RYUJIN is not set
# CONFIG_SENSORS_AXI_FAN_CONTROL is not set
# CONFIG_SENSORS_K8TEMP is not set
# CONFIG_SENSORS_K10TEMP is not set
# CONFIG_SENSORS_FAM15H_POWER is not set
# CONFIG_SENSORS_APPLESMC is not set
# CONFIG_SENSORS_ASB100 is not set
# CONFIG_SENSORS_ATXP1 is not set
# CONFIG_SENSORS_CHIPCAP2 is not set
# CONFIG_SENSORS_CORSAIR_CPRO is not set
# CONFIG_SENSORS_CORSAIR_PSU is not set
# CONFIG_SENSORS_DRIVETEMP is not set
# CONFIG_SENSORS_DS620 is not set
# CONFIG_SENSORS_DS1621 is not set
# CONFIG_SENSORS_DELL_SMM is not set
# CONFIG_SENSORS_I5K_AMB is not set
# CONFIG_SENSORS_F71805F is not set
# CONFIG_SENSORS_F71882FG is not set
# CONFIG_SENSORS_F75375S is not set
# CONFIG_SENSORS_FSCHMD is not set
# CONFIG_SENSORS_FTSTEUTATES is not set
# CONFIG_SENSORS_GIGABYTE_WATERFORCE is not set
# CONFIG_SENSORS_GL518SM is not set
# CONFIG_SENSORS_GL520SM is not set
# CONFIG_SENSORS_G760A is not set
# CONFIG_SENSORS_G762 is not set
# CONFIG_SENSORS_HIH6130 is not set
# CONFIG_SENSORS_HS3001 is not set
# CONFIG_SENSORS_I5500 is not set
CONFIG_SENSORS_CORETEMP=y
# CONFIG_SENSORS_ISL28022 is not set
# CONFIG_SENSORS_IT87 is not set
# CONFIG_SENSORS_JC42 is not set
# CONFIG_SENSORS_POWERZ is not set
# CONFIG_SENSORS_POWR1220 is not set
# CONFIG_SENSORS_LENOVO_EC is not set
# CONFIG_SENSORS_LINEAGE is not set
# CONFIG_SENSORS_LTC2945 is not set
# CONFIG_SENSORS_LTC2947_I2C is not set
# CONFIG_SENSORS_LTC2990 is not set
# CONFIG_SENSORS_LTC2991 is not set
# CONFIG_SENSORS_LTC4151 is not set
# CONFIG_SENSORS_LTC4215 is not set
# CONFIG_SENSORS_LTC4222 is not set
# CONFIG_SENSORS_LTC4245 is not set
# CONFIG_SENSORS_LTC4260 is not set
# CONFIG_SENSORS_LTC4261 is not set
# CONFIG_SENSORS_LTC4282 is not set
# CONFIG_SENSORS_MAX127 is not set
# CONFIG_SENSORS_MAX16065 is not set
# CONFIG_SENSORS_MAX1619 is not set
# CONFIG_SENSORS_MAX1668 is not set
# CONFIG_SENSORS_MAX197 is not set
# CONFIG_SENSORS_MAX31730 is not set
# CONFIG_SENSORS_MAX31760 is not set
# CONFIG_MAX31827 is not set
# CONFIG_SENSORS_MAX6620 is not set
# CONFIG_SENSORS_MAX6621 is not set
# CONFIG_SENSORS_MAX6639 is not set
# CONFIG_SENSORS_MAX6650 is not set
# CONFIG_SENSORS_MAX6697 is not set
# CONFIG_SENSORS_MAX31790 is not set
# CONFIG_SENSORS_MC34VR500 is not set
# CONFIG_SENSORS_MCP3021 is not set
# CONFIG_SENSORS_TC654 is not set
# CONFIG_SENSORS_TPS23861 is not set
# CONFIG_SENSORS_MR75203 is not set
# CONFIG_SENSORS_LM63 is not set
# CONFIG_SENSORS_LM73 is not set
# CONFIG_SENSORS_LM75 is not set
# CONFIG_SENSORS_LM77 is not set
# CONFIG_SENSORS_LM78 is not set
# CONFIG_SENSORS_LM80 is not set
# CONFIG_SENSORS_LM83 is not set
# CONFIG_SENSORS_LM85 is not set
# CONFIG_SENSORS_LM87 is not set
# CONFIG_SENSORS_LM90 is not set
# CONFIG_SENSORS_LM92 is not set
# CONFIG_SENSORS_LM93 is not set
# CONFIG_SENSORS_LM95234 is not set
# CONFIG_SENSORS_LM95241 is not set
# CONFIG_SENSORS_LM95245 is not set
# CONFIG_SENSORS_PC87360 is not set
# CONFIG_SENSORS_PC87427 is not set
# CONFIG_SENSORS_NCT6683 is not set
# CONFIG_SENSORS_NCT6775 is not set
# CONFIG_SENSORS_NCT6775_I2C is not set
# CONFIG_SENSORS_NCT7363 is not set
# CONFIG_SENSORS_NCT7802 is not set
# CONFIG_SENSORS_NCT7904 is not set
# CONFIG_SENSORS_NPCM7XX is not set
# CONFIG_SENSORS_NZXT_KRAKEN2 is not set
# CONFIG_SENSORS_NZXT_KRAKEN3 is not set
# CONFIG_SENSORS_NZXT_SMART2 is not set
# CONFIG_SENSORS_OCC_P8_I2C is not set
# CONFIG_SENSORS_OXP is not set
# CONFIG_SENSORS_PCF8591 is not set
# CONFIG_PMBUS is not set
# CONFIG_SENSORS_PT5161L is not set
# CONFIG_SENSORS_SBTSI is not set
# CONFIG_SENSORS_SBRMI is not set
# CONFIG_SENSORS_SHT21 is not set
# CONFIG_SENSORS_SHT3x is not set
# CONFIG_SENSORS_SHT4x is not set
# CONFIG_SENSORS_SHTC1 is not set
# CONFIG_SENSORS_SIS5595 is not set
# CONFIG_SENSORS_DME1737 is not set
# CONFIG_SENSORS_EMC1403 is not set
# CONFIG_SENSORS_EMC2103 is not set
# CONFIG_SENSORS_EMC2305 is not set
# CONFIG_SENSORS_EMC6W201 is not set
# CONFIG_SENSORS_SMSC47M1 is not set
# CONFIG_SENSORS_SMSC47M192 is not set
# CONFIG_SENSORS_SMSC47B397 is not set
# CONFIG_SENSORS_SCH5627 is not set
# CONFIG_SENSORS_SCH5636 is not set
# CONFIG_SENSORS_STTS751 is not set
# CONFIG_SENSORS_ADC128D818 is not set
# CONFIG_SENSORS_ADS7828 is not set
# CONFIG_SENSORS_AMC6821 is not set
# CONFIG_SENSORS_INA209 is not set
# CONFIG_SENSORS_INA2XX is not set
# CONFIG_SENSORS_INA238 is not set
# CONFIG_SENSORS_INA3221 is not set
# CONFIG_SENSORS_SPD5118 is not set
# CONFIG_SENSORS_TC74 is not set
# CONFIG_SENSORS_THMC50 is not set
# CONFIG_SENSORS_TMP102 is not set
# CONFIG_SENSORS_TMP103 is not set
# CONFIG_SENSORS_TMP108 is not set
# CONFIG_SENSORS_TMP401 is not set
# CONFIG_SENSORS_TMP421 is not set
# CONFIG_SENSORS_TMP464 is not set
# CONFIG_SENSORS_TMP513 is not set
# CONFIG_SENSORS_VIA_CPUTEMP is not set
# CONFIG_SENSORS_VIA686A is not set
# CONFIG_SENSORS_VT1211 is not set
# CONFIG_SENSORS_VT8231 is not set
# CONFIG_SENSORS_W83773G is not set
# CONFIG_SENSORS_W83781D is not set
# CONFIG_SENSORS_W83791D is not set
# CONFIG_SENSORS_W83792D is not set
# CONFIG_SENSORS_W83793 is not set
# CONFIG_SENSORS_W83795 is not set
# CONFIG_SENSORS_W83L785TS is not set
# CONFIG_SENSORS_W83L786NG is not set
# CONFIG_SENSORS_W83627HF is not set
# CONFIG_SENSORS_W83627EHF is not set
# CONFIG_SENSORS_XGENE is not set

#
# ACPI drivers
#
# CONFIG_SENSORS_ACPI_POWER is not set
# CONFIG_SENSORS_ATK0110 is not set
# CONFIG_SENSORS_ASUS_WMI is not set
# CONFIG_SENSORS_ASUS_EC is not set
# CONFIG_SENSORS_HP_WMI is not set
CONFIG_THERMAL=y
# CONFIG_THERMAL_NETLINK is not set
# CONFIG_THERMAL_STATISTICS is not set
# CONFIG_THERMAL_DEBUGFS is not set
# CONFIG_THERMAL_CORE_TESTING is not set
CONFIG_THERMAL_EMERGENCY_POWEROFF_DELAY_MS=0
CONFIG_THERMAL_HWMON=y
CONFIG_THERMAL_DEFAULT_GOV_STEP_WISE=y
# CONFIG_THERMAL_DEFAULT_GOV_FAIR_SHARE is not set
# CONFIG_THERMAL_DEFAULT_GOV_USER_SPACE is not set
# CONFIG_THERMAL_GOV_FAIR_SHARE is not set
CONFIG_THERMAL_GOV_STEP_WISE=y
# CONFIG_THERMAL_GOV_BANG_BANG is not set
CONFIG_THERMAL_GOV_USER_SPACE=y
# CONFIG_PCIE_THERMAL is not set
# CONFIG_THERMAL_EMULATION is not set

#
# Intel thermal drivers
#
# CONFIG_INTEL_POWERCLAMP is not set
CONFIG_X86_THERMAL_VECTOR=y
CONFIG_INTEL_TCC=y
CONFIG_X86_PKG_TEMP_THERMAL=m
# CONFIG_INTEL_SOC_DTS_THERMAL is not set

#
# ACPI INT340X thermal drivers
#
# CONFIG_INT340X_THERMAL is not set
# end of ACPI INT340X thermal drivers

# CONFIG_INTEL_PCH_THERMAL is not set
# CONFIG_INTEL_TCC_COOLING is not set
# CONFIG_INTEL_HFI_THERMAL is not set
# end of Intel thermal drivers

CONFIG_WATCHDOG=y
# CONFIG_WATCHDOG_CORE is not set
# CONFIG_WATCHDOG_NOWAYOUT is not set
CONFIG_WATCHDOG_HANDLE_BOOT_ENABLED=y
CONFIG_WATCHDOG_OPEN_TIMEOUT=0
# CONFIG_WATCHDOG_SYSFS is not set
# CONFIG_WATCHDOG_HRTIMER_PRETIMEOUT is not set

#
# Watchdog Pretimeout Governors
#

#
# Watchdog Device Drivers
#
# CONFIG_SOFT_WATCHDOG is not set
# CONFIG_LENOVO_SE10_WDT is not set
# CONFIG_WDAT_WDT is not set
# CONFIG_XILINX_WATCHDOG is not set
# CONFIG_ZIIRAVE_WATCHDOG is not set
# CONFIG_CADENCE_WATCHDOG is not set
# CONFIG_DW_WATCHDOG is not set
# CONFIG_MAX63XX_WATCHDOG is not set
# CONFIG_ACQUIRE_WDT is not set
# CONFIG_ADVANTECH_WDT is not set
# CONFIG_ADVANTECH_EC_WDT is not set
# CONFIG_ALIM1535_WDT is not set
# CONFIG_ALIM7101_WDT is not set
# CONFIG_EBC_C384_WDT is not set
# CONFIG_EXAR_WDT is not set
# CONFIG_F71808E_WDT is not set
# CONFIG_SP5100_TCO is not set
# CONFIG_SBC_FITPC2_WATCHDOG is not set
# CONFIG_EUROTECH_WDT is not set
# CONFIG_IB700_WDT is not set
# CONFIG_IBMASR is not set
# CONFIG_WAFER_WDT is not set
# CONFIG_I6300ESB_WDT is not set
# CONFIG_IE6XX_WDT is not set
# CONFIG_ITCO_WDT is not set
# CONFIG_IT8712F_WDT is not set
# CONFIG_IT87_WDT is not set
# CONFIG_HP_WATCHDOG is not set
# CONFIG_SC1200_WDT is not set
# CONFIG_PC87413_WDT is not set
# CONFIG_NV_TCO is not set
# CONFIG_60XX_WDT is not set
# CONFIG_SMSC_SCH311X_WDT is not set
# CONFIG_SMSC37B787_WDT is not set
# CONFIG_TQMX86_WDT is not set
# CONFIG_VIA_WDT is not set
# CONFIG_W83627HF_WDT is not set
# CONFIG_W83877F_WDT is not set
# CONFIG_W83977F_WDT is not set
# CONFIG_MACHZ_WDT is not set
# CONFIG_SBC_EPX_C3_WATCHDOG is not set
# CONFIG_NI903X_WDT is not set
# CONFIG_NIC7018_WDT is not set

#
# PCI-based Watchdog Cards
#
# CONFIG_PCIPCWATCHDOG is not set
# CONFIG_WDTPCI is not set

#
# USB-based Watchdog Cards
#
# CONFIG_USBPCWATCHDOG is not set
CONFIG_SSB_POSSIBLE=y
# CONFIG_SSB is not set
CONFIG_BCMA_POSSIBLE=y
# CONFIG_BCMA is not set

#
# Multifunction device drivers
#
# CONFIG_MFD_AS3711 is not set
# CONFIG_MFD_SMPRO is not set
# CONFIG_PMIC_ADP5520 is not set
# CONFIG_MFD_BCM590XX is not set
# CONFIG_MFD_BD9571MWV is not set
# CONFIG_MFD_AXP20X_I2C is not set
# CONFIG_MFD_CGBC is not set
# CONFIG_MFD_CS42L43_I2C is not set
# CONFIG_MFD_MADERA is not set
# CONFIG_PMIC_DA903X is not set
# CONFIG_MFD_DA9052_I2C is not set
# CONFIG_MFD_DA9055 is not set
# CONFIG_MFD_DA9062 is not set
# CONFIG_MFD_DA9063 is not set
# CONFIG_MFD_DA9150 is not set
# CONFIG_MFD_DLN2 is not set
# CONFIG_MFD_MC13XXX_I2C is not set
# CONFIG_MFD_MP2629 is not set
# CONFIG_MFD_INTEL_QUARK_I2C_GPIO is not set
# CONFIG_LPC_ICH is not set
# CONFIG_LPC_SCH is not set
# CONFIG_MFD_INTEL_LPSS_ACPI is not set
# CONFIG_MFD_INTEL_LPSS_PCI is not set
# CONFIG_MFD_INTEL_PMC_BXT is not set
# CONFIG_MFD_IQS62X is not set
# CONFIG_MFD_JANZ_CMODIO is not set
# CONFIG_MFD_KEMPLD is not set
# CONFIG_MFD_88PM800 is not set
# CONFIG_MFD_88PM805 is not set
# CONFIG_MFD_88PM860X is not set
# CONFIG_MFD_MAX14577 is not set
# CONFIG_MFD_MAX77541 is not set
# CONFIG_MFD_MAX77693 is not set
# CONFIG_MFD_MAX77843 is not set
# CONFIG_MFD_MAX8907 is not set
# CONFIG_MFD_MAX8925 is not set
# CONFIG_MFD_MAX8997 is not set
# CONFIG_MFD_MAX8998 is not set
# CONFIG_MFD_MT6360 is not set
# CONFIG_MFD_MT6370 is not set
# CONFIG_MFD_MT6397 is not set
# CONFIG_MFD_MENF21BMC is not set
# CONFIG_MFD_VIPERBOARD is not set
# CONFIG_MFD_RETU is not set
# CONFIG_MFD_PCF50633 is not set
# CONFIG_MFD_SY7636A is not set
# CONFIG_MFD_RDC321X is not set
# CONFIG_MFD_RT4831 is not set
# CONFIG_MFD_RT5033 is not set
# CONFIG_MFD_RT5120 is not set
# CONFIG_MFD_RC5T583 is not set
# CONFIG_MFD_SI476X_CORE is not set
# CONFIG_MFD_SM501 is not set
# CONFIG_MFD_SKY81452 is not set
# CONFIG_MFD_SYSCON is not set
# CONFIG_MFD_LP3943 is not set
# CONFIG_MFD_LP8788 is not set
# CONFIG_MFD_TI_LMU is not set
# CONFIG_MFD_PALMAS is not set
# CONFIG_TPS6105X is not set
# CONFIG_TPS6507X is not set
# CONFIG_MFD_TPS65086 is not set
# CONFIG_MFD_TPS65090 is not set
# CONFIG_MFD_TI_LP873X is not set
# CONFIG_MFD_TPS6586X is not set
# CONFIG_MFD_TPS65912_I2C is not set
# CONFIG_MFD_TPS6594_I2C is not set
# CONFIG_TWL4030_CORE is not set
# CONFIG_TWL6040_CORE is not set
# CONFIG_MFD_WL1273_CORE is not set
# CONFIG_MFD_LM3533 is not set
# CONFIG_MFD_TQMX86 is not set
# CONFIG_MFD_VX855 is not set
# CONFIG_MFD_ARIZONA_I2C is not set
# CONFIG_MFD_WM8400 is not set
# CONFIG_MFD_WM831X_I2C is not set
# CONFIG_MFD_WM8350_I2C is not set
# CONFIG_MFD_WM8994 is not set
# CONFIG_MFD_ATC260X_I2C is not set
# CONFIG_MFD_CS40L50_I2C is not set
# end of Multifunction device drivers

# CONFIG_REGULATOR is not set
# CONFIG_RC_CORE is not set

#
# CEC support
#
# CONFIG_MEDIA_CEC_SUPPORT is not set
# end of CEC support

CONFIG_MEDIA_SUPPORT=y
CONFIG_MEDIA_SUPPORT_FILTER=y
CONFIG_MEDIA_SUBDRV_AUTOSELECT=y

#
# Media device types
#
CONFIG_MEDIA_CAMERA_SUPPORT=y
# CONFIG_MEDIA_ANALOG_TV_SUPPORT is not set
# CONFIG_MEDIA_DIGITAL_TV_SUPPORT is not set
# CONFIG_MEDIA_RADIO_SUPPORT is not set
# CONFIG_MEDIA_SDR_SUPPORT is not set
# CONFIG_MEDIA_PLATFORM_SUPPORT is not set
# CONFIG_MEDIA_TEST_SUPPORT is not set
# end of Media device types

CONFIG_VIDEO_DEV=y
CONFIG_MEDIA_CONTROLLER=y

#
# Video4Linux options
#
CONFIG_VIDEO_V4L2_I2C=y
CONFIG_VIDEO_V4L2_SUBDEV_API=y
# CONFIG_VIDEO_ADV_DEBUG is not set
# CONFIG_VIDEO_FIXED_MINOR_RANGES is not set
CONFIG_V4L2_FWNODE=y
CONFIG_V4L2_ASYNC=y
# end of Video4Linux options

#
# Media controller options
#
# end of Media controller options

#
# Media drivers
#

#
# Drivers filtered as selected at 'Filter media drivers'
#

#
# Media drivers
#
# CONFIG_MEDIA_USB_SUPPORT is not set
# CONFIG_MEDIA_PCI_SUPPORT is not set
# end of Media drivers

CONFIG_MEDIA_HIDE_ANCILLARY_SUBDRV=y

#
# Media ancillary drivers
#
CONFIG_VIDEO_CAMERA_SENSOR=y
# CONFIG_VIDEO_ALVIUM_CSI2 is not set
# CONFIG_VIDEO_AR0521 is not set
# CONFIG_VIDEO_GC0308 is not set
# CONFIG_VIDEO_GC05A2 is not set
# CONFIG_VIDEO_GC08A3 is not set
# CONFIG_VIDEO_GC2145 is not set
# CONFIG_VIDEO_HI556 is not set
# CONFIG_VIDEO_HI846 is not set
# CONFIG_VIDEO_HI847 is not set
# CONFIG_VIDEO_IMX208 is not set
# CONFIG_VIDEO_IMX219 is not set
# CONFIG_VIDEO_IMX258 is not set
# CONFIG_VIDEO_IMX274 is not set
# CONFIG_VIDEO_IMX283 is not set
# CONFIG_VIDEO_IMX290 is not set
# CONFIG_VIDEO_IMX296 is not set
# CONFIG_VIDEO_IMX319 is not set
# CONFIG_VIDEO_IMX355 is not set
# CONFIG_VIDEO_MT9M001 is not set
# CONFIG_VIDEO_MT9M111 is not set
# CONFIG_VIDEO_MT9M114 is not set
# CONFIG_VIDEO_MT9P031 is not set
# CONFIG_VIDEO_MT9T112 is not set
# CONFIG_VIDEO_MT9V011 is not set
# CONFIG_VIDEO_MT9V032 is not set
# CONFIG_VIDEO_MT9V111 is not set
# CONFIG_VIDEO_OG01A1B is not set
# CONFIG_VIDEO_OV01A10 is not set
# CONFIG_VIDEO_OV02A10 is not set
# CONFIG_VIDEO_OV08D10 is not set
# CONFIG_VIDEO_OV08X40 is not set
# CONFIG_VIDEO_OV13858 is not set
# CONFIG_VIDEO_OV13B10 is not set
# CONFIG_VIDEO_OV2640 is not set
# CONFIG_VIDEO_OV2680 is not set
# CONFIG_VIDEO_OV2685 is not set
# CONFIG_VIDEO_OV2740 is not set
# CONFIG_VIDEO_OV5647 is not set
# CONFIG_VIDEO_OV5648 is not set
# CONFIG_VIDEO_OV5670 is not set
# CONFIG_VIDEO_OV5675 is not set
# CONFIG_VIDEO_OV5693 is not set
# CONFIG_VIDEO_OV5695 is not set
# CONFIG_VIDEO_OV64A40 is not set
# CONFIG_VIDEO_OV6650 is not set
# CONFIG_VIDEO_OV7251 is not set
# CONFIG_VIDEO_OV7640 is not set
# CONFIG_VIDEO_OV7670 is not set
# CONFIG_VIDEO_OV772X is not set
# CONFIG_VIDEO_OV7740 is not set
# CONFIG_VIDEO_OV8856 is not set
# CONFIG_VIDEO_OV8858 is not set
# CONFIG_VIDEO_OV8865 is not set
# CONFIG_VIDEO_OV9640 is not set
# CONFIG_VIDEO_OV9650 is not set
# CONFIG_VIDEO_OV9734 is not set
# CONFIG_VIDEO_RDACM20 is not set
# CONFIG_VIDEO_RDACM21 is not set
# CONFIG_VIDEO_RJ54N1 is not set
# CONFIG_VIDEO_S5K5BAF is not set
# CONFIG_VIDEO_S5K6A3 is not set
# CONFIG_VIDEO_CCS is not set
# CONFIG_VIDEO_ET8EK8 is not set

#
# Camera ISPs
#
# CONFIG_VIDEO_THP7312 is not set
# end of Camera ISPs

#
# Lens drivers
#
# CONFIG_VIDEO_AK7375 is not set
# CONFIG_VIDEO_DW9714 is not set
# CONFIG_VIDEO_DW9719 is not set
# CONFIG_VIDEO_DW9768 is not set
# CONFIG_VIDEO_DW9807_VCM is not set
# end of Lens drivers

#
# Flash devices
#
# CONFIG_VIDEO_ADP1653 is not set
# CONFIG_VIDEO_LM3560 is not set
# CONFIG_VIDEO_LM3646 is not set
# end of Flash devices

#
# audio, video and radio I2C drivers auto-selected by 'Autoselect ancillary drivers'
#

#
# Video and audio decoders
#

#
# Video serializers and deserializers
#
# end of Video serializers and deserializers
# end of Media ancillary drivers

#
# Graphics support
#
CONFIG_APERTURE_HELPERS=y
CONFIG_SCREEN_INFO=y
CONFIG_VIDEO=y
# CONFIG_AUXDISPLAY is not set
CONFIG_AGP=y
# CONFIG_AGP_AMD64 is not set
# CONFIG_AGP_INTEL is not set
# CONFIG_AGP_SIS is not set
# CONFIG_AGP_VIA is not set
CONFIG_INTEL_GTT=m
# CONFIG_VGA_SWITCHEROO is not set
CONFIG_DRM=y
CONFIG_DRM_MIPI_DSI=y
# CONFIG_DRM_DEBUG_MM is not set
CONFIG_DRM_KMS_HELPER=m
# CONFIG_DRM_PANIC is not set
CONFIG_DRM_CLIENT=y
CONFIG_DRM_CLIENT_LIB=m
CONFIG_DRM_CLIENT_SELECTION=m
CONFIG_DRM_CLIENT_SETUP=y

#
# Supported DRM clients
#
CONFIG_DRM_FBDEV_EMULATION=y
CONFIG_DRM_FBDEV_OVERALLOC=100
# end of Supported DRM clients

CONFIG_DRM_LOAD_EDID_FIRMWARE=y
CONFIG_DRM_DISPLAY_HELPER=m
# CONFIG_DRM_DISPLAY_DP_AUX_CEC is not set
# CONFIG_DRM_DISPLAY_DP_AUX_CHARDEV is not set
CONFIG_DRM_DISPLAY_DP_HELPER=y
CONFIG_DRM_DISPLAY_DSC_HELPER=y
CONFIG_DRM_DISPLAY_HDCP_HELPER=y
CONFIG_DRM_DISPLAY_HDMI_HELPER=y
CONFIG_DRM_TTM=m
CONFIG_DRM_BUDDY=m

#
# I2C encoder or helper chips
#
# CONFIG_DRM_I2C_CH7006 is not set
# CONFIG_DRM_I2C_SIL164 is not set
# CONFIG_DRM_I2C_NXP_TDA998X is not set
# CONFIG_DRM_I2C_NXP_TDA9950 is not set
# end of I2C encoder or helper chips

#
# ARM devices
#
# end of ARM devices

# CONFIG_DRM_RADEON is not set
# CONFIG_DRM_AMDGPU is not set
# CONFIG_DRM_NOUVEAU is not set
CONFIG_DRM_I915=m
CONFIG_DRM_I915_FORCE_PROBE=""""
CONFIG_DRM_I915_CAPTURE_ERROR=y
CONFIG_DRM_I915_COMPRESS_ERROR=y
CONFIG_DRM_I915_USERPTR=y
CONFIG_DRM_I915_REQUEST_TIMEOUT=20000
CONFIG_DRM_I915_FENCE_TIMEOUT=10000
CONFIG_DRM_I915_USERFAULT_AUTOSUSPEND=250
CONFIG_DRM_I915_HEARTBEAT_INTERVAL=2500
CONFIG_DRM_I915_PREEMPT_TIMEOUT=640
CONFIG_DRM_I915_PREEMPT_TIMEOUT_COMPUTE=7500
CONFIG_DRM_I915_MAX_REQUEST_BUSYWAIT=8000
CONFIG_DRM_I915_STOP_TIMEOUT=100
CONFIG_DRM_I915_TIMESLICE_DURATION=1
# CONFIG_DRM_XE is not set
# CONFIG_DRM_VGEM is not set
# CONFIG_DRM_VKMS is not set
# CONFIG_DRM_GMA500 is not set
# CONFIG_DRM_UDL is not set
# CONFIG_DRM_AST is not set
# CONFIG_DRM_MGAG200 is not set
# CONFIG_DRM_QXL is not set
# CONFIG_DRM_VIRTIO_GPU is not set
CONFIG_DRM_PANEL=y

#
# Display Panels
#
# CONFIG_DRM_PANEL_RASPBERRYPI_TOUCHSCREEN is not set
# end of Display Panels

CONFIG_DRM_BRIDGE=y
CONFIG_DRM_PANEL_BRIDGE=y

#
# Display Interface Bridges
#
# CONFIG_DRM_ANALOGIX_ANX78XX is not set
# end of Display Interface Bridges

# CONFIG_DRM_ETNAVIV is not set
# CONFIG_DRM_BOCHS is not set
# CONFIG_DRM_CIRRUS_QEMU is not set
# CONFIG_DRM_GM12U320 is not set
# CONFIG_DRM_SIMPLEDRM is not set
# CONFIG_DRM_VBOXVIDEO is not set
# CONFIG_DRM_GUD is not set
# CONFIG_DRM_SSD130X is not set
CONFIG_DRM_PRIVACY_SCREEN=y
CONFIG_DRM_PANEL_ORIENTATION_QUIRKS=y

#
# Frame buffer Devices
#
CONFIG_FB=y
# CONFIG_FB_CIRRUS is not set
# CONFIG_FB_PM2 is not set
# CONFIG_FB_CYBER2000 is not set
# CONFIG_FB_ARC is not set
# CONFIG_FB_ASILIANT is not set
# CONFIG_FB_IMSTT is not set
# CONFIG_FB_VGA16 is not set
# CONFIG_FB_UVESA is not set
# CONFIG_FB_VESA is not set
CONFIG_FB_EFI=y
# CONFIG_FB_N411 is not set
# CONFIG_FB_HGA is not set
# CONFIG_FB_OPENCORES is not set
# CONFIG_FB_S1D13XXX is not set
# CONFIG_FB_NVIDIA is not set
# CONFIG_FB_RIVA is not set
# CONFIG_FB_I740 is not set
# CONFIG_FB_MATROX is not set
# CONFIG_FB_RADEON is not set
# CONFIG_FB_ATY128 is not set
# CONFIG_FB_ATY is not set
# CONFIG_FB_S3 is not set
# CONFIG_FB_SAVAGE is not set
# CONFIG_FB_SIS is not set
# CONFIG_FB_NEOMAGIC is not set
# CONFIG_FB_KYRO is not set
# CONFIG_FB_3DFX is not set
# CONFIG_FB_VOODOO1 is not set
# CONFIG_FB_VT8623 is not set
# CONFIG_FB_TRIDENT is not set
# CONFIG_FB_ARK is not set
# CONFIG_FB_PM3 is not set
# CONFIG_FB_CARMINE is not set
# CONFIG_FB_SMSCUFX is not set
# CONFIG_FB_UDL is not set
# CONFIG_FB_IBM_GXT4500 is not set
# CONFIG_FB_VIRTUAL is not set
# CONFIG_FB_METRONOME is not set
# CONFIG_FB_MB862XX is not set
# CONFIG_FB_SIMPLE is not set
# CONFIG_FB_SM712 is not set
CONFIG_FB_CORE=y
CONFIG_FB_NOTIFY=y
CONFIG_FIRMWARE_EDID=y
CONFIG_FB_DEVICE=y
CONFIG_FB_CFB_FILLRECT=y
CONFIG_FB_CFB_COPYAREA=y
CONFIG_FB_CFB_IMAGEBLIT=y
# CONFIG_FB_FOREIGN_ENDIAN is not set
CONFIG_FB_IOMEM_FOPS=y
CONFIG_FB_IOMEM_HELPERS=y
CONFIG_FB_MODE_HELPERS=y
CONFIG_FB_TILEBLITTING=y
# end of Frame buffer Devices

#
# Backlight & LCD device support
#
# CONFIG_LCD_CLASS_DEVICE is not set
CONFIG_BACKLIGHT_CLASS_DEVICE=m
# CONFIG_BACKLIGHT_KTD2801 is not set
# CONFIG_BACKLIGHT_KTZ8866 is not set
# CONFIG_BACKLIGHT_APPLE is not set
# CONFIG_BACKLIGHT_QCOM_WLED is not set
# CONFIG_BACKLIGHT_SAHARA is not set
# CONFIG_BACKLIGHT_ADP8860 is not set
# CONFIG_BACKLIGHT_ADP8870 is not set
# CONFIG_BACKLIGHT_LM3509 is not set
# CONFIG_BACKLIGHT_LM3639 is not set
# CONFIG_BACKLIGHT_LV5207LP is not set
# CONFIG_BACKLIGHT_BD6107 is not set
# CONFIG_BACKLIGHT_ARCXCNN is not set
# end of Backlight & LCD device support

CONFIG_HDMI=y

#
# Console display driver support
#
CONFIG_VGA_CONSOLE=y
CONFIG_DUMMY_CONSOLE=y
CONFIG_DUMMY_CONSOLE_COLUMNS=80
CONFIG_DUMMY_CONSOLE_ROWS=25
CONFIG_FRAMEBUFFER_CONSOLE=y
# CONFIG_FRAMEBUFFER_CONSOLE_LEGACY_ACCELERATION is not set
CONFIG_FRAMEBUFFER_CONSOLE_DETECT_PRIMARY=y
# CONFIG_FRAMEBUFFER_CONSOLE_ROTATION is not set
# CONFIG_FRAMEBUFFER_CONSOLE_DEFERRED_TAKEOVER is not set
# end of Console display driver support

CONFIG_LOGO=y
# CONFIG_LOGO_LINUX_MONO is not set
# CONFIG_LOGO_LINUX_VGA16 is not set
CONFIG_LOGO_LINUX_CLUT224=y
# end of Graphics support

# CONFIG_DRM_ACCEL is not set
CONFIG_SOUND=y
CONFIG_SND=y
CONFIG_SND_TIMER=y
CONFIG_SND_PCM=y
CONFIG_SND_HWDEP=y
CONFIG_SND_SEQ_DEVICE=y
CONFIG_SND_JACK=y
CONFIG_SND_JACK_INPUT_DEV=y
# CONFIG_SND_OSSEMUL is not set
CONFIG_SND_PCM_TIMER=y
CONFIG_SND_HRTIMER=y
# CONFIG_SND_DYNAMIC_MINORS is not set
CONFIG_SND_SUPPORT_OLD_API=y
CONFIG_SND_PROC_FS=y
CONFIG_SND_VERBOSE_PROCFS=y
CONFIG_SND_CTL_FAST_LOOKUP=y
# CONFIG_SND_DEBUG is not set
# CONFIG_SND_CTL_INPUT_VALIDATION is not set
# CONFIG_SND_UTIMER is not set
CONFIG_SND_VMASTER=y
CONFIG_SND_DMA_SGBUF=y
CONFIG_SND_CTL_LED=y
CONFIG_SND_SEQUENCER=y
CONFIG_SND_SEQ_DUMMY=y
CONFIG_SND_SEQ_HRTIMER_DEFAULT=y
# CONFIG_SND_SEQ_UMP is not set
# CONFIG_SND_DRIVERS is not set
CONFIG_SND_PCI=y
# CONFIG_SND_AD1889 is not set
# CONFIG_SND_ALS300 is not set
# CONFIG_SND_ALS4000 is not set
# CONFIG_SND_ALI5451 is not set
# CONFIG_SND_ASIHPI is not set
# CONFIG_SND_ATIIXP is not set
# CONFIG_SND_ATIIXP_MODEM is not set
# CONFIG_SND_AU8810 is not set
# CONFIG_SND_AU8820 is not set
# CONFIG_SND_AU8830 is not set
# CONFIG_SND_AW2 is not set
# CONFIG_SND_AZT3328 is not set
# CONFIG_SND_BT87X is not set
# CONFIG_SND_CA0106 is not set
# CONFIG_SND_CMIPCI is not set
# CONFIG_SND_OXYGEN is not set
# CONFIG_SND_CS4281 is not set
# CONFIG_SND_CS46XX is not set
# CONFIG_SND_CTXFI is not set
# CONFIG_SND_DARLA20 is not set
# CONFIG_SND_GINA20 is not set
# CONFIG_SND_LAYLA20 is not set
# CONFIG_SND_DARLA24 is not set
# CONFIG_SND_GINA24 is not set
# CONFIG_SND_LAYLA24 is not set
# CONFIG_SND_MONA is not set
# CONFIG_SND_MIA is not set
# CONFIG_SND_ECHO3G is not set
# CONFIG_SND_INDIGO is not set
# CONFIG_SND_INDIGOIO is not set
# CONFIG_SND_INDIGODJ is not set
# CONFIG_SND_INDIGOIOX is not set
# CONFIG_SND_INDIGODJX is not set
# CONFIG_SND_EMU10K1 is not set
# CONFIG_SND_EMU10K1X is not set
# CONFIG_SND_ENS1370 is not set
# CONFIG_SND_ENS1371 is not set
# CONFIG_SND_ES1938 is not set
# CONFIG_SND_ES1968 is not set
# CONFIG_SND_FM801 is not set
# CONFIG_SND_HDSP is not set
# CONFIG_SND_HDSPM is not set
# CONFIG_SND_ICE1712 is not set
# CONFIG_SND_ICE1724 is not set
# CONFIG_SND_INTEL8X0 is not set
# CONFIG_SND_INTEL8X0M is not set
# CONFIG_SND_KORG1212 is not set
# CONFIG_SND_LOLA is not set
# CONFIG_SND_LX6464ES is not set
# CONFIG_SND_MAESTRO3 is not set
# CONFIG_SND_MIXART is not set
# CONFIG_SND_NM256 is not set
# CONFIG_SND_PCXHR is not set
# CONFIG_SND_RIPTIDE is not set
# CONFIG_SND_RME32 is not set
# CONFIG_SND_RME96 is not set
# CONFIG_SND_RME9652 is not set
# CONFIG_SND_SE6X is not set
# CONFIG_SND_SONICVIBES is not set
# CONFIG_SND_TRIDENT is not set
# CONFIG_SND_VIA82XX is not set
# CONFIG_SND_VIA82XX_MODEM is not set
# CONFIG_SND_VIRTUOSO is not set
# CONFIG_SND_VX222 is not set
# CONFIG_SND_YMFPCI is not set

#
# HD-Audio
#
CONFIG_SND_HDA=y
CONFIG_SND_HDA_GENERIC_LEDS=y
CONFIG_SND_HDA_INTEL=y
CONFIG_SND_HDA_HWDEP=y
CONFIG_SND_HDA_RECONFIG=y
# CONFIG_SND_HDA_INPUT_BEEP is not set
CONFIG_SND_HDA_PATCH_LOADER=y
CONFIG_SND_HDA_SCODEC_COMPONENT=y
CONFIG_SND_HDA_CODEC_REALTEK=y
# CONFIG_SND_HDA_CODEC_ANALOG is not set
# CONFIG_SND_HDA_CODEC_SIGMATEL is not set
# CONFIG_SND_HDA_CODEC_VIA is not set
# CONFIG_SND_HDA_CODEC_HDMI is not set
# CONFIG_SND_HDA_CODEC_CIRRUS is not set
# CONFIG_SND_HDA_CODEC_CS8409 is not set
# CONFIG_SND_HDA_CODEC_CONEXANT is not set
# CONFIG_SND_HDA_CODEC_SENARYTECH is not set
# CONFIG_SND_HDA_CODEC_CA0110 is not set
# CONFIG_SND_HDA_CODEC_CA0132 is not set
# CONFIG_SND_HDA_CODEC_CMEDIA is not set
# CONFIG_SND_HDA_CODEC_SI3054 is not set
CONFIG_SND_HDA_GENERIC=y
CONFIG_SND_HDA_POWER_SAVE_DEFAULT=0
# CONFIG_SND_HDA_INTEL_HDMI_SILENT_STREAM is not set
# CONFIG_SND_HDA_CTL_DEV_ID is not set
# end of HD-Audio

CONFIG_SND_HDA_CORE=y
CONFIG_SND_HDA_COMPONENT=y
CONFIG_SND_HDA_I915=y
CONFIG_SND_HDA_PREALLOC_SIZE=1024
CONFIG_SND_INTEL_NHLT=y
CONFIG_SND_INTEL_DSP_CONFIG=y
CONFIG_SND_INTEL_SOUNDWIRE_ACPI=y
# CONFIG_SND_USB is not set
# CONFIG_SND_SOC is not set
CONFIG_SND_X86=y
# CONFIG_HDMI_LPE_AUDIO is not set
CONFIG_HID_SUPPORT=y
CONFIG_HID=y
# CONFIG_HID_BATTERY_STRENGTH is not set
CONFIG_HIDRAW=y
# CONFIG_UHID is not set
CONFIG_HID_GENERIC=y

#
# Special HID drivers
#
CONFIG_HID_A4TECH=y
# CONFIG_HID_ACCUTOUCH is not set
# CONFIG_HID_ACRUX is not set
CONFIG_HID_APPLE=m
# CONFIG_HID_APPLEIR is not set
# CONFIG_HID_ASUS is not set
# CONFIG_HID_AUREAL is not set
CONFIG_HID_BELKIN=y
# CONFIG_HID_BETOP_FF is not set
# CONFIG_HID_BIGBEN_FF is not set
CONFIG_HID_CHERRY=y
CONFIG_HID_CHICONY=y
# CONFIG_HID_CORSAIR is not set
# CONFIG_HID_COUGAR is not set
# CONFIG_HID_MACALLY is not set
# CONFIG_HID_PRODIKEYS is not set
# CONFIG_HID_CMEDIA is not set
# CONFIG_HID_CREATIVE_SB0540 is not set
CONFIG_HID_CYPRESS=y
# CONFIG_HID_DRAGONRISE is not set
# CONFIG_HID_EMS_FF is not set
# CONFIG_HID_ELAN is not set
# CONFIG_HID_ELECOM is not set
# CONFIG_HID_ELO is not set
# CONFIG_HID_EVISION is not set
CONFIG_HID_EZKEY=y
# CONFIG_HID_FT260 is not set
# CONFIG_HID_GEMBIRD is not set
# CONFIG_HID_GFRM is not set
# CONFIG_HID_GLORIOUS is not set
# CONFIG_HID_HOLTEK is not set
# CONFIG_HID_GOOGLE_STADIA_FF is not set
# CONFIG_HID_VIVALDI is not set
# CONFIG_HID_GT683R is not set
# CONFIG_HID_KEYTOUCH is not set
# CONFIG_HID_KYE is not set
# CONFIG_HID_KYSONA is not set
# CONFIG_HID_UCLOGIC is not set
# CONFIG_HID_WALTOP is not set
# CONFIG_HID_VIEWSONIC is not set
# CONFIG_HID_VRC2 is not set
# CONFIG_HID_XIAOMI is not set
CONFIG_HID_GYRATION=y
# CONFIG_HID_ICADE is not set
CONFIG_HID_ITE=y
# CONFIG_HID_JABRA is not set
# CONFIG_HID_TWINHAN is not set
CONFIG_HID_KENSINGTON=y
# CONFIG_HID_LCPOWER is not set
# CONFIG_HID_LED is not set
# CONFIG_HID_LENOVO is not set
# CONFIG_HID_LETSKETCH is not set
CONFIG_HID_LOGITECH=m
# CONFIG_HID_LOGITECH_DJ is not set
# CONFIG_HID_LOGITECH_HIDPP is not set
CONFIG_LOGITECH_FF=y
# CONFIG_LOGIRUMBLEPAD2_FF is not set
# CONFIG_LOGIG940_FF is not set
CONFIG_LOGIWHEELS_FF=y
# CONFIG_HID_MAGICMOUSE is not set
# CONFIG_HID_MALTRON is not set
# CONFIG_HID_MAYFLASH is not set
# CONFIG_HID_MEGAWORLD_FF is not set
CONFIG_HID_REDRAGON=y
CONFIG_HID_MICROSOFT=y
CONFIG_HID_MONTEREY=y
# CONFIG_HID_MULTITOUCH is not set
# CONFIG_HID_NINTENDO is not set
# CONFIG_HID_NTI is not set
CONFIG_HID_NTRIG=y
# CONFIG_HID_ORTEK is not set
CONFIG_HID_PANTHERLORD=y
CONFIG_PANTHERLORD_FF=y
# CONFIG_HID_PENMOUNT is not set
CONFIG_HID_PETALYNX=y
# CONFIG_HID_PICOLCD is not set
# CONFIG_HID_PLANTRONICS is not set
# CONFIG_HID_PXRC is not set
# CONFIG_HID_RAZER is not set
# CONFIG_HID_PRIMAX is not set
# CONFIG_HID_RETRODE is not set
# CONFIG_HID_ROCCAT is not set
# CONFIG_HID_SAITEK is not set
CONFIG_HID_SAMSUNG=y
# CONFIG_HID_SEMITEK is not set
# CONFIG_HID_SIGMAMICRO is not set
CONFIG_HID_SONY=m
# CONFIG_SONY_FF is not set
# CONFIG_HID_SPEEDLINK is not set
# CONFIG_HID_STEAM is not set
# CONFIG_HID_STEELSERIES is not set
CONFIG_HID_SUNPLUS=y
# CONFIG_HID_RMI is not set
# CONFIG_HID_GREENASIA is not set
# CONFIG_HID_SMARTJOYPLUS is not set
# CONFIG_HID_TIVO is not set
CONFIG_HID_TOPSEED=y
# CONFIG_HID_TOPRE is not set
# CONFIG_HID_THINGM is not set
# CONFIG_HID_THRUSTMASTER is not set
# CONFIG_HID_UDRAW_PS3 is not set
# CONFIG_HID_U2FZERO is not set
# CONFIG_HID_WACOM is not set
# CONFIG_HID_WIIMOTE is not set
# CONFIG_HID_WINWING is not set
# CONFIG_HID_XINMO is not set
# CONFIG_HID_ZEROPLUS is not set
# CONFIG_HID_ZYDACRON is not set
# CONFIG_HID_SENSOR_HUB is not set
# CONFIG_HID_ALPS is not set
# CONFIG_HID_MCP2221 is not set
# end of Special HID drivers

#
# HID-BPF support
#
# end of HID-BPF support

#
# USB HID support
#
CONFIG_USB_HID=y
CONFIG_HID_PID=y
CONFIG_USB_HIDDEV=y
# end of USB HID support

CONFIG_I2C_HID=y
# CONFIG_I2C_HID_ACPI is not set
# CONFIG_I2C_HID_OF is not set

#
# Intel ISH HID support
#
# CONFIG_INTEL_ISH_HID is not set
# end of Intel ISH HID support

#
# AMD SFH HID Support
#
# CONFIG_AMD_SFH_HID is not set
# end of AMD SFH HID Support

CONFIG_USB_OHCI_LITTLE_ENDIAN=y
CONFIG_USB_SUPPORT=y
CONFIG_USB_COMMON=y
# CONFIG_USB_LED_TRIG is not set
# CONFIG_USB_ULPI_BUS is not set
CONFIG_USB_ARCH_HAS_HCD=y
CONFIG_USB=y
CONFIG_USB_PCI=y
CONFIG_USB_PCI_AMD=y
CONFIG_USB_ANNOUNCE_NEW_DEVICES=y

#
# Miscellaneous USB options
#
CONFIG_USB_DEFAULT_PERSIST=y
# CONFIG_USB_FEW_INIT_RETRIES is not set
# CONFIG_USB_DYNAMIC_MINORS is not set
# CONFIG_USB_OTG is not set
# CONFIG_USB_OTG_PRODUCTLIST is not set
# CONFIG_USB_LEDS_TRIGGER_USBPORT is not set
CONFIG_USB_AUTOSUSPEND_DELAY=2
CONFIG_USB_DEFAULT_AUTHORIZATION_MODE=1
CONFIG_USB_MON=y

#
# USB Host Controller Drivers
#
# CONFIG_USB_C67X00_HCD is not set
CONFIG_USB_XHCI_HCD=y
# CONFIG_USB_XHCI_DBGCAP is not set
CONFIG_USB_XHCI_PCI=y
# CONFIG_USB_XHCI_PCI_RENESAS is not set
# CONFIG_USB_XHCI_PLATFORM is not set
CONFIG_USB_EHCI_HCD=y
# CONFIG_USB_EHCI_ROOT_HUB_TT is not set
CONFIG_USB_EHCI_TT_NEWSCHED=y
CONFIG_USB_EHCI_PCI=y
# CONFIG_USB_EHCI_FSL is not set
# CONFIG_USB_EHCI_HCD_PLATFORM is not set
# CONFIG_USB_OXU210HP_HCD is not set
# CONFIG_USB_ISP116X_HCD is not set
CONFIG_USB_OHCI_HCD=y
CONFIG_USB_OHCI_HCD_PCI=y
# CONFIG_USB_OHCI_HCD_PLATFORM is not set
CONFIG_USB_UHCI_HCD=y
# CONFIG_USB_SL811_HCD is not set
# CONFIG_USB_R8A66597_HCD is not set
# CONFIG_USB_HCD_TEST_MODE is not set

#
# USB Device Class drivers
#
# CONFIG_USB_ACM is not set
CONFIG_USB_PRINTER=y
# CONFIG_USB_WDM is not set
# CONFIG_USB_TMC is not set

#
# NOTE: USB_STORAGE depends on SCSI but BLK_DEV_SD may
#

#
# also be needed; see USB_STORAGE Help for more info
#
CONFIG_USB_STORAGE=y
# CONFIG_USB_STORAGE_DEBUG is not set
# CONFIG_USB_STORAGE_REALTEK is not set
# CONFIG_USB_STORAGE_DATAFAB is not set
# CONFIG_USB_STORAGE_FREECOM is not set
# CONFIG_USB_STORAGE_ISD200 is not set
# CONFIG_USB_STORAGE_USBAT is not set
# CONFIG_USB_STORAGE_SDDR09 is not set
# CONFIG_USB_STORAGE_SDDR55 is not set
# CONFIG_USB_STORAGE_JUMPSHOT is not set
# CONFIG_USB_STORAGE_ALAUDA is not set
# CONFIG_USB_STORAGE_ONETOUCH is not set
# CONFIG_USB_STORAGE_KARMA is not set
# CONFIG_USB_STORAGE_CYPRESS_ATACB is not set
# CONFIG_USB_STORAGE_ENE_UB6250 is not set
# CONFIG_USB_UAS is not set

#
# USB Imaging devices
#
# CONFIG_USB_MDC800 is not set
# CONFIG_USB_MICROTEK is not set
# CONFIG_USBIP_CORE is not set

#
# USB dual-mode controller drivers
#
# CONFIG_USB_CDNS_SUPPORT is not set
# CONFIG_USB_MUSB_HDRC is not set
# CONFIG_USB_DWC3 is not set
# CONFIG_USB_DWC2 is not set
# CONFIG_USB_CHIPIDEA is not set
# CONFIG_USB_ISP1760 is not set

#
# USB port drivers
#
# CONFIG_USB_SERIAL is not set

#
# USB Miscellaneous drivers
#
# CONFIG_USB_EMI62 is not set
# CONFIG_USB_EMI26 is not set
# CONFIG_USB_ADUTUX is not set
# CONFIG_USB_SEVSEG is not set
# CONFIG_USB_LEGOTOWER is not set
# CONFIG_USB_LCD is not set
# CONFIG_USB_CYPRESS_CY7C63 is not set
# CONFIG_USB_CYTHERM is not set
# CONFIG_USB_IDMOUSE is not set
# CONFIG_USB_APPLEDISPLAY is not set
# CONFIG_APPLE_MFI_FASTCHARGE is not set
# CONFIG_USB_LJCA is not set
# CONFIG_USB_SISUSBVGA is not set
# CONFIG_USB_LD is not set
# CONFIG_USB_TRANCEVIBRATOR is not set
# CONFIG_USB_IOWARRIOR is not set
# CONFIG_USB_TEST is not set
# CONFIG_USB_EHSET_TEST_FIXTURE is not set
# CONFIG_USB_ISIGHTFW is not set
# CONFIG_USB_YUREX is not set
# CONFIG_USB_EZUSB_FX2 is not set
# CONFIG_USB_HUB_USB251XB is not set
# CONFIG_USB_HSIC_USB3503 is not set
# CONFIG_USB_HSIC_USB4604 is not set
# CONFIG_USB_LINK_LAYER_TEST is not set
# CONFIG_USB_CHAOSKEY is not set

#
# USB Physical Layer drivers
#
# CONFIG_NOP_USB_XCEIV is not set
# CONFIG_USB_ISP1301 is not set
# end of USB Physical Layer drivers

# CONFIG_USB_GADGET is not set
CONFIG_TYPEC=y
# CONFIG_TYPEC_TCPM is not set
# CONFIG_TYPEC_UCSI is not set
# CONFIG_TYPEC_TPS6598X is not set
# CONFIG_TYPEC_RT1719 is not set
# CONFIG_TYPEC_STUSB160X is not set
# CONFIG_TYPEC_WUSB3801 is not set

#
# USB Type-C Multiplexer/DeMultiplexer Switch support
#
# CONFIG_TYPEC_MUX_FSA4480 is not set
# CONFIG_TYPEC_MUX_GPIO_SBU is not set
# CONFIG_TYPEC_MUX_PI3USB30532 is not set
# CONFIG_TYPEC_MUX_IT5205 is not set
# CONFIG_TYPEC_MUX_NB7VPQ904M is not set
# CONFIG_TYPEC_MUX_PTN36502 is not set
# CONFIG_TYPEC_MUX_TUSB1046 is not set
# CONFIG_TYPEC_MUX_WCD939X_USBSS is not set
# end of USB Type-C Multiplexer/DeMultiplexer Switch support

#
# USB Type-C Alternate Mode drivers
#
# CONFIG_TYPEC_DP_ALTMODE is not set
# end of USB Type-C Alternate Mode drivers

# CONFIG_USB_ROLE_SWITCH is not set
# CONFIG_MMC is not set
# CONFIG_SCSI_UFSHCD is not set
# CONFIG_MEMSTICK is not set
CONFIG_NEW_LEDS=y
CONFIG_LEDS_CLASS=y
# CONFIG_LEDS_CLASS_FLASH is not set
# CONFIG_LEDS_CLASS_MULTICOLOR is not set
# CONFIG_LEDS_BRIGHTNESS_HW_CHANGED is not set

#
# LED drivers
#
# CONFIG_LEDS_APU is not set
# CONFIG_LEDS_AW200XX is not set
# CONFIG_LEDS_LM3530 is not set
# CONFIG_LEDS_LM3532 is not set
# CONFIG_LEDS_LM3642 is not set
# CONFIG_LEDS_PCA9532 is not set
# CONFIG_LEDS_LP3944 is not set
# CONFIG_LEDS_PCA955X is not set
# CONFIG_LEDS_PCA963X is not set
# CONFIG_LEDS_PCA995X is not set
# CONFIG_LEDS_BD2606MVV is not set
# CONFIG_LEDS_BD2802 is not set
# CONFIG_LEDS_INTEL_SS4200 is not set
# CONFIG_LEDS_TCA6507 is not set
# CONFIG_LEDS_TLC591XX is not set
# CONFIG_LEDS_LM355x is not set
# CONFIG_LEDS_IS31FL319X is not set

#
# LED driver for blink(1) USB RGB LED is under Special HID drivers (HID_THINGM)
#
# CONFIG_LEDS_BLINKM is not set
# CONFIG_LEDS_MLXCPLD is not set
# CONFIG_LEDS_MLXREG is not set
# CONFIG_LEDS_USER is not set
# CONFIG_LEDS_NIC78BX is not set

#
# Flash and Torch LED drivers
#

#
# RGB LED drivers
#

#
# LED Triggers
#
CONFIG_LEDS_TRIGGERS=y
# CONFIG_LEDS_TRIGGER_TIMER is not set
# CONFIG_LEDS_TRIGGER_ONESHOT is not set
# CONFIG_LEDS_TRIGGER_DISK is not set
# CONFIG_LEDS_TRIGGER_HEARTBEAT is not set
# CONFIG_LEDS_TRIGGER_BACKLIGHT is not set
# CONFIG_LEDS_TRIGGER_CPU is not set
# CONFIG_LEDS_TRIGGER_ACTIVITY is not set
# CONFIG_LEDS_TRIGGER_DEFAULT_ON is not set

#
# iptables trigger is under Netfilter config (LED target)
#
# CONFIG_LEDS_TRIGGER_TRANSIENT is not set
# CONFIG_LEDS_TRIGGER_CAMERA is not set
# CONFIG_LEDS_TRIGGER_PANIC is not set
# CONFIG_LEDS_TRIGGER_NETDEV is not set
# CONFIG_LEDS_TRIGGER_PATTERN is not set
# CONFIG_LEDS_TRIGGER_TTY is not set
# CONFIG_LEDS_TRIGGER_INPUT_EVENTS is not set

#
# Simple LED drivers
#
# CONFIG_ACCESSIBILITY is not set
# CONFIG_INFINIBAND is not set
CONFIG_EDAC_ATOMIC_SCRUB=y
CONFIG_EDAC_SUPPORT=y
CONFIG_RTC_LIB=y
CONFIG_RTC_MC146818_LIB=y
CONFIG_RTC_CLASS=y
# CONFIG_RTC_HCTOSYS is not set
CONFIG_RTC_SYSTOHC=y
CONFIG_RTC_SYSTOHC_DEVICE=""rtc0""
# CONFIG_RTC_DEBUG is not set
CONFIG_RTC_NVMEM=y

#
# RTC interfaces
#
CONFIG_RTC_INTF_SYSFS=y
CONFIG_RTC_INTF_PROC=y
CONFIG_RTC_INTF_DEV=y
# CONFIG_RTC_INTF_DEV_UIE_EMUL is not set
# CONFIG_RTC_DRV_TEST is not set

#
# I2C RTC drivers
#
# CONFIG_RTC_DRV_ABB5ZES3 is not set
# CONFIG_RTC_DRV_ABEOZ9 is not set
# CONFIG_RTC_DRV_ABX80X is not set
# CONFIG_RTC_DRV_DS1307 is not set
# CONFIG_RTC_DRV_DS1374 is not set
# CONFIG_RTC_DRV_DS1672 is not set
# CONFIG_RTC_DRV_MAX6900 is not set
# CONFIG_RTC_DRV_MAX31335 is not set
# CONFIG_RTC_DRV_RS5C372 is not set
# CONFIG_RTC_DRV_ISL1208 is not set
# CONFIG_RTC_DRV_ISL12022 is not set
# CONFIG_RTC_DRV_X1205 is not set
# CONFIG_RTC_DRV_PCF8523 is not set
# CONFIG_RTC_DRV_PCF85063 is not set
# CONFIG_RTC_DRV_PCF85363 is not set
# CONFIG_RTC_DRV_PCF8563 is not set
# CONFIG_RTC_DRV_PCF8583 is not set
# CONFIG_RTC_DRV_M41T80 is not set
# CONFIG_RTC_DRV_BQ32K is not set
# CONFIG_RTC_DRV_S35390A is not set
# CONFIG_RTC_DRV_FM3130 is not set
# CONFIG_RTC_DRV_RX8010 is not set
# CONFIG_RTC_DRV_RX8111 is not set
# CONFIG_RTC_DRV_RX8581 is not set
# CONFIG_RTC_DRV_RX8025 is not set
# CONFIG_RTC_DRV_EM3027 is not set
# CONFIG_RTC_DRV_RV3028 is not set
# CONFIG_RTC_DRV_RV3032 is not set
# CONFIG_RTC_DRV_RV8803 is not set
# CONFIG_RTC_DRV_SD2405AL is not set
# CONFIG_RTC_DRV_SD3078 is not set

#
# SPI RTC drivers
#
CONFIG_RTC_I2C_AND_SPI=y

#
# SPI and I2C RTC drivers
#
# CONFIG_RTC_DRV_DS3232 is not set
# CONFIG_RTC_DRV_PCF2127 is not set
# CONFIG_RTC_DRV_RV3029C2 is not set
# CONFIG_RTC_DRV_RX6110 is not set

#
# Platform RTC drivers
#
CONFIG_RTC_DRV_CMOS=y
# CONFIG_RTC_DRV_DS1286 is not set
# CONFIG_RTC_DRV_DS1511 is not set
# CONFIG_RTC_DRV_DS1553 is not set
# CONFIG_RTC_DRV_DS1685_FAMILY is not set
# CONFIG_RTC_DRV_DS1742 is not set
# CONFIG_RTC_DRV_DS2404 is not set
# CONFIG_RTC_DRV_STK17TA8 is not set
# CONFIG_RTC_DRV_M48T86 is not set
# CONFIG_RTC_DRV_M48T35 is not set
# CONFIG_RTC_DRV_M48T59 is not set
# CONFIG_RTC_DRV_MSM6242 is not set
# CONFIG_RTC_DRV_RP5C01 is not set

#
# on-CPU RTC drivers
#
# CONFIG_RTC_DRV_FTRTC010 is not set

#
# HID Sensor RTC drivers
#
# CONFIG_RTC_DRV_GOLDFISH is not set
CONFIG_DMADEVICES=y
# CONFIG_DMADEVICES_DEBUG is not set

#
# DMA Devices
#
CONFIG_DMA_ENGINE=y
CONFIG_DMA_VIRTUAL_CHANNELS=y
CONFIG_DMA_ACPI=y
# CONFIG_ALTERA_MSGDMA is not set
# CONFIG_INTEL_IDMA64 is not set
# CONFIG_INTEL_IDXD is not set
# CONFIG_INTEL_IDXD_COMPAT is not set
# CONFIG_INTEL_IOATDMA is not set
# CONFIG_PLX_DMA is not set
# CONFIG_XILINX_DMA is not set
# CONFIG_XILINX_XDMA is not set
# CONFIG_AMD_QDMA is not set
# CONFIG_AMD_PTDMA is not set
# CONFIG_QCOM_HIDMA_MGMT is not set
# CONFIG_QCOM_HIDMA is not set
CONFIG_DW_DMAC_CORE=y
# CONFIG_DW_DMAC is not set
CONFIG_DW_DMAC_PCI=y
# CONFIG_DW_EDMA is not set
CONFIG_HSU_DMA=y
# CONFIG_SF_PDMA is not set
# CONFIG_INTEL_LDMA is not set

#
# DMA Clients
#
# CONFIG_ASYNC_TX_DMA is not set
# CONFIG_DMATEST is not set

#
# DMABUF options
#
CONFIG_SYNC_FILE=y
# CONFIG_SW_SYNC is not set
# CONFIG_UDMABUF is not set
# CONFIG_DMABUF_MOVE_NOTIFY is not set
# CONFIG_DMABUF_DEBUG is not set
# CONFIG_DMABUF_SELFTESTS is not set
# CONFIG_DMABUF_HEAPS is not set
# CONFIG_DMABUF_SYSFS_STATS is not set
# end of DMABUF options

# CONFIG_UIO is not set
# CONFIG_VFIO is not set
CONFIG_IRQ_BYPASS_MANAGER=y
# CONFIG_VIRT_DRIVERS is not set
CONFIG_VIRTIO_MENU=y
# CONFIG_VIRTIO_PCI is not set
# CONFIG_VIRTIO_MMIO is not set
# CONFIG_VDPA is not set
CONFIG_VHOST_TASK=y
CONFIG_VHOST_MENU=y
# CONFIG_VHOST_NET is not set
# CONFIG_VHOST_CROSS_ENDIAN_LEGACY is not set

#
# Microsoft Hyper-V guest support
#
# end of Microsoft Hyper-V guest support

# CONFIG_GREYBUS is not set
# CONFIG_COMEDI is not set
# CONFIG_STAGING is not set
# CONFIG_GOLDFISH is not set
# CONFIG_CHROME_PLATFORMS is not set
# CONFIG_MELLANOX_PLATFORM is not set
CONFIG_SURFACE_PLATFORMS=y
# CONFIG_SURFACE_3_POWER_OPREGION is not set
# CONFIG_SURFACE_GPE is not set
# CONFIG_SURFACE_PRO3_BUTTON is not set
CONFIG_X86_PLATFORM_DEVICES=y
CONFIG_ACPI_WMI=m
CONFIG_WMI_BMOF=m
# CONFIG_HUAWEI_WMI is not set
# CONFIG_MXM_WMI is not set
# CONFIG_NVIDIA_WMI_EC_BACKLIGHT is not set
# CONFIG_XIAOMI_WMI is not set
# CONFIG_GIGABYTE_WMI is not set
# CONFIG_YOGABOOK is not set
# CONFIG_ACERHDF is not set
# CONFIG_ACER_WIRELESS is not set
# CONFIG_ACER_WMI is not set

#
# AMD HSMP Driver
#
# CONFIG_AMD_HSMP_ACPI is not set
# CONFIG_AMD_HSMP_PLAT is not set
# end of AMD HSMP Driver

# CONFIG_AMD_PMC is not set
# CONFIG_AMD_3D_VCACHE is not set
# CONFIG_AMD_WBRF is not set
# CONFIG_ADV_SWBUTTON is not set
# CONFIG_APPLE_GMUX is not set
# CONFIG_ASUS_LAPTOP is not set
# CONFIG_ASUS_WIRELESS is not set
# CONFIG_ASUS_WMI is not set
CONFIG_EEEPC_LAPTOP=m
# CONFIG_X86_PLATFORM_DRIVERS_DELL is not set
# CONFIG_AMILO_RFKILL is not set
# CONFIG_FUJITSU_LAPTOP is not set
# CONFIG_FUJITSU_TABLET is not set
# CONFIG_GPD_POCKET_FAN is not set
# CONFIG_X86_PLATFORM_DRIVERS_HP is not set
# CONFIG_WIRELESS_HOTKEY is not set
# CONFIG_IBM_RTL is not set
# CONFIG_IDEAPAD_LAPTOP is not set
# CONFIG_SENSORS_HDAPS is not set
CONFIG_THINKPAD_ACPI=m
CONFIG_THINKPAD_ACPI_ALSA_SUPPORT=y
# CONFIG_THINKPAD_ACPI_DEBUGFACILITIES is not set
# CONFIG_THINKPAD_ACPI_DEBUG is not set
# CONFIG_THINKPAD_ACPI_UNSAFE_LEDS is not set
CONFIG_THINKPAD_ACPI_VIDEO=y
CONFIG_THINKPAD_ACPI_HOTKEY_POLL=y
# CONFIG_THINKPAD_LMI is not set
# CONFIG_INTEL_ATOMISP2_PM is not set
# CONFIG_INTEL_IFS is not set
# CONFIG_INTEL_SAR_INT1092 is not set

#
# Intel Speed Select Technology interface support
#
# CONFIG_INTEL_SPEED_SELECT_INTERFACE is not set
# end of Intel Speed Select Technology interface support

# CONFIG_INTEL_WMI_SBL_FW_UPDATE is not set
# CONFIG_INTEL_WMI_THUNDERBOLT is not set

#
# Intel Uncore Frequency Control
#
# CONFIG_INTEL_UNCORE_FREQ_CONTROL is not set
# end of Intel Uncore Frequency Control

# CONFIG_INTEL_HID_EVENT is not set
# CONFIG_INTEL_VBTN is not set
# CONFIG_INTEL_OAKTRAIL is not set
# CONFIG_INTEL_PUNIT_IPC is not set
# CONFIG_INTEL_RST is not set
# CONFIG_INTEL_SMARTCONNECT is not set
# CONFIG_INTEL_TURBO_MAX_3 is not set
# CONFIG_INTEL_VSEC is not set
# CONFIG_ACPI_QUICKSTART is not set
# CONFIG_MSI_EC is not set
# CONFIG_MSI_LAPTOP is not set
# CONFIG_MSI_WMI is not set
# CONFIG_MSI_WMI_PLATFORM is not set
# CONFIG_SAMSUNG_LAPTOP is not set
# CONFIG_SAMSUNG_Q10 is not set
# CONFIG_TOSHIBA_BT_RFKILL is not set
# CONFIG_TOSHIBA_HAPS is not set
# CONFIG_TOSHIBA_WMI is not set
# CONFIG_ACPI_CMPC is not set
# CONFIG_COMPAL_LAPTOP is not set
# CONFIG_LG_LAPTOP is not set
# CONFIG_PANASONIC_LAPTOP is not set
# CONFIG_SONY_LAPTOP is not set
# CONFIG_SYSTEM76_ACPI is not set
# CONFIG_TOPSTAR_LAPTOP is not set
# CONFIG_SERIAL_MULTI_INSTANTIATE is not set
# CONFIG_MLX_PLATFORM is not set
# CONFIG_INSPUR_PLATFORM_PROFILE is not set
# CONFIG_LENOVO_WMI_CAMERA is not set
# CONFIG_INTEL_IPS is not set
# CONFIG_INTEL_SCU_PCI is not set
# CONFIG_INTEL_SCU_PLATFORM is not set
# CONFIG_SIEMENS_SIMATIC_IPC is not set
# CONFIG_WINMATE_FM07_KEYS is not set
CONFIG_P2SB=y
CONFIG_HAVE_CLK=y
CONFIG_HAVE_CLK_PREPARE=y
CONFIG_COMMON_CLK=y
# CONFIG_COMMON_CLK_MAX9485 is not set
# CONFIG_COMMON_CLK_SI5341 is not set
# CONFIG_COMMON_CLK_SI5351 is not set
# CONFIG_COMMON_CLK_SI544 is not set
# CONFIG_COMMON_CLK_CDCE706 is not set
# CONFIG_COMMON_CLK_CS2000_CP is not set
# CONFIG_XILINX_VCU is not set
# CONFIG_HWSPINLOCK is not set

#
# Clock Source drivers
#
CONFIG_CLKEVT_I8253=y
CONFIG_I8253_LOCK=y
CONFIG_CLKBLD_I8253=y
# end of Clock Source drivers

CONFIG_MAILBOX=y
CONFIG_PCC=y
# CONFIG_ALTERA_MBOX is not set
CONFIG_IOMMU_IOVA=y
CONFIG_IOMMU_API=y
CONFIG_IOMMU_SUPPORT=y

#
# Generic IOMMU Pagetable Support
#
# end of Generic IOMMU Pagetable Support

# CONFIG_IOMMU_DEBUGFS is not set
# CONFIG_IOMMU_DEFAULT_DMA_STRICT is not set
CONFIG_IOMMU_DEFAULT_DMA_LAZY=y
# CONFIG_IOMMU_DEFAULT_PASSTHROUGH is not set
CONFIG_IOMMU_DMA=y
CONFIG_IOMMU_IOPF=y
# CONFIG_AMD_IOMMU is not set
CONFIG_DMAR_TABLE=y
CONFIG_INTEL_IOMMU=y
# CONFIG_INTEL_IOMMU_SVM is not set
CONFIG_INTEL_IOMMU_DEFAULT_ON=y
CONFIG_INTEL_IOMMU_FLOPPY_WA=y
CONFIG_INTEL_IOMMU_SCALABLE_MODE_DEFAULT_ON=y
CONFIG_INTEL_IOMMU_PERF_EVENTS=y
# CONFIG_IOMMUFD is not set
# CONFIG_IRQ_REMAP is not set

#
# Remoteproc drivers
#
# CONFIG_REMOTEPROC is not set
# end of Remoteproc drivers

#
# Rpmsg drivers
#
# CONFIG_RPMSG_QCOM_GLINK_RPM is not set
# CONFIG_RPMSG_VIRTIO is not set
# end of Rpmsg drivers

#
# SOC (System On Chip) specific Drivers
#

#
# Amlogic SoC drivers
#
# end of Amlogic SoC drivers

#
# Broadcom SoC drivers
#
# end of Broadcom SoC drivers

#
# NXP/Freescale QorIQ SoC drivers
#
# end of NXP/Freescale QorIQ SoC drivers

#
# fujitsu SoC drivers
#
# end of fujitsu SoC drivers

#
# i.MX SoC drivers
#
# end of i.MX SoC drivers

#
# Enable LiteX SoC Builder specific drivers
#
# end of Enable LiteX SoC Builder specific drivers

# CONFIG_WPCM450_SOC is not set

#
# Qualcomm SoC drivers
#
# end of Qualcomm SoC drivers

# CONFIG_SOC_TI is not set

#
# Xilinx SoC drivers
#
# end of Xilinx SoC drivers
# end of SOC (System On Chip) specific Drivers

#
# PM Domains
#

#
# Amlogic PM Domains
#
# end of Amlogic PM Domains

#
# Broadcom PM Domains
#
# end of Broadcom PM Domains

#
# i.MX PM Domains
#
# end of i.MX PM Domains

#
# Qualcomm PM Domains
#
# end of Qualcomm PM Domains
# end of PM Domains

# CONFIG_PM_DEVFREQ is not set
# CONFIG_EXTCON is not set
# CONFIG_MEMORY is not set
# CONFIG_IIO is not set
# CONFIG_NTB is not set
# CONFIG_PWM is not set

#
# IRQ chip support
#
# end of IRQ chip support

# CONFIG_IPACK_BUS is not set
# CONFIG_RESET_CONTROLLER is not set

#
# PHY Subsystem
#
# CONFIG_GENERIC_PHY is not set
# CONFIG_USB_LGM_PHY is not set
# CONFIG_PHY_CAN_TRANSCEIVER is not set

#
# PHY drivers for Broadcom platforms
#
# CONFIG_BCM_KONA_USB2_PHY is not set
# end of PHY drivers for Broadcom platforms

# CONFIG_PHY_PXA_28NM_HSIC is not set
# CONFIG_PHY_PXA_28NM_USB2 is not set
# CONFIG_PHY_INTEL_LGM_EMMC is not set
# end of PHY Subsystem

# CONFIG_POWERCAP is not set
# CONFIG_MCB is not set

#
# Performance monitor support
#
# CONFIG_DWC_PCIE_PMU is not set
# end of Performance monitor support

# CONFIG_RAS is not set
# CONFIG_USB4 is not set

#
# Android
#
# CONFIG_ANDROID_BINDER_IPC is not set
# end of Android

# CONFIG_LIBNVDIMM is not set
# CONFIG_DAX is not set
CONFIG_NVMEM=y
CONFIG_NVMEM_SYSFS=y
# CONFIG_NVMEM_LAYOUTS is not set
# CONFIG_NVMEM_RMEM is not set

#
# HW tracing support
#
# CONFIG_STM is not set
# CONFIG_INTEL_TH is not set
# end of HW tracing support

# CONFIG_FPGA is not set
# CONFIG_TEE is not set
# CONFIG_SIOX is not set
# CONFIG_SLIMBUS is not set
# CONFIG_INTERCONNECT is not set
# CONFIG_COUNTER is not set
# CONFIG_PECI is not set
# CONFIG_HTE is not set
CONFIG_DPLL=y
# end of Device Drivers

#
# File systems
#
CONFIG_DCACHE_WORD_ACCESS=y
# CONFIG_VALIDATE_FS_PARSER is not set
CONFIG_FS_IOMAP=y
CONFIG_FS_STACK=y
CONFIG_BUFFER_HEAD=y
CONFIG_LEGACY_DIRECT_IO=y
# CONFIG_EXT2_FS is not set
# CONFIG_EXT3_FS is not set
CONFIG_EXT4_FS=y
CONFIG_EXT4_USE_FOR_EXT2=y
CONFIG_EXT4_FS_POSIX_ACL=y
CONFIG_EXT4_FS_SECURITY=y
# CONFIG_EXT4_DEBUG is not set
CONFIG_JBD2=y
# CONFIG_JBD2_DEBUG is not set
CONFIG_FS_MBCACHE=y
# CONFIG_JFS_FS is not set
CONFIG_XFS_FS=y
CONFIG_XFS_SUPPORT_V4=y
CONFIG_XFS_SUPPORT_ASCII_CI=y
# CONFIG_XFS_QUOTA is not set
CONFIG_XFS_POSIX_ACL=y
CONFIG_XFS_RT=y
# CONFIG_XFS_ONLINE_SCRUB is not set
# CONFIG_XFS_WARN is not set
# CONFIG_XFS_DEBUG is not set
# CONFIG_GFS2_FS is not set
# CONFIG_BTRFS_FS is not set
# CONFIG_NILFS2_FS is not set
# CONFIG_F2FS_FS is not set
# CONFIG_BCACHEFS_FS is not set
CONFIG_FS_POSIX_ACL=y
CONFIG_EXPORTFS=y
# CONFIG_EXPORTFS_BLOCK_OPS is not set
CONFIG_FILE_LOCKING=y
# CONFIG_FS_ENCRYPTION is not set
# CONFIG_FS_VERITY is not set
CONFIG_FSNOTIFY=y
CONFIG_DNOTIFY=y
CONFIG_INOTIFY_USER=y
# CONFIG_FANOTIFY is not set
CONFIG_QUOTA=y
CONFIG_QUOTA_NETLINK_INTERFACE=y
# CONFIG_QUOTA_DEBUG is not set
CONFIG_QUOTA_TREE=y
# CONFIG_QFMT_V1 is not set
CONFIG_QFMT_V2=y
CONFIG_QUOTACTL=y
CONFIG_AUTOFS_FS=y
CONFIG_FUSE_FS=y
# CONFIG_CUSE is not set
# CONFIG_VIRTIO_FS is not set
CONFIG_FUSE_PASSTHROUGH=y
# CONFIG_OVERLAY_FS is not set

#
# Caches
#
# end of Caches

#
# CD-ROM/DVD Filesystems
#
CONFIG_ISO9660_FS=y
CONFIG_JOLIET=y
CONFIG_ZISOFS=y
CONFIG_UDF_FS=y
# end of CD-ROM/DVD Filesystems

#
# DOS/FAT/EXFAT/NT Filesystems
#
CONFIG_FAT_FS=y
CONFIG_MSDOS_FS=y
CONFIG_VFAT_FS=y
CONFIG_FAT_DEFAULT_CODEPAGE=437
CONFIG_FAT_DEFAULT_IOCHARSET=""iso8859-1""
# CONFIG_FAT_DEFAULT_UTF8 is not set
CONFIG_EXFAT_FS=m
CONFIG_EXFAT_DEFAULT_IOCHARSET=""utf8""
CONFIG_NTFS3_FS=m
# CONFIG_NTFS3_64BIT_CLUSTER is not set
# CONFIG_NTFS3_LZX_XPRESS is not set
# CONFIG_NTFS3_FS_POSIX_ACL is not set
CONFIG_NTFS_FS=m
# end of DOS/FAT/EXFAT/NT Filesystems

#
# Pseudo filesystems
#
CONFIG_PROC_FS=y
CONFIG_PROC_KCORE=y
CONFIG_PROC_VMCORE=y
# CONFIG_PROC_VMCORE_DEVICE_DUMP is not set
CONFIG_PROC_SYSCTL=y
CONFIG_PROC_PAGE_MONITOR=y
# CONFIG_PROC_CHILDREN is not set
CONFIG_PROC_PID_ARCH_STATUS=y
CONFIG_KERNFS=y
CONFIG_SYSFS=y
CONFIG_TMPFS=y
CONFIG_TMPFS_POSIX_ACL=y
CONFIG_TMPFS_XATTR=y
# CONFIG_TMPFS_INODE64 is not set
# CONFIG_TMPFS_QUOTA is not set
CONFIG_HUGETLBFS=y
# CONFIG_HUGETLB_PAGE_OPTIMIZE_VMEMMAP_DEFAULT_ON is not set
CONFIG_HUGETLB_PAGE=y
CONFIG_HUGETLB_PAGE_OPTIMIZE_VMEMMAP=y
CONFIG_HUGETLB_PMD_PAGE_TABLE_SHARING=y
CONFIG_ARCH_HAS_GIGANTIC_PAGE=y
# CONFIG_CONFIGFS_FS is not set
CONFIG_EFIVAR_FS=m
# end of Pseudo filesystems

CONFIG_MISC_FILESYSTEMS=y
# CONFIG_ORANGEFS_FS is not set
# CONFIG_ADFS_FS is not set
# CONFIG_AFFS_FS is not set
# CONFIG_ECRYPT_FS is not set
# CONFIG_HFS_FS is not set
# CONFIG_HFSPLUS_FS is not set
# CONFIG_BEFS_FS is not set
# CONFIG_BFS_FS is not set
# CONFIG_EFS_FS is not set
# CONFIG_CRAMFS is not set
# CONFIG_SQUASHFS is not set
# CONFIG_VXFS_FS is not set
# CONFIG_MINIX_FS is not set
# CONFIG_OMFS_FS is not set
# CONFIG_HPFS_FS is not set
# CONFIG_QNX4FS_FS is not set
# CONFIG_QNX6FS_FS is not set
# CONFIG_ROMFS_FS is not set
# CONFIG_PSTORE is not set
# CONFIG_SYSV_FS is not set
# CONFIG_UFS_FS is not set
# CONFIG_EROFS_FS is not set
CONFIG_NETWORK_FILESYSTEMS=y
CONFIG_NFS_FS=y
CONFIG_NFS_V2=y
CONFIG_NFS_V3=y
CONFIG_NFS_V3_ACL=y
CONFIG_NFS_V4=y
# CONFIG_NFS_SWAP is not set
# CONFIG_NFS_V4_1 is not set
CONFIG_ROOT_NFS=y
# CONFIG_NFS_FSCACHE is not set
# CONFIG_NFS_USE_LEGACY_DNS is not set
CONFIG_NFS_USE_KERNEL_DNS=y
CONFIG_NFS_DISABLE_UDP_SUPPORT=y
# CONFIG_NFSD is not set
CONFIG_GRACE_PERIOD=y
CONFIG_LOCKD=y
CONFIG_LOCKD_V4=y
CONFIG_NFS_ACL_SUPPORT=y
CONFIG_NFS_COMMON=y
CONFIG_SUNRPC=y
CONFIG_SUNRPC_GSS=y
CONFIG_RPCSEC_GSS_KRB5=y
# CONFIG_SUNRPC_DEBUG is not set
# CONFIG_CEPH_FS is not set
# CONFIG_CIFS is not set
# CONFIG_SMB_SERVER is not set
# CONFIG_CODA_FS is not set
# CONFIG_AFS_FS is not set
CONFIG_NLS=y
CONFIG_NLS_DEFAULT=""utf8""
CONFIG_NLS_CODEPAGE_437=y
# CONFIG_NLS_CODEPAGE_737 is not set
# CONFIG_NLS_CODEPAGE_775 is not set
# CONFIG_NLS_CODEPAGE_850 is not set
# CONFIG_NLS_CODEPAGE_852 is not set
# CONFIG_NLS_CODEPAGE_855 is not set
# CONFIG_NLS_CODEPAGE_857 is not set
# CONFIG_NLS_CODEPAGE_860 is not set
# CONFIG_NLS_CODEPAGE_861 is not set
# CONFIG_NLS_CODEPAGE_862 is not set
# CONFIG_NLS_CODEPAGE_863 is not set
# CONFIG_NLS_CODEPAGE_864 is not set
# CONFIG_NLS_CODEPAGE_865 is not set
# CONFIG_NLS_CODEPAGE_866 is not set
# CONFIG_NLS_CODEPAGE_869 is not set
# CONFIG_NLS_CODEPAGE_936 is not set
# CONFIG_NLS_CODEPAGE_950 is not set
# CONFIG_NLS_CODEPAGE_932 is not set
# CONFIG_NLS_CODEPAGE_949 is not set
# CONFIG_NLS_CODEPAGE_874 is not set
# CONFIG_NLS_ISO8859_8 is not set
# CONFIG_NLS_CODEPAGE_1250 is not set
# CONFIG_NLS_CODEPAGE_1251 is not set
CONFIG_NLS_ASCII=y
CONFIG_NLS_ISO8859_1=y
# CONFIG_NLS_ISO8859_2 is not set
# CONFIG_NLS_ISO8859_3 is not set
# CONFIG_NLS_ISO8859_4 is not set
# CONFIG_NLS_ISO8859_5 is not set
# CONFIG_NLS_ISO8859_6 is not set
# CONFIG_NLS_ISO8859_7 is not set
# CONFIG_NLS_ISO8859_9 is not set
# CONFIG_NLS_ISO8859_13 is not set
# CONFIG_NLS_ISO8859_14 is not set
# CONFIG_NLS_ISO8859_15 is not set
# CONFIG_NLS_KOI8_R is not set
# CONFIG_NLS_KOI8_U is not set
# CONFIG_NLS_MAC_ROMAN is not set
# CONFIG_NLS_MAC_CELTIC is not set
# CONFIG_NLS_MAC_CENTEURO is not set
# CONFIG_NLS_MAC_CROATIAN is not set
# CONFIG_NLS_MAC_CYRILLIC is not set
# CONFIG_NLS_MAC_GAELIC is not set
# CONFIG_NLS_MAC_GREEK is not set
# CONFIG_NLS_MAC_ICELAND is not set
# CONFIG_NLS_MAC_INUIT is not set
# CONFIG_NLS_MAC_ROMANIAN is not set
# CONFIG_NLS_MAC_TURKISH is not set
CONFIG_NLS_UTF8=y
# CONFIG_UNICODE is not set
CONFIG_IO_WQ=y
# end of File systems

#
# Security options
#
CONFIG_KEYS=y
# CONFIG_KEYS_REQUEST_CACHE is not set
# CONFIG_PERSISTENT_KEYRINGS is not set
# CONFIG_TRUSTED_KEYS is not set
# CONFIG_ENCRYPTED_KEYS is not set
# CONFIG_KEY_DH_OPERATIONS is not set
# CONFIG_SECURITY_DMESG_RESTRICT is not set
CONFIG_PROC_MEM_ALWAYS_FORCE=y
# CONFIG_PROC_MEM_FORCE_PTRACE is not set
# CONFIG_PROC_MEM_NO_FORCE is not set
CONFIG_SECURITY=y
CONFIG_SECURITYFS=y
CONFIG_SECURITY_NETWORK=y
# CONFIG_SECURITY_NETWORK_XFRM is not set
CONFIG_SECURITY_PATH=y
# CONFIG_INTEL_TXT is not set
CONFIG_LSM_MMAP_MIN_ADDR=65536
# CONFIG_HARDENED_USERCOPY is not set
# CONFIG_FORTIFY_SOURCE is not set
# CONFIG_STATIC_USERMODEHELPER is not set
CONFIG_SECURITY_SELINUX=y
CONFIG_SECURITY_SELINUX_BOOTPARAM=y
CONFIG_SECURITY_SELINUX_DEVELOP=y
CONFIG_SECURITY_SELINUX_AVC_STATS=y
CONFIG_SECURITY_SELINUX_SIDTAB_HASH_BITS=9
CONFIG_SECURITY_SELINUX_SID2STR_CACHE_SIZE=256
# CONFIG_SECURITY_SELINUX_DEBUG is not set
# CONFIG_SECURITY_SMACK is not set
# CONFIG_SECURITY_TOMOYO is not set
CONFIG_SECURITY_APPARMOR=y
# CONFIG_SECURITY_APPARMOR_DEBUG is not set
CONFIG_SECURITY_APPARMOR_INTROSPECT_POLICY=y
CONFIG_SECURITY_APPARMOR_HASH=y
CONFIG_SECURITY_APPARMOR_HASH_DEFAULT=y
CONFIG_SECURITY_APPARMOR_EXPORT_BINARY=y
CONFIG_SECURITY_APPARMOR_PARANOID_LOAD=y
# CONFIG_SECURITY_LOADPIN is not set
# CONFIG_SECURITY_YAMA is not set
# CONFIG_SECURITY_SAFESETID is not set
# CONFIG_SECURITY_LOCKDOWN_LSM is not set
CONFIG_SECURITY_LANDLOCK=y
# CONFIG_SECURITY_IPE is not set
CONFIG_INTEGRITY=y
# CONFIG_INTEGRITY_SIGNATURE is not set
CONFIG_INTEGRITY_AUDIT=y
# CONFIG_IMA is not set
# CONFIG_IMA_SECURE_AND_OR_TRUSTED_BOOT is not set
# CONFIG_EVM is not set
CONFIG_DEFAULT_SECURITY_SELINUX=y
# CONFIG_DEFAULT_SECURITY_APPARMOR is not set
# CONFIG_DEFAULT_SECURITY_DAC is not set
CONFIG_LSM=""landlock,lockdown,yama,loadpin,safesetid,integrity,selinux,smack,tomoyo,apparmor,bpf""

#
# Kernel hardening options
#

#
# Memory initialization
#
CONFIG_CC_HAS_AUTO_VAR_INIT_PATTERN=y
CONFIG_CC_HAS_AUTO_VAR_INIT_ZERO_BARE=y
CONFIG_CC_HAS_AUTO_VAR_INIT_ZERO=y
# CONFIG_INIT_STACK_NONE is not set
# CONFIG_INIT_STACK_ALL_PATTERN is not set
CONFIG_INIT_STACK_ALL_ZERO=y
# CONFIG_GCC_PLUGIN_STACKLEAK is not set
# CONFIG_INIT_ON_ALLOC_DEFAULT_ON is not set
# CONFIG_INIT_ON_FREE_DEFAULT_ON is not set
CONFIG_CC_HAS_ZERO_CALL_USED_REGS=y
# CONFIG_ZERO_CALL_USED_REGS is not set
# end of Memory initialization

#
# Hardening of kernel data structures
#
# CONFIG_LIST_HARDENED is not set
# CONFIG_BUG_ON_DATA_CORRUPTION is not set
# end of Hardening of kernel data structures

CONFIG_RANDSTRUCT_NONE=y
# CONFIG_RANDSTRUCT_FULL is not set
# CONFIG_RANDSTRUCT_PERFORMANCE is not set
# end of Kernel hardening options
# end of Security options

CONFIG_CRYPTO=y

#
# Crypto core or helper
#
CONFIG_CRYPTO_ALGAPI=y
CONFIG_CRYPTO_ALGAPI2=y
CONFIG_CRYPTO_AEAD=y
CONFIG_CRYPTO_AEAD2=y
CONFIG_CRYPTO_SIG=y
CONFIG_CRYPTO_SIG2=y
CONFIG_CRYPTO_SKCIPHER=y
CONFIG_CRYPTO_SKCIPHER2=y
CONFIG_CRYPTO_HASH=y
CONFIG_CRYPTO_HASH2=y
CONFIG_CRYPTO_RNG=y
CONFIG_CRYPTO_RNG2=y
CONFIG_CRYPTO_RNG_DEFAULT=y
CONFIG_CRYPTO_AKCIPHER2=y
CONFIG_CRYPTO_AKCIPHER=y
CONFIG_CRYPTO_KPP2=y
CONFIG_CRYPTO_ACOMP2=y
CONFIG_CRYPTO_MANAGER=y
CONFIG_CRYPTO_MANAGER2=y
# CONFIG_CRYPTO_USER is not set
CONFIG_CRYPTO_MANAGER_DISABLE_TESTS=y
CONFIG_CRYPTO_NULL=y
CONFIG_CRYPTO_NULL2=y
# CONFIG_CRYPTO_PCRYPT is not set
CONFIG_CRYPTO_CRYPTD=y
CONFIG_CRYPTO_AUTHENC=y
# CONFIG_CRYPTO_TEST is not set
CONFIG_CRYPTO_SIMD=y
# end of Crypto core or helper

#
# Public-key cryptography
#
CONFIG_CRYPTO_RSA=y
# CONFIG_CRYPTO_DH is not set
# CONFIG_CRYPTO_ECDH is not set
# CONFIG_CRYPTO_ECDSA is not set
# CONFIG_CRYPTO_ECRDSA is not set
# CONFIG_CRYPTO_CURVE25519 is not set
# end of Public-key cryptography

#
# Block ciphers
#
CONFIG_CRYPTO_AES=y
# CONFIG_CRYPTO_AES_TI is not set
# CONFIG_CRYPTO_ARIA is not set
# CONFIG_CRYPTO_BLOWFISH is not set
# CONFIG_CRYPTO_CAMELLIA is not set
# CONFIG_CRYPTO_CAST5 is not set
# CONFIG_CRYPTO_CAST6 is not set
# CONFIG_CRYPTO_DES is not set
# CONFIG_CRYPTO_FCRYPT is not set
# CONFIG_CRYPTO_SERPENT is not set
# CONFIG_CRYPTO_SM4_GENERIC is not set
# CONFIG_CRYPTO_TWOFISH is not set
# end of Block ciphers

#
# Length-preserving ciphers and modes
#
# CONFIG_CRYPTO_ADIANTUM is not set
# CONFIG_CRYPTO_CHACHA20 is not set
CONFIG_CRYPTO_CBC=y
CONFIG_CRYPTO_CTR=y
# CONFIG_CRYPTO_CTS is not set
CONFIG_CRYPTO_ECB=y
# CONFIG_CRYPTO_HCTR2 is not set
# CONFIG_CRYPTO_KEYWRAP is not set
# CONFIG_CRYPTO_LRW is not set
# CONFIG_CRYPTO_PCBC is not set
# CONFIG_CRYPTO_XTS is not set
# end of Length-preserving ciphers and modes

#
# AEAD (authenticated encryption with associated data) ciphers
#
# CONFIG_CRYPTO_AEGIS128 is not set
# CONFIG_CRYPTO_CHACHA20POLY1305 is not set
CONFIG_CRYPTO_CCM=y
CONFIG_CRYPTO_GCM=y
CONFIG_CRYPTO_GENIV=y
CONFIG_CRYPTO_SEQIV=y
CONFIG_CRYPTO_ECHAINIV=y
CONFIG_CRYPTO_ESSIV=y
# end of AEAD (authenticated encryption with associated data) ciphers

#
# Hashes, digests, and MACs
#
# CONFIG_CRYPTO_BLAKE2B is not set
CONFIG_CRYPTO_CMAC=y
CONFIG_CRYPTO_GHASH=y
CONFIG_CRYPTO_HMAC=y
# CONFIG_CRYPTO_MD4 is not set
CONFIG_CRYPTO_MD5=y
# CONFIG_CRYPTO_MICHAEL_MIC is not set
# CONFIG_CRYPTO_POLY1305 is not set
# CONFIG_CRYPTO_RMD160 is not set
CONFIG_CRYPTO_SHA1=y
CONFIG_CRYPTO_SHA256=y
CONFIG_CRYPTO_SHA512=y
CONFIG_CRYPTO_SHA3=y
# CONFIG_CRYPTO_SM3_GENERIC is not set
# CONFIG_CRYPTO_STREEBOG is not set
# CONFIG_CRYPTO_VMAC is not set
# CONFIG_CRYPTO_WP512 is not set
# CONFIG_CRYPTO_XCBC is not set
# CONFIG_CRYPTO_XXHASH is not set
# end of Hashes, digests, and MACs

#
# CRCs (cyclic redundancy checks)
#
CONFIG_CRYPTO_CRC32C=y
# CONFIG_CRYPTO_CRC32 is not set
# CONFIG_CRYPTO_CRCT10DIF is not set
# end of CRCs (cyclic redundancy checks)

#
# Compression
#
# CONFIG_CRYPTO_DEFLATE is not set
CONFIG_CRYPTO_LZO=y
# CONFIG_CRYPTO_842 is not set
# CONFIG_CRYPTO_LZ4 is not set
# CONFIG_CRYPTO_LZ4HC is not set
# CONFIG_CRYPTO_ZSTD is not set
# end of Compression

#
# Random number generation
#
# CONFIG_CRYPTO_ANSI_CPRNG is not set
CONFIG_CRYPTO_DRBG_MENU=y
CONFIG_CRYPTO_DRBG_HMAC=y
# CONFIG_CRYPTO_DRBG_HASH is not set
# CONFIG_CRYPTO_DRBG_CTR is not set
CONFIG_CRYPTO_DRBG=y
CONFIG_CRYPTO_JITTERENTROPY=y
CONFIG_CRYPTO_JITTERENTROPY_MEMORY_BLOCKS=64
CONFIG_CRYPTO_JITTERENTROPY_MEMORY_BLOCKSIZE=32
CONFIG_CRYPTO_JITTERENTROPY_OSR=1
# end of Random number generation

#
# Userspace interface
#
# CONFIG_CRYPTO_USER_API_HASH is not set
# CONFIG_CRYPTO_USER_API_SKCIPHER is not set
# CONFIG_CRYPTO_USER_API_RNG is not set
# CONFIG_CRYPTO_USER_API_AEAD is not set
# end of Userspace interface

CONFIG_CRYPTO_HASH_INFO=y

#
# Accelerated Cryptographic Algorithms for CPU (x86)
#
# CONFIG_CRYPTO_CURVE25519_X86 is not set
CONFIG_CRYPTO_AES_NI_INTEL=y
# CONFIG_CRYPTO_BLOWFISH_X86_64 is not set
# CONFIG_CRYPTO_CAMELLIA_X86_64 is not set
# CONFIG_CRYPTO_CAMELLIA_AESNI_AVX_X86_64 is not set
# CONFIG_CRYPTO_CAMELLIA_AESNI_AVX2_X86_64 is not set
# CONFIG_CRYPTO_CAST5_AVX_X86_64 is not set
# CONFIG_CRYPTO_CAST6_AVX_X86_64 is not set
# CONFIG_CRYPTO_DES3_EDE_X86_64 is not set
# CONFIG_CRYPTO_SERPENT_SSE2_X86_64 is not set
# CONFIG_CRYPTO_SERPENT_AVX_X86_64 is not set
# CONFIG_CRYPTO_SERPENT_AVX2_X86_64 is not set
# CONFIG_CRYPTO_SM4_AESNI_AVX_X86_64 is not set
# CONFIG_CRYPTO_SM4_AESNI_AVX2_X86_64 is not set
# CONFIG_CRYPTO_TWOFISH_X86_64 is not set
# CONFIG_CRYPTO_TWOFISH_X86_64_3WAY is not set
# CONFIG_CRYPTO_TWOFISH_AVX_X86_64 is not set
# CONFIG_CRYPTO_ARIA_AESNI_AVX_X86_64 is not set
# CONFIG_CRYPTO_ARIA_AESNI_AVX2_X86_64 is not set
# CONFIG_CRYPTO_ARIA_GFNI_AVX512_X86_64 is not set
# CONFIG_CRYPTO_CHACHA20_X86_64 is not set
# CONFIG_CRYPTO_AEGIS128_AESNI_SSE2 is not set
# CONFIG_CRYPTO_NHPOLY1305_SSE2 is not set
# CONFIG_CRYPTO_NHPOLY1305_AVX2 is not set
# CONFIG_CRYPTO_BLAKE2S_X86 is not set
# CONFIG_CRYPTO_POLYVAL_CLMUL_NI is not set
# CONFIG_CRYPTO_POLY1305_X86_64 is not set
# CONFIG_CRYPTO_SHA1_SSSE3 is not set
# CONFIG_CRYPTO_SHA256_SSSE3 is not set
# CONFIG_CRYPTO_SHA512_SSSE3 is not set
# CONFIG_CRYPTO_SM3_AVX_X86_64 is not set
# CONFIG_CRYPTO_GHASH_CLMUL_NI_INTEL is not set
# CONFIG_CRYPTO_CRC32C_INTEL is not set
# CONFIG_CRYPTO_CRC32_PCLMUL is not set
# end of Accelerated Cryptographic Algorithms for CPU (x86)

CONFIG_CRYPTO_HW=y
# CONFIG_CRYPTO_DEV_PADLOCK is not set
# CONFIG_CRYPTO_DEV_ATMEL_ECC is not set
# CONFIG_CRYPTO_DEV_ATMEL_SHA204A is not set
# CONFIG_CRYPTO_DEV_CCP is not set
# CONFIG_CRYPTO_DEV_NITROX_CNN55XX is not set
# CONFIG_CRYPTO_DEV_QAT_DH895xCC is not set
# CONFIG_CRYPTO_DEV_QAT_C3XXX is not set
# CONFIG_CRYPTO_DEV_QAT_C62X is not set
# CONFIG_CRYPTO_DEV_QAT_4XXX is not set
# CONFIG_CRYPTO_DEV_QAT_420XX is not set
# CONFIG_CRYPTO_DEV_QAT_DH895xCCVF is not set
# CONFIG_CRYPTO_DEV_QAT_C3XXXVF is not set
# CONFIG_CRYPTO_DEV_QAT_C62XVF is not set
# CONFIG_CRYPTO_DEV_SAFEXCEL is not set
# CONFIG_CRYPTO_DEV_AMLOGIC_GXL is not set
CONFIG_ASYMMETRIC_KEY_TYPE=y
CONFIG_ASYMMETRIC_PUBLIC_KEY_SUBTYPE=y
CONFIG_X509_CERTIFICATE_PARSER=y
# CONFIG_PKCS8_PRIVATE_KEY_PARSER is not set
CONFIG_PKCS7_MESSAGE_PARSER=y
# CONFIG_PKCS7_TEST_KEY is not set
# CONFIG_SIGNED_PE_FILE_VERIFICATION is not set
# CONFIG_FIPS_SIGNATURE_SELFTEST is not set

#
# Certificates for signature checking
#
CONFIG_SYSTEM_TRUSTED_KEYRING=y
CONFIG_SYSTEM_TRUSTED_KEYS=""""
# CONFIG_SYSTEM_EXTRA_CERTIFICATE is not set
# CONFIG_SECONDARY_TRUSTED_KEYRING is not set
# CONFIG_SYSTEM_BLACKLIST_KEYRING is not set
# end of Certificates for signature checking

CONFIG_BINARY_PRINTF=y

#
# Library routines
#
# CONFIG_PACKING is not set
CONFIG_BITREVERSE=y
CONFIG_GENERIC_STRNCPY_FROM_USER=y
CONFIG_GENERIC_STRNLEN_USER=y
CONFIG_GENERIC_NET_UTILS=y
# CONFIG_CORDIC is not set
# CONFIG_PRIME_NUMBERS is not set
CONFIG_RATIONAL=y
CONFIG_GENERIC_IOMAP=y
CONFIG_ARCH_USE_CMPXCHG_LOCKREF=y
CONFIG_ARCH_HAS_FAST_MULTIPLIER=y
CONFIG_ARCH_USE_SYM_ANNOTATIONS=y

#
# Crypto library routines
#
CONFIG_CRYPTO_LIB_UTILS=y
CONFIG_CRYPTO_LIB_AES=y
CONFIG_CRYPTO_LIB_ARC4=y
CONFIG_CRYPTO_LIB_GF128MUL=y
CONFIG_CRYPTO_LIB_BLAKE2S_GENERIC=y
# CONFIG_CRYPTO_LIB_CHACHA is not set
# CONFIG_CRYPTO_LIB_CURVE25519 is not set
CONFIG_CRYPTO_LIB_POLY1305_RSIZE=11
# CONFIG_CRYPTO_LIB_POLY1305 is not set
# CONFIG_CRYPTO_LIB_CHACHA20POLY1305 is not set
CONFIG_CRYPTO_LIB_SHA1=y
CONFIG_CRYPTO_LIB_SHA256=y
# end of Crypto library routines

CONFIG_CRC_CCITT=y
CONFIG_CRC16=y
# CONFIG_CRC_T10DIF is not set
# CONFIG_CRC64_ROCKSOFT is not set
CONFIG_CRC_ITU_T=y
CONFIG_CRC32=y
# CONFIG_CRC32_SELFTEST is not set
CONFIG_CRC32_SLICEBY8=y
# CONFIG_CRC32_SLICEBY4 is not set
# CONFIG_CRC32_SARWATE is not set
# CONFIG_CRC32_BIT is not set
# CONFIG_CRC64 is not set
# CONFIG_CRC4 is not set
# CONFIG_CRC7 is not set
CONFIG_LIBCRC32C=y
# CONFIG_CRC8 is not set
CONFIG_XXHASH=y
# CONFIG_RANDOM32_SELFTEST is not set
CONFIG_ZLIB_INFLATE=y
CONFIG_ZLIB_DEFLATE=y
CONFIG_LZO_COMPRESS=y
CONFIG_LZO_DECOMPRESS=y
CONFIG_LZ4_DECOMPRESS=y
CONFIG_ZSTD_COMMON=y
CONFIG_ZSTD_COMPRESS=y
CONFIG_ZSTD_DECOMPRESS=y
CONFIG_XZ_DEC=y
CONFIG_XZ_DEC_X86=y
CONFIG_XZ_DEC_POWERPC=y
CONFIG_XZ_DEC_ARM=y
CONFIG_XZ_DEC_ARMTHUMB=y
CONFIG_XZ_DEC_ARM64=y
CONFIG_XZ_DEC_SPARC=y
CONFIG_XZ_DEC_RISCV=y
# CONFIG_XZ_DEC_MICROLZMA is not set
CONFIG_XZ_DEC_BCJ=y
# CONFIG_XZ_DEC_TEST is not set
CONFIG_DECOMPRESS_GZIP=y
CONFIG_DECOMPRESS_BZIP2=y
CONFIG_DECOMPRESS_LZMA=y
CONFIG_DECOMPRESS_XZ=y
CONFIG_DECOMPRESS_LZO=y
CONFIG_DECOMPRESS_LZ4=y
CONFIG_DECOMPRESS_ZSTD=y
CONFIG_GENERIC_ALLOCATOR=y
CONFIG_INTERVAL_TREE=y
CONFIG_XARRAY_MULTI=y
CONFIG_ASSOCIATIVE_ARRAY=y
CONFIG_HAS_IOMEM=y
CONFIG_HAS_IOPORT=y
CONFIG_HAS_IOPORT_MAP=y
CONFIG_HAS_DMA=y
CONFIG_DMA_OPS_HELPERS=y
CONFIG_NEED_SG_DMA_FLAGS=y
CONFIG_NEED_SG_DMA_LENGTH=y
CONFIG_NEED_DMA_MAP_STATE=y
CONFIG_ARCH_DMA_ADDR_T_64BIT=y
CONFIG_ARCH_HAS_FORCE_DMA_UNENCRYPTED=y
CONFIG_SWIOTLB=y
# CONFIG_SWIOTLB_DYNAMIC is not set
CONFIG_DMA_NEED_SYNC=y
CONFIG_DMA_COHERENT_POOL=y
# CONFIG_DMA_API_DEBUG is not set
# CONFIG_DMA_MAP_BENCHMARK is not set
CONFIG_SGL_ALLOC=y
CONFIG_CHECK_SIGNATURE=y
CONFIG_CPU_RMAP=y
CONFIG_DQL=y
CONFIG_GLOB=y
# CONFIG_GLOB_SELFTEST is not set
CONFIG_NLATTR=y
CONFIG_CLZ_TAB=y
# CONFIG_IRQ_POLL is not set
CONFIG_MPILIB=y
CONFIG_DIMLIB=y
CONFIG_OID_REGISTRY=y
CONFIG_UCS2_STRING=y
CONFIG_HAVE_GENERIC_VDSO=y
CONFIG_GENERIC_GETTIMEOFDAY=y
CONFIG_GENERIC_VDSO_TIME_NS=y
CONFIG_GENERIC_VDSO_OVERFLOW_PROTECT=y
CONFIG_VDSO_GETRANDOM=y
CONFIG_FONT_SUPPORT=y
# CONFIG_FONTS is not set
CONFIG_FONT_8x8=y
CONFIG_FONT_8x16=y
CONFIG_SG_POOL=y
CONFIG_ARCH_HAS_PMEM_API=y
CONFIG_ARCH_HAS_CPU_CACHE_INVALIDATE_MEMREGION=y
CONFIG_ARCH_HAS_UACCESS_FLUSHCACHE=y
CONFIG_ARCH_HAS_COPY_MC=y
CONFIG_ARCH_STACKWALK=y
CONFIG_STACKDEPOT=y
CONFIG_STACKDEPOT_MAX_FRAMES=64
CONFIG_SBITMAP=y
# CONFIG_LWQ_TEST is not set
# end of Library routines

CONFIG_PLDMFW=y
CONFIG_FIRMWARE_TABLE=y
CONFIG_UNION_FIND=y

#
# Kernel hacking
#

#
# printk and dmesg options
#
CONFIG_PRINTK_TIME=y
# CONFIG_PRINTK_CALLER is not set
# CONFIG_STACKTRACE_BUILD_ID is not set
CONFIG_CONSOLE_LOGLEVEL_DEFAULT=7
CONFIG_CONSOLE_LOGLEVEL_QUIET=4
CONFIG_MESSAGE_LOGLEVEL_DEFAULT=4
# CONFIG_BOOT_PRINTK_DELAY is not set
# CONFIG_DYNAMIC_DEBUG is not set
# CONFIG_DYNAMIC_DEBUG_CORE is not set
# CONFIG_SYMBOLIC_ERRNAME is not set
CONFIG_DEBUG_BUGVERBOSE=y
# end of printk and dmesg options

CONFIG_DEBUG_KERNEL=y
CONFIG_DEBUG_MISC=y

#
# Compile-time checks and compiler options
#
CONFIG_AS_HAS_NON_CONST_ULEB128=y
CONFIG_DEBUG_INFO_NONE=y
# CONFIG_DEBUG_INFO_DWARF_TOOLCHAIN_DEFAULT is not set
# CONFIG_DEBUG_INFO_DWARF4 is not set
# CONFIG_DEBUG_INFO_DWARF5 is not set
CONFIG_FRAME_WARN=2048
# CONFIG_STRIP_ASM_SYMS is not set
# CONFIG_READABLE_ASM is not set
# CONFIG_HEADERS_INSTALL is not set
# CONFIG_DEBUG_SECTION_MISMATCH is not set
CONFIG_SECTION_MISMATCH_WARN_ONLY=y
CONFIG_OBJTOOL=y
# CONFIG_DEBUG_FORCE_WEAK_PER_CPU is not set
# end of Compile-time checks and compiler options

#
# Generic Kernel Debugging Instruments
#
CONFIG_MAGIC_SYSRQ=y
CONFIG_MAGIC_SYSRQ_DEFAULT_ENABLE=0x1
CONFIG_MAGIC_SYSRQ_SERIAL=y
CONFIG_MAGIC_SYSRQ_SERIAL_SEQUENCE=""""
CONFIG_DEBUG_FS=y
CONFIG_DEBUG_FS_ALLOW_ALL=y
# CONFIG_DEBUG_FS_DISALLOW_MOUNT is not set
# CONFIG_DEBUG_FS_ALLOW_NONE is not set
CONFIG_HAVE_ARCH_KGDB=y
# CONFIG_KGDB is not set
CONFIG_ARCH_HAS_UBSAN=y
# CONFIG_UBSAN is not set
CONFIG_HAVE_ARCH_KCSAN=y
CONFIG_HAVE_KCSAN_COMPILER=y
# CONFIG_KCSAN is not set
# end of Generic Kernel Debugging Instruments

#
# Networking Debugging
#
# CONFIG_NET_DEV_REFCNT_TRACKER is not set
# CONFIG_NET_NS_REFCNT_TRACKER is not set
# CONFIG_DEBUG_NET is not set
# CONFIG_DEBUG_NET_SMALL_RTNL is not set
# end of Networking Debugging

#
# Memory Debugging
#
# CONFIG_PAGE_EXTENSION is not set
# CONFIG_DEBUG_PAGEALLOC is not set
CONFIG_SLUB_DEBUG=y
# CONFIG_SLUB_DEBUG_ON is not set
# CONFIG_PAGE_OWNER is not set
# CONFIG_PAGE_TABLE_CHECK is not set
# CONFIG_PAGE_POISONING is not set
# CONFIG_DEBUG_PAGE_REF is not set
# CONFIG_DEBUG_RODATA_TEST is not set
CONFIG_ARCH_HAS_DEBUG_WX=y
# CONFIG_DEBUG_WX is not set
CONFIG_GENERIC_PTDUMP=y
# CONFIG_PTDUMP_DEBUGFS is not set
CONFIG_HAVE_DEBUG_KMEMLEAK=y
# CONFIG_DEBUG_KMEMLEAK is not set
# CONFIG_PER_VMA_LOCK_STATS is not set
# CONFIG_DEBUG_OBJECTS is not set
# CONFIG_SHRINKER_DEBUG is not set
CONFIG_DEBUG_STACK_USAGE=y
# CONFIG_SCHED_STACK_END_CHECK is not set
CONFIG_ARCH_HAS_DEBUG_VM_PGTABLE=y
# CONFIG_DEBUG_VM is not set
# CONFIG_DEBUG_VM_PGTABLE is not set
CONFIG_ARCH_HAS_DEBUG_VIRTUAL=y
# CONFIG_DEBUG_VIRTUAL is not set
CONFIG_DEBUG_MEMORY_INIT=y
# CONFIG_DEBUG_PER_CPU_MAPS is not set
CONFIG_ARCH_SUPPORTS_KMAP_LOCAL_FORCE_MAP=y
# CONFIG_DEBUG_KMAP_LOCAL_FORCE_MAP is not set
# CONFIG_MEM_ALLOC_PROFILING is not set
CONFIG_HAVE_ARCH_KASAN=y
CONFIG_HAVE_ARCH_KASAN_VMALLOC=y
CONFIG_CC_HAS_KASAN_GENERIC=y
CONFIG_CC_HAS_KASAN_SW_TAGS=y
CONFIG_CC_HAS_WORKING_NOSANITIZE_ADDRESS=y
# CONFIG_KASAN is not set
CONFIG_HAVE_ARCH_KFENCE=y
# CONFIG_KFENCE is not set
CONFIG_HAVE_ARCH_KMSAN=y
# end of Memory Debugging

# CONFIG_DEBUG_SHIRQ is not set

#
# Debug Oops, Lockups and Hangs
#
# CONFIG_PANIC_ON_OOPS is not set
CONFIG_PANIC_ON_OOPS_VALUE=0
CONFIG_PANIC_TIMEOUT=0
# CONFIG_SOFTLOCKUP_DETECTOR is not set
CONFIG_HAVE_HARDLOCKUP_DETECTOR_BUDDY=y
# CONFIG_HARDLOCKUP_DETECTOR is not set
CONFIG_HARDLOCKUP_CHECK_TIMESTAMP=y
# CONFIG_DETECT_HUNG_TASK is not set
# CONFIG_WQ_WATCHDOG is not set
# CONFIG_WQ_CPU_INTENSIVE_REPORT is not set
# CONFIG_TEST_LOCKUP is not set
# end of Debug Oops, Lockups and Hangs

#
# Scheduler Debugging
#
# CONFIG_SCHED_DEBUG is not set
CONFIG_SCHED_INFO=y
CONFIG_SCHEDSTATS=y
# end of Scheduler Debugging

CONFIG_DEBUG_PREEMPT=y

#
# Lock Debugging (spinlocks, mutexes, etc...)
#
CONFIG_LOCK_DEBUGGING_SUPPORT=y
# CONFIG_PROVE_LOCKING is not set
# CONFIG_LOCK_STAT is not set
# CONFIG_DEBUG_RT_MUTEXES is not set
# CONFIG_DEBUG_SPINLOCK is not set
# CONFIG_DEBUG_MUTEXES is not set
# CONFIG_DEBUG_WW_MUTEX_SLOWPATH is not set
# CONFIG_DEBUG_RWSEMS is not set
# CONFIG_DEBUG_LOCK_ALLOC is not set
# CONFIG_DEBUG_ATOMIC_SLEEP is not set
# CONFIG_DEBUG_LOCKING_API_SELFTESTS is not set
# CONFIG_LOCK_TORTURE_TEST is not set
# CONFIG_WW_MUTEX_SELFTEST is not set
# CONFIG_SCF_TORTURE_TEST is not set
# CONFIG_CSD_LOCK_WAIT_DEBUG is not set
# end of Lock Debugging (spinlocks, mutexes, etc...)

# CONFIG_NMI_CHECK_CPU is not set
# CONFIG_DEBUG_IRQFLAGS is not set
CONFIG_STACKTRACE=y
# CONFIG_WARN_ALL_UNSEEDED_RANDOM is not set
# CONFIG_DEBUG_KOBJECT is not set

#
# Debug kernel data structures
#
# CONFIG_DEBUG_LIST is not set
# CONFIG_DEBUG_PLIST is not set
# CONFIG_DEBUG_SG is not set
# CONFIG_DEBUG_NOTIFIERS is not set
# CONFIG_DEBUG_MAPLE_TREE is not set
# end of Debug kernel data structures

#
# RCU Debugging
#
# CONFIG_RCU_SCALE_TEST is not set
# CONFIG_RCU_TORTURE_TEST is not set
# CONFIG_RCU_REF_SCALE_TEST is not set
CONFIG_RCU_CPU_STALL_TIMEOUT=21
CONFIG_RCU_EXP_CPU_STALL_TIMEOUT=0
# CONFIG_RCU_CPU_STALL_CPUTIME is not set
# CONFIG_RCU_CPU_STALL_NOTIFIER is not set
CONFIG_RCU_TRACE=y
# CONFIG_RCU_EQS_DEBUG is not set
# end of RCU Debugging

# CONFIG_DEBUG_WQ_FORCE_RR_CPU is not set
# CONFIG_CPU_HOTPLUG_STATE_CONTROL is not set
# CONFIG_LATENCYTOP is not set
# CONFIG_DEBUG_CGROUP_REF is not set
CONFIG_USER_STACKTRACE_SUPPORT=y
CONFIG_NOP_TRACER=y
CONFIG_HAVE_RETHOOK=y
CONFIG_RETHOOK=y
CONFIG_HAVE_FUNCTION_TRACER=y
CONFIG_HAVE_DYNAMIC_FTRACE=y
CONFIG_HAVE_DYNAMIC_FTRACE_WITH_REGS=y
CONFIG_HAVE_DYNAMIC_FTRACE_WITH_DIRECT_CALLS=y
CONFIG_HAVE_DYNAMIC_FTRACE_WITH_ARGS=y
CONFIG_HAVE_DYNAMIC_FTRACE_NO_PATCHABLE=y
CONFIG_HAVE_FTRACE_MCOUNT_RECORD=y
CONFIG_HAVE_SYSCALL_TRACEPOINTS=y
CONFIG_HAVE_FENTRY=y
CONFIG_HAVE_OBJTOOL_MCOUNT=y
CONFIG_HAVE_OBJTOOL_NOP_MCOUNT=y
CONFIG_HAVE_C_RECORDMCOUNT=y
CONFIG_HAVE_BUILDTIME_MCOUNT_SORT=y
CONFIG_TRACE_CLOCK=y
CONFIG_RING_BUFFER=y
CONFIG_EVENT_TRACING=y
CONFIG_CONTEXT_SWITCH_TRACER=y
CONFIG_TRACING=y
CONFIG_GENERIC_TRACER=y
CONFIG_TRACING_SUPPORT=y
CONFIG_FTRACE=y
# CONFIG_BOOTTIME_TRACING is not set
# CONFIG_FUNCTION_TRACER is not set
# CONFIG_STACK_TRACER is not set
# CONFIG_IRQSOFF_TRACER is not set
# CONFIG_PREEMPT_TRACER is not set
# CONFIG_SCHED_TRACER is not set
# CONFIG_HWLAT_TRACER is not set
# CONFIG_OSNOISE_TRACER is not set
# CONFIG_TIMERLAT_TRACER is not set
# CONFIG_MMIOTRACE is not set
# CONFIG_FTRACE_SYSCALLS is not set
# CONFIG_TRACER_SNAPSHOT is not set
CONFIG_BRANCH_PROFILE_NONE=y
# CONFIG_PROFILE_ANNOTATED_BRANCHES is not set
# CONFIG_PROFILE_ALL_BRANCHES is not set
CONFIG_BLK_DEV_IO_TRACE=y
CONFIG_KPROBE_EVENTS=y
CONFIG_UPROBE_EVENTS=y
CONFIG_DYNAMIC_EVENTS=y
CONFIG_PROBE_EVENTS=y
# CONFIG_SYNTH_EVENTS is not set
# CONFIG_USER_EVENTS is not set
# CONFIG_HIST_TRIGGERS is not set
# CONFIG_TRACE_EVENT_INJECT is not set
# CONFIG_TRACEPOINT_BENCHMARK is not set
# CONFIG_RING_BUFFER_BENCHMARK is not set
# CONFIG_TRACE_EVAL_MAP_FILE is not set
# CONFIG_FTRACE_STARTUP_TEST is not set
# CONFIG_RING_BUFFER_STARTUP_TEST is not set
# CONFIG_RING_BUFFER_VALIDATE_TIME_DELTAS is not set
# CONFIG_PREEMPTIRQ_DELAY_TEST is not set
# CONFIG_KPROBE_EVENT_GEN_TEST is not set
# CONFIG_RV is not set
CONFIG_PROVIDE_OHCI1394_DMA_INIT=y
CONFIG_SAMPLES=y
# CONFIG_SAMPLE_AUXDISPLAY is not set
# CONFIG_SAMPLE_TRACE_EVENTS is not set
# CONFIG_SAMPLE_TRACE_CUSTOM_EVENTS is not set
# CONFIG_SAMPLE_TRACE_PRINTK is not set
# CONFIG_SAMPLE_TRACE_ARRAY is not set
# CONFIG_SAMPLE_KOBJECT is not set
# CONFIG_SAMPLE_KPROBES is not set
# CONFIG_SAMPLE_HW_BREAKPOINT is not set
# CONFIG_SAMPLE_KFIFO is not set
# CONFIG_SAMPLE_VFIO_MDEV_MDPY_FB is not set
# CONFIG_SAMPLE_WATCHDOG is not set
CONFIG_HAVE_SAMPLE_FTRACE_DIRECT=y
CONFIG_HAVE_SAMPLE_FTRACE_DIRECT_MULTI=y
CONFIG_ARCH_HAS_DEVMEM_IS_ALLOWED=y
CONFIG_STRICT_DEVMEM=y
# CONFIG_IO_STRICT_DEVMEM is not set

#
# x86 Debugging
#
CONFIG_EARLY_PRINTK_USB=y
CONFIG_X86_VERBOSE_BOOTUP=y
CONFIG_EARLY_PRINTK=y
CONFIG_EARLY_PRINTK_DBGP=y
# CONFIG_EARLY_PRINTK_USB_XDBC is not set
# CONFIG_EFI_PGT_DUMP is not set
# CONFIG_DEBUG_TLBFLUSH is not set
CONFIG_HAVE_MMIOTRACE_SUPPORT=y
# CONFIG_X86_DECODER_SELFTEST is not set
CONFIG_IO_DELAY_0X80=y
# CONFIG_IO_DELAY_0XED is not set
# CONFIG_IO_DELAY_UDELAY is not set
# CONFIG_IO_DELAY_NONE is not set
CONFIG_DEBUG_BOOT_PARAMS=y
# CONFIG_CPA_DEBUG is not set
# CONFIG_DEBUG_ENTRY is not set
# CONFIG_DEBUG_NMI_SELFTEST is not set
CONFIG_X86_DEBUG_FPU=y
# CONFIG_PUNIT_ATOM_DEBUG is not set
CONFIG_UNWINDER_ORC=y
# CONFIG_UNWINDER_FRAME_POINTER is not set
# end of x86 Debugging

#
# Kernel Testing and Coverage
#
# CONFIG_KUNIT is not set
# CONFIG_NOTIFIER_ERROR_INJECTION is not set
# CONFIG_FUNCTION_ERROR_INJECTION is not set
# CONFIG_FAULT_INJECTION is not set
CONFIG_ARCH_HAS_KCOV=y
CONFIG_CC_HAS_SANCOV_TRACE_PC=y
# CONFIG_KCOV is not set
CONFIG_RUNTIME_TESTING_MENU=y
# CONFIG_TEST_DHRY is not set
# CONFIG_LKDTM is not set
# CONFIG_TEST_MIN_HEAP is not set
# CONFIG_TEST_DIV64 is not set
# CONFIG_TEST_MULDIV64 is not set
# CONFIG_BACKTRACE_SELF_TEST is not set
# CONFIG_TEST_REF_TRACKER is not set
# CONFIG_RBTREE_TEST is not set
# CONFIG_REED_SOLOMON_TEST is not set
# CONFIG_INTERVAL_TREE_TEST is not set
# CONFIG_PERCPU_TEST is not set
# CONFIG_ATOMIC64_SELFTEST is not set
# CONFIG_TEST_HEXDUMP is not set
# CONFIG_TEST_KSTRTOX is not set
# CONFIG_TEST_PRINTF is not set
# CONFIG_TEST_SCANF is not set
# CONFIG_TEST_BITMAP is not set
# CONFIG_TEST_UUID is not set
# CONFIG_TEST_XARRAY is not set
# CONFIG_TEST_MAPLE_TREE is not set
# CONFIG_TEST_RHASHTABLE is not set
# CONFIG_TEST_IDA is not set
# CONFIG_TEST_LKM is not set
# CONFIG_TEST_BITOPS is not set
# CONFIG_TEST_VMALLOC is not set
# CONFIG_TEST_BPF is not set
# CONFIG_TEST_BLACKHOLE_DEV is not set
# CONFIG_FIND_BIT_BENCHMARK is not set
# CONFIG_TEST_FIRMWARE is not set
# CONFIG_TEST_SYSCTL is not set
# CONFIG_TEST_UDELAY is not set
# CONFIG_TEST_STATIC_KEYS is not set
# CONFIG_TEST_KMOD is not set
# CONFIG_TEST_KALLSYMS is not set
# CONFIG_TEST_MEMCAT_P is not set
# CONFIG_TEST_MEMINIT is not set
# CONFIG_TEST_FREE_PAGES is not set
# CONFIG_TEST_FPU is not set
# CONFIG_TEST_CLOCKSOURCE_WATCHDOG is not set
# CONFIG_TEST_OBJPOOL is not set
CONFIG_ARCH_USE_MEMTEST=y
# CONFIG_MEMTEST is not set
# end of Kernel Testing and Coverage

#
# Rust hacking
#
# end of Rust hacking
# end of Kernel hacking
"
Rb6Y9uW2,Beamng 0.37 standard role lua,Drakkxs,Lua,Saturday 22nd of November 2025 12:36:53 AM CDT,"-- This Source Code Form is subject to the terms of the bCDDL, v. 1.1.
-- If a copy of the bCDDL was not distributed with this
-- file, You can obtain one at http://beamng.com/bCDDL-1.1.txt

local min = math.min
local max = math.max
local ceil = math.ceil
local random = math.random

local C = {}

function C:init()
  self.personalityModifiers = {}
  self.actions = {
    fleePostCrash = function (args)
      if self.veh.isAi then
        self.veh:setAiMode('flee')
        local obj = getObjectByID(self.veh.id)
        obj:queueLuaCommand('ai.driveInLane(""off"")')
        obj:queueLuaCommand('ai.setAggressionMode(""off"")')
        self:setAggression(args.aggression or max(0.5, random()))
      end
      self.state = 'flee'
      self.flags.askInsurance = nil
    end,
    followPostCrash = function (args)
      if self.veh.isAi then
        self.veh:setAiMode(args.isChase and 'chase' or 'follow')
        local obj = getObjectByID(self.veh.id)
        obj:queueLuaCommand('ai.driveInLane(""off"")')
        obj:queueLuaCommand('ai.setAggressionMode(""off"")')
        self:setAggression(args.aggression or max(0.5, random()))
      end
      self.state = 'follow'
      self.flags.askInsurance = nil
    end,
    askInsurance = function (args)
      if self.veh.isAi then
        self.veh:setAiMode('stop')
      end
      self.flags.askInsurance = nil
    end,
    disabled = function (args)
      if self.veh.isAi then
        self.veh:setAiMode('stop')
      end
      self.state = 'disabled'
    end
  }

  for k, v in pairs(self.baseActions) do
    self.actions[k] = v
  end
  self.baseActions = nil
end

function C:onRefresh()
  self.targetId = nil
  self.actionTimer = 0
  local personality = self.driver.personality

  self.driver.eventType = nil
  self.driver.damageAction = 'none'
  self.driver.damageThreshold = 1000
  self.driver.collisionThreshold = math.huge

  if self.veh.isAi then -- only calculates values if vehicle is AI
    self.driver.damageAction = 'stop'

    if personality.bravery >= 0.55 then
      self.driver.damageAction = 'followPostCrash'
    elseif personality.bravery <= 0.45 then
      self.driver.damageAction = 'fleePostCrash'
    end

    local squareRandom = square(random())
    self.driver.damageThreshold = max(self.veh.damageLimits[1], squareRandom * 1000) -- minimum damage that triggers damage action
    self.driver.collisionThreshold = ceil(squareRandom * 6) -- minimum number of collisions that triggers damage action
  end

  self.driver.selfHitCount = 0
  self.driver.otherHitCount = 0
  self.driver.enableAskInsurance = true
end

function C:onCrashDamage(data)
  -- triggers if self is currently not in a collision or witness to one
  if self.driver.eventType ~= 'selfCollision' and self.driver.eventType ~= 'otherCollision' then
    self.driver.eventType = 'selfCrash'
  end
end

function C:onOtherCrashDamage(otherId, data)
  -- triggers if self is currently not in a collision or witness to one
  if self.driver.eventType ~= 'selfCollision' and self.driver.eventType ~= 'otherCollision' then
    self.driver.eventType = 'otherCrash'
    self:setTarget(otherId)
  end
end

function C:onCollision(otherId, data)
  if self.veh.speed >= self.veh.tracking.speedLimit * 1.2 then -- speeding always means collision fault for self
    self.veh.collisions[otherId].fault = true
  end
  if self.driver.eventType ~= 'selfCollision' then -- overrides previous events
    self.driver.eventType = 'selfCollision'
    self:setTarget(otherId)
  end

  if self.veh.isAi and not self.flags.askInsurance and self.driver.personality.bravery >= 0.52 and random() >= 0.5 / clamp(data.count, 1, 3) then
    self.flags.honkHornDelay = 1
  end

  self.driver.selfHitCount = data.count
end

function C:onOtherCollision(id1, id2, data)
  if self.driver.eventType ~= 'selfCollision' then
    local targetVeh, secondVeh = gameplay_traffic.getTrafficData()[id1], gameplay_traffic.getTrafficData()[id2]
    if not targetVeh or not secondVeh then return end
    local targetId = targetVeh.speed < secondVeh.speed and id1 or id2 -- target the slower vehicle in collision
    if targetId == id2 then targetVeh = gameplay_traffic.getTrafficData()[targetId] end

    -- checks if target is visible, within distance, and in front of self
    if self:checkTargetVisible(targetId) and self.veh:getInteractiveDistance(targetVeh.pos, true) <= 3600 and self.veh.dirVec:dot(targetVeh.pos - self.veh.pos) > 0 then
      if self.driver.eventType ~= 'otherCollision' then
        self.driver.eventType = 'otherCollision'
        self:setTarget(targetId)
      end

      if self.veh.isAi and self.driver.personality.bravery >= 0.56 and random() >= 0.5 then
        self.flags.honkHornDelay = 1
      end

      self.driver.otherHitCount = data.count
    end
  end
end

function C:onTrafficTick(tickTime)
  if self.state == 'disabled' then return end

  if self.veh.isAi and self.state ~= 'disabled' and self.veh.state == 'active' and self.veh.damage > self.veh.damageLimits[3] then
    self:setAction('disabled')
  end

  local targetVeh = self.targetId and gameplay_traffic.getTrafficData()[self.targetId]
  self.targetVisible = self:checkTargetVisible()
  self.targetNear = (targetVeh and self.veh:getInteractiveDistance(targetVeh.pos, true) <= 3600) and true or false

  if targetVeh and self.veh.isAi then
    local driver = self.driver

    if self.targetVisible and self.targetNear then
      local actionType

      -- target vehicle collided with self
      if driver.eventType == 'selfCollision' and self.veh.damage >= driver.damageThreshold then
        if driver.selfHitCount >= driver.collisionThreshold then
          actionType = 'crashThreshold'
          driver.collisionThreshold = driver.collisionThreshold + 2
        else
          actionType = 'crash'
        end

      -- target vehicle collided with other vehicle
      elseif driver.eventType == 'otherCollision' and targetVeh.damage >= driver.damageThreshold then
        if driver.otherHitCount >= driver.collisionThreshold + 1 then -- higher threshold than self collision
          actionType = 'crashThreshold'
          driver.collisionThreshold = driver.collisionThreshold + 2
        else
          actionType = 'crash'
        end

      -- target vehicle crashed by itself
      elseif driver.eventType == 'otherCrash' then
        if self.state == 'none' and driver.personality.bravery + driver.personality.patience >= 0.8
        and self.veh.driveVec:dot(targetVeh.pos - self.veh.pos) > 0 then
          actionType = 'crash'
        end
      end

      if actionType == 'crashThreshold' then -- follow, flee, etc.
        local minTime = 5
        if driver.damageAction == 'followPostCrash' and self.state ~= 'follow' then
          local chaseTarget = false
          if targetVeh.tracking.collisions >= 2 and driver.personality.bravery >= 0.6 then -- mode change if target driver is reckless
            chaseTarget = true
            minTime = 10
          end
          self:setAction('followPostCrash', {reason = driver.eventType, targetId = self.targetId, isChase = chaseTarget})
          self.actionTimer = max(minTime, (driver.personality.bravery - 0.5) * 60) -- duration for following target
        elseif driver.damageAction == 'fleePostCrash' and self.state ~= 'flee' then
          self:setAction('fleePostCrash', {reason = driver.eventType, targetId = self.targetId})
          self.actionTimer = max(minTime, (0.5 - driver.personality.bravery) * 60) -- duration for fleeing from target
        else
          if self.state == 'none' then
            self:setAction('pullOver', {dist = self.veh:getBrakingDistance(self.veh.speed, driver.aggression * 1.5), reason = driver.eventType, useWarnSignal = true})
            self.actionTimer = max(minTime, driver.personality.patience * 30)
          end
        end
      elseif actionType == 'crash' then -- just pull over and stop
        if self.state == 'none' then
          self:setAction('pullOver', {dist = self.veh:getBrakingDistance(self.veh.speed, driver.aggression * 1.5), reason = driver.eventType, useWarnSignal = true})
          self.actionTimer = max(3, driver.personality.patience * 20)
          if driver.eventType == 'selfCollision' then
            self.flags.askInsurance = 1
          end
        end
      end
    else -- target not visible or out of range
      if self.state ~= 'none' and self.veh.pos:squaredDistance(targetVeh.pos) >= 14400 then -- check if state needs to be reset
        self:resetAction()
      end
    end
  end

  if self.enableTrafficSignalsChange and self.veh.speed >= 6 and next(map.objects[self.veh.id].states) then -- lightbar triggers all traffic lights to change to the red state
    -- this exists here until we have a way to properly recognize emergency vehicles (lightbar exists)
    if map.objects[self.veh.id].states.lightbar then
      self:freezeTrafficSignals(true)
    else
      if self.flags.freezeSignals then
        self:freezeTrafficSignals(false)
      end
    end
  else
    if self.flags.freezeSignals then
      self:freezeTrafficSignals(false)
    end
  end
end

function C:onUpdate(dt, dtSim)
  if self.state == 'disabled' then return end

  local targetVeh = self.targetId and gameplay_traffic.getTrafficData()[self.targetId]
  if targetVeh then
    if self.actionTimer > 0 then
      self.actionTimer = self.actionTimer - dtSim

      if self.flags.askInsurance then
        if self.actionTimer <= 0 then
          if self.targetVisible and self.veh.speed <= 1 and targetVeh.speed <= 1 and self.veh.pos:squaredDistance(targetVeh.pos) <= 400 then
            self:setAction('askInsurance') -- exchange insurance information
            if gameplay_traffic.showMessages and self.targetId == be:getPlayerVehicleID(0) then
              if career_career and career_career.isActive() then
                -- career insurance logic might go here
              else
                ui_message('ui.traffic.interactions.insuranceExchanged', 5, 'traffic', 'traffic')
              end
            end
            self.targetId = nil
          else
            self.actionTimer = 5 -- bounce time
          end
        end
      elseif self.actionName == 'followPostCrash' or self.actionName == 'fleePostCrash' then
        if self.veh.pos:squaredDistance(targetVeh.pos) > 1600 or self.actionTimer <= 0 then
          if self.veh.collisions[self.targetId] then -- switch to askInsurance mode
            self:setAction('pullOver', {dist = self.veh:getBrakingDistance(self.veh.speed, self.driver.aggression * 1.5), reason = 'selfCollision', useWarnSignal = true})
            self.flags.askInsurance = 1
            self.actionTimer = 5
          else
            self:resetAction()
          end
        end
      elseif self.actionName == 'pullOver' then
        if self.actionTimer <= 0 then
          self:resetAction()
        end
      end
    end
  end

  if self.flags.honkHornDelay and random() >= 0.9 then
    self.veh:honkHorn(max(0.25, square(random()) * 1.5))
    self.flags.honkHornDelay = nil
  end
end

return function(...) return require('/lua/ge/extensions/gameplay/traffic/baseRole')(C, ...) end"
S09JtCzk,widget1,Leo0777,JavaScript,Saturday 22nd of November 2025 12:28:11 AM CDT,"<?php
// ZpracovÃ¡nÃ­ poÅ¾adavku na pÅ™epnutÃ­ relÃ©
if (isset($_GET['rele']) && isset($_GET['kanal']) && isset($_GET['stav'])) {
    $rele = $_GET['rele'];
    $kanal = $_GET['kanal'];
    $stav = strtoupper($_GET['stav']);
    
    // SpeciÃ¡lnÃ­ pÅ™Ã­pad pro zÃ¡suvku (nemÃ¡ kanÃ¡l, jen stav)
    if ($rele === 'zasuvka_sekacka') {
        exec(""sudo /home/leo/skripty/muj_web/zasuvka_kurnik_sekacka.sh $stav"");
    } else {
        // BÄ›Å¾nÃ© relÃ© s kanÃ¡lem
        exec(""sudo /home/leo/skripty/muj_web/rele_{$rele}.sh $kanal $stav"");
    }
    
    // VrÃ¡tit JSON odpovÄ›Ä
    header('Content-Type: application/json');
    echo json_encode(['success' => true, 'rele' => $rele, 'kanal' => $kanal, 'stav' => $stav]);
    exit;
}
?>



<body>
  <div class=""dashboard"">
    <h1 class=""dashboard-title"">ðŸ  DomÃ¡cÃ­ Dashboard</h1>
    
    <div id=""status"" class=""status"">NaÄÃ­tÃ¡m data...</div>
    
    <!-- TEPLOMÄšRY -->
    <div class=""teplomery-container"">

<!--------------------------------------------------------------------------------------------------------------------------------------------------->
<!------------- teplomÄ›ry sklep --------------------------------------------------------------------------------------------------------------------->
<!--------------------------------------------------------------------------------------------------------------------------------------------------->
      
      <div class=""widget"">
        <h2>TeplomÄ›ry sklep</h2>
        <div class=""widget-row"">
          <span>ðŸ”¥ Kotel:</span>
          <span id=""temp_kotel"">-- Â°C</span>
        </div>
        <div class=""widget-row"">
          <span>ðŸ’§ Voda:</span>
          <span id=""temp_voda"">-- Â°C</span>
        </div>
      </div>
 <!-------------------------------------------------------------------------------------------------------------------------------------------------->
<!------------- teplomÄ›r venku ---------------------------------------------------------------------------------------------------------------------->
<!--------------------------------------------------------------------------------------------------------------------------------------------------->
     
      <div class=""widget"">
        <h2>TeplomÄ›r venku</h2>
        <div class=""widget-row"">
          <span>ðŸŒ¡ï¸ Teplota:</span>
          <span id=""temp_venku"">-- Â°C</span>
        </div>
        <div class=""widget-row"">
          <span>ðŸ’§ Vlhkost:</span>
          <span id=""hum_venku"">-- %</span>
        </div>
      </div>
<!--------------------------------------------------------------------------------------------------------------------------------------------------->
<!------------- teplomÄ›ry zahrada ------------------------------------------------------------------------------------------------------------------->
<!--------------------------------------------------------------------------------------------------------------------------------------------------->
      
      <div class=""widget"">
        <h2>TeplomÄ›r zahrada</h2>
        <div class=""widget-row"">
          <span>ðŸŒ¡ï¸ Teplota:</span>
          <span id=""temp_zahrada"">-- Â°C</span>
        </div>
        <div class=""widget-row"">
          <span>ðŸ’§ Vlhkost:</span>
          <span id=""hum_zahrada"">-- %</span>
        </div>
      </div>
 <!--------------------------------------------------------------------------------------------------------------------------------------------------->
<!------------- teplomÄ›ry koupelna ------------------------------------------------------------------------------------------------------------------->
<!---------------------------------------------------------------------------------------------------------------------------------------------------->
     
      <div class=""widget"">
        <h2>TeplomÄ›r koupelna</h2>
        <div class=""widget-row"">
          <span>ðŸŒ¡ï¸ Teplota:</span>
          <span id=""temp_koupelna"">-- Â°C</span>
        </div>
        <div class=""widget-row"">
          <span>ðŸ’§ Vlhkost:</span>
          <span id=""hum_koupelna"">-- %</span>
        </div>
      </div>
<!--------------------------------------------------------------------------------------------------------------------------------------------------->
<!------------- teplomÄ›ry loznice ------------------------------------------------------------------------------------------------------------------->
<!--------------------------------------------------------------------------------------------------------------------------------------------------->
    
      <div class=""widget"">
        <h2>TeplomÄ›r loÅ¾nice</h2>
        <div class=""widget-row"">
          <span>ðŸŒ¡ï¸ Teplota:</span>
          <span id=""temp1"">-- Â°C</span>
        </div>
        <div class=""widget-row"">
          <span>ðŸ’§ Vlhkost:</span>
          <span id=""hum1"">-- %</span>
        </div>
      </div>
<!--------------------------------------------------------------------------------------------------------------------------------------------------->
<!------------- teplomÄ›ry pokoj --------------------------------------------------------------------------------------------------------------------->
<!--------------------------------------------------------------------------------------------------------------------------------------------------->
     
      <div class=""widget"">
        <h2>TeplomÄ›r pokoj</h2>
        <div class=""widget-row"">
          <span>ðŸŒ¡ï¸ Teplota:</span>
          <span id=""temp2"">-- Â°C</span>
        </div>
        <div class=""widget-row"">
          <span>ðŸ’§ Vlhkost:</span>
          <span id=""hum2"">-- %</span>
        </div>
      </div>
 <!--------------------------------------------------------------------------------------------------------------------------------------------------->
<!------------- teplomÄ›ry obyvak --------------------------------------------------------------------------------------------------------------------->
<!--------------------------------------------------------------------------------------------------------------------------------------------------->
     
      <div class=""widget"">
        <h2>TeplomÄ›r obÃ½vÃ¡k</h2>
        <div class=""widget-row"">
          <span>ðŸŒ¡ï¸ Teplota:</span>
          <span id=""temp3"">-- Â°C</span>
        </div>
        <div class=""widget-row"">
          <span>ðŸ’§ Vlhkost:</span>
          <span id=""hum3"">-- %</span>
        </div>
      </div>
      
    </div>
<!--------------------------------------------------------------------------------------------------------------------------------------------------->
<!--------------------------------------------------------------------------------------------------------------------------------------------------->
<!------------- rele -------------------------------------------------------------------------------------------------------------------------------->
<!--------------------------------------------------------------------------------------------------------------------------------------------------->
<!--------------------------------------------------------------------------------------------------------------------------------------------------->

    <!-- RELÃ‰ -->
    <div class=""rele-container"">
<!--------------------------------------------------------------------------------------------------------------------------------------------------->
<!------------- rele svÄ›tla ------------------------------------------------------------------------------------------------------------------------->
<!--------------------------------------------------------------------------------------------------------------------------------------------------->
     
      <!-- SvÄ›tla -->
      <div class=""widget-rele"">
        <h2>RelÃ© svÄ›tla</h2>
        
        <div class=""rele-row"">
          <span>â­ KanÃ¡l L1</span>
          <img src=""Switch_off.png"" alt=""Switch OFF"" class=""image-switch"" id=""state_l1"" data-state=""OFF"" data-rele=""svetla"" data-kanal=""l1"">
        </div>
        
        <div class=""rele-row"">
          <span>â­ KanÃ¡l L2</span>
          <img src=""Switch_off.png"" alt=""Switch OFF"" class=""image-switch"" id=""state_l2"" data-state=""OFF"" data-rele=""svetla"" data-kanal=""l2"">
        </div>
        
        <div class=""rele-row"">
          <span>â­ KanÃ¡l L3</span>
          <img src=""Switch_off.png"" alt=""Switch OFF"" class=""image-switch"" id=""state_l3"" data-state=""OFF"" data-rele=""svetla"" data-kanal=""l3"">
        </div>
        
        <div class=""rele-row"">
          <span>â­ KanÃ¡l L4</span>
          <img src=""Switch_off.png"" alt=""Switch OFF"" class=""image-switch"" id=""state_l4"" data-state=""OFF"" data-rele=""svetla"" data-kanal=""l4"">
        </div>
      </div>
<!--------------------------------------------------------------------------------------------------------------------------------------------------->
<!------------- rele pÅ¯da --------------------------------------------------------------------------------------------------------------------------->
<!--------------------------------------------------------------------------------------------------------------------------------------------------->

      <!-- PÅ¯da -->
      <div class=""widget-rele"">
        <h2>RelÃ© pÅ¯da</h2>
        
        <div class=""rele-row"">
          <span>â­ KanÃ¡l L1</span>
          <img src=""Switch_off.png"" alt=""Switch OFF"" class=""image-switch"" id=""state_puda_l1"" data-state=""OFF"" data-rele=""puda"" data-kanal=""l1"">
        </div>
        
        <div class=""rele-row"">
          <span>â­ KanÃ¡l L2</span>
          <img src=""Switch_off.png"" alt=""Switch OFF"" class=""image-switch"" id=""state_puda_l2"" data-state=""OFF"" data-rele=""puda"" data-kanal=""l2"">
        </div>
        
        <div class=""rele-row"">
          <span>â­ KanÃ¡l L3</span>
          <img src=""Switch_off.png"" alt=""Switch OFF"" class=""image-switch"" id=""state_puda_l3"" data-state=""OFF"" data-rele=""puda"" data-kanal=""l3"">
        </div>
        
        <div class=""rele-row"">
          <span>â­ KanÃ¡l L4</span>
          <img src=""Switch_off.png"" alt=""Switch OFF"" class=""image-switch"" id=""state_puda_l4"" data-state=""OFF"" data-rele=""puda"" data-kanal=""l4"">
        </div>
      </div>
<!--------------------------------------------------------------------------------------------------------------------------------------------------->
<!------------- rele garÃ¡Å¾ -------------------------------------------------------------------------------------------------------------------------->
<!--------------------------------------------------------------------------------------------------------------------------------------------------->

      <!-- GarÃ¡Å¾ -->
      <div class=""widget-rele"">
        <h2>RelÃ© garÃ¡Å¾</h2>
        
        <div class=""rele-row"">
          <span>â­ KanÃ¡l L1</span>
          <img src=""Switch_off.png"" alt=""Switch OFF"" class=""image-switch"" id=""state_garaz_l1"" data-state=""OFF"" data-rele=""garaz"" data-kanal=""l1"">
        </div>
        
        <div class=""rele-row"">
          <span>â­ KanÃ¡l L2</span>
          <img src=""Switch_off.png"" alt=""Switch OFF"" class=""image-switch"" id=""state_garaz_l2"" data-state=""OFF"" data-rele=""garaz"" data-kanal=""l2"">
        </div>
        
        <div class=""rele-row"">
          <span>â­ KanÃ¡l L3</span>
          <img src=""Switch_off.png"" alt=""Switch OFF"" class=""image-switch"" id=""state_garaz_l3"" data-state=""OFF"" data-rele=""garaz"" data-kanal=""l3"">
        </div>
        
        <div class=""rele-row"">
          <span>â­ KanÃ¡l L4</span>
          <img src=""Switch_off.png"" alt=""Switch OFF"" class=""image-switch"" id=""state_garaz_l4"" data-state=""OFF"" data-rele=""garaz"" data-kanal=""l4"">
        </div>
      </div>
<!--------------------------------------------------------------------------------------------------------------------------------------------------->
<!------------- rele dveÅ™e pravÃ© -------------------------------------------------------------------------------------------------------------------->
<!--------------------------------------------------------------------------------------------------------------------------------------------------->

      <!-- DveÅ™e pravÃ© -->
      <div class=""widget-rele"">
        <h2>RelÃ© dveÅ™e P</h2>
        
        <div class=""rele-row"">
          <span>â­ KanÃ¡l L1</span>
          <img src=""Switch_off.png"" alt=""Switch OFF"" class=""image-switch"" id=""state_dvere_p_l1"" data-state=""OFF"" data-rele=""dvere_p"" data-kanal=""l1"">
        </div>
        
        <div class=""rele-row"">
          <span>â­ KanÃ¡l L2</span>
          <img src=""Switch_off.png"" alt=""Switch OFF"" class=""image-switch"" id=""state_dvere_p_l2"" data-state=""OFF"" data-rele=""dvere_p"" data-kanal=""l2"">
        </div>
        
        <div class=""rele-row"">
          <span>â­ KanÃ¡l L3</span>
          <img src=""Switch_off.png"" alt=""Switch OFF"" class=""image-switch"" id=""state_dvere_p_l3"" data-state=""OFF"" data-rele=""dvere_p"" data-kanal=""l3"">
        </div>
        
        <div class=""rele-row"">
          <span>â­ KanÃ¡l L4</span>
          <img src=""Switch_off.png"" alt=""Switch OFF"" class=""image-switch"" id=""state_dvere_p_l4"" data-state=""OFF"" data-rele=""dvere_p"" data-kanal=""l4"">
        </div>
      </div>
<!--------------------------------------------------------------------------------------------------------------------------------------------------->
<!------------- rele dveÅ™e levÃ© --------------------------------------------------------------------------------------------------------------------->
<!--------------------------------------------------------------------------------------------------------------------------------------------------->

      <!-- DveÅ™e levÃ© -->
      <div class=""widget-rele"">
        <h2>RelÃ© dveÅ™e L</h2>
        
        <div class=""rele-row"">
          <span>â­ KanÃ¡l L1</span>
          <img src=""Switch_off.png"" alt=""Switch OFF"" class=""image-switch"" id=""state_dvere_l_l1"" data-state=""OFF"" data-rele=""dvere_l"" data-kanal=""l1"">
        </div>
        
        <div class=""rele-row"">
          <span>â­ KanÃ¡l L2</span>
          <img src=""Switch_off.png"" alt=""Switch OFF"" class=""image-switch"" id=""state_dvere_l_l2"" data-state=""OFF"" data-rele=""dvere_l"" data-kanal=""l2"">
        </div>
        
        <div class=""rele-row"">
          <span>â­ Reprak AirAux</span>
          <img src=""Switch_off.png"" alt=""Switch OFF"" class=""image-switch"" id=""state_dvere_l_l3"" data-state=""OFF"" data-rele=""dvere_l"" data-kanal=""l3"">
        </div>
        
        <div class=""rele-row"">
          <span>â­ KanÃ¡l L4</span>
          <img src=""Switch_off.png"" alt=""Switch OFF"" class=""image-switch"" id=""state_dvere_l_l4"" data-state=""OFF"" data-rele=""dvere_l"" data-kanal=""l4"">
        </div>
      </div>
<!--------------------------------------------------------------------------------------------------------------------------------------------------->
<!------------- rele venku pÅ™ed dveÅ™mi -------------------------------------------------------------------------------------------------------------->
<!--------------------------------------------------------------------------------------------------------------------------------------------------->

      <!-- Venku pÅ™ed dveÅ™mi -->
      <div class=""widget-rele"">
        <h2>RelÃ© venku</h2>
        
        <div class=""rele-row"">
          <span>â­ Kamera Hiseeu</span>
          <img src=""Switch_off.png"" alt=""Switch OFF"" class=""image-switch"" id=""state_venku_l1"" data-state=""OFF"" data-rele=""venku"" data-kanal=""l1"">
        </div>
        
        <div class=""rele-row"">
          <span>â­ KanÃ¡l L2</span>
          <img src=""Switch_off.png"" alt=""Switch OFF"" class=""image-switch"" id=""state_venku_l2"" data-state=""OFF"" data-rele=""venku"" data-kanal=""l2"">
        </div>
        
        <div class=""rele-row"">
          <span>â­ TP-Link router</span>
          <img src=""Switch_off.png"" alt=""Switch OFF"" class=""image-switch"" id=""state_venku_l3"" data-state=""OFF"" data-rele=""venku"" data-kanal=""l3"">
        </div>
        
        <div class=""rele-row"">
          <span>â­ KanÃ¡l L4</span>
          <img src=""Switch_off.png"" alt=""Switch OFF"" class=""image-switch"" id=""state_venku_l4"" data-state=""OFF"" data-rele=""venku"" data-kanal=""l4"">
        </div>
      </div>
<!--------------------------------------------------------------------------------------------------------------------------------------------------->
<!------------- rele Slepice ------------------------------------------------------------------------------------------------------------------------>
<!--------------------------------------------------------------------------------------------------------------------------------------------------->

      <!-- Slepice -->
      <div class=""widget-rele"">
        <h2>RelÃ© slepice</h2>
        
        <div class=""rele-row"">
          <span>â­ Kamera</span>
          <img src=""Switch_off.png"" alt=""Switch OFF"" class=""image-switch"" id=""rele_slepice_l1"" data-state=""OFF"" data-rele=""slepice"" data-kanal=""l1"">
        </div>
        
        <div class=""rele-row"">
          <span>â­ KanÃ¡l L2</span>
          <img src=""Switch_off.png"" alt=""Switch OFF"" class=""image-switch"" id=""rele_slepice_l2"" data-state=""OFF"" data-rele=""slepice"" data-kanal=""l2"">
        </div>
        
        <div class=""rele-row"">
          <span>â­ KanÃ¡l L3</span>
          <img src=""Switch_off.png"" alt=""Switch OFF"" class=""image-switch"" id=""rele_slepice_l3"" data-state=""OFF"" data-rele=""slepice"" data-kanal=""l3"">
        </div>
        
        <div class=""rele-row"">
          <span>â­ KanÃ¡l L4</span>
          <img src=""Switch_off.png"" alt=""Switch OFF"" class=""image-switch"" id=""rele_slepice_l4"" data-state=""OFF"" data-rele=""slepice"" data-kanal=""l4"">
        </div>
      </div>
<!--------------------------------------------------------------------------------------------------------------------------------------------------->
<!--------------------------------------------------------------------------------------------------------------------------------------------------->
<!--------------------------------------------------------------------------------------------------------------------------------------------------->
   
    </div>

<!--------------------------------------------------------------------------------------------------------------------------------------------------->
<!--------------------------------------------------------------------------------------------------------------------------------------------------->
<!------------- Power Monitoring -------------------------------------------------------------------------------------------------------------------->
<!--------------------------------------------------------------------------------------------------------------------------------------------------->
<!--------------------------------------------------------------------------------------------------------------------------------------------------->
    
    <!-- POWER MONITORING -->
    <div class=""power-container"">
      
      <!-- ZÃ¡suvka sekaÄka -->
      <div class=""widget-power"">
        <div class=""power-header"">
          <div class=""power-device-info"">
            <div class=""power-device-name"">ZÃ¡suvka sekaÄka</div>
          </div>
        </div>
        
        <div class=""power-metrics"">
          <div class=""power-metric-row"">
            <div class=""power-metric-label"">
              <span class=""power-metric-icon icon-state"">â­</span>
              <span>Stav</span>
            </div>
            <img src=""Switch_off.png"" alt=""Switch OFF"" class=""image-switch"" id=""zasuvka_sekacka_switch"" data-state=""OFF"" data-rele=""zasuvka_sekacka"" data-kanal=""dummy"">
          </div>
          
          <div class=""power-metric-row"">
            <div class=""power-metric-label"">
              <span class=""power-metric-icon icon-power"">ðŸ”‹</span>
              <span>NapÃ¡jenÃ­</span>
            </div>
            <div class=""power-metric-value"">
              <span id=""power_napajeni"">0</span>
              <span class=""power-metric-unit"">W</span>
            </div>
          </div>
          
          <div class=""power-metric-row"">
            <div class=""power-metric-label"">
              <span class=""power-metric-icon icon-current"">ðŸŸ¡</span>
              <span>AktuÃ¡lnÃ­</span>
            </div>
            <div class=""power-metric-value"">
              <span id=""power_aktualni"">0.00</span>
              <span class=""power-metric-unit"">A</span>
            </div>
          </div>
          
          <div class=""power-metric-row"">
            <div class=""power-metric-label"">
              <span class=""power-metric-icon icon-voltage"">âš¡</span>
              <span>NapÄ›tÃ­</span>
            </div>
            <div class=""power-metric-value"">
              <span id=""power_napeti"">0</span>
              <span class=""power-metric-unit"">V</span>
            </div>
          </div>
          
          <div class=""power-metric-row"">
            <div class=""power-metric-label"">
              <span class=""power-metric-icon icon-energy"">ðŸ”Œ</span>
              <span>Energie</span>
            </div>
            <div class=""power-metric-value"">
              <span id=""power_energie"">0.00</span>
              <span class=""power-metric-unit"">kWh</span>
            </div>
          </div>
        </div>
      </div>
      
    </div>
  </div>


<script>
// KONFIGURAÄŒNÃ PROMÄšNNÃ‰
// =====================
const API_URL = ""http://192.168.1.5:1880/api/teplomery"";
const REFRESH_INTERVAL = 1000;
const SWITCH_OFF_IMG = ""Switch_off.png"";
const SWITCH_ON_IMG = ""Switch_on.png"";

let lastClickTime = 0;

/**
 * HLAVNÃ FUNKCE PRO NAÄŒÃTÃNÃ DAT
 */
async function nacistData() {
  try {
    const now = Date.now();
    if (now - lastClickTime < 500) {
      return;
    }
    
    const response = await fetch(API_URL);
    
    if (!response.ok) {
      throw new Error(""Chyba pÅ™i naÄÃ­tÃ¡nÃ­ dat"");
    }
    
    const data = await response.json();

//------------------------------------------------------------------------------------------------------       
//----- AKTUALIZACE TEPLOMÄšRÅ® --------------------------------------------------------------------------
//------------------------------------------------------------------------------------------------------

    // TeplomÄ›ry ve sklepÄ›
    if (data.sklep) {
      if (data.sklep.kotel !== null) {
        document.getElementById(""temp_kotel"").innerText = data.sklep.kotel.toFixed(1) + "" Â°C"";
      } else {
        document.getElementById(""temp_kotel"").innerText = ""-- Â°C"";
      }
      
      if (data.sklep.voda !== null) {
        document.getElementById(""temp_voda"").innerText = data.sklep.voda.toFixed(1) + "" Â°C"";
      } else {
        document.getElementById(""temp_voda"").innerText = ""-- Â°C"";
      }
    } else {
      document.getElementById(""temp_kotel"").innerText = ""-- Â°C"";
      document.getElementById(""temp_voda"").innerText = ""-- Â°C"";
    }
    
    // VenkovnÃ­ teplomÄ›r
    if (data.venku && data.venku.temperature !== null) {
      document.getElementById(""temp_venku"").innerText = data.venku.temperature.toFixed(1) + "" Â°C"";
      document.getElementById(""hum_venku"").innerText = data.venku.humidity.toFixed(1) + "" %"";
    } else {
      document.getElementById(""temp_venku"").innerText = ""-- Â°C"";
      document.getElementById(""hum_venku"").innerText = ""-- %"";
    }
    
    // TeplomÄ›r zahrada
    if (data.teplomer_zahrada && data.teplomer_zahrada.temperature !== null) {
      document.getElementById(""temp_zahrada"").innerText = data.teplomer_zahrada.temperature.toFixed(1) + "" Â°C"";
      document.getElementById(""hum_zahrada"").innerText = data.teplomer_zahrada.humidity.toFixed(1) + "" %"";
    } else {
      document.getElementById(""temp_zahrada"").innerText = ""-- Â°C"";
      document.getElementById(""hum_zahrada"").innerText = ""-- %"";
    }
    
    // TeplomÄ›r koupelna
    if (data.koupelna && data.koupelna.temperature !== null) {
      document.getElementById(""temp_koupelna"").innerText = data.koupelna.temperature.toFixed(1) + "" Â°C"";
      document.getElementById(""hum_koupelna"").innerText = data.koupelna.humidity.toFixed(1) + "" %"";
    } else {
      document.getElementById(""temp_koupelna"").innerText = ""-- Â°C"";
      document.getElementById(""hum_koupelna"").innerText = ""-- %"";
    }
    
    // TeplomÄ›r loÅ¾nice
    if (data.loznice && data.loznice.temperature !== null) {
      document.getElementById(""temp1"").innerText = data.loznice.temperature.toFixed(1) + "" Â°C"";
      document.getElementById(""hum1"").innerText = data.loznice.humidity.toFixed(1) + "" %"";
    } else {
      document.getElementById(""temp1"").innerText = ""-- Â°C"";
      document.getElementById(""hum1"").innerText = ""-- %"";
    }
    
    // TeplomÄ›r pokoj
    if (data.pokoj && data.pokoj.temperature !== null) {
      document.getElementById(""temp2"").innerText = data.pokoj.temperature.toFixed(1) + "" Â°C"";
      document.getElementById(""hum2"").innerText = data.pokoj.humidity.toFixed(1) + "" %"";
    } else {
      document.getElementById(""temp2"").innerText = ""-- Â°C"";
      document.getElementById(""hum2"").innerText = ""-- %"";
    }
    
    // TeplomÄ›r obÃ½vÃ¡k
    if (data.obyvak && data.obyvak.temperature !== null) {
      document.getElementById(""temp3"").innerText = data.obyvak.temperature.toFixed(1) + "" Â°C"";
      document.getElementById(""hum3"").innerText = data.obyvak.humidity.toFixed(1) + "" %"";
    } else {
      document.getElementById(""temp3"").innerText = ""-- Â°C"";
      document.getElementById(""hum3"").innerText = ""-- %"";
    }

//------------------------------------------------------------------------------------------------------       
//----- AKTUALIZACE STAVU RELÃ‰ -------------------------------------------------------------------------
//------------------------------------------------------------------------------------------------------

    if (data.rele) {
      const updateSwitchImage = (elementId, newState) => {
        const imgElement = document.getElementById(elementId);
        if (imgElement) {
          const isON = newState === ""ON"";
          imgElement.src = isON ? SWITCH_ON_IMG : SWITCH_OFF_IMG;
          imgElement.alt = isON ? ""Switch ON"" : ""Switch OFF"";
          imgElement.dataset.state = newState;
        }
      };
      
      // SvÄ›tla
      updateSwitchImage(""state_l1"", data.rele.state_l1);
      updateSwitchImage(""state_l2"", data.rele.state_l2);
      updateSwitchImage(""state_l3"", data.rele.state_l3);
      updateSwitchImage(""state_l4"", data.rele.state_l4);
      
      // PÅ¯da
      updateSwitchImage(""state_puda_l1"", data.rele.state_puda_l1);
      updateSwitchImage(""state_puda_l2"", data.rele.state_puda_l2);
      updateSwitchImage(""state_puda_l3"", data.rele.state_puda_l3);
      updateSwitchImage(""state_puda_l4"", data.rele.state_puda_l4);
      
      // GarÃ¡Å¾
      updateSwitchImage(""state_garaz_l1"", data.rele.state_garaz_l1);
      updateSwitchImage(""state_garaz_l2"", data.rele.state_garaz_l2);
      updateSwitchImage(""state_garaz_l3"", data.rele.state_garaz_l3);
      updateSwitchImage(""state_garaz_l4"", data.rele.state_garaz_l4);
      
      // DveÅ™e pravÃ©
      updateSwitchImage(""state_dvere_p_l1"", data.rele.state_dvere_p_l1);
      updateSwitchImage(""state_dvere_p_l2"", data.rele.state_dvere_p_l2);
      updateSwitchImage(""state_dvere_p_l3"", data.rele.state_dvere_p_l3);
      updateSwitchImage(""state_dvere_p_l4"", data.rele.state_dvere_p_l4);
      
      // DveÅ™e levÃ©
      updateSwitchImage(""state_dvere_l_l1"", data.rele.state_dvere_l_l1);
      updateSwitchImage(""state_dvere_l_l2"", data.rele.state_dvere_l_l2);
      updateSwitchImage(""state_dvere_l_l3"", data.rele.state_dvere_l_l3);
      updateSwitchImage(""state_dvere_l_l4"", data.rele.state_dvere_l_l4);
      
      // Venku
      updateSwitchImage(""state_venku_l1"", data.rele.state_venku_l1);
      updateSwitchImage(""state_venku_l2"", data.rele.state_venku_l2);
      updateSwitchImage(""state_venku_l3"", data.rele.state_venku_l3);
      updateSwitchImage(""state_venku_l4"", data.rele.state_venku_l4);
      
      // Slepice
      updateSwitchImage(""rele_slepice_l1"", data.rele.rele_slepice_l1);
      updateSwitchImage(""rele_slepice_l2"", data.rele.rele_slepice_l2);
      updateSwitchImage(""rele_slepice_l3"", data.rele.rele_slepice_l3);
      updateSwitchImage(""rele_slepice_l4"", data.rele.rele_slepice_l4);
    }

//------------------------------------------------------------------------------------------------------
//----- AKTUALIZACE ZÃSUVKY SEKAÄŒKY -------------------------------------------------------------------
//------------------------------------------------------------------------------------------------------

    if (data.zasuvka_sekacka) {
      // Aktualizace pÅ™epÃ­naÄe
      const imgElement = document.getElementById(""zasuvka_sekacka_switch"");
      if (imgElement) {
        const isON = data.zasuvka_sekacka.state === ""ON"";
        imgElement.src = isON ? SWITCH_ON_IMG : SWITCH_OFF_IMG;
        imgElement.alt = isON ? ""Switch ON"" : ""Switch OFF"";
        imgElement.dataset.state = data.zasuvka_sekacka.state;
      }
      
      // Aktualizace hodnot
      document.getElementById(""power_napajeni"").innerText = data.zasuvka_sekacka.power || 0;
      document.getElementById(""power_aktualni"").innerText = (data.zasuvka_sekacka.current || 0).toFixed(2);
      document.getElementById(""power_napeti"").innerText = data.zasuvka_sekacka.voltage || 0;
      document.getElementById(""power_energie"").innerText = (data.zasuvka_sekacka.energy || 0).toFixed(2);
    }
    
    // Aktualizace stavovÃ©ho Å™Ã¡dku
    const statusElement = document.getElementById(""status"");
    statusElement.innerText = ""âœ“ PÅ™ipojeno - "" + new Date().toLocaleTimeString();
    statusElement.className = ""status connected"";
    
  } catch (error) {
    console.error(""Chyba:"", error);
    const statusElement = document.getElementById(""status"");
    statusElement.innerText = ""âœ— Chyba pÅ™ipojenÃ­"";
    statusElement.className = ""status error"";
  }
}

/**
 * FUNKCE PRO OVLÃDÃNÃ RELÃ‰
 */
async function ovladatRele(imgElement) {
  const rele = imgElement.dataset.rele;
  const kanal = imgElement.dataset.kanal;
  const currentState = imgElement.dataset.state;
  const newState = currentState === ""ON"" ? ""OFF"" : ""ON"";

  imgElement.classList.add('disabled');

  try {
    lastClickTime = Date.now();
    
    const statusElement = document.getElementById(""status"");
    statusElement.innerText = `PÅ™epÃ­nÃ¡m ${rele}...`;
    statusElement.className = ""status"";
    
    const response = await fetch(`?rele=${rele}&kanal=${kanal}&stav=${newState.toLowerCase()}`);
    
    if (!response.ok) {
      throw new Error(""Chyba pÅ™i ovlÃ¡dÃ¡nÃ­"");
    }
    
    const result = await response.json();
    
    if (result.success) {
      imgElement.src = newState === ""ON"" ? SWITCH_ON_IMG : SWITCH_OFF_IMG;
      imgElement.alt = newState === ""ON"" ? ""Switch ON"" : ""Switch OFF"";
      imgElement.dataset.state = newState;
      
      statusElement.innerText = `âœ“ ${rele} pÅ™epnuto na ${newState}`;
      statusElement.className = ""status connected"";
    } else {
      throw new Error(""PÅ™epnutÃ­ selhalo"");
    }
    
    setTimeout(() => {
      lastClickTime = 0;
      nacistData();
    }, 200);
    
  } catch (error) {
    console.error(""Chyba:"", error);
    const statusElement = document.getElementById(""status"");
    statusElement.innerText = ""âœ— Chyba pÅ™i pÅ™epÃ­nÃ¡nÃ­"";
    statusElement.className = ""status error"";
    
    imgElement.src = currentState === ""ON"" ? SWITCH_ON_IMG : SWITCH_OFF_IMG;
    imgElement.dataset.state = currentState;
    lastClickTime = 0;
  } finally {
    imgElement.classList.remove('disabled');
  }
}

// INICIALIZACE DASHBOARDU
  document.querySelectorAll('.image-switch').forEach(img => {
   img.addEventListener('click', function() {
    ovladatRele(this);
  });
});

  nacistData();
  setInterval(nacistData, REFRESH_INTERVAL);

  console.log(""Dashboard s 7 relÃ©, 7 teplomÄ›rÅ¯ a 1 zÃ¡suvkou spuÅ¡tÄ›n"");
</script>

</body>
</html>
"
XKt6fmgP,wodget,Leo0777,JavaScript,Saturday 22nd of November 2025 12:12:11 AM CDT,"<?php
// ZpracovÃ¡nÃ­ poÅ¾adavku na pÅ™epnutÃ­ relÃ©
if (isset($_GET['rele']) && isset($_GET['kanal']) && isset($_GET['stav'])) {
    $rele = $_GET['rele'];
    $kanal = $_GET['kanal'];
    $stav = strtoupper($_GET['stav']);
    
    // Spustit pÅ™Ã­sluÅ¡nÃ½ skript s parametry
    exec(""sudo /home/leo/skripty/muj_web/rele_{$rele}.sh $kanal $stav"");
    
    // VrÃ¡tit JSON odpovÄ›Ä
    header('Content-Type: application/json');
    echo json_encode(['success' => true, 'rele' => $rele, 'kanal' => $kanal, 'stav' => $stav]);
    exit;
}
?>

<!DOCTYPE html>
<html lang=""cs"">
<head>
  <meta charset=""UTF-8"">
  <meta name=""viewport"" content=""width=device-width, initial-scale=1.0"">
  <title>MQTT Dashboard</title>
  <style>
    body {
      margin: 0;
      padding: 20px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      font-family: Arial, sans-serif;
    }
    
    .dashboard {
      max-width: 1200px;
      margin: 0 auto;
    }
    
    .dashboard-title {
      text-align: center;
      color: white;
      font-size: 32px;
      margin-bottom: 30px;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
    }
    
    .teplomery-container {
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
      justify-content: center;
      margin-bottom: 30px;
      min-height: 200px;
      width: 100%;
      max-width: 800px;
      margin: 0 auto 30px auto;
      background: rgba(255,255,255,0.1);
      border-radius: 10px;
      padding: 20px;
    }

    .rele-container {
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
      justify-content: center;
      min-height: 150px;
      width: 100%;
      max-width: 800px;
      margin: 0 auto 30px auto;
      background: rgba(255,255,255,0.1);
      border-radius: 10px;
      padding: 20px;
    }
    
    .power-container {
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
      justify-content: center;
      min-height: 150px;
      width: 100%;
      max-width: 800px;
      margin: 0 auto;
      background: rgba(255,255,255,0.1);
      border-radius: 10px;
      padding: 20px;
    }
    
    .widget {
      background: #1e293b;
      color: #e2e8f0;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
      width: 170px;
      height: auto;
      flex-shrink: 0;
    }
    
    .widget-rele {
      background: #1e293b;
      color: #e2e8f0;
      padding: 15px;
      border-radius: 10px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
      width: 220px;
      height: auto;
      flex-shrink: 0;
    }
    
    .widget-power {
      background: #1e293b;
      color: #e2e8f0;
      padding: 0;
      border-radius: 10px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
      width: 250px;
      height: auto;
      flex-shrink: 0;
      overflow: hidden;
    }
    
    .widget h2 {
      text-align: center;
      margin: 0 0 10px 0;
      font-size: 16px;
      color: white;
      padding: 5px 0;
    }
    
    .widget-rele h2 {
      text-align: center;
      margin: 0 0 10px 0;
      font-size: 16px;
      color: white;
      padding: 5px 0;
    }
    
    .widget-row {
      display: flex;
      justify-content: space-between;
      padding: 8px 0;
      border-bottom: 1px solid #444;
    }
    
    .widget-row:last-child {
      border-bottom: none;
    }
    
    .widget-row span:first-child {
      font-weight: bold;
    }
    
   .status {
     text-align: center;
     color: white;
     font-size: 14px;
     margin-bottom: 20px;
     padding: 10px;
     background: transparent;
     border-radius: 5px;
     max-width: 200px;
     margin-left: auto;
     margin-right: auto;
    }
    
    .status.connected {
       background: transparent;
       color: white;
    }
    
    .status.error {
      background: transparent;
      color: white;
     }
    
    .rele-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 6px 0;
      border-bottom: 1px solid #374151;
    }
    
    .rele-row:last-child {
      border-bottom: none;
    }
    
    .rele-row span {
      display: flex;
      align-items: center;
      font-size: 13px;
    }
    
    .image-switch {
      cursor: pointer;
      width: 50px;
      height: auto;
      vertical-align: middle;
      transition: transform 0.1s;
    }
    
    .image-switch:active {
      transform: scale(0.95);
    }
    
    .image-switch.disabled {
      opacity: 0.5;
      cursor: wait;
    }
    
    .power-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 15px;
      background: #1e293b;
      border-bottom: none;
    }
    
    .power-device-info {
      display: flex;
      align-items: center;
      gap: 8px;
      flex: 1;
      min-width: 0;
    }
    
    .power-device-icon {
      width: 28px;
      height: 28px;
      background: #e8e8e8;
      border-radius: 6px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 16px;
      flex-shrink: 0;
    }
    
    .power-device-name {
      color: #ffffff;
      font-size: 16px;
      font-weight: 400;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
      text-align: center;
      width: 100%;
    }
    
    .power-metrics {
      padding: 0;
      background: #1e293b;
    }
    
    .power-metric-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 5px 15px;
      border-bottom: none;
      transition: background 0.15s ease;
    }
    
    .power-metric-row:hover {
      background: #2d3e52;
    }
    
    .power-metric-label {
      display: flex;
      align-items: center;
      gap: 8px;
      color: #e2e8f0;
      font-size: 13px;
      font-weight: 400;
    }
    
    .power-metric-label span {
      color: #e2e8f0;
    }
    
    .power-metric-icon {
      font-size: 16px;
      width: 20px;
      text-align: center;
    }
    
    .power-metric-value {
      display: flex;
      align-items: baseline;
      gap: 3px;
      color: #ffffff;
      font-size: 15px;
      font-weight: 500;
    }
    
    .power-metric-unit {
      color: #e2e8f0;
      font-size: 12px;
      font-weight: 400;
    }
    
    .icon-state { color: #f4d03f; }
    .icon-power { color: #5fb878; }
    .icon-current { color: #ff9f43; }
    .icon-voltage { color: #5eb3f6; }
    .icon-energy { color: #26c6da; }
    
    @media (max-width: 768px) {
      .teplomery-container,
      .rele-container,
      .power-container {
        flex-direction: column;
        align-items: center;
      }
      
      .widget, .widget-rele, .widget-power {
        width: 100%;
        max-width: 300px;
      }
    }
  </style>
</head>
<body>
  <div class=""dashboard"">
    <h1 class=""dashboard-title"">ðŸ  DomÃ¡cÃ­ Dashboard</h1>
    
    <div id=""status"" class=""status"">NaÄÃ­tÃ¡m data...</div>
    
    <!-- TEPLOMÄšRY -->
    <div class=""teplomery-container"">

<!--------------------------------------------------------------------------------------------------------------------------------------------------->
<!------------- teplomÄ›ry sklep --------------------------------------------------------------------------------------------------------------------->
<!--------------------------------------------------------------------------------------------------------------------------------------------------->
      
      <div class=""widget"">
        <h2>TeplomÄ›ry sklep</h2>
        <div class=""widget-row"">
          <span>ðŸ”¥ Kotel:</span>
          <span id=""temp_kotel"">-- Â°C</span>
        </div>
        <div class=""widget-row"">
          <span>ðŸ’§ Voda:</span>
          <span id=""temp_voda"">-- Â°C</span>
        </div>
      </div>
 <!-------------------------------------------------------------------------------------------------------------------------------------------------->
<!------------- teplomÄ›r venku ---------------------------------------------------------------------------------------------------------------------->
<!--------------------------------------------------------------------------------------------------------------------------------------------------->
     
      <div class=""widget"">
        <h2>TeplomÄ›r venku</h2>
        <div class=""widget-row"">
          <span>ðŸŒ¡ï¸ Teplota:</span>
          <span id=""temp_venku"">-- Â°C</span>
        </div>
        <div class=""widget-row"">
          <span>ðŸ’§ Vlhkost:</span>
          <span id=""hum_venku"">-- %</span>
        </div>
      </div>
<!--------------------------------------------------------------------------------------------------------------------------------------------------->
<!------------- teplomÄ›ry zahrada ------------------------------------------------------------------------------------------------------------------->
<!--------------------------------------------------------------------------------------------------------------------------------------------------->
      
      <div class=""widget"">
        <h2>TeplomÄ›r zahrada</h2>
        <div class=""widget-row"">
          <span>ðŸŒ¡ï¸ Teplota:</span>
          <span id=""temp_zahrada"">-- Â°C</span>
        </div>
        <div class=""widget-row"">
          <span>ðŸ’§ Vlhkost:</span>
          <span id=""hum_zahrada"">-- %</span>
        </div>
      </div>
 <!--------------------------------------------------------------------------------------------------------------------------------------------------->
<!------------- teplomÄ›ry koupelna ------------------------------------------------------------------------------------------------------------------->
<!---------------------------------------------------------------------------------------------------------------------------------------------------->
     
      <div class=""widget"">
        <h2>TeplomÄ›r koupelna</h2>
        <div class=""widget-row"">
          <span>ðŸŒ¡ï¸ Teplota:</span>
          <span id=""temp_koupelna"">-- Â°C</span>
        </div>
        <div class=""widget-row"">
          <span>ðŸ’§ Vlhkost:</span>
          <span id=""hum_koupelna"">-- %</span>
        </div>
      </div>
<!--------------------------------------------------------------------------------------------------------------------------------------------------->
<!------------- teplomÄ›ry loznice ------------------------------------------------------------------------------------------------------------------->
<!--------------------------------------------------------------------------------------------------------------------------------------------------->
    
      <div class=""widget"">
        <h2>TeplomÄ›r loÅ¾nice</h2>
        <div class=""widget-row"">
          <span>ðŸŒ¡ï¸ Teplota:</span>
          <span id=""temp1"">-- Â°C</span>
        </div>
        <div class=""widget-row"">
          <span>ðŸ’§ Vlhkost:</span>
          <span id=""hum1"">-- %</span>
        </div>
      </div>
<!--------------------------------------------------------------------------------------------------------------------------------------------------->
<!------------- teplomÄ›ry pokoj --------------------------------------------------------------------------------------------------------------------->
<!--------------------------------------------------------------------------------------------------------------------------------------------------->
     
      <div class=""widget"">
        <h2>TeplomÄ›r pokoj</h2>
        <div class=""widget-row"">
          <span>ðŸŒ¡ï¸ Teplota:</span>
          <span id=""temp2"">-- Â°C</span>
        </div>
        <div class=""widget-row"">
          <span>ðŸ’§ Vlhkost:</span>
          <span id=""hum2"">-- %</span>
        </div>
      </div>
 <!--------------------------------------------------------------------------------------------------------------------------------------------------->
<!------------- teplomÄ›ry obyvak --------------------------------------------------------------------------------------------------------------------->
<!--------------------------------------------------------------------------------------------------------------------------------------------------->
     
      <div class=""widget"">
        <h2>TeplomÄ›r obÃ½vÃ¡k</h2>
        <div class=""widget-row"">
          <span>ðŸŒ¡ï¸ Teplota:</span>
          <span id=""temp3"">-- Â°C</span>
        </div>
        <div class=""widget-row"">
          <span>ðŸ’§ Vlhkost:</span>
          <span id=""hum3"">-- %</span>
        </div>
      </div>
      
    </div>
<!--------------------------------------------------------------------------------------------------------------------------------------------------->
<!--------------------------------------------------------------------------------------------------------------------------------------------------->
<!------------- rele -------------------------------------------------------------------------------------------------------------------------------->
<!--------------------------------------------------------------------------------------------------------------------------------------------------->
<!--------------------------------------------------------------------------------------------------------------------------------------------------->

    <!-- RELÃ‰ -->
    <div class=""rele-container"">
<!--------------------------------------------------------------------------------------------------------------------------------------------------->
<!------------- rele svÄ›tla ------------------------------------------------------------------------------------------------------------------------->
<!--------------------------------------------------------------------------------------------------------------------------------------------------->
     
      <!-- SvÄ›tla -->
      <div class=""widget-rele"">
        <h2>RelÃ© svÄ›tla</h2>
        
        <div class=""rele-row"">
          <span>â­ KanÃ¡l L1</span>
          <img src=""Switch_off.png"" alt=""Switch OFF"" class=""image-switch"" id=""state_l1"" data-state=""OFF"" data-rele=""svetla"" data-kanal=""l1"">
        </div>
        
        <div class=""rele-row"">
          <span>â­ KanÃ¡l L2</span>
          <img src=""Switch_off.png"" alt=""Switch OFF"" class=""image-switch"" id=""state_l2"" data-state=""OFF"" data-rele=""svetla"" data-kanal=""l2"">
        </div>
        
        <div class=""rele-row"">
          <span>â­ KanÃ¡l L3</span>
          <img src=""Switch_off.png"" alt=""Switch OFF"" class=""image-switch"" id=""state_l3"" data-state=""OFF"" data-rele=""svetla"" data-kanal=""l3"">
        </div>
        
        <div class=""rele-row"">
          <span>â­ KanÃ¡l L4</span>
          <img src=""Switch_off.png"" alt=""Switch OFF"" class=""image-switch"" id=""state_l4"" data-state=""OFF"" data-rele=""svetla"" data-kanal=""l4"">
        </div>
      </div>
<!--------------------------------------------------------------------------------------------------------------------------------------------------->
<!------------- rele pÅ¯da --------------------------------------------------------------------------------------------------------------------------->
<!--------------------------------------------------------------------------------------------------------------------------------------------------->

      <!-- PÅ¯da -->
      <div class=""widget-rele"">
        <h2>RelÃ© pÅ¯da</h2>
        
        <div class=""rele-row"">
          <span>â­ KanÃ¡l L1</span>
          <img src=""Switch_off.png"" alt=""Switch OFF"" class=""image-switch"" id=""state_puda_l1"" data-state=""OFF"" data-rele=""puda"" data-kanal=""l1"">
        </div>
        
        <div class=""rele-row"">
          <span>â­ KanÃ¡l L2</span>
          <img src=""Switch_off.png"" alt=""Switch OFF"" class=""image-switch"" id=""state_puda_l2"" data-state=""OFF"" data-rele=""puda"" data-kanal=""l2"">
        </div>
        
        <div class=""rele-row"">
          <span>â­ KanÃ¡l L3</span>
          <img src=""Switch_off.png"" alt=""Switch OFF"" class=""image-switch"" id=""state_puda_l3"" data-state=""OFF"" data-rele=""puda"" data-kanal=""l3"">
        </div>
        
        <div class=""rele-row"">
          <span>â­ KanÃ¡l L4</span>
          <img src=""Switch_off.png"" alt=""Switch OFF"" class=""image-switch"" id=""state_puda_l4"" data-state=""OFF"" data-rele=""puda"" data-kanal=""l4"">
        </div>
      </div>
<!--------------------------------------------------------------------------------------------------------------------------------------------------->
<!------------- rele garÃ¡Å¾ -------------------------------------------------------------------------------------------------------------------------->
<!--------------------------------------------------------------------------------------------------------------------------------------------------->

      <!-- GarÃ¡Å¾ -->
      <div class=""widget-rele"">
        <h2>RelÃ© garÃ¡Å¾</h2>
        
        <div class=""rele-row"">
          <span>â­ KanÃ¡l L1</span>
          <img src=""Switch_off.png"" alt=""Switch OFF"" class=""image-switch"" id=""state_garaz_l1"" data-state=""OFF"" data-rele=""garaz"" data-kanal=""l1"">
        </div>
        
        <div class=""rele-row"">
          <span>â­ KanÃ¡l L2</span>
          <img src=""Switch_off.png"" alt=""Switch OFF"" class=""image-switch"" id=""state_garaz_l2"" data-state=""OFF"" data-rele=""garaz"" data-kanal=""l2"">
        </div>
        
        <div class=""rele-row"">
          <span>â­ KanÃ¡l L3</span>
          <img src=""Switch_off.png"" alt=""Switch OFF"" class=""image-switch"" id=""state_garaz_l3"" data-state=""OFF"" data-rele=""garaz"" data-kanal=""l3"">
        </div>
        
        <div class=""rele-row"">
          <span>â­ KanÃ¡l L4</span>
          <img src=""Switch_off.png"" alt=""Switch OFF"" class=""image-switch"" id=""state_garaz_l4"" data-state=""OFF"" data-rele=""garaz"" data-kanal=""l4"">
        </div>
      </div>
<!--------------------------------------------------------------------------------------------------------------------------------------------------->
<!------------- rele dveÅ™e pravÃ© -------------------------------------------------------------------------------------------------------------------->
<!--------------------------------------------------------------------------------------------------------------------------------------------------->

      <!-- DveÅ™e pravÃ© -->
      <div class=""widget-rele"">
        <h2>RelÃ© dveÅ™e P</h2>
        
        <div class=""rele-row"">
          <span>â­ KanÃ¡l L1</span>
          <img src=""Switch_off.png"" alt=""Switch OFF"" class=""image-switch"" id=""state_dvere_p_l1"" data-state=""OFF"" data-rele=""dvere_p"" data-kanal=""l1"">
        </div>
        
        <div class=""rele-row"">
          <span>â­ KanÃ¡l L2</span>
          <img src=""Switch_off.png"" alt=""Switch OFF"" class=""image-switch"" id=""state_dvere_p_l2"" data-state=""OFF"" data-rele=""dvere_p"" data-kanal=""l2"">
        </div>
        
        <div class=""rele-row"">
          <span>â­ KanÃ¡l L3</span>
          <img src=""Switch_off.png"" alt=""Switch OFF"" class=""image-switch"" id=""state_dvere_p_l3"" data-state=""OFF"" data-rele=""dvere_p"" data-kanal=""l3"">
        </div>
        
        <div class=""rele-row"">
          <span>â­ KanÃ¡l L4</span>
          <img src=""Switch_off.png"" alt=""Switch OFF"" class=""image-switch"" id=""state_dvere_p_l4"" data-state=""OFF"" data-rele=""dvere_p"" data-kanal=""l4"">
        </div>
      </div>
<!--------------------------------------------------------------------------------------------------------------------------------------------------->
<!------------- rele dveÅ™e levÃ© --------------------------------------------------------------------------------------------------------------------->
<!--------------------------------------------------------------------------------------------------------------------------------------------------->

      <!-- DveÅ™e levÃ© -->
      <div class=""widget-rele"">
        <h2>RelÃ© dveÅ™e L</h2>
        
        <div class=""rele-row"">
          <span>â­ KanÃ¡l L1</span>
          <img src=""Switch_off.png"" alt=""Switch OFF"" class=""image-switch"" id=""state_dvere_l_l1"" data-state=""OFF"" data-rele=""dvere_l"" data-kanal=""l1"">
        </div>
        
        <div class=""rele-row"">
          <span>â­ KanÃ¡l L2</span>
          <img src=""Switch_off.png"" alt=""Switch OFF"" class=""image-switch"" id=""state_dvere_l_l2"" data-state=""OFF"" data-rele=""dvere_l"" data-kanal=""l2"">
        </div>
        
        <div class=""rele-row"">
          <span>â­ Reprak AirAux</span>
          <img src=""Switch_off.png"" alt=""Switch OFF"" class=""image-switch"" id=""state_dvere_l_l3"" data-state=""OFF"" data-rele=""dvere_l"" data-kanal=""l3"">
        </div>
        
        <div class=""rele-row"">
          <span>â­ KanÃ¡l L4</span>
          <img src=""Switch_off.png"" alt=""Switch OFF"" class=""image-switch"" id=""state_dvere_l_l4"" data-state=""OFF"" data-rele=""dvere_l"" data-kanal=""l4"">
        </div>
      </div>
<!--------------------------------------------------------------------------------------------------------------------------------------------------->
<!------------- rele venku pÅ™ed dveÅ™mi -------------------------------------------------------------------------------------------------------------->
<!--------------------------------------------------------------------------------------------------------------------------------------------------->

      <!-- Venku pÅ™ed dveÅ™mi -->
      <div class=""widget-rele"">
        <h2>RelÃ© venku</h2>
        
        <div class=""rele-row"">
          <span>â­ Kamera Hiseeu</span>
          <img src=""Switch_off.png"" alt=""Switch OFF"" class=""image-switch"" id=""state_venku_l1"" data-state=""OFF"" data-rele=""venku"" data-kanal=""l1"">
        </div>
        
        <div class=""rele-row"">
          <span>â­ KanÃ¡l L2</span>
          <img src=""Switch_off.png"" alt=""Switch OFF"" class=""image-switch"" id=""state_venku_l2"" data-state=""OFF"" data-rele=""venku"" data-kanal=""l2"">
        </div>
        
        <div class=""rele-row"">
          <span>â­ TP-Link router</span>
          <img src=""Switch_off.png"" alt=""Switch OFF"" class=""image-switch"" id=""state_venku_l3"" data-state=""OFF"" data-rele=""venku"" data-kanal=""l3"">
        </div>
        
        <div class=""rele-row"">
          <span>â­ KanÃ¡l L4</span>
          <img src=""Switch_off.png"" alt=""Switch OFF"" class=""image-switch"" id=""state_venku_l4"" data-state=""OFF"" data-rele=""venku"" data-kanal=""l4"">
        </div>
      </div>
<!--------------------------------------------------------------------------------------------------------------------------------------------------->
<!------------- rele Slepice ------------------------------------------------------------------------------------------------------------------------>
<!--------------------------------------------------------------------------------------------------------------------------------------------------->

      <!-- Slepice -->
      <div class=""widget-rele"">
        <h2>RelÃ© slepice</h2>
        
        <div class=""rele-row"">
          <span>â­ Kamera</span>
          <img src=""Switch_off.png"" alt=""Switch OFF"" class=""image-switch"" id=""rele_slepice_l1"" data-state=""OFF"" data-rele=""slepice"" data-kanal=""l1"">
        </div>
        
        <div class=""rele-row"">
          <span>â­ KanÃ¡l L2</span>
          <img src=""Switch_off.png"" alt=""Switch OFF"" class=""image-switch"" id=""rele_slepice_l2"" data-state=""OFF"" data-rele=""slepice"" data-kanal=""l2"">
        </div>
        
        <div class=""rele-row"">
          <span>â­ KanÃ¡l L3</span>
          <img src=""Switch_off.png"" alt=""Switch OFF"" class=""image-switch"" id=""rele_slepice_l3"" data-state=""OFF"" data-rele=""slepice"" data-kanal=""l3"">
        </div>
        
        <div class=""rele-row"">
          <span>â­ KanÃ¡l L4</span>
          <img src=""Switch_off.png"" alt=""Switch OFF"" class=""image-switch"" id=""rele_slepice_l4"" data-state=""OFF"" data-rele=""slepice"" data-kanal=""l4"">
        </div>
      </div>
<!--------------------------------------------------------------------------------------------------------------------------------------------------->
<!--------------------------------------------------------------------------------------------------------------------------------------------------->
<!--------------------------------------------------------------------------------------------------------------------------------------------------->
   
    </div>

<!--------------------------------------------------------------------------------------------------------------------------------------------------->
<!--------------------------------------------------------------------------------------------------------------------------------------------------->
<!------------- Power Monitoring -------------------------------------------------------------------------------------------------------------------->
<!--------------------------------------------------------------------------------------------------------------------------------------------------->
<!--------------------------------------------------------------------------------------------------------------------------------------------------->
    
    <!-- POWER MONITORING -->
    <div class=""power-container"">
      
      <!-- ZÃ¡suvka poÄÃ­taÄ -->
      <div class=""widget-power"">
        <div class=""power-header"">
          <div class=""power-device-info"">
            <div class=""power-device-name"">Zasuvka sekaÄky</div>
          </div>
        </div>
        
        <div class=""power-metrics"">
          <div class=""power-metric-row"">
            <div class=""power-metric-label"">
              <span class=""power-metric-icon icon-state"">â­</span>
              <span>Stav</span>
            </div>
            <img src=""Switch_off.png"" alt=""Switch OFF"" class=""image-switch"" id=""power_pocitac"" data-state=""OFF"" data-rele=""power"" data-kanal=""pocitac"">
          </div>
          
          <div class=""power-metric-row"">
            <div class=""power-metric-label"">
              <span class=""power-metric-icon icon-power"">ðŸ”‹</span>
              <span>NapÃ¡jenÃ­</span>
            </div>
            <div class=""power-metric-value"">
              <span id=""power_napajeni"">112</span>
              <span class=""power-metric-unit"">W</span>
            </div>
          </div>
          
          <div class=""power-metric-row"">
            <div class=""power-metric-label"">
              <span class=""power-metric-icon icon-current"">ðŸŸ¡</span>
              <span>AktuÃ¡lnÃ­</span>
            </div>
            <div class=""power-metric-value"">
              <span id=""power_aktualni"">0.57</span>
              <span class=""power-metric-unit"">A</span>
            </div>
          </div>
          
          <div class=""power-metric-row"">
            <div class=""power-metric-label"">
              <span class=""power-metric-icon icon-voltage"">âš¡</span>
              <span>NapÄ›tÃ­</span>
            </div>
            <div class=""power-metric-value"">
              <span id=""power_napeti"">237</span>
              <span class=""power-metric-unit"">V</span>
            </div>
          </div>
          
          <div class=""power-metric-row"">
            <div class=""power-metric-label"">
              <span class=""power-metric-icon icon-energy"">ðŸ”Œ</span>
              <span>Energie</span>
            </div>
            <div class=""power-metric-value"">
              <span id=""power_energie"">201.02</span>
              <span class=""power-metric-unit"">kWh</span>
            </div>
          </div>
        </div>
      </div>
      
    </div>
  </div>

 

<!-- 
JAVASCRIPT - LOGIKA DASHBOARDU
==============================
-->
<script>
  // KONFIGURAÄŒNÃ PROMÄšNNÃ‰
  // =====================
  const API_URL = ""http://192.168.1.5:1880/api/teplomery""; // URL adresa Node-RED API endpointu
  const REFRESH_INTERVAL = 1000; // Interval obnovovÃ¡nÃ­ dat v milisekundÃ¡ch (1 sekunda)
  const SWITCH_OFF_IMG = ""Switch_off.png""; // Cesta k obrÃ¡zku vypnutÃ©ho pÅ™epÃ­naÄe
  const SWITCH_ON_IMG = ""Switch_on.png""; // Cesta k obrÃ¡zku zapnutÃ©ho pÅ™epÃ­naÄe
  
  let lastClickTime = 0; // ÄŒas poslednÃ­ho kliknutÃ­ - pro prevenci dvojklikÅ¯
  
  /**
   * HLAVNÃ FUNKCE PRO NAÄŒÃTÃNÃ DAT
   * ==============================
   * AsynchronnÃ­ funkce, kterÃ¡ stahuje data z API a aktualizuje UI
   */
  async function nacistData() {
    try {
      // Prevence pÅ™Ã­liÅ¡ ÄastÃ½ch poÅ¾adavkÅ¯ (debouncing)
      const now = Date.now();
      if (now - lastClickTime < 500) {
        return; // Pokud od poslednÃ­ho kliknutÃ­ neuplynulo 500ms, nic nedÄ›lej
      }
      
      // NaÄtenÃ­ dat z API pomocÃ­ Fetch API
      const response = await fetch(API_URL);
      
      // Kontrola, zda byl poÅ¾adavek ÃºspÄ›Å¡nÃ½
      if (!response.ok) {
        throw new Error(""Chyba pÅ™i naÄÃ­tÃ¡nÃ­ dat"");
      }
      
      // PÅ™evod odpovÄ›di na JSON formÃ¡t
      const data = await response.json();
      
      //------------------------------------------------------------------------------------------------------       
      //----- AKTUALIZACE TEPLOMÄšRÅ® --------------------------------------------------------------------------
      //------------------------------------------------------------------------------------------------------
      
      // TeplomÄ›ry ve sklepÄ› - kotel a voda
      if (data.sklep) {
        // Teplota kotle - formÃ¡tovÃ¡nÃ­ na 1 desetinnÃ© mÃ­sto
        if (data.sklep.kotel !== null) {
          document.getElementById(""temp_kotel"").innerText = data.sklep.kotel.toFixed(1) + "" Â°C"";
        } else {
          document.getElementById(""temp_kotel"").innerText = ""-- Â°C""; // Fallback pro chybÄ›jÃ­cÃ­ data
        }
        
        // Teplota vody
        if (data.sklep.voda !== null) {
          document.getElementById(""temp_voda"").innerText = data.sklep.voda.toFixed(1) + "" Â°C"";
        } else {
          document.getElementById(""temp_voda"").innerText = ""-- Â°C"";
        }
      } else {
        // Fallback pokud celÃ¡ sekce sklep chybÃ­
        document.getElementById(""temp_kotel"").innerText = ""-- Â°C"";
        document.getElementById(""temp_voda"").innerText = ""-- Â°C"";
      }
      
      // VenkovnÃ­ teplomÄ›r - teplota a vlhkost
      if (data.venku && data.venku.temperature !== null) {
        document.getElementById(""temp_venku"").innerText = data.venku.temperature.toFixed(1) + "" Â°C"";
        document.getElementById(""hum_venku"").innerText = data.venku.humidity.toFixed(1) + "" %"";
      } else {
        document.getElementById(""temp_venku"").innerText = ""-- Â°C"";
        document.getElementById(""hum_venku"").innerText = ""-- %"";
      }
      
      // TeplomÄ›r na zahradÄ› - podle sprÃ¡vnÃ©ho klÃ­Äe v JSON
      if (data.teplomer_zahrada && data.teplomer_zahrada.temperature !== null) {
        document.getElementById(""temp_zahrada"").innerText = data.teplomer_zahrada.temperature.toFixed(1) + "" Â°C"";
        document.getElementById(""hum_zahrada"").innerText = data.teplomer_zahrada.humidity.toFixed(1) + "" %"";
      } else {
        document.getElementById(""temp_zahrada"").innerText = ""-- Â°C"";
        document.getElementById(""hum_zahrada"").innerText = ""-- %"";
      }
      
      // TeplomÄ›r v koupelnÄ›
      if (data.koupelna && data.koupelna.temperature !== null) {
        document.getElementById(""temp_koupelna"").innerText = data.koupelna.temperature.toFixed(1) + "" Â°C"";
        document.getElementById(""hum_koupelna"").innerText = data.koupelna.humidity.toFixed(1) + "" %"";
      } else {
        document.getElementById(""temp_koupelna"").innerText = ""-- Â°C"";
        document.getElementById(""hum_koupelna"").innerText = ""-- %"";
      }
      
      // TeplomÄ›r v loÅ¾nici
      if (data.loznice && data.loznice.temperature !== null) {
        document.getElementById(""temp1"").innerText = data.loznice.temperature.toFixed(1) + "" Â°C"";
        document.getElementById(""hum1"").innerText = data.loznice.humidity.toFixed(1) + "" %"";
      } else {
        document.getElementById(""temp1"").innerText = ""-- Â°C"";
        document.getElementById(""hum1"").innerText = ""-- %"";
      }
      
      // TeplomÄ›r v pokoji
      if (data.pokoj && data.pokoj.temperature !== null) {
        document.getElementById(""temp2"").innerText = data.pokoj.temperature.toFixed(1) + "" Â°C"";
        document.getElementById(""hum2"").innerText = data.pokoj.humidity.toFixed(1) + "" %"";
      } else {
        document.getElementById(""temp2"").innerText = ""-- Â°C"";
        document.getElementById(""hum2"").innerText = ""-- %"";
      }
      
      // TeplomÄ›r v obÃ½vÃ¡ku
      if (data.obyvak && data.obyvak.temperature !== null) {
        document.getElementById(""temp3"").innerText = data.obyvak.temperature.toFixed(1) + "" Â°C"";
        document.getElementById(""hum3"").innerText = data.obyvak.humidity.toFixed(1) + "" %"";
      } else {
        document.getElementById(""temp3"").innerText = ""-- Â°C"";
        document.getElementById(""hum3"").innerText = ""-- %"";
      }
      
      //------------------------------------------------------------------------------------------------------       
      //----- AKTUALIZACE STAVU RELÃ‰ -------------------------------------------------------------------------
      //------------------------------------------------------------------------------------------------------       
      
      if (data.rele) {
        /**
         * POMOCNÃ FUNKCE PRO AKTUALIZACI PÅ˜EPÃNAÄŒÅ®
         * @param {string} elementId - ID HTML elementu pÅ™epÃ­naÄe
         * @param {string} newState - NovÃ½ stav (""ON"" nebo ""OFF"")
         */
        const updateSwitchImage = (elementId, newState) => {
          const imgElement = document.getElementById(elementId);
          if (imgElement) {
            const isON = newState === ""ON"";
            // ZmÄ›na obrÃ¡zku podle stavu
            imgElement.src = isON ? SWITCH_ON_IMG : SWITCH_OFF_IMG;
            imgElement.alt = isON ? ""Switch ON"" : ""Switch OFF"";
            imgElement.dataset.state = newState; // Aktualizace data atributu
          }
        };
        
        // Aktualizace vÅ¡ech pÅ™epÃ­naÄÅ¯ svÄ›tel
        updateSwitchImage(""state_l1"", data.rele.state_l1);
        updateSwitchImage(""state_l2"", data.rele.state_l2);
        updateSwitchImage(""state_l3"", data.rele.state_l3);
        updateSwitchImage(""state_l4"", data.rele.state_l4);
        
        // Aktualizace pÅ™epÃ­naÄÅ¯ na pÅ¯dÄ›
        updateSwitchImage(""state_puda_l1"", data.rele.state_puda_l1);
        updateSwitchImage(""state_puda_l2"", data.rele.state_puda_l2);
        updateSwitchImage(""state_puda_l3"", data.rele.state_puda_l3);
        updateSwitchImage(""state_puda_l4"", data.rele.state_puda_l4);
        
        // Aktualizace pÅ™epÃ­naÄÅ¯ v garÃ¡Å¾i
        updateSwitchImage(""state_garaz_l1"", data.rele.state_garaz_l1);
        updateSwitchImage(""state_garaz_l2"", data.rele.state_garaz_l2);
        updateSwitchImage(""state_garaz_l3"", data.rele.state_garaz_l3);
        updateSwitchImage(""state_garaz_l4"", data.rele.state_garaz_l4);
        
        // Aktualizace pÅ™epÃ­naÄÅ¯ pravÃ½ch dveÅ™Ã­
        updateSwitchImage(""state_dvere_p_l1"", data.rele.state_dvere_p_l1);
        updateSwitchImage(""state_dvere_p_l2"", data.rele.state_dvere_p_l2);
        updateSwitchImage(""state_dvere_p_l3"", data.rele.state_dvere_p_l3);
        updateSwitchImage(""state_dvere_p_l4"", data.rele.state_dvere_p_l4);
        
        // Aktualizace pÅ™epÃ­naÄÅ¯ levÃ½ch dveÅ™Ã­
        updateSwitchImage(""state_dvere_l_l1"", data.rele.state_dvere_l_l1);
        updateSwitchImage(""state_dvere_l_l2"", data.rele.state_dvere_l_l2);
        updateSwitchImage(""state_dvere_l_l3"", data.rele.state_dvere_l_l3);
        updateSwitchImage(""state_dvere_l_l4"", data.rele.state_dvere_l_l4);
        
        // Aktualizace venkovnÃ­ch pÅ™epÃ­naÄÅ¯
        updateSwitchImage(""state_venku_l1"", data.rele.state_venku_l1);
        updateSwitchImage(""state_venku_l2"", data.rele.state_venku_l2);
        updateSwitchImage(""state_venku_l3"", data.rele.state_venku_l3);
        updateSwitchImage(""state_venku_l4"", data.rele.state_venku_l4);
        
        // Aktualizace pÅ™epÃ­naÄÅ¯ u slepic
        updateSwitchImage(""rele_slepice_l1"", data.rele.rele_slepice_l1);
        updateSwitchImage(""rele_slepice_l2"", data.rele.rele_slepice_l2);
        updateSwitchImage(""rele_slepice_l3"", data.rele.rele_slepice_l3);
        updateSwitchImage(""rele_slepice_l4"", data.rele.rele_slepice_l4);
      }
      
      // Aktualizace stavovÃ©ho Å™Ã¡dku - ÃºspÄ›Å¡nÃ© pÅ™ipojenÃ­
      const statusElement = document.getElementById(""status"");
      statusElement.innerText = ""âœ“ PÅ™ipojeno - "" + new Date().toLocaleTimeString();
      statusElement.className = ""status connected"";
      
    } catch (error) {
      // ZPRACOVÃNÃ CHYB
      // ===============
      console.error(""Chyba:"", error);
      const statusElement = document.getElementById(""status"");
      statusElement.innerText = ""âœ— Chyba pÅ™ipojenÃ­"";
      statusElement.className = ""status error"";
    }
  }
  
  /**
   * FUNKCE PRO OVLÃDÃNÃ RELÃ‰
   * ========================
   * @param {HTMLElement} imgElement - KliknutÃ½ obrÃ¡zek pÅ™epÃ­naÄe
   */
  async function ovladatRele(imgElement) {
    // ZÃ­skÃ¡nÃ­ parametrÅ¯ z data atributÅ¯
    const rele = imgElement.dataset.rele; // Typ relÃ© (svetla, puda, garaz...)
    const kanal = imgElement.dataset.kanal; // KonkrÃ©tnÃ­ kanÃ¡l (l1, l2, l3...)
    const currentState = imgElement.dataset.state; // AktuÃ¡lnÃ­ stav
    const newState = currentState === ""ON"" ? ""OFF"" : ""ON""; // NovÃ½ stav (opaÄnÃ½)

    // VizualnÃ­ feedback - zablokovÃ¡nÃ­ pÅ™epÃ­naÄe bÄ›hem pÅ™epÃ­nÃ¡nÃ­
    imgElement.classList.add('disabled');

    try {
      // NastavenÃ­ Äasu poslednÃ­ho kliknutÃ­ pro prevenci dvojklikÅ¯
      lastClickTime = Date.now();
      
      // Aktualizace stavovÃ©ho Å™Ã¡dku - informace o probÃ­hajÃ­cÃ­ akci
      const statusElement = document.getElementById(""status"");
      statusElement.innerText = `PÅ™epÃ­nÃ¡m ${rele} ${kanal.toUpperCase()}...`;
      statusElement.className = ""status"";
      
      /**
       * ODESLÃNÃ PÅ˜ÃKAZU NA SERVER
       * ==========================
       * PouÅ¾Ã­vÃ¡ GET poÅ¾adavek s parametry v URL:
       * ?rele=svetla&kanal=l1&stav=on
       */
      const response = await fetch(`?rele=${rele}&kanal=${kanal}&stav=${newState.toLowerCase()}`);
      
      if (!response.ok) {
        throw new Error(""Chyba pÅ™i ovlÃ¡dÃ¡nÃ­ relÃ©"");
      }
      
      // ZpracovÃ¡nÃ­ odpovÄ›di serveru
      const result = await response.json();
      
      if (result.success) {
        // ÃšSPÄšÅ NÃ‰ PÅ˜EPNUTÃ
        // ================
        // Aktualizace obrÃ¡zku pÅ™epÃ­naÄe
        imgElement.src = newState === ""ON"" ? SWITCH_ON_IMG : SWITCH_OFF_IMG;
        imgElement.alt = newState === ""ON"" ? ""Switch ON"" : ""Switch OFF"";
        imgElement.dataset.state = newState;
        
        // Aktualizace stavovÃ©ho Å™Ã¡dku
        statusElement.innerText = `âœ“ ${rele} ${kanal.toUpperCase()} pÅ™epnuto na ${newState}`;
        statusElement.className = ""status connected"";
      } else {
        throw new Error(""PÅ™epnutÃ­ selhalo"");
      }
      
      // ObnovenÃ­ dat po krÃ¡tkÃ© prodlevÄ› (pro pÅ™Ã­pad, Å¾e by se stav zmÄ›nil i jinak)
      setTimeout(() => {
        lastClickTime = 0; // ResetovÃ¡nÃ­ ÄasovaÄe pro dalÅ¡Ã­ kliknutÃ­
        nacistData(); // ZnovunaÄtenÃ­ dat ze serveru
      }, 200);
      
    } catch (error) {
      // ZPRACOVÃNÃ CHYB PÅ˜I PÅ˜EPÃNÃNÃ
      // ==============================
      console.error(""Chyba:"", error);
      const statusElement = document.getElementById(""status"");
      statusElement.innerText = ""âœ— Chyba pÅ™i pÅ™epÃ­nÃ¡nÃ­"";
      statusElement.className = ""status error"";
      
      // NÃ¡vrat pÅ™epÃ­naÄe do pÅ¯vodnÃ­ho stavu
      imgElement.src = currentState === ""ON"" ? SWITCH_ON_IMG : SWITCH_OFF_IMG;
      imgElement.dataset.state = currentState;
      lastClickTime = 0; // ResetovÃ¡nÃ­ ÄasovaÄe
    } finally {
      // OdblokovÃ¡nÃ­ pÅ™epÃ­naÄe bez ohledu na vÃ½sledek
      imgElement.classList.remove('disabled');
    }
  }
  
  // INICIALIZACE DASHBOARDU
  // =======================
  
  // PÅ™idÃ¡nÃ­ event listenerÅ¯ na vÅ¡echny pÅ™epÃ­naÄe
  document.querySelectorAll('.image-switch').forEach(img => {
    img.addEventListener('click', function() {
      ovladatRele(this); // PÅ™edÃ¡nÃ­ kliknutÃ©ho elementu do funkce
    });
  });
  
  // SpuÅ¡tÄ›nÃ­ naÄÃ­tÃ¡nÃ­ dat a nastavenÃ­ periodickÃ©ho obnovovÃ¡nÃ­
  nacistData(); // OkamÅ¾itÃ© naÄtenÃ­ po naÄtenÃ­ strÃ¡nky
  setInterval(nacistData, REFRESH_INTERVAL); // PeriodickÃ© obnovovÃ¡nÃ­ kaÅ¾dou sekundu
  
  // Log pro kontrolu do konzole
  console.log(""Dashboard s 7 relÃ© a 7 teplomÄ›rÅ¯ spuÅ¡tÄ›n"");
</script>
</body>
</html>
           

"
YdPL4YWh,Beamng 0.37 AI lua,Drakkxs,Lua,Saturday 22nd of November 2025 12:10:06 AM CDT,"-- This Source Code Form is subject to the terms of the bCDDL, v. 1.1.
-- If a copy of the bCDDL was not distributed with this
-- file, You can obtain one at http://beamng.com/bCDDL-1.1.txt

local M = {}
local E = setmetatable({}, {__newindex = function(t, key, val) log('E', 'ai.lua', 'Tried to insert new elements into token empty table') end})

M.mode = 'disabled' -- this is the main mode
M.manualTargetName = nil
M.debugMode = 'off'
M.speedMode = nil
M.routeSpeed = nil
M.extAggression = 0.3
M.cutOffDrivability = 0
M.driveInLaneFlag = 'off'
M.extAvoidCars = 'auto'

-- [[ STORE FREQUENTLY USED FUNCTIONS IN UPVALUES ]] --
local buffer = require(""string.buffer"")
local max = math.max
local min = math.min
local sin = math.sin
local asin = math.asin
local pi = math.pi
local abs = math.abs
local sqrt = math.sqrt
local floor = math.floor
local tableInsert = table.insert
local tableRemove = table.remove
local tableConcat = table.concat
local strFormat = string.format

-- [[ HEAVY DEBUG MODE ]] --
local visDebug = {trajecRec = {last = 0}, routeRec = {last = 0}, labelRenderDistance = 10, debugSpots = {}, candidatePaths = nil}
--local newPositionsDebug = {} -- for debug purposes

-- [[ Simulation time step]] --
local dt

-- [[ ENVIRONMENT VARIABLES ]] --
local g = obj:getGravity() -- standard gravity is negative
local gravityDir = vec3(0, 0, sign2(g))
g = max(1e-30, abs(g)) -- prevent divivion by 0 gravity

-- [[ PERFORMANCE RELATED ]] --
local aggression = 1

-- [[ AI DATA: POSITION, CONTROL, STATE ]] --
local ego = {
  pos = obj:getFrontPosition(),
  dirVec = obj:getDirectionVector(),
  prevDirVec = obj:getDirectionVector(),
  upVec = obj:getDirectionVectorUp(),
  rightVec = vec3(),
  width = nil,
  length = nil,
  wheelBase = nil,
  currentSegment = {},
  vel = vec3(obj:getSmoothRefVelocityXYZ()),
  speed = vec3(obj:getSmoothRefVelocityXYZ()):length(),
  staticFrictionCoef = 1,
  ghostR = nil,
  ghostL = nil,
}

ego.race = {
  dT_min = 0.1,
  dT_max = 0.3,
  Td = 0.1,
  Tp = 0.01,
  d = 4, --distance thredshold, unless my distance from vehicle ahead is greater than this, I'll want to go faster than him
  kp = 0.6
}

local targetSpeedDifSmoother = newTemporalSmoothingNonLinear(1e300, 4, 0)
local targetSpeedSmoother = newTemporalSmoothingNonLinear(10, 10, ego.speed)
local egoDeviationSmoother = newTemporalSmoothing(1)
local smoothTcs = newTemporalSmoothingNonLinear(0.1, 0.9)
local throttleSmoother = newTemporalSmoothing(1e30, 0.2)

local internalState = {
  changePlanTimer = 0,
  egoCannotMoveTime = 0,
  egoForceGoFrontTime = 0,
  road = 'onroad',
  crash = {time = 0, manoeuvre = 0, dir = nil, pos = nil},
  chaseData = {playerState = nil, playerStoppedTimer = 0, playerRoad = nil, driveAhead = false, targetSpeed = nil}
}

local twt = {
  state = 0,
  dirState = {0, 0}, -- direction, steer
  posTable = {vec3(), vec3(), vec3(), vec3()},
  dirTable = {vec3(), vec3(), vec3(), vec3()},
  minRay = """",
  rayMins = {math.huge, math.huge, math.huge, math.huge, math.huge, math.huge, math.huge, math.huge}, --clockwise beginning from corner front left
  minRayCoefs = {0, 0, 0, 0, 0, 0, 0, 0}, -- clockwise as above
  blueNoiseCoefs = {0, 0, 0, 0, 0, 0, 0, 0},
  biasedCoefs = {0, 0, 0, 0, 0, 0, 0, 0},
  blueNoiseRR = 0,
  sampleCounter = 0, -- for starting scan, to give some time for precision
  targetSpeed = 0,
  OBBinRange = {},
  RRT = {1,1,1,2,1,2,2,2,2,2,2,3,2,3,3,3,3,3,3,4,3,4,4,4,4,4,4,1,4,1,1,1},
  speedSmoother = newTemporalSmoothingNonLinear(1000, 0.25),
  steerSmoother = newTemporalSmoothingNonLinear(2)
}

twt.reset = function()
  twt.state = 0
  twt.dirState[1], twt.dirState[2] = 0, 0
  twt.minRay = nil
  for i = 1, #twt.rayMins do twt.rayMins[i] = math.huge end
  for i = 1, #twt.blueNoiseCoefs do twt.blueNoiseCoefs[i] = 0 end
  twt.sampleCounter = 0
  twt.targetSpeed = 0
  twt.speedSmoother:set(0)
  twt.steerSmoother:set(0)
end

local forces = {}
local velocities = {}
local lastCommand = {steering = 0, throttle = 0, brake = 0, parkingbrake = 0}

local opt = {driveInLaneFlag = false, racing = false, trajMethod = nil, aggressionMode = nil, avoidCars = 'on'}

-- [[ TRAFFIC ]] --
local trafficStates = {}
local trafficPathState = {}

local traffic = {
  trafficTable = {},
  trafficFilterQue = {array = {}, dict = {}},
  trafficFilterFromQue = {},
  frameQue = 0,
  rateQue = 0, -- 1 means adding a que vehicle every second
  filtered = true,    -- TrafficFilter on or off (true/false)
  intersection = true, -- check for intersection between ego and other vehicle
  vdraw = false,       -- draw debuf spheres to show traffic vehicles in trafficTable
  Rfl = 60, -- larger radius for traffic filter queue
  Rfl_fun = function(v) return clamp((v+10)*3, 60, 200) end, --
  Rfs = 60, -- smaller radius for traffic table
  Rfs_fun = function(v) return clamp(v*3, 60, 100) end,
  distAhead = 40     -- minimum Ahead distance for searching traffic vehicle
}

-- [[ OPPONENT DATA ]] --
local player

-- [[ SETTINGS, PARAMETERS, AUXILIARY DATA ]] --
local mapData -- map data including node connections (edges and edge data), node positions and node radii
local signalsData -- traffic intersection and signals data
local currentRoute
local MIN_PLAN_COUNT = 3
local targetWPName
local edgeDict
local wpList
local manualPath
local validateInput = nop
local speedProfile
local loopPath, noOfLaps
local parameters
local restoreGearboxMode = false
local targetObjectSelectionMode
local scriptData
local scriptai = nil
local recover = {recoverOnCrash = false, recoverTimer = 0, _recoverOnCrash = false}
------------------------------

-- For Debugging (useful function to print a numbered list of upvalues of a specific function)
local function inspect_upvalues(func)
  local i = 1
  while true do
    local name, value = debug.getupvalue(func, i)
    if not name then break end
    print(string.format(""Upvalue %d: %s = %s"", i, name, tostring(value)))
    i = i + 1
  end
end

local dataLogger = {logData = nop}
local function logDataTocsv()
  if not dataLogger.csvFile then
    print('Started Logging Data')
    dataLogger.csvFile = require('csvlib').newCSV(""time"", ""posX"", ""posY"", ""posZ"", ""speed"", ""targetSpeed"", ""ax"", ""ay"", ""az"", ""vx"", ""vy"", ""vz"", ""throttle"", ""brake"", ""steering"", ""staticFrictionCoef"")
    dataLogger.time = 0
  else
    dataLogger.time = dataLogger.time + dt
  end
  dataLogger.csvFile:add(
    dataLogger.time,
    ego.pos.x,
    ego.pos.y,
    ego.pos.z,
    ego.speed,
    ((currentRoute or E).plan or E).targetSpeed,
    -sensors.gy,
    sensors.gx,
    sensors.gz,
    ego.vel:dot(ego.dirVec),
    -(ego.vel:dot(ego.rightVec)),
    ego.vel:dot(ego.upVec),
    lastCommand.throttle * 100,
    lastCommand.brake * 100,
    lastCommand.steering * 100,
    ego.staticFrictionCoef)
end

local function writeCsvFile(name)
  if dataLogger.csvFile then
    print('Writing Data to CSV.')
    dataLogger.csvFile:write(name)
    dataLogger.csvFile = nil
    dataLogger.time = nil
    print('Done')
  else
    print('No data to write')
  end
end

local function startStopDataLog(name)
  if dataLogger.logData == nop then
    print('Initialized Data Log')
    dataLogger.logData = logDataTocsv
    dataLogger.name = name
  else
    print('Stopped Logging Data')
    dataLogger.logData = nop
    writeCsvFile(dataLogger.name or name)
    dataLogger.name = nil
  end
end

local function getObjectBoundingBox(id)
  local x = obj:getObjectDirectionVector(id)
  local z = obj:getObjectDirectionVectorUp(id)
  local y = z:cross(x)
  y:setScaled(obj:getObjectInitialWidth(id) * 0.5 / max(y:length(), 1e-30))
  x:setScaled(obj:getObjectInitialLength(id) * 0.5)
  z:setScaled(obj:getObjectInitialHeight(id) * 0.5)
  return obj:getObjectCenterPosition(id), x, y, z
end

local function drawOBB(c, x, y, z, col)
  -- c: center point
  -- x: front half extent vec
  -- y: left half extent vec
  -- z: up half extent vec

  local debugDrawer = obj.debugDrawProxy
  col = col or color(255, 0, 0, 255)

  local p1 = c - x + y - z -- RLD
  local p2 = c - x - y - z -- RRD
  local p3 = c - x - y + z -- RRU
  local p4 = c - x + y + z -- RLU
  local p5 = c + x + y - z -- FLD
  local p6 = c + x - y - z -- FRD
  local p7 = c + x - y + z -- FRU
  local p8 = c + x + y + z -- FLU

  -- rear face
  debugDrawer:drawCylinder(p1, p2, 0.02, col)
  debugDrawer:drawCylinder(p2, p3, 0.02, col)
  debugDrawer:drawCylinder(p3, p4, 0.02, col)
  debugDrawer:drawCylinder(p4, p1, 0.02, col)

  -- front face
  debugDrawer:drawCylinder(p5, p6, 0.02, col)
  debugDrawer:drawCylinder(p6, p7, 0.02, col)
  debugDrawer:drawCylinder(p7, p8, 0.02, col)
  debugDrawer:drawCylinder(p8, p5, 0.02, col)

  -- left face
  debugDrawer:drawCylinder(p1, p5, 0.02, col)
  debugDrawer:drawCylinder(p4, p8, 0.02, col)

  -- right face
  debugDrawer:drawCylinder(p2, p6, 0.02, col)
  debugDrawer:drawCylinder(p3, p7, 0.02, col)
end

local function drawVehicleBoundingBox(vid, col)
  local c, vx, vy, vz = getObjectBoundingBox(vid)
  drawOBB(c, vx, vy, vz, col)
end

local function aistatus(status, category)
  guihooks.trigger(""AIStatusChange"", {status=status, category=category})
end

local function getState()
  return M
end

local function stateChanged()
  if playerInfo.anyPlayerSeated then
    guihooks.trigger(""AIStateChange"", getState())
  end
end

local function setSpeed(speed)
  if type(speed) ~= 'number' then M.routeSpeed = nil else M.routeSpeed = speed end
end

local function setSpeedMode(speedMode)
  if speedMode == 'set' or speedMode == 'limit' or speedMode == 'legal' or speedMode == 'off' then
    M.speedMode = speedMode
  else
    M.speedMode = nil
  end
end

local function resetSpeedModeAndValue()
  M.speedMode = nil -- maybe this should be 'off'
  M.routeSpeed = nil
end

local function setAggressionInternal(v)
  aggression = v or M.extAggression
end

local function setAggressionExternal(v)
  M.extAggression = v or M.extAggression
  setAggressionInternal()
  stateChanged()
end

local function setAggressionMode(aggrmode)
  if aggrmode == 'rubberBand' then
    opt.aggressionMode = aggrmode
  else
    opt.aggressionMode = nil
    setAggressionInternal()
  end
end

local function resetAggression()
  setAggressionInternal()
end

local function resetInternalStates()
  trafficStates.block = {timer = 0, coef = 0, timerLimit = 6, block = false}
  trafficStates.side = {timer = 0, cTimer = 0, side = 1, displacement = 0, timerLimit = 6}
  trafficStates.action = {hornTimer = -1, hornTimerLimit = 1, forcedStop = false}
  trafficStates.intersection = {timer = 0, turn = 0, block = false}

  internalState.chaseData.playerState = nil
  internalState.chaseData.playerStoppedTimer = 0
  internalState.chaseData.playerRoad = nil
  internalState.chaseData.driveAhead = false
  internalState.chaseData.targetSpeed = nil

  internalState.crash.time = 0
  internalState.crash.manoeuvre = 0
  internalState.crash.dir = nil
  internalState.crash.pos = nil

  if electrics.values.horn == 1 then electrics.horn(false) end
  if electrics.values.signal_left_input or electrics.values.signal_right_input then electrics.set_warn_signal(false) end

  trafficPathState = {}
end
resetInternalStates()

local function resetParameters()
  -- parameters are used for finer AI control
  parameters = {
    turnForceCoef = 2, -- coefficient for curve spring forces
    awarenessForceCoef = 0.25, -- coefficient for vehicle awareness displacement
    edgeDist = 0, -- minimum distance from the edge of the road
    trafficWaitTime = 2, -- traffic delay after stopping at intersection
    delayFactorWaitTime = {0.55 + (0.95 - 0.55) * math.random() , 0.05 + (0.45 - 0.05) * math.random()},
    enableElectrics = true, -- use electrics such as hazard lights (especially for traffic)
    driveStyle = 'default',
    staticFrictionCoefMult = 0.95,
    lookAheadKv = 0.6,
    applyWidthMarginOffset = true,
    planErrorSmoothing = true,
    springForceIntegratorDispLim = 0.1, -- node displacement force magnitude limit
    understeerThrottleControl = 'on', -- anything other than an 'off' value will keep this active
    oversteerThrottleControl = 'on', -- anything other than an 'off' value will keep this active
    throttleTcs = 'on', -- anything other than an 'off' value will keep this active
    abBrakeControl = 'on',
    underSteerBrakeControl = 'on',
    throttleKp = 0.5,
    targetSpeedSmootherRate = 10,
  }
end
resetParameters()

local function setParameters(data)
  tableMerge(parameters, data)
end

local function dumpParameters()
  dump(parameters)
  dump('aggression = ', aggression)
end
M.dumpParameters = dumpParameters

local function setTargetObjectID(id)
  M.targetObjectID = M.targetObjectID ~= objectId and id or -1
  if M.targetObjectID ~= -1 then targetObjectSelectionMode = 'manual' end
end

local function calculateWheelBase()
  local avgWheelNodePos, numOfWheels = vec3(), 0
  for _, wheel in pairs(wheels.wheels) do
    -- obj:getNodePosition is the pos vector of query node (wheel.node1) relative to ref node in world coordinates
    avgWheelNodePos:setAdd(obj:getNodePosition(wheel.node1))
    numOfWheels = numOfWheels + 1
  end
  if numOfWheels == 0 then return 0 end

  avgWheelNodePos:setScaled(1 / numOfWheels)

  local dirVec = obj:getDirectionVector()
  local avgFrontWheelPos, frontWheelCount = vec3(), 0
  local avgBackWheelPos, backWheelCount = vec3(), 0
  for _, wheel in pairs(wheels.wheels) do
    local wheelPos = obj:getNodePosition(wheel.node1)
    if wheelPos:dot(dirVec) > avgWheelNodePos:dot(dirVec) then
      avgFrontWheelPos:setAdd(wheelPos)
      frontWheelCount = frontWheelCount + 1
    else
      avgBackWheelPos:setAdd(wheelPos)
      backWheelCount = backWheelCount + 1
    end
  end

  avgFrontWheelPos:setScaled(1 / frontWheelCount)
  avgBackWheelPos:setScaled(1 / backWheelCount)

  return avgFrontWheelPos:distance(avgBackWheelPos)
end

local function updatePlayerData()
  mapmgr.getObjects()
  if not next(mapmgr.objects) then return end -- prevents changes if table is empty

  if mapmgr.objects[M.targetObjectID] and targetObjectSelectionMode == 'manual' then
    player = mapmgr.objects[M.targetObjectID]
  elseif tableSize(mapmgr.objects) == 2 then
    if player ~= nil then
      player = mapmgr.objects[player.id]
    else
      for k, v in pairs(mapmgr.objects) do
        if k ~= objectId then
          M.targetObjectID = k
          player = v
          break
        end
      end
      targetObjectSelectionMode = 'auto'
    end
  else
    if player ~= nil and player.active == true then
      player = mapmgr.objects[player.id]
    else
      for k, v in pairs(mapmgr.objects) do
        if k ~= objectId and v.active == true then
          M.targetObjectID = k
          player = v
          break
        end
      end
      targetObjectSelectionMode = 'targetActive'
    end
  end
end

local function driveCar(steering, throttle, brake, parkingbrake)
  input.event(""steering"", steering, ""FILTER_AI"", nil, nil, nil, ""ai"")
  input.event(""throttle"", throttle, ""FILTER_AI"", nil, nil, nil, ""ai"")
  input.event(""brake"", brake, ""FILTER_AI"", nil, nil, nil, ""ai"")
  input.event(""parkingbrake"", parkingbrake, ""FILTER_AI"", nil, nil, nil, ""ai"")

  lastCommand.steering = steering
  lastCommand.throttle = throttle
  lastCommand.brake = brake
  lastCommand.parkingbrake = parkingbrake
end

local function populateOBBinRange(range)
  range = range * range
  local i = 0
  for id in pairs(mapmgr.getObjects()) do
    if id ~= objectId then
      local pos = obj:getObjectCenterPosition(id)
      if pos:squaredDistance(ego.pos) < range then
        twt.OBBinRange[i+1] = pos

        -- Get bounding box direction vectors
        twt.OBBinRange[i+2] = obj:getObjectDirectionVector(id) -- x
        twt.OBBinRange[i+4] = obj:getObjectDirectionVectorUp(id) -- z
        twt.OBBinRange[i+3] = twt.OBBinRange[i+3] or vec3()
        twt.OBBinRange[i+3]:setCross(twt.OBBinRange[i+4], twt.OBBinRange[i+2]); twt.OBBinRange[i+3]:normalize() -- y (left)

        -- Scale bounding box direction vectors to vehicle diamensions
        twt.OBBinRange[i+3]:setScaled(obj:getObjectInitialWidth(id) * 0.5)
        twt.OBBinRange[i+2]:setScaled(obj:getObjectInitialLength(id) * 0.5)
        twt.OBBinRange[i+4]:setScaled(obj:getObjectInitialHeight(id) * 0.5)
        i = i + 4
      end
    end
  end
  twt.OBBinRange.n = i
end

local function castRay(rpos, rdir, rayDist)
  for i = 1, twt.OBBinRange.n, 4 do
    local minHit, maxHit = intersectsRay_OBB(rpos, rdir, twt.OBBinRange[i], twt.OBBinRange[i+1], twt.OBBinRange[i+2], twt.OBBinRange[i+3])
    if maxHit > 0 then
      rayDist = min(rayDist, max(minHit, 0))
    end
  end
  return obj:castRayStatic(rpos, rdir, rayDist)
end

local function driveToTarget(targetPos, throttle, brake, targetSpeed)
  if not targetPos then return end

  local plan = currentRoute and currentRoute.plan
  targetSpeed = targetSpeed or plan and plan.targetSpeed
  if not targetSpeed then return end

  local targetVec = targetPos - ego.pos; targetVec:normalize()
  local dirAngle = asin(ego.rightVec:dot(targetVec))

  -- oversteer
  local throttleOverCoef = 1
  if ego.speed > 1 then
    local rightVel = ego.rightVec:dot(ego.vel)
    if rightVel * ego.rightVec:dot(targetPos - ego.pos) > 0 then
      local rotVel = min(1, (ego.prevDirVec:projectToOriginPlane(ego.upVec):normalized()):distance(ego.dirVec) * dt * 10000)
      throttleOverCoef = max(0, 1 - abs(rightVel * ego.speed * 0.05) * min(1, dirAngle * dirAngle * ego.speed * 6) * rotVel)
    end
  end

  local dirVel = ego.vel:dot(ego.dirVec)
  local absegoSpeed = abs(dirVel)
  local throttleUnderCoef = 1
  local brakeUnderCoef = 1

  if plan and plan[3] and dirVel > 3 then
    local p1, p2 = plan[1].pos, plan[2].pos
    local p2p1DirVec = p2 - p1; p2p1DirVec:normalize()

    local tp2 = (plan.targetSeg or 0) > 1 and targetPos or plan[3].pos
    local targetSide = (tp2 - p2):dot(p2p1DirVec:cross(ego.upVec))

    local outDeviation = egoDeviationSmoother:value() - plan.egoDeviation * sign(targetSide)
    outDeviation = sign(outDeviation) * min(1, abs(outDeviation))
    egoDeviationSmoother:set(outDeviation)
    egoDeviationSmoother:getUncapped(0, dt)

    if outDeviation > 0 and absegoSpeed > 3 then
      local steerCoef = outDeviation * absegoSpeed * absegoSpeed * min(1, dirAngle * dirAngle * 4)
      local understeerCoef = max(0, steerCoef) * min(1, abs(ego.vel:dot(p2p1DirVec) * 3))
      local noUndersteerCoef = max(0, 1 - understeerCoef)
      throttleUnderCoef = noUndersteerCoef
      brakeUnderCoef = min(brakeUnderCoef, max(0, 1 - understeerCoef * understeerCoef))
    end
  else
    egoDeviationSmoother:set(0)
  end

  -- wheel speed
  local throttleTcsCoef = 1
  local brakeABSCoef = 1
  if absegoSpeed > 0.05 then
    if sensors.gz <= 0.1 then
      local totalSlip = 0
      local propSlip = 0
      local totalDownForce = 0
      local lwheels = wheels.wheels
      for i = 0, tableSizeC(lwheels) - 1 do
        local wd = lwheels[i]
        if not wd.isBroken then
          local lastSlip = wd.lastSlip
          local downForce = wd.downForceRaw
          totalSlip = totalSlip + lastSlip * downForce
          totalDownForce = totalDownForce + downForce
          if wd.isPropulsed then
            propSlip = max(propSlip, lastSlip)
          end
        end
      end

      absegoSpeed = max(absegoSpeed, 3)

      totalSlip = totalSlip / (totalDownForce + 1e-25)

      -- abs
      brakeABSCoef = min(1, 1.5 * square(square(square(max(0, absegoSpeed - totalSlip) / absegoSpeed))))

      -- tcs
      propSlip = propSlip * (parameters.driveStyle == 'offRoad' and 0.8 or 1)
      local tcsCoef = max(0, absegoSpeed - propSlip * propSlip) / absegoSpeed
      throttleTcsCoef = min(tcsCoef, smoothTcs:get(tcsCoef, dt))
    else
      brakeABSCoef = 0
      throttleTcsCoef = 0
    end
  end

  local brakeCoef = 1
  if parameters.underSteerBrakeControl ~= 'off' then
    brakeCoef = min(brakeCoef, brakeUnderCoef)
  end
  if parameters.abBrakeControl ~= 'off' then
    brakeCoef = min(brakeCoef, brakeABSCoef)
  end

  local throttleCoef = 1
  if parameters.oversteerThrottleControl ~= 'off' then
    throttleCoef = min(throttleCoef, throttleOverCoef)
  end
  if parameters.understeerThrottleControl ~= 'off' then
    throttleCoef = min(throttleCoef, throttleUnderCoef)
  end
  if parameters.throttleTcs ~= 'off' then
    throttleCoef = min(throttleCoef, throttleTcsCoef)
  end

  local dirTarget = ego.dirVec:dot(targetVec)
  local dirTargetAxis = ego.rightVec:dot(targetVec)

  if internalState.crash.manoeuvre == 1 and dirTarget < ego.dirVec:dot(internalState.crash.dir) then
    driveCar(-sign(dirAngle), brake * brakeCoef, throttle * throttleCoef, 0)
    return
  else
    internalState.crash.manoeuvre = 0
  end

  if parameters.driveStyle == 'offRoad' then
    brakeCoef = 1
    throttleCoef = sqrt(throttleCoef)
  end

  internalState.egoForceGoFrontTime = max(0, internalState.egoForceGoFrontTime - dt)
  if twt.state == 1 and internalState.egoCannotMoveTime > 1 and internalState.egoForceGoFrontTime == 0 then
    twt.state = 0
    internalState.egoCannotMoveTime = 0
    internalState.egoForceGoFrontTime = 2
  end

  if internalState.egoForceGoFrontTime > 0 and dirTarget < 0 then
    dirTarget = -dirTarget
    dirAngle = -dirAngle
  end

  if currentRoute and (dirTarget < 0 or (twt.state == 1 and dirTarget < 0.866)) then   -- TODO: Improve entry condition when twt.state == 1
    local helperVec = 0.35 * ego.upVec -- auxiliary vector
    twt.posTable[2]:setAdd2(ego.pos, helperVec)
    helperVec:setScaled2(ego.dirVec, -0.05 * ego.length)
    twt.posTable[2]:setAdd(helperVec)
    helperVec:setScaled2(ego.rightVec, 0.5 * (0.7 * ego.width)) -- lateral translation
    twt.posTable[2]:setAdd(helperVec) -- front right corner pos
    helperVec:setScaled(-2)
    twt.posTable[1]:setAdd2(twt.posTable[2], helperVec) -- front left corner pos
    helperVec:setScaled2(ego.dirVec, -0.9 * ego.length) -- longitudinal translation
    twt.posTable[3]:setAdd2(twt.posTable[2], helperVec) -- back right corner pos
    twt.posTable[4]:setAdd2(twt.posTable[1], helperVec) -- back left corner pos

    twt.dirTable[1]:setScaled2(ego.rightVec, -1)
    twt.dirTable[2]:set(ego.dirVec)
    twt.dirTable[3]:set(ego.rightVec)
    twt.dirTable[4]:setScaled2(ego.dirVec, -1)

    local sizeRatio = ego.length/ego.width
    local blueNoiseRange = 6 + 2 * sizeRatio
    local rayDist = 4 * ego.wheelBase -- TODO: Optimize rayDist. Higher is better for more open spaces but w performance hit
    populateOBBinRange(rayDist)
    local tmpVec = vec3()
    local RRPicks = max(1, min(floor(150 * dt + 0.5), 8)) -- x * dt where x/fps is the numer of samples
    for k = 1, RRPicks do --the ray cast loop: each iteration scans one area and casts on the minimum
      local i = 0
      local blueIndex = twt.blueNoiseRR * blueNoiseRange
      if blueIndex < 3 then
        i = floor(1 + blueIndex)
      elseif blueIndex < 6 then
        i = floor(1 + blueIndex) + 1
      elseif blueIndex < 6 + sizeRatio then
        i = 4
      else
        i = 8
      end

      local j = i * 4
      tmpVec:setLerp(twt.posTable[twt.RRT[j-3]], twt.posTable[twt.RRT[j-2]], twt.biasedCoefs[i])
      helperVec:setLerp(twt.dirTable[twt.RRT[j-1]], twt.dirTable[twt.RRT[j]], twt.biasedCoefs[i]) -- LERP corner direction
      helperVec:normalize()
      local rayLen = castRay(tmpVec, helperVec, min(twt.rayMins[i], rayDist))
      if twt.rayMins[i] > rayLen or rayLen == rayDist then
        twt.minRayCoefs[i] = twt.biasedCoefs[i]
        twt.rayMins[i] = rayLen
      else
        tmpVec:setLerp(twt.posTable[twt.RRT[j-3]], twt.posTable[twt.RRT[j-2]], twt.minRayCoefs[i])
        helperVec:setLerp(twt.dirTable[twt.RRT[j-1]], twt.dirTable[twt.RRT[j]], twt.minRayCoefs[i]) -- LERP corner direction
        helperVec:normalize()
        twt.rayMins[i] = castRay(tmpVec, helperVec, min(max(2 * twt.rayMins[i], 0.02), rayDist))
      end
      twt.blueNoiseRR = getBlueNoise1d(twt.blueNoiseRR)
      twt.blueNoiseCoefs[i] = getBlueNoise1d(twt.blueNoiseCoefs[i])
      local criticality = 2 * twt.rayMins[i] / (twt.rayMins[i] + rayDist) + 0.25
      twt.biasedCoefs[i] = biasGainFun(twt.blueNoiseCoefs[i], twt.minRayCoefs[i], criticality)
    end
    local minRayDist = min(twt.rayMins[1], twt.rayMins[2], twt.rayMins[3], twt.rayMins[4], twt.rayMins[5], twt.rayMins[6], twt.rayMins[7], twt.rayMins[8])

    twt.sampleCounter = twt.sampleCounter + 1
    if twt.state == 0 then
      if twt.sampleCounter * dt > max(0.5, min(50 * dt, 2.5)) and ego.speed <= 0.5 then -- TODO: Optimize sample count condition
        twt.state = 1
      else
        local speed = max(0, ego.speed - 0.25)
        local throttle = max(0, -sign(speed * dirVel)) * 0.3
        local brake = max(0, sign(speed * dirVel)) * 0.3
        driveCar(0, throttle, brake, 0)
      end
    end

    if twt.state == 1 then  -- start driving
      if twt.targetSpeed < 0.66 or twt.minRay == ""S"" then -- TODO: Some branches may be consolidated
        if minRayDist == twt.rayMins[7] then
          twt.dirState[1] = 1
          twt.dirState[2] = sign2(dirTargetAxis)
          twt.minRay = ""BL""
        elseif minRayDist == twt.rayMins[5] then
          twt.dirState[1] = 1
          twt.dirState[2] = sign2(dirTargetAxis)
          twt.minRay = ""BR""
        elseif minRayDist == twt.rayMins[1] then
          twt.dirState[1] = -1
          twt.dirState[2] = -sign2(dirTargetAxis)
          twt.minRay = ""FL""
          if twt.dirState[2] == 1 and twt.rayMins[8] < 0.4 and twt.targetSpeed < 0.6 then twt.dirState[2] = 0 end
        elseif minRayDist == twt.rayMins[3] then
          twt.dirState[1] = -1
          twt.dirState[2] = -sign2(dirTargetAxis)
          if twt.dirState[2] == -1 and twt.rayMins[4] < 0.4 and twt.targetSpeed < 0.6 then twt.dirState[2] = 0 end
          twt.minRay = ""FR""
        elseif minRayDist == twt.rayMins[6] then
          twt.dirState[1] = 1
          twt.dirState[2] = sign2(dirTargetAxis)
          twt.minRay = ""B""
        elseif minRayDist == min(twt.rayMins[4], twt.rayMins[8]) then
          local sideRuler = 0
          local minSide =  minRayDist == twt.rayMins[8] and ""L"" or ""R""
          if minSide == ""L"" then
            sideRuler = ego.length * (1 - twt.minRayCoefs[8])
          else
            sideRuler = ego.length * twt.minRayCoefs[4]
          end
          twt.dirState[2] = 0
          if sideRuler < twt.rayMins[6] and dirTarget < 0 then --TODO : test this
            twt.dirState[1] = -1
          elseif (ego.length - sideRuler) < twt.rayMins[2] then
            twt.dirState[1] = 1
            if minSide == ""L"" then
              twt.dirState[2] = 1
            else
              twt.dirState[2] = -1
            end
          end
          twt.minRay = ""S""
        else
          twt.dirState[1] = -1
          twt.dirState[2] = -sign2(dirTargetAxis)
          twt.minRay = ""F""
        end
      end

      local threshold = min(ego.speed - 0.1, 0.66)
      local dirCoef, minDist = 1, nil --TODO: what is car is trapped/sandwiched?
      if twt.dirState[1] == -1 then -- reverse
        dirCoef = min(1.2 - dirTarget, 1) -- dirTarget -> targetSpeed modulation
        if twt.dirState[2] == -1 then -- steer left
          minDist = min(twt.rayMins[4], twt.rayMins[6], twt.rayMins[7])
        elseif twt.dirState[2] == 1 then -- steer right
          minDist = min(twt.rayMins[5], twt.rayMins[6], twt.rayMins[8])
        else -- no steering
          minDist = twt.rayMins[6]
          if twt.minRay ~= ""S"" then
            threshold = twt.rayMins[2] -- possibly max(threshold, twt.rayMins[2])
          end
        end
      else -- forward
        if twt.dirState[2] == -1 then
          minDist = min(twt.rayMins[1], twt.rayMins[2], twt.rayMins[8])
        elseif twt.dirState[2] == 1 then
          minDist = min(twt.rayMins[2], twt.rayMins[3], twt.rayMins[4])
        else
          minDist = twt.rayMins[2]
        end
      end

      local targetSpeed = sqrt(2 * g * min(aggression, ego.staticFrictionCoef) * max(0, minDist - threshold) * dirCoef)
      twt.targetSpeed = max(min(twt.speedSmoother:get(targetSpeed, dt), min(6, aggression * 6)), 0.3)
      local speedDif = twt.targetSpeed - twt.dirState[1] * sign2(dirVel) * ego.speed
      local steering = twt.steerSmoother:get(twt.dirState[2], dt)
      local pbrake = 0 -- * clamp(sign2(0.83 + ego.upVec:dot(gravityDir)), 0, 1) -- >= 10 deg
      local throttle, brake = 0, 0
      if twt.dirState[1] == -1 then
        throttle = clamp(-speedDif * 0.4, 0, 0.4)
        brake = clamp(speedDif * 0.2, 0, 1)
      elseif twt.dirState[1] == 1 then
        throttle = clamp(speedDif * 0.2, 0, 1)
        brake = clamp(-speedDif * 0.4, 0, 0.4)
      end
      driveCar(steering, throttle, brake, pbrake)
    end
  else
    twt.reset()

    local pbrake
    if ego.vel:dot(ego.dirVec) < 0 and ego.speed > 0.1 then
      -- TODO: handbrake when stoped or moving backward
      -- apply brake (in arcade mode throttle input when moving backwards activates the brakes) and or parkingbrake
      -- when vehicle is moving backwards but the target speed is effectively zero
      if ego.speed < 0.15 and targetSpeed <= 1e-5 then
        pbrake = 1
      else
        pbrake = 0
      end
      throttle = 0.5 * throttleCoef
      brake = 0
    else
      if (ego.speed > 4 and ego.speed < 30 and abs(dirAngle) > 0.97 and brake == 0) or (ego.speed < 0.15 and targetSpeed <= 1e-5) then
        -- The first condition was supposed to help the vehicles turn in tight corners by applying handbrake. This is very old logic. It might
        -- no longer be needed. Revise.
        -- The second condition is supposed to apply handbrake when the vehicle is at a stop but it looks to be unstable
        -- TODO: handbrake when turning
        pbrake = 1
      else
        pbrake = 0
      end
      throttle = throttle * throttleCoef
      brake = brake * brakeCoef
    end

    local aggSq = square(aggression + max(0, -(ego.dirVec:dot(gravityDir))))
    local rate = max(throttleSmoother[throttleSmoother:value() < throttle], 10 * aggSq * aggSq)
    throttle = throttleSmoother:getWithRateUncapped(throttle, dt, rate)

    driveCar(dirAngle, throttle, brake, pbrake)
  end
end

local function posOnPlan(pos, plan, dist)
  if not plan then return end
  dist = dist or 4
  dist = dist * dist
  local bestSeg, bestXnorm
  for i = 1, #plan-2 do
    local p0, p1 = plan[i].pos, plan[i+1].pos
    local xnorm1 = pos:xnormOnLine(p0, p1)
    if xnorm1 > 0 then
      local p2 = plan[i+2].pos
      local xnorm2 = pos:xnormOnLine(p1, p2)
      if xnorm1 < 1 then -- contained in segment i
        if xnorm2 > 0 then -- also partly contained in segment i+1
          local sqDistFromP1 = pos:squaredDistance(p1)
          if sqDistFromP1 <= dist then
            bestSeg = i
            bestXnorm = 1
            break -- break inside conditional
          end
        else
          local sqDistFromLine = pos:squaredDistance(p0 + (p1 - p0) * xnorm1)
          if sqDistFromLine <= dist then
            bestSeg = i
            bestXnorm = xnorm1
          end
          break -- break should be outside above conditional
        end
      elseif xnorm2 < 0 then
        local sqDistFromP1 = pos:squaredDistance(p1)
        if sqDistFromP1 <= dist then
          bestSeg = i
          bestXnorm = 1
        end
        break -- break outside conditional
      end
    else
      break
    end
  end

  return bestSeg, bestXnorm
end

local function egoPosOnPlan(plan)
  local planCount = plan.planCount
  local egoSeg = 1
  local egoXnormOnSeg = 0
  for i = 1, planCount-1 do
    local p0Pos, p1Pos = plan[i].pos, plan[i+1].pos
    local xnorm = ego.pos:xnormOnLine(p0Pos, p1Pos)
    if xnorm < 1 then
      if i < planCount - 2 then
        local nextXnorm = ego.pos:xnormOnLine(p1Pos, plan[i+2].pos)
        if nextXnorm >= 0 then
          local p1Radius = plan[i+1].radiusOrig
          if ego.pos:squaredDistance(linePointFromXnorm(p1Pos, plan[i+2].pos, nextXnorm)) <
              square(ego.width + lerp(p1Radius, plan[i+2].radiusOrig, min(1, nextXnorm))) then
            egoXnormOnSeg = nextXnorm
            egoSeg = i + 1
            break
          end
        end
      end
      egoXnormOnSeg = xnorm
      egoSeg = i
      break
    end
  end

  local disp = 0
  if egoSeg > 1 then
    local sumLen = 0
    disp = egoSeg - 1
    for i = 1, disp do
      sumLen = sumLen + plan[i].length
    end

    for i = 1, plan.planCount do
      plan[i] = plan[i+disp]
      if disp > 0 and i + disp > plan.planCount then
        velocities[i] = vec3(0,0,0)
      else
        velocities[i] = velocities[i+disp]
      end
    end

    plan.planCount = plan.planCount - disp
    plan.planLen = max(0, plan.planLen - sumLen)
    plan.stopSeg = max(1, plan.stopSeg - disp)
  end

  plan.egoXnormOnSeg = egoXnormOnSeg
  plan.egoSeg = egoSeg - disp
end

-- returns the node index
local function getLastNodeWithinDistance(plan, dist)
  dist = dist - plan[1].length * (1 - plan.egoXnormOnSeg)
  if dist < 0 then
    return 1
  end

  local planSeg = plan.planCount
  for i = 2, plan.planCount-1 do
    dist = dist - plan[i].length
    if dist < 0 then
      planSeg = i
      break
    end
  end

  return planSeg
end

local function calculateTarget(plan)
  egoPosOnPlan(plan)
  local targetLength = max(ego.speed * parameters.lookAheadKv, 4.5)

  if plan.planCount >= 3 then
    local xnorm = clamp(plan.egoXnormOnSeg, 0, 1)
    targetLength = max(targetLength, plan[1].length * (1 - xnorm), plan[2].length * xnorm)
  end

  local remainder = targetLength

  local targetPos = vec3(plan[plan.planCount].pos)
  local targetSeg = max(1, plan.planCount-1)
  local prevPos = linePointFromXnorm(plan[1].pos, plan[2].pos, plan.egoXnormOnSeg) -- ego.pos

  local segVec, segLen = vec3(), nil
  for i = 2, plan.planCount do
    local pos = plan[i].pos

    segVec:setSub2(pos, prevPos)
    segLen = segLen or segVec:length()

    if remainder <= segLen then
      targetSeg = i - 1
      targetPos:setScaled2(segVec, remainder / (segLen + 1e-30)); targetPos:setAdd(prevPos)

      -- smooth target
      local xnorm = clamp(targetPos:xnormOnLine(prevPos, pos), 0, 1)
      local lp_n1n2 = linePointFromXnorm(prevPos, pos, xnorm * 0.5 + 0.25)
      if xnorm <= 0.5 then
        if i >= 3 then
          targetPos = linePointFromXnorm(linePointFromXnorm(plan[i-2].pos, prevPos, xnorm * 0.5 + 0.75), lp_n1n2, xnorm + 0.5)
        end
      else
        if i <= plan.planCount - 2 then
          targetPos = linePointFromXnorm(lp_n1n2, linePointFromXnorm(pos, plan[i+1].pos, xnorm * 0.5 - 0.25), xnorm - 0.5)
        end
      end
      break
    end

    prevPos = pos
    remainder = remainder - segLen
    segLen = plan[i].length
  end

  plan.targetPos = targetPos
  plan.targetSeg = targetSeg
end

local function targetsCompatible(baseRoute, newRoute)
  local baseTvec = baseRoute.plan.targetPos - ego.pos
  local newTvec = newRoute.plan.targetPos - ego.pos
  if ego.speed < 2 then return true end
  if newTvec:dot(ego.dirVec) * baseTvec:dot(ego.dirVec) <= 0 then return false end
  local baseTargetRight = baseTvec:cross(ego.upVec); baseTargetRight:normalize()
  return abs(newTvec:normalized():dot(baseTargetRight)) * ego.speed < 2
end

local function getMinPlanLen(limLow, speed, accelg)
  -- given current speed, distance required to come to a stop if I can decelerate at 0.2g
  limLow = limLow or 150
  speed = speed or ego.speed
  accelg = max(0.2, accelg or 0.2)
  return min(550, max(limLow, 0.5 * speed * speed / (accelg * g)))
end

local function pickAiWp(wp1, wp2, dirVec)
  dirVec = dirVec or ego.dirVec
  local vec1 = mapData.positions[wp1] - ego.pos
  local vec2 = mapData.positions[wp2] - ego.pos
  local dot1 = vec1:dot(dirVec)
  local dot2 = vec2:dot(dirVec)
  if (dot1 * dot2) <= 0 then
    if dot1 < 0 then
      return wp2, wp1
    end
  else
    if vec2:squaredLength() < vec1:squaredLength() then
      return wp2, wp1
    end
  end
  return wp1, wp2
end

local function pathExtend(path, newPath)
  if newPath == nil then return end
  local pathCount = #path
  if path[pathCount] ~= newPath[1] then return end
  pathCount = pathCount - 1
  for i = 2, #newPath do
    path[pathCount+i] = newPath[i]
  end
end

-- http://cnx.org/contents/--TzKjCB@8/Projectile-motion-on-an-inclin
local function projectileSqSpeedToRangeRatio(pos1, pos2, pos3)
  local sinTheta = (pos2.z - pos1.z) / pos1:distance(pos2)
  local sinAlpha = (pos3.z - pos2.z) / pos2:distance(pos3)
  local cosAlphaSquared = max(1 - sinAlpha * sinAlpha, 0)
  local cosTheta = sqrt(max(1 - sinTheta * sinTheta, 0)) -- in the interval theta = {-pi/2, pi/2} cosTheta is always positive
  return 0.5 * g * cosAlphaSquared / max(cosTheta * (sinTheta*sqrt(cosAlphaSquared) - cosTheta*sinAlpha), 0)
end

local function getPathLen(path, startIdx, stopIdx)
  if not path then return end
  startIdx = startIdx or 1
  stopIdx = stopIdx or #path
  local positions = mapData.positions
  local pathLen = 0
  for i = startIdx+1, stopIdx do
    pathLen = pathLen + positions[path[i-1]]:distance(positions[path[i]])
  end

  return pathLen
end

local function getPathBBox(path, startIdx, stopIdx)
  if not path then return end
  startIdx = startIdx or 1
  stopIdx = stopIdx or #path

  local positions = mapData.positions
  local p = positions[path[startIdx]]
  local v = positions[path[stopIdx]] + p; v:setScaled(0.5)
  local r = getPathLen(path, startIdx, stopIdx) * 0.5

  return {v.x - r, v.y - r, v.x + r, v.y + r}, v, r
end

local function waypointInPath(path, waypoint, startIdx, stopIdx)
  if not path or not waypoint then return end
  startIdx = startIdx or 1
  stopIdx = stopIdx or #path
  for i = startIdx, stopIdx do
    if path[i] == waypoint then
      return i
    end
  end
end

local function getPlanLen(plan, from, to)
  from = max(1, from or 1)
  to = min(plan.planCount-1, to or math.huge)
  local planLen = 0
  for i = from, to do
    planLen = planLen + plan[i].length
  end

  return planLen
end

local function abortUpcommingLaneChange()
  if not currentRoute then return end
  if currentRoute.laneChanges[1] then
    currentRoute.laneChanges[1].side = 0
  end
  local lastPlanPidx = currentRoute.plan[currentRoute.plan.planCount].pathidx
  for _, lc in ipairs(currentRoute.laneChanges) do
    if lc.pathIdx <= lastPlanPidx then
      lc.side = 0
    end
  end
end

local function updatePlanLen(plan, j, k)
  --profilerPushEvent(""ai_update_planLen"")
  -- bulk recalculation of plan edge lengths and length of entire plan
  -- j: index of earliest node position that has changed
  -- k: index of latest node position that has changed
  j = max((j or 1) - 1, 1)
  k = min(k or plan.planCount, plan.planCount-1)

  local planLen = plan.planLen
  for i = j, k do
    local edgeLen = plan[i+1].pos:distance(plan[i].pos)
    planLen = planLen - plan[i].length + edgeLen
    plan[i].length = edgeLen
  end
  plan.planLen = planLen
  --profilerPopEvent(""ai_update_planLen"")
end

-- expand lane lateral limits of this plan node to the lane range limits
local function openLaneToLaneRange(planNode)
  local roadHalfWidth = planNode.halfWidth
  planNode.laneLimLeft = linearScale(planNode.rangeLeft, 0, 1, -roadHalfWidth, roadHalfWidth)
  planNode.laneLimRight = linearScale(planNode.rangeRight, 0, 1, -roadHalfWidth, roadHalfWidth)
  planNode.lanesOpen = true
end

-- expand lane lateral limits to the lane range for all nodes up to and including idx
local function openPlanLanesToLaneRange(plan, idx)
  plan = plan or (currentRoute and currentRoute.plan)
  if not plan then return end
  for i = 1, min(plan.planCount, idx) do
    openLaneToLaneRange(plan[i])
  end
end

local function laneChange(plan, dist, signedDisp)
  if not plan and currentRoute then plan = currentRoute.plan end
  if not plan then return end

  -- Apply node displacement
  local invDist = 1 / (dist + 1e-30)
  local curDist, normalDispVec = 0, vec3()
  for i = 2, plan.planCount do
    openLaneToLaneRange(plan[i])
    curDist = curDist + plan[i-1].length
    plan[i].lateralXnorm = clamp(plan[i].lateralXnorm + signedDisp * min(curDist * invDist, 1), plan[i].laneLimLeft, plan[i].laneLimRight)
    normalDispVec:setScaled2(plan[i].normal, plan[i].lateralXnorm)
    plan[i].pos:setAdd2(plan[i].posOrig, normalDispVec)

    -- Recalculate vec and dirVec
    plan[i].vec:setSub2(plan[i-1].pos, plan[i].pos); plan[i].vec.z = 0
    plan[i].dirVec:set(plan[i].vec)
    plan[i].dirVec:normalize()
  end

  updatePlanLen(plan)

  --[[ For debugging
  table.clear(newPositionsDebug)
  for i = 1, #newPositions do
    newPositionsDebug[i] = vec3(newPositions[i])
  end
  --]]
end

local function setStopPoint(plan, dist, args)
  if not plan and currentRoute then
    plan = currentRoute.plan
  end
  if not plan then return end

  if not dist then -- reset stop segment
    plan.stopSeg = math.huge
    return
  end

  if (args or E).avoidJunction and currentRoute.path then -- prevents stopping directly in junctions
    -- this code is temporary, and inefficient...
    local seg
    while true do
      seg = getLastNodeWithinDistance(plan, dist)
      local nid = currentRoute.path[plan[seg].pathidx]
      if seg < plan.planCount - 1 and tableSize(mapData.graph[nid]) > 2 and plan[seg].pos:squaredDistance(mapData.positions[nid]) <= square(mapData.radius[nid]) then
        dist = dist + 20
      else
        break
      end
    end
    plan.stopSeg = seg
  else
    plan.stopSeg = getLastNodeWithinDistance(plan, dist)
  end
end

local function numOfLanesFromRadius(rad1, rad2)
  return max(1, math.floor(min(rad1, rad2 or math.huge) * 2 / 3.61 + 0.5)) -- math.floor(min(rad1, rad2) / 2.7) + 1
end

local laneStringBuffer = buffer.new()
local function flipLanes(lanes)
  -- ex. '--+++' becomes '---++'
  for i = #lanes, 1, -1 do
    laneStringBuffer:put(lanes:byte(i) == 43 and '-' or lanes:byte(i) == 45 and '+' or '0')
  end
  return laneStringBuffer:get()
end

-- returns the number of lanes in a given direction
local function numOfLanesInDirection(lanes, dir)
  -- lanes: a lane string
  -- dir: '+' or '-'
  dir = dir == '+' and 43 or dir == '-' and 45
  local lanesN = 0
  for i = 1, #lanes, 1 do
    if lanes:byte(i) == dir then
      lanesN = lanesN + 1
    end
  end
  return lanesN
end

-- Returns the lane configuration of an edge as traversed in the fromNode -> toNode direction
-- if an edge does not have lane data they are deduced from the node radii
local function getEdgeLaneConfig(fromNode, toNode)
  local lanes
  local edge = mapData.graph[fromNode][toNode]
  if edge.lanes then
    lanes = edge.lanes
  else -- make up some lane data in case they don't exist
    if edge.oneWay then
      local numOfLanes = numOfLanesFromRadius(mapData.radius[fromNode], mapData.radius[toNode])
      lanes = string.rep(""+"", numOfLanes)
    else
      local numOfLanes = max(1, math.floor(numOfLanesFromRadius(mapData.radius[fromNode], mapData.radius[toNode]) * 0.5))
      if mapmgr.rules.rightHandDrive then
        lanes = string.rep(""+"", numOfLanes)..string.rep(""-"", numOfLanes)
      else
        lanes = string.rep(""-"", numOfLanes)..string.rep(""+"", numOfLanes)
      end
    end
  end

  return edge.inNode == fromNode and lanes or flipLanes(lanes) -- flip lanes string based on inNode data
end

-- Calculate the edge incident on wp2 which is most similar to the edge wp1->wp2
local function roadNaturalContinuation(wp1, wp2)
  local inLaneConfig = getEdgeLaneConfig(wp1, wp2)
  local inRadiuswp2, inRadiuswp1 = mapData:getEdgeRadii(wp2, wp1)
  local inEdgeDir = vec3(); inEdgeDir:setSub2(mapData:getEdgePositions(wp2, wp1)); inEdgeDir:normalize()
  local laneFlow = mapData.graph[wp1][wp2].drivability * 4 * min(inRadiuswp2, inRadiuswp1) / #inLaneConfig
  local inLaneCount = numOfLanesInDirection(inLaneConfig, '+')
  local inFwdFlow = inLaneCount * laneFlow
  local inLaneCountOpposite = (#inLaneConfig - inLaneCount)
  local inBackFlow = inLaneCountOpposite * laneFlow
  local outEdgeDir, maxOutflow, minNode = vec3(), 0, nil
  for k, v in pairs(mapData.graph[wp2]) do
    if k ~= wp1 then
      local outLaneConfig = getEdgeLaneConfig(wp2, k)
      local numOfOutLanes = numOfLanesInDirection(outLaneConfig, '+')
      outEdgeDir:setSub2(mapData:getEdgePositions(k, wp2)); outEdgeDir:normalize()
      local dirCoef = 0.5 * max(0, 1 + outEdgeDir:dot(inEdgeDir))
      local outLaneCountOpposite = (#outLaneConfig - numOfOutLanes)
      local outRadiuswp2, outRadiusk = mapData:getEdgeRadii(wp2, k)
      if numOfOutLanes == inLaneCount and  outLaneCountOpposite == inLaneCountOpposite then
        laneFlow = mapData.graph[wp2][k].drivability * 4 * 0.5 * (inRadiuswp2 + outRadiuswp2) / #outLaneConfig
      else
        laneFlow = mapData.graph[wp2][k].drivability * 4 * min(outRadiuswp2, outRadiusk)/ #outLaneConfig
      end
      local outFwdFlow = min(inFwdFlow, numOfOutLanes * laneFlow)
      local outBackFlow = min(inBackFlow, outLaneCountOpposite * laneFlow)
      local outflow = outFwdFlow * (1 + outBackFlow) * dirCoef

      if outflow > maxOutflow then
        maxOutflow = outflow
        minNode = k
      end
    end
  end

  return minNode
end


-- returns the lane indices of the left most and right most lanes in the direction of travel
local function laneRangeIdx(laneConfig)
  local numOfLanes = #laneConfig
  local leftIdx, rightIdx = 1, numOfLanes
  for i = 1, numOfLanes do
    if laneConfig:byte(i) == 43 then -- ""+""
      leftIdx = i
      break
    end
  end

  for i = numOfLanes, 1, -1 do
    if laneConfig:byte(i) == 43 then -- ""+""
      rightIdx = i
      break
    end
  end

  return leftIdx, rightIdx, numOfLanes
end

-- returns the lane lateral xnorm limits (boundaries in [0, 1] range 0 being the left boundary)
-- of the left most and right most lanes in the direction of travel and the number of lanes in that range.
-- This range might include lanes in the opposite direction if they are interleaved with lanes in the direction of travel
-- ex. '--++-++' the left most lane is lane 3, the right most lane is lane 7. The range is from lane 3 to lane 7 inclusive.
local function laneRange(laneConfig)
  local leftLim, rightLim, numOfLanes = laneRangeIdx(laneConfig)
  return (leftLim - 1) / numOfLanes, rightLim / numOfLanes, rightLim - leftLim + 1
end

-- Splits the lane string into three parts 1:leftIdx-1, leftIdx:rightIdx, rightIdx+1:numOfLanes and returns the three strings
-- leftIdx is the indice of the left most lane in the direction of travel
-- rightIdx is the indice of the right most lane in the direction of travel
-- therefore leftIdx:rightIdx is the lane string from the left most to the right most lane in the direction of travel
local function splitLaneRange(laneConfig)
  local leftIdx, rightIdx, numOfLanes = laneRangeIdx(laneConfig)
  --leftIdx = leftIdx
  --rightIdx = rightIdx

  return laneConfig:sub(1, leftIdx-1), laneConfig:sub(leftIdx, rightIdx), laneConfig:sub(rightIdx+1, numOfLanes)
end

-- Lateral xnorm limits ([0, 1]) of the left most and right most lanes from ""lane"" in the direction of ""lane""
local function getLaneRangeFromLane(laneConfig, lane)
  -- laneConfig: a string representing lane configuration ex. ""-a-a+a+a""
  -- lane: the lane number (1 to n) counting from left to right in the direction of travel
  local numOfLanes = #laneConfig
  local leftIdx, rightIdx = lane, lane
  -- search left
  for i = lane-1, 1, -1 do
    if laneConfig:byte(i) == 43 then -- ""+""
      leftIdx = i
    else
      break
    end
  end

  -- search right
  for i = lane+1, numOfLanes do
    if laneConfig:byte(i) == 43 then -- ""+""
      rightIdx = i
    else
      break
    end
  end

  return (leftIdx-1) / numOfLanes, rightIdx / numOfLanes, leftIdx, rightIdx
end

-- Calculates the composite lane configuration coming into newNode
-- and adjusted lateral position, lane limits and lane range of the last plan node.
local function processNodeIncommingLanes(newNode, planNode)
  local leftRange, centerRange, rightRange = splitLaneRange(newNode.inEdgeLanes)
  local latXnorm = planNode.lateralXnorm
  local laneLimLeft = planNode.laneLimLeft
  local laneLimRight = planNode.laneLimRight
  local halfWidth = planNode.halfWidth
  local numOfOutLanes = numOfLanesInDirection(newNode.outEdgeLanes, ""+"")
  local numOfInLanes = numOfLanesInDirection(newNode.inEdgeLanes, ""+"")
  local defaultLaneWidth = min(2 * halfWidth / (#newNode.inEdgeLanes), 3.45)
  local inEdgeDrivabilityInv = 1 / ((newNode.inEdgedrivability or 1) + 1e-30)
  if not planNode.rangeLeft then planNode.rangeLeft, planNode.rangeRight = laneRange(newNode.inEdgeLanes) end
  local rangeLeft = linearScale(planNode.rangeLeft or 0, 0, 1, -halfWidth, halfWidth)
  local rangeRight = linearScale(planNode.rangeRight or 1, 0, 1, -halfWidth, halfWidth)

  for nodeId, edgeData in pairs(mapData.graph[newNode.name]) do
    if nodeId ~= newNode.nextNodeInPath and nodeId ~= newNode.prevNodeInPath then -- and not mapmgr.signalsData.nodes[newNode.name]
      local lanes = getEdgeLaneConfig(nodeId, newNode.name)
      local thisEdgeInLanes = numOfLanesInDirection(lanes, '+')
      if thisEdgeInLanes > 0 then -- TODO: Should also possibly include traffic light data
        local nodePos = mapData.positions[nodeId]
        local dirRatio = max(0, (mapData.positions[newNode.nextNodeInPath or newNode.name] - newNode.posOrig):normalized():dot((newNode.posOrig - nodePos):normalized()))
        local drivabilityRatio = min(1, edgeData.drivability * inEdgeDrivabilityInv)
        thisEdgeInLanes = math.floor(thisEdgeInLanes * dirRatio * drivabilityRatio + 0.5)

        if thisEdgeInLanes > 0 then
          if newNode.inEdgeNormal:dot(nodePos) < newNode.inEdgeNormal:dot(newNode.posOrig) then -- coming into newNode from the left
            numOfInLanes = numOfInLanes + thisEdgeInLanes
            centerRange = string.rep(""+"", thisEdgeInLanes)..centerRange
            local radius = thisEdgeInLanes * defaultLaneWidth * 0.5
            latXnorm = latXnorm + radius
            laneLimLeft = laneLimLeft + radius
            laneLimRight = laneLimRight + radius
            halfWidth = halfWidth + radius
            rangeLeft = rangeLeft - radius
            rangeRight = rangeRight + radius -- TODO: is this correct?
          elseif numOfInLanes < numOfOutLanes then
            local capInLanes = min(numOfInLanes + thisEdgeInLanes, numOfOutLanes)
            thisEdgeInLanes = capInLanes - numOfInLanes
            numOfInLanes = capInLanes
            local radius = thisEdgeInLanes * defaultLaneWidth * 0.5
            centerRange = centerRange..string.rep(""+"", thisEdgeInLanes)
            latXnorm = latXnorm - radius
            laneLimLeft = laneLimLeft - radius
            laneLimRight = laneLimRight - radius
            halfWidth = halfWidth + radius
            rangeLeft = rangeLeft - radius
            rangeRight = rangeRight + radius
          end
        end
      end
    end
  end

  return leftRange..centerRange..rightRange, latXnorm, laneLimLeft, laneLimRight, rangeLeft, rangeRight, halfWidth
end

-- Calculate the most appropriate lane of laneConfig
local function getBestLane(laneConfig, nodeLatPos, laneLeftLimLatPos, laneRightLimLatPos, plan, newNode)
  -- nodeLatPos, laneLeftLimLatPos, laneRightLimLatPos are in the [0, 1] interval
  local laneWidth = laneRightLimLatPos - laneLeftLimLatPos
  local numOfLanes = max(1, #laneConfig)
  local bestError = math.huge
  local bestLane, newLaneLimLeft, newLaneLimRight
  local planPos, dirVec
  if plan then
    planPos = plan[plan.planCount].pos
    dirVec = plan[plan.planCount].pos - plan[max(1, plan.planCount-1)].pos; dirVec:normalize()
  else
    planPos = vec3()
    dirVec = planPos
    newNode = {}
    newNode.posOrig = planPos
    newNode.radiusOrig = 0
    newNode.halfWidth = 0
    newNode.normal = planPos
    newNode.outEdgeLanes = laneConfig
  end
  if #newNode.outEdgeLanes == #laneConfig then -- TODO: this might not be correct
    dirVec:set(0, 0, 0)
  end

  -- Get driving side parameter of the map for more exterior lane selection
  local isRightHandDrive = mapmgr.rules.rightHandDrive
  local newNodeWidthVec = newNode.halfWidth * newNode.normal

  for i = 1, numOfLanes do -- traverse lanes in laneConfig
    local thisLaneLimLeft, thisLaneLimRight = (i - 1) / numOfLanes, i / numOfLanes
    local thisLaneLatPos = (thisLaneLimRight + thisLaneLimLeft) * 0.5
    local laneColinearity = ((thisLaneLatPos * 2 - 1) * push3(newNodeWidthVec) + newNode.posOrig - planPos):normalized():dot(dirVec)
    local colinearityError = 1 - max(0, laneColinearity)
    local distError = abs(thisLaneLatPos - nodeLatPos)
    local overlapError = laneWidth - max(0, min(thisLaneLimRight, laneRightLimLatPos) - max(thisLaneLimLeft, laneLeftLimLatPos))
    local directionError = laneConfig:byte(i) == 43 and 0 or 1

    -- lane bias, as driving-side aware, for right-hand drive: prefer leftmost lanes, for left-hand drive: prefer rightmost lanes
    local laneBias = isRightHandDrive and i - 1 or numOfLanes - i
    local totalError = distError + overlapError * 10 + directionError * 100 + laneBias * 0.1 + colinearityError * 3
    if totalError < bestError then
      bestError = totalError
      bestLane = i
      newLaneLimLeft = thisLaneLimLeft
      newLaneLimRight = thisLaneLimRight
    end
  end

  return bestLane, newLaneLimLeft, newLaneLimRight -- lateral positions are in the [0, 1] interval
end

local function getPathNodePosition(route, i)
  local path = route.path
  local wp1 = path[i-1] or route.plan[1].wp
  local wp2 = path[i]
  local wp3 = path[i+1]
  --dump('---- > in', i, path[i])
  if not wp1 and not wp3 then
    --dump('!!!!!!!!!!!!!!', path, objectId)
    return mapData.positions[wp2]:copy()
  elseif not wp1 then
    local wp2Pos = mapData:getEdgePositions(wp2, wp3)
    return wp2Pos:copy()
  elseif not wp3 then
    local _, wp2Pos = mapData:getEdgePositions(wp1, wp2)
    return wp2Pos:copy()
  else
    local e1P1, e1P2 = mapData:getEdgePositions(wp1, wp2)
    local e2P1, e2P2 = mapData:getEdgePositions(wp2, wp3)
    --dump(wp1, wp2, wp3, e1P2:squaredDistance(e2P1))
    if e1P2:squaredDistance(e2P1) < 0.005 then
      --dump('b0')
      return (e1P2 + e2P1) * 0.5
    else
      local e1Xnorm, e2Xnorm = closestLinePoints(e1P1, e1P2, e2P1, e2P2)
      local e2Xnorm2 = closestLinePoints(e2P1, e2P2, e1P1, e1P2)
      local _, e1R2 = mapData:getEdgeRadii(wp1, wp2)
      local e2R1 = mapData:getEdgeRadii(wp2, wp3)

      if e1Xnorm == 0 and e2Xnorm2 == 0 then
        -- segments are parallel
        --dump('b1')
        return (e1P2 + e2P1) * 0.5

      elseif e1Xnorm >= 0 and (e1Xnorm - 1) * e1P2:distance(e1P1) <= e1R2 and e2Xnorm * e2P1:distance(e2P2) >= -e2R1 and e2Xnorm <= 1 then
        -- intersection is within the (radius augmented at P2) e1 and e2 segments
        --dump('b2', 'e1Xnorm = ', e1Xnorm, 'e2Xnorm = ', e2Xnorm)
        local p1 = linePointFromXnorm(e1P1, e1P2, e1Xnorm)
        local p2 = linePointFromXnorm(e2P1, e2P2, e2Xnorm)
        p1:setAdd(p2); p1:setScaled(0.5)
        return p1

      elseif e2Xnorm < 1 and e1Xnorm >= 0 and (e1Xnorm - 1) * e1P2:distance(e1P1) <= e1R2 then
        -- intersection is within (radius augmented at P2) e1 segment and not furnter than the end of e2 (enures that it is not over segment 2 end, if it is too short)
        --dump('b3', 'e1Xnorm = ', e1Xnorm, 'e2Xnorm = ', e2Xnorm)
        local segLen = e1P2:distance(e1P1)
        return linePointFromXnorm(e1P1, e1P2, max(e1Xnorm, 1 - e1R2/segLen))

      elseif e1Xnorm > 0 and e2Xnorm * e2P1:distance(e2P2) >= -e2R1 and e2Xnorm <= 1 then
        -- intersection is within (radius augmented at P2) e2 segment and infront of e1P1
        --dump('b4', 'e1Xnorm = ', e1Xnorm, 'e2Xnorm = ', e2Xnorm)
        local segLen = e2P1:distance(e2P2)
        return linePointFromXnorm(e2P1, e2P2, min(e2Xnorm, e2R1/segLen))

      elseif e2Xnorm >= 1 or e1Xnorm < 0 then
        -- intersection is over segment 2 end or before segment 1 start (particular case)
        --dump('b5')
        return (e1P2 + e2P1) * 0.5

      else
        -- intersection is between segments 1 and 2 but outside of radii extensions
        --dump('b6')
        local p1 = linePointFromXnorm(e1P1, e1P2, e1Xnorm)
        local p2 = linePointFromXnorm(e2P1, e2P2, e2Xnorm)
        p1:setAdd(p2); p1:setScaled(0.5)
        local avgPoint = (e1P2 + e2P1) * 0.5
        local avgPointToP1Line = p1 - avgPoint
        return avgPoint + max(0, min(1, (e1R2 + e2R1) * 0.5 / avgPointToP1Line:length())) * avgPointToP1Line
      end
    end
  end
end

local function getPathNodeRadius(path, i)
  if not path[i-1] and not path[i+1] then
    return mapData.radius[path[i]]
  elseif not path[i-1] then
    local wp1Rad = mapData:getEdgeRadii(path[i], path[i+1])
    return wp1Rad
  elseif not path[i+1] then
    local _, wp2Rad = mapData:getEdgeRadii(path[i-1], path[i])
    return wp2Rad
  else
    local wp1Pos, wp2Pos = mapData:getEdgePositions(path[i-1], path[i])
    local wp3Pos, wp4Pos = mapData:getEdgePositions(path[i], path[i+1])
    local e1Xnorm, e2Xnorm = closestLineSegmentPoints(wp1Pos, wp2Pos, wp3Pos, wp4Pos)
    local wp1Rad, wp2Rad = mapData:getEdgeRadii(path[i-1], path[i])
    local wp3Rad, wp4Rad = mapData:getEdgeRadii(path[i], path[i+1])
    local r1 = wp1Rad + (wp2Rad - wp1Rad) * e1Xnorm
    local r2 = wp3Rad + (wp4Rad - wp3Rad) * e2Xnorm
    return (r1 + r2) * 0.5
  end
end

local function buildNextRoute(route, currentplan)
  local plan, path = currentplan or route.plan, route.path
  local planCount = plan.planCount
  local nextPathIdx = (plan[planCount].pathidx or 0) + 1

  if loopPath == true and noOfLaps and noOfLaps > 1 and not path[nextPathIdx] then -- in case the path loops
    local loopPathId
    local pathCount = #path
    local lastWayPoint = path[pathCount]
    for i = 1, pathCount do
      if lastWayPoint == path[i] then
        loopPathId = i
        break
      end
    end
    nextPathIdx = 1 + loopPathId -- nextPathIdx % #path
    noOfLaps = not plan.copy and noOfLaps - 1 or noOfLaps -- avoid decreasing noOfLaps for alternative plans
  end

  local newNodeName = path[nextPathIdx]
  if not newNodeName then return end
  local graph = mapData.graph
  if not graph[newNodeName] then return end

  -- gather information about new node
  local tmpPos = getPathNodePosition(route, nextPathIdx)
  local newNode = {
    name = newNodeName,
    posOrig = tmpPos,
    pos = tmpPos:copy(),
    radiusOrig = getPathNodeRadius(path, nextPathIdx),
    biNormal = -mapmgr.surfaceNormalBelow(mapData.positions[newNodeName], mapData.radius[newNodeName] * 0.5),
    prevNodeInPath = path[nextPathIdx-1],
    inEdgeDrivability = nil,
    inEdgeLanes = nil, -- lanes going into the node along the path
    inEdgeSpeedLimit = nil,
    nextNodeInPath = path[nextPathIdx+1],
    outEdgeLanes = nil, -- lanes coming out of the node along the path
    outEdgeSpeedLimit = nil,
  }

  if newNode.prevNodeInPath then
    newNode.prevNodePos = mapData.positions[newNode.prevNodeInPath]
    local link = graph[newNode.prevNodeInPath][newNode.name]
    if link then
      newNode.inEdgeLanes = getEdgeLaneConfig(newNode.prevNodeInPath, newNode.name)
      newNode.inEdgeSpeedLimit = link.speedLimit
      newNode.inEdgeDrivability = link.drivability
    end
  else -- if previous plan node is the ego.pos then
    newNode.prevNodePos = vec3(plan[1].posOrig)
    if planCount == 1 and plan[1].wp then -- check whether information is available
      --newNode.inEdgeLanes = plan[1].lanes -- TODO: use plan[1].wp to get lane configuration instead of saving the lane configuration in plan[1].lanes?
      newNode.prevNodeInPath = plan[1].wp
      newNode.inEdgeLanes = getEdgeLaneConfig(newNode.prevNodeInPath, newNode.name)
      newNode.inEdgeDrivability = graph[newNode.prevNodeInPath][newNode.name].drivability
    end
  end

  -- if there is no nextNodeInPath can we deduce it by elimination?
  -- we need to see if there is a unique node towards which we can lawfully drive
  if not newNode.nextNodeInPath then
    local nextPosibleNode = nil
    for k, v in pairs(graph[newNode.name]) do
      if k ~= newNode.prevNodeInPath then
        if numOfLanesInDirection(getEdgeLaneConfig(newNode.name, k), '+') > 0 then
          if nextPosibleNode then
            nextPosibleNode = nil
            break
          else
            nextPosibleNode = k
          end
        end
      end
    end
    newNode.nextNodeInPath = nextPosibleNode
  end

  if newNode.nextNodeInPath then
    local link = graph[newNode.name][newNode.nextNodeInPath]
    if link then
      newNode.outEdgeLanes = getEdgeLaneConfig(newNode.name, newNode.nextNodeInPath)
      newNode.outEdgeSpeedLimit = link.speedLimit
    end
  else
    if M.mode ~= 'traffic' then
      newNode.outEdgeLanes = newNode.inEdgeLanes
      newNode.outEdgeSpeedLimit = newNode.inEdgeSpeedLimit
    else
      return
    end
  end

  if newNode.outEdgeLanes and not newNode.inEdgeLanes then
    newNode.inEdgeLanes = newNode.outEdgeLanes
  end

  -- Adjust last plan node normal given information about node to be inserted:
  -- The normal of the node that is currently the last in the plan may need to be updated
  -- either because the path has been extended (where previously it was the last node in the path)
  -- or because the path has changed from this node forwards
  if planCount > 1 then
    if plan[planCount].wayPointAhead ~= path[nextPathIdx] then
      local norm1 = plan[planCount].biNormal:cross(plan[planCount].posOrig - plan[planCount-1].posOrig); norm1:normalize()
      local norm2 = plan[planCount].biNormal:cross(newNode.posOrig - plan[planCount].posOrig); norm2:normalize()
      plan[planCount].normal:setAdd2(norm1, norm2)
      local tmp = plan[planCount].normal:length()
      plan[planCount].normal:setScaled(1 / (tmp + 1e-30))
      local chordLength = min(2 / tmp, (1 - norm1:dot(norm2) * 0.5) * tmp) -- 2 / tmp == cos(x/2) : x is angle between norm1, norm2
      plan[planCount].halfWidth = plan[planCount].radiusOrig * chordLength
    end
  else
    plan[planCount].normal:setSub2(newNode.posOrig, plan[planCount].posOrig)
    plan[planCount].normal:setCross(plan[planCount].biNormal, plan[planCount].normal)
    plan[planCount].normal:normalize()
  end

  -- Calculate normal of node to be inserted into the plan
  -- This normal is calculated from the normals of the two path edges incident on it
  newNode.inEdgeNormal = vec3()
  if newNode.prevNodeInPath then -- TODO: why not check for newNode.prevNodePos?
    local wp1Pos, wp2Pos = mapData:getEdgePositions(newNode.prevNodeInPath, newNode.name)
    newNode.inEdgeNormal:setSub2(wp2Pos, wp1Pos)
    newNode.inEdgeNormal:setCross(newNode.biNormal, newNode.inEdgeNormal)
    newNode.inEdgeNormal:normalize()
  end

  newNode.outEdgeNormal = vec3()
  if newNode.nextNodeInPath then
    local wp1Pos, wp2Pos = mapData:getEdgePositions(newNode.name, newNode.nextNodeInPath)
    newNode.outEdgeNormal:setSub2(wp2Pos, wp1Pos)
    newNode.outEdgeNormal:setCross(newNode.biNormal, newNode.outEdgeNormal)
    newNode.outEdgeNormal:normalize()
  end

  newNode.normal = newNode.inEdgeNormal + newNode.outEdgeNormal
  local tmp = newNode.normal:length()
  newNode.normal:setScaled(1 / (tmp + 1e-30))
  newNode.chordLength = min(2 / tmp, (1 - newNode.inEdgeNormal:dot(newNode.outEdgeNormal) * 0.5) * tmp) -- new node road width multiplier
  newNode.halfWidth = newNode.radiusOrig * newNode.chordLength

  local newNodeLaneLimLeft = 0
  local newNodeLaneLimRight = 1
  local newNodeRangeLeft = 0
  local newNodeRangeRight = 1
  local newNodeRangeLaneCount = 1
  local rangeBestLane = 0
  local bestLane
  local newNodeLaneConfig
  local newNodeRangeLeftIdx -- index of left most lane in range
  local newNodeRangeRightIdx -- index of right most lane in range

  if opt.driveInLaneFlag and newNode.inEdgeLanes then
    -- Consider lanes comming into newNode, scale/translate planNode lateral position and lane limits and add them to the in lane configuration as appropriate
    local inLaneConfig, planNodeLatPos, planNodelaneLimLeft, planNodelaneLimRight, planNodeRangeLeft, planNodeRangeRight, planNodeHalfWidth = processNodeIncommingLanes(newNode, plan[planCount]) -- lateral coordinates in [-r, r]

    -- Calculate lateral xnorm ranges of lanes in the direction of travel (in [0, 1])
    local outRangeLeft, outRangeRight, outRangeLaneCount = laneRange(newNode.outEdgeLanes)
    local inRangeLeft, inRangeRight, inRangeLaneCount = laneRange(inLaneConfig)

    -- Decide on the lane configuration of newNode: --> Retain the narrowest range
    local newNodeLaneConfigOrig
    if (inRangeRight - inRangeLeft) * outRangeLaneCount < (outRangeRight - outRangeLeft) * inRangeLaneCount then
      newNodeLaneConfig, newNodeRangeLeft, newNodeRangeRight, newNodeRangeLaneCount = inLaneConfig, inRangeLeft, inRangeRight, inRangeLaneCount
      newNodeLaneConfigOrig = newNode.inEdgeLanes
    else
      newNodeLaneConfig, newNodeRangeLeft, newNodeRangeRight, newNodeRangeLaneCount = newNode.outEdgeLanes, outRangeLeft, outRangeRight, outRangeLaneCount
      newNodeLaneConfigOrig = newNode.outEdgeLanes
    end

    local planNodeLatPosNrmd = linearScale(planNodeLatPos, planNodeRangeLeft, planNodeRangeRight, newNodeRangeLeft, newNodeRangeRight) -- TODO: lateralXnorm might be outside [inRangeLeft, inRangeRight]
    local planNodeLaneLimLeftNrmd = linearScale(planNodelaneLimLeft, planNodeRangeLeft, planNodeRangeRight, newNodeRangeLeft, newNodeRangeRight)
    local planNodeLaneLimRightNrmd = linearScale(planNodelaneLimRight, planNodeRangeLeft, planNodeRangeRight, newNodeRangeLeft, newNodeRangeRight)
    -- Calculate the most appropriate lane out of newNodeLaneConfig. This will be where to position the new node lateraly along the normal of newNode.
    bestLane, newNodeLaneLimLeft, newNodeLaneLimRight = getBestLane(newNodeLaneConfig, planNodeLatPosNrmd, planNodeLaneLimLeftNrmd, planNodeLaneLimRightNrmd, plan, newNode) -- lateral coordinates in [0, 1]

    -- Calculate the lane range (i.e. lateral limits of left most and right most lanes traveling in the same direction as bestLane, starting from bestLane)
    local rangeLeft, rangeRight = newNodeRangeLeft, newNodeRangeRight
    newNodeRangeLeft, newNodeRangeRight, newNodeRangeLeftIdx, newNodeRangeRightIdx = getLaneRangeFromLane(newNodeLaneConfig, bestLane) -- lateral coordinates in [0, 1]

    local rangeLeftOrig, rangeRightOrig = laneRange(newNodeLaneConfigOrig) -- Will this work when the lane config is not monotonic?
    newNodeRangeLeft = linearScale(newNodeRangeLeft, rangeLeft, rangeRight, rangeLeftOrig, rangeRightOrig)
    newNodeRangeRight = linearScale(newNodeRangeRight, rangeLeft, rangeRight, rangeLeftOrig, rangeRightOrig)
    --newNodeLaneLimLeft = linearScale(newNodeRangeLeft + (bestLane - newNodeRangeLeftIdx) * laneWidth, 0, 1, -roadHalfWidth, roadHalfWidth)
    --newNodeLaneLimRight = linearScale(newNodeRangeLeft + (bestLane - newNodeRangeLeftIdx) + 1) * laneWidth, 0, 1, -roadHalfWidth, roadHalfWidth)
    newNodeLaneLimLeft = linearScale(newNodeLaneLimLeft, rangeLeft, rangeRight, rangeLeftOrig, rangeRightOrig)
    newNodeLaneLimRight = linearScale(newNodeLaneLimRight, rangeLeft, rangeRight, rangeLeftOrig, rangeRightOrig)
  end

  newNode.pos:setAdd(((newNodeLaneLimLeft + newNodeLaneLimRight) - 1) * newNode.halfWidth * newNode.normal)

  newNode.inEdgeNormal:setSub2(newNode.pos, plan[planCount].pos)
  newNode.inEdgeNormal:setCross(newNode.biNormal, newNode.inEdgeNormal)
  newNode.inEdgeNormal:normalize()
  newNode.normal = newNode.inEdgeNormal + newNode.outEdgeNormal

  local tmp = newNode.normal:length()
  newNode.normal:setScaled(1 / (tmp + 1e-30))
  newNode.chordLength = min(2 / tmp, (1 - newNode.inEdgeNormal:dot(newNode.outEdgeNormal) * 0.5) * tmp)
  newNode.halfWidth = newNode.radiusOrig * newNode.chordLength

  local newNodeLatPos
  if newNodeLaneConfig and #newNodeLaneConfig > 1 and newNode.nextNodeInPath and newNode.prevNodeInPath then -- TODO: error hits if the nextNode/prevNode conditions are not here
    local laneWidth = 2 * newNode.radiusOrig * (newNodeRangeRight - newNodeRangeLeft) / newNodeRangeLaneCount -- lane width not including chordLength
    local turnDir = (mapData.positions[newNode.nextNodeInPath] - newNode.posOrig) + (mapData.positions[newNode.prevNodeInPath] - newNode.posOrig)
    -- keep inside lanes narrower
    if turnDir:dot(newNode.normal) < 0 then
      newNodeLaneLimLeft = linearScale(newNodeRangeLeft, 0, 1, -newNode.halfWidth, newNode.halfWidth) + (bestLane - newNodeRangeLeftIdx) * laneWidth
      --[[ tighter outside left turns
      newNodeLaneLimLeft = -newNodeHalfWidth + (bestLane - 1) * laneWidth
      newNodeRangeLeft = min(newNodeRangeLeft, linearScale(-newNodeHalfWidth + (newNodeRangeLeftIdx - 1) * laneWidth, -newNodeHalfWidth, newNodeHalfWidth, 0, 1))
      --]]
      newNodeLaneLimRight = newNodeLaneLimLeft + laneWidth
      newNodeLatPos = (newNodeLaneLimLeft + newNodeLaneLimRight) * 0.5
      if bestLane == #newNodeLaneConfig then newNodeLaneLimRight = newNode.halfWidth end -- give remaining space on the right to the right most lane
    else
      newNodeLaneLimRight = linearScale(newNodeRangeRight, 0, 1, -newNode.halfWidth, newNode.halfWidth) - (newNodeRangeRightIdx - bestLane) * laneWidth
      newNodeLaneLimLeft = newNodeLaneLimRight - laneWidth
      newNodeLatPos = (newNodeLaneLimLeft + newNodeLaneLimRight) * 0.5
      if bestLane == 1 then newNodeLaneLimLeft = -newNode.halfWidth end -- give remaining space on the left to left most lane
    end
  else
    -- Transform newNode lateral position and lane limits from [0, 1] to [-r, r] using the recalculated newNodeHalfWidth
    newNodeLaneLimLeft = linearScale(newNodeLaneLimLeft, 0, 1, -newNode.halfWidth, newNode.halfWidth)
    newNodeLaneLimRight = linearScale(newNodeLaneLimRight, 0, 1, -newNode.halfWidth, newNode.halfWidth)
    newNodeLatPos = (newNodeLaneLimLeft + newNodeLaneLimRight) * 0.5
  end
  newNodeLatPos = newNodeLatPos + (plan.offset or 0)
  -- plan converges gradually towards the center of the road
  if not opt.driveInLaneFlag then
    -- normalized lateral xnorm of the last node on the plan
    local normalizedPrevLatXnorm = plan[plan.planCount].lateralXnorm / (plan[plan.planCount].halfWidth)

    -- last plan node lateral xnorm scaled to the width of the new node
    local lateralXnorm = max(min(normalizedPrevLatXnorm * newNode.halfWidth, newNode.halfWidth), -newNode.halfWidth)

    -- calculate smoothing parameter
    local t = min(1, max(0, plan.planLen / 100)) -- currently converges to the center of the road at 100m

    -- calculate desired lateral xnorm for the new plan node
    newNodeLatPos = lateralXnorm * (1 - t) + newNodeLatPos * t
  end

  newNode.pos = newNode.posOrig + newNodeLatPos * newNode.normal

  local lastPlanPos = plan[planCount] and plan[planCount].pos or ego.pos
  local vec = lastPlanPos - newNode.pos; vec.z = 0

  return {
    posOrig = newNode.posOrig,
    pos = newNode.pos,
    vec = vec,
    dirVec = vec:normalized(),
    turnDir = vec3(0,0,0),
    biNormal = newNode.biNormal,
    normal = newNode.normal,
    radiusOrig = newNode.radiusOrig,
    manSpeed = speedProfile and speedProfile[newNode.name],
    roadSpeedLimit = newNode.prevNodeInPath and mapData.graph[newNode.prevNodeInPath][newNode.name].speedLimit,
    pathidx = nextPathIdx,
    halfWidth = newNode.halfWidth,
    widthMarginOffset = 0,
    wayPointAhead = newNode.nextNodeInPath,
    laneLimLeft = newNodeLaneLimLeft, -- lateral coordinate of current lane left limit [-hW, hW]
    laneLimRight = newNodeLaneLimRight, -- lateral coordinate of current lane right limit [-hW, hW]
    curvature = 0,
    curvatureZ = 0,
    lateralXnorm = newNodeLatPos, -- lateral coordinate of pos [-hW, hW]
    legalSpeed = nil,
    speed = nil,
    inLaneConfig = newNode.inEdgeLanes, -- lane configuration of incoming edge to node
    rangeLeft = newNodeRangeLeft, -- lateral coordinate [0, 1] of the left hand side limit of the left most lane in the direction of travel
    rangeRight = newNodeRangeRight, -- lateral coordinate [0, 1] of the right hand side limit of the right most lane in the direction of travel
    rangeLaneCount = newNodeRangeLaneCount, -- number of contiguous lanes in the direction of travel counting from the current lane
    rangeBestLane = bestLane and newNodeRangeLeftIdx and (bestLane - newNodeRangeLeftIdx) or rangeBestLane, -- 0 indexed
    trafficSqVel = math.huge,
    dispDir = 0
  }
end

local function mergePathPrefix(source, dest, srcStart)
  srcStart = srcStart or 1
  local sourceCount = #source
  local dict = table.new(0, sourceCount-(srcStart-1))
  for i = srcStart, sourceCount do
    dict[source[i]] = i
  end

  local destCount = #dest
  for i = destCount, 1, -1 do
    local srci = dict[dest[i]]
    if srci ~= nil then
      local res = table.new(destCount, 0)
      local resi = 1
      for i1 = srcStart, srci - 1 do
        res[resi] = source[i1]
        resi = resi + 1
      end
      for i1 = i, destCount do
        res[resi] = dest[i1]
        resi = resi + 1
      end

      return res, srci
    end
  end

  return dest, 0
end

local function uniformPlanErrorDistribution(plan)
  if twt.state == 0 then
    local p1, p2 = plan[1].pos, plan[2].pos
    local dispVec = ego.pos - linePointFromXnorm(p1, p2, ego.pos:xnormOnLine(p1, p2))
    dispVec:setScaled(min(1, 4 * dt))
    local dispVecDir = dispVec:normalized()

    local tmpVec = p2 - p1; tmpVec:setCross(tmpVec, ego.upVec); tmpVec:normalize()
    --egoDeviation = dispVec:dot(tmpVec)

    local j = 0
    local dTotal = 0
    for i = 1, plan.planCount-1 do
      tmpVec:setSub2(plan[i+1].pos, plan[i].pos)
      if math.abs(dispVecDir:dot(tmpVec)) > 0.5 * plan[i].length then
        break
      end
      j = i
      dTotal = dTotal + plan[i].length
    end
    local laneWidthMargin = ego.width * 0.6
    local sumLen = 0
    for i = j, 1, -1 do
      local n = plan[i]
      sumLen = sumLen + plan[i].length

      local lateralXnorm = n.lateralXnorm or 0
      local newLateralXnorm = clamp(lateralXnorm + ((dispVec):dot(n.normal) * sumLen / dTotal), (n.laneLimLeft + laneWidthMargin) or -math.huge, (n.laneLimRight - laneWidthMargin) or math.huge)
      tmpVec:setScaled2(n.normal, newLateralXnorm - lateralXnorm)
      n.pos:setAdd(tmpVec)
      n.lateralXnorm = newLateralXnorm

      plan[i+1].vec:setSub2(plan[i].pos, plan[i+1].pos); plan[i+1].vec.z = 0
      plan[i+1].dirVec:setScaled2(plan[i+1].vec, 1 / plan[i+1].vec:lengthGuarded())
    end

    updatePlanLen(plan, 1, j)
  end
end

local function createNewRoute(path)
  local newRoute = {
    path = path,
    plan = table.new(15, 10),
    laneChanges = {}, -- array: in the array each lane change is a dict with an idx key (path index at which lane change occurs) and a side key (direction of lane change)
    lastLaneChangeIdx = 1, -- path node up to which we have checked for a posible lane change
    pathLength = {0} -- distance from beggining of path to node at index i
  }
  newRoute.plan.stopSeg = math.huge

  return newRoute
end

local function isVehicleStopped(v)
  if v.isParked then
    return true
  elseif v.states.ignitionLevel == 0 or v.states.ignitionLevel == 1 then
    return true
  elseif v.states.hazard_enabled == 1 and v.vel:squaredLength() < 9 then
    return true
  end
  return false
end

local function inCurvature(v1, v2)
  --[[
    Given three points A, B, C (with AB being the vector from A to B), the curvature (= 1 / radius)
    of the circle going through them is:

    curvature = 2 * (AB x BC) / ( |AB| * |BC| * |CA| ) =>
              = 2 * |AB| * |BC| * Sin(th) / ( |AB| * |BC| * |CA| ) =>
              = 2 * (+/-) * sqrt ( 1 - Cos^2(th) ) / |CA| =>
              = 2 * (+/-) sqrt [ ( 1 - Cos^2(th) ) / |CA|^2 ) ] -- This is an sqrt optimization step

    In the calculation below the (+/-) which indicates the turning direction (direction of AB x BC) has been dropped
  --]]

  -- v1 and v2 vector components
  local v1x, v1y, v1z, v2x, v2y, v2z = v1.x, v1.y, v1.z, v2.x, v2.y, v2.z

  local v1Sqlen, v2Sqlen = v1x * v1x + v1y * v1y + v1z * v1z, v2x * v2x + v2y * v2y + v2z * v2z
  local dot12 = v1x * v2x + v1y * v2y + v1z * v2z
  local cosSq = min(1, dot12 * dot12 / max(1e-30, v1Sqlen * v2Sqlen))

  if dot12 < 0 then -- angle between the two segments is > 90 deg
    local minDsq = min(v1Sqlen, v2Sqlen)
    local maxDsq = minDsq / max(1e-30, cosSq)
    if max(v1Sqlen, v2Sqlen) > (minDsq + maxDsq) * 0.5 then
      if v1Sqlen > v2Sqlen then
        -- swap v1 and v2
        v1x, v1y, v1z, v2x, v2y, v2z = v2x, v2y, v2z, v1x, v1y, v1z
        v1Sqlen, v2Sqlen = v2Sqlen, v1Sqlen
      end
      local s = sqrt(0.5 * (minDsq + maxDsq) / max(1e-30, v2Sqlen))
      v2x, v2y, v2z = s * v2x, s * v2y, s * v2z
    end
  end

  return 2 * sqrt((1 - cosSq) / max(1e-30, square(v1x + v2x) + square(v1y + v2y) + square(v1z + v2z))) -- the denominator is v1:squaredLength(-v2)
end

-- ********* FUNCTIONS FOR SPEED PROFILE GENERATION ********* --

-- Computes the acceleration budget based on the vehicle speed (x) to simulate more realistic real world driving behaviour
-- https://arxiv.org/pdf/1907.01747
local function speedBasedAccelBudget(x, a)
  x = max(0, x)
  a = a or 0

  local fx
  if 0 <= x and x < 5 then
    fx = 0.3 * x + 4
  elseif 5 <= x and x < 10 then
    fx = 5.5
  elseif 10 <= x and x < 15 then
    fx = -0.1 * x + 6.5
  elseif 15 <= x and x < 20 then
    fx = -0.15 * x + 7.25
  elseif 20 <= x and x < 25 then
    fx = -0.15 * x + 7.25
  elseif 25 <= x and x < 30 then
    fx = -0.1 * x + 6
  else
    fx = 3
  end

  return max(0, min(fx + a, ego.staticFrictionCoef * g))
end

local speedProfileMode -- ('Back' for new backward method, 'ForwBack' for forward+Backward method)
local function setSpeedProfileMode(mode)
  if mode == 'Back' then
    speedProfileMode = 'Back'
  elseif mode == 'ForwBack' then
    speedProfileMode = 'ForwBack'
  else
    speedProfileMode = nil
  end
end

-- Compute maximum available longitudinal acceleration
local function acc_eval_1(speedSq, acc_max, curvature)
  local ax_max_tyre = acc_max -- has to be exctracted from ggv
  local ay_max_tyre = acc_max -- has to be exctracted from ggv
  local ay_used = speedSq * curvature
  return ax_max_tyre * max(0, 1 - ay_used / ay_max_tyre)
end

local function acc_eval_2(speedSq, acc_max, curvature)
  local ax_max_tyre = acc_max -- has to be exctracted from ggv
  local ay_max_tyre = acc_max -- has to be exctracted from ggv
  local ay_used = speedSq * curvature
  if ay_used < ay_max_tyre then
    return ax_max_tyre * sqrt(1 - square(ay_used/ay_max_tyre))
  else
    return 0
  end
end

local acc_eval = acc_eval_2 -- Default adherence constraint
-- set the index for adherence constraint, useful only for Back or ForwBack mode
local function setTractionModel(model_index)
  if model_index == 1 then
    acc_eval = acc_eval_1
  else
    acc_eval = acc_eval_2
  end
end

-- Compute forward pass (speed0 = starting velocity, model_index = index for adherence constraint)
local function solver_f_acc_profile(plan, speed0)
  -- Note: This calculation need the node speed values to be squared.
  -- This will already be the case if the previous calculation for the limiting turn speed avoided calculating square root of speeds.

  plan[1].speed = speed0 or plan[1].speed

  -- The last node speed value was not calculated from the limiting turn speed (due to absence of curvature value), so square it.
  plan[plan.planCount].speed = square(plan[plan.planCount].speed)

  for i = 1, plan.planCount-1 do
    local n1, n2 = plan[i], plan[i+1]

    local vx_possible_next
    if plan.stopSeg <= i+1 then
      vx_possible_next = 0
    else
      if min(n2.speed, n2.trafficSqVel) < n1.speed then -- max velocity at i-1 is less than velocity at i (not a deceleration phase)
        vx_possible_next = min(n2.speed, n2.trafficSqVel)
      else
        local ax_final = acc_eval(n1.speed, n1.acc_max, abs(n1.curvature))
        vx_possible_next = n1.speed + 2 * ax_final * n1.length -- speed squared
        vx_possible_next = min(n2.speed, min(n2.trafficSqVel, vx_possible_next))
      end
    end

    n2.speed = vx_possible_next
  end

  -- Backwards aceel integrator expects the last node speed value to not be squared
  plan[plan.planCount].speed = sqrt(plan[plan.planCount].speed)
end

-- Compute backward pass (speed_end = final velocity, model_index = index for adherence constraint)
local function solver_b_acc_profile(plan)
  for i = plan.planCount, 2, -1 do
    local n1, n2 = plan[i-1], plan[i]
    local vx_possible_next
    if plan.stopSeg <= i-1 then
      vx_possible_next = 0
    else
      local n2SpeedSq = n2.speed * n2.speed
      if min(n1.speed, n1.trafficSqVel) < n2SpeedSq then -- max velocity at i-1 is less than velocity at i (not a deceleration phase)
        vx_possible_next = sqrt(min(n1.speed, n1.trafficSqVel))
      else
        -- available longitudinal acceleration at node i
        local ax_possible_current = acc_eval(n2SpeedSq, n2.acc_max, abs(n2.curvature))
        -- possible velocity at node i-1 given available longitudinal acceleration at node i
        vx_possible_next = n2SpeedSq + 2 * n1.length * ax_possible_current

        -- available longitudinal acceleration at node i-1 given velocity estimate at node i-1
        local ax_possible_next = acc_eval(vx_possible_next, n1.acc_max, abs(n1.curvature))
        -- possible velocity at i-1 given available longitudinal acceleration at node i-1
        local vx_tmp = n2SpeedSq + 2 * n1.length * ax_possible_next

        if vx_possible_next > vx_tmp then
          -- available longitudinal acceleration at node i-1 given new velocity estimate at node i-1
          ax_possible_next = acc_eval(vx_tmp, n1.acc_max, abs(n1.curvature))
          -- improve velocity estimate at i-1 given available longitudinal acceleration at node i-1
          vx_tmp = n2SpeedSq + 2 * n1.length * ax_possible_next
          -- keep the velocity that satisfies longitudinal acceleration constraints at node i-1 and node i
          vx_possible_next = min(vx_possible_next, vx_tmp)
        end

        vx_possible_next = sqrt(min(n1.speed, min(n1.trafficSqVel, vx_possible_next))) -- respect traffic speed
      end
    end

    n1.speed = n1.manSpeed or
               (M.speedMode == 'limit' and M.routeSpeed and min(M.routeSpeed, vx_possible_next)) or
               (M.speedMode == 'set' and M.routeSpeed) or
               vx_possible_next

    if M.speedMode == 'legal' then
      n2.legalSpeed = n2.legalSpeed or n2.speed
      n1.legalSpeed = min(min(n1.speed, sqrt(n2.legalSpeed * n2.legalSpeed + (n1.acc_max + n2.acc_max) * n1.length)), (n1.roadSpeedLimit or math.huge))
    end

    n1.trafficSqVel = math.huge
  end
end

local function setRacing(v)
  if v == true then
    opt.racing = true
    traffic.filtered = false
  else
    opt.racing = false
  end
end
M.setRacing = setRacing

local function setTrafficFilter(v)
  if v == true then
    traffic.filtered = true
  else
    traffic.filtered = false
  end
end
M.setTrafficFilter = setTrafficFilter

local function setVdraw(v)
  if v == true then
    traffic.vdraw = true
  else
    traffic.vdraw = false
  end
end
M.setVdraw = setVdraw

local function trafficFilter(index, route, v, draw)
  local path = route.path
  local plan1 = route.plan[1]
  local plan2 = route.plan[2]
  --local ego2vmiddle =  ego.pos:squaredDistance(v.posMiddle)

  -- Initialize n1 node data table
  local n1 = {name = nil, posOrig = plan1.posOrig, radiusOrig = plan1.radiusOrig, biNormal = plan1.biNormal, normal = vec3()}

  -- Initialize n2 node data table
  local n2 = {normal = vec3()}

  -- placeholder for segment direction vector
  local dirVec, dirVecNext = vec3(), vec3()

  -- cache player vehicle position and direction data
  local vPfront, vPrear, vPmiddle, vdirVec = v.posFront, v.posRear, v.posMiddle, v.dirVec

  -- will be set to true if any of the path nodes is an intersection
  local intersectionFound = false
  for i = max(index.start, plan2.pathidx), index.final do
    -- check if this node is an intersection
    intersectionFound = intersectionFound or tableSize(mapData.graph[route.path[i]]) > 2

    -- gather data on node n2
    n2.name = path[i]
    n2.posOrig = getPathNodePosition(route, i)
    n2.radiusOrig = getPathNodeRadius(path, i) --mapData.radius[path[i]],
    n2.biNormal = -mapmgr.surfaceNormalBelow(mapData.positions[path[i]], mapData.radius[path[i]] * 0.5)

    dirVec:setSub2(n1.posOrig, n2.posOrig); dirVec.z = 0; dirVec:normalize()
    n1.normal:setCross(dirVec, n1.biNormal)
    n2.normal:setCross(dirVec, n2.biNormal)

    local roadHalfWidth1, roadHalfWidth2 =  n1.radiusOrig * 1.05, n2.radiusOrig * 1.05

    -- n1 and n2 left boundaries
    local n1PosLeft, n2PosLeft = n1.posOrig - roadHalfWidth1 * n1.normal, n2.posOrig - roadHalfWidth2 * n2.normal

    -- n1 and n2 right boundaries
    local n1PosRight, n2PosRight = n1.posOrig + roadHalfWidth1 * n1.normal, n2.posOrig + roadHalfWidth2 * n2.normal

    -- projection of vehicle front position on line passing through right boundaries
    local xnormFrRight = vPfront:xnormOnLine(n1PosRight, n2PosRight)

    -- projection of vehicle front position on line passing through left boundaries
    local xnormFrLeft = vPfront:xnormOnLine(n1PosLeft, n2PosLeft)

    -- projection of vehicle rear position on line passing through right boundaries
    local xnormReRight = vPrear:xnormOnLine(n1PosRight, n2PosRight)

    -- projection of vehicle rear position on line passing through left boundaries
    local xnormReLeft = vPrear:xnormOnLine(n1PosLeft, n2PosLeft)

    -- taking the nearest projection of vehicle front and rear
    local minF = min(xnormFrRight, xnormFrLeft)
    local minR = min(xnormReRight, xnormReLeft)

    -- ego to vehicle direction vector
    local ego2PlVec = vPfront - ego.pos; ego2PlVec:normalize()

    local ego2v = vPmiddle:squaredDistance(ego.pos - 0.5 * ego.length * ego.dirVec)
    local xnormV = vPmiddle:xnormOnLine(plan1.posOrig - roadHalfWidth1 * plan1.normal, plan1.posOrig + roadHalfWidth1 * plan1.normal)
    local lanew = (plan1.rangeRight - plan1.rangeLeft)/plan1.rangeLaneCount
    if plan1.rangeLaneCount > 1 and ego.dirVec:dot(vdirVec) > 0.7 and ego2v < square((1.2 * ego.length + 1.2*v.length)) and (xnormV > plan1.rangeLeft and xnormV < plan1.rangeRight) and (not (xnormV > (plan1.rangeLeft + lanew*plan1.rangeBestLane) and xnormV < (plan1.rangeLeft + lanew*(plan1.rangeBestLane+1)))) then
      if draw then obj.debugDrawProxy:drawSphere(2, vPfront, color(0,0,0,160)) end
      if ego2PlVec:dot(ego.rightVec) > 0 then
        ego.ghostR = true
      else
        ego.ghostL = true
      end
      return true
    end

    -- *Check 1.1: check if v-vehicle is in the current path-segment projection
    if (minF > 0 and minF < 1) or (minR > 0 and minR < 1) then
      -- *Check 1.1.1: check if v-vehicle is coming in opposite direction
      if ego2PlVec:dot(vdirVec) < 0 then
        -- smooth transition of dirVec if mesh is not large enough
        if minF < 1 and minR > 1 and path[i+1] then
          local n3posOrig = getPathNodePosition(route, i+1)
          dirVecNext:setSub2(n2.posOrig, n3posOrig); dirVecNext.z = 0; dirVecNext:normalize()
          dirVec:setAdd2(max(0,minF)*dirVecNext, max(0,1-minF)*dirVec)
          --dirVec:setAdd(dirVecNext)
          dirVec:normalize()
        end
        -- *Check 1.1.1.1: add it if it is not parallel to current path-segment
        if vdirVec:dot(dirVec) < 0.95 then
          if draw then obj.debugDrawProxy:drawSphere(2, vPfront, color(255, 0, 0, 160)) end
          return true
        -- *Check 1.1.1.2: add it if it is parallel to current path-segment but there is an intersection
        else
          if traffic.intersection and intersectionFound then
            if draw then obj.debugDrawProxy:drawSphere(2, vPfront, color(255, 100, 0, 160)) end
            return true
          end
        end
      -- *Check 1.1.2: add v-vehicle if it is in front of us
      else
        v.noproj = true
        if draw then obj.debugDrawProxy:drawSphere(2, vPfront, color(0, 255, 0, 160)) end
        return true
      end
      -- *Check 1.1.3: check for v-vehicles that are coming in opposite direction and are in our lanes
      local xnormP = vPfront:xnormOnLine(n1PosLeft, n1PosRight)
      local rangeLeft, rangeRight = plan1.rangeLeft, plan1.rangeRight
      if n1.name then
        local lanes = getEdgeLaneConfig(n1.name, n2.name)
        rangeLeft, rangeRight = laneRange(lanes)
      end
      if xnormP > rangeLeft and xnormP < rangeRight then
        if draw then obj.debugDrawProxy:drawSphere(2, vPfront, color(255, 255, 255, 160)) end
        return true
      else
        return false
      end
    -- *Check 1.2: add v-vehicles if it is behind us or in an dead corner (due to path projection)
    elseif xnormFrRight < 0 or xnormFrLeft < 0 then
      if vPfront:squaredDistance(n1.posOrig) < 100 * 100 then
        if draw then obj.debugDrawProxy:drawSphere(2, vPfront, color(0, 0, 255, 160)) end
        return true
      end
    end

    -- update n1 data
    n1.name, n1.posOrig, n1.radiusOrig, n1.biNormal = n2.name, n2.posOrig, n2.radiusOrig, n2.biNormal
  end

  return false
end

local function trafficFilter_2(route, v)
  local path = route.path
  local curPlanIdx = route.plan[2].pathidx
  local pathCount = #path
  local frontChecks, rearChecks = nil, nil
  for i = 1, pathCount-1 do

    if i >= curPlanIdx then
      if tableSize(mapData.graph[path[i]]) > 2 then
        return true
      end
    end

    local pos1, pos2 = mapData:getEdgePositions(path[i], path[i+1])
    local rad1, rad2 = mapData:getEdgeRadii(path[i], path[i+1])
    local biNormal = mapmgr.surfaceNormalBelow(pos1)
    local normal = (pos2-pos1):cross(biNormal); normal:normalize()
    local laneConfig = getEdgeLaneConfig(path[i], path[i+1])
    local laneRangeLimLeft, laneRangeLimRight = laneRange(laneConfig)

    if not frontChecks then
      local longXnormFront = v.posFront:xnormOnLine(pos1, pos2)
      local latXnormFront = v.posFront:xnormOnLine(pos1, pos1 + normal * (rad1 + (rad2 - rad1) * clamp(longXnormFront, 0, 1)))
      latXnormFront = (latXnormFront + 1) * 0.5 -- maps [-1, 1] interval to [0, 1] interval
      if longXnormFront >= 0 and longXnormFront <= 1 and latXnormFront >= 0 and latXnormFront <= laneRangeLimLeft then
        frontChecks = i
      end
    end

    if not rearChecks then
      local longXnormRear = v.posRear:xnormOnLine(pos1, pos2)
      local latXnormRear = v.posRear:xnormOnLine(pos1, pos1 + normal * (rad1 + (rad2 - rad1) * clamp(longXnormRear, 0, 1)))
      latXnormRear = (latXnormRear + 1) * 0.5 -- maps [-1, 1] interval to [0, 1] interval
      if longXnormRear >= 0 and longXnormRear <= 1 and latXnormRear >= 0 and latXnormRear <= laneRangeLimLeft then
        rearChecks = i
      end
    end

    if frontChecks and rearChecks then
      return false
    end


  end

  return true
end

local function updatePlanbestRange(plan)
  for i = 1, plan.planCount do
    local n = plan[i]
    local roadHalfWidth = n.halfWidth
    local laneWidth = 2 * roadHalfWidth * (n.rangeRight - n.rangeLeft) / n.rangeLaneCount
    plan[i].rangeBestLane = clamp((n.laneLimLeft - ((2 * n.rangeLeft - 1) * roadHalfWidth)) / laneWidth, 0, n.rangeLaneCount-1)
    --print(plan[i].rangeBestLane)
  end
end

local function calculateTrafficTargetSpeed(plan, trafficTable, trafficTableLen, pmode, route)
  plan.distances = math.huge
  plan.trafficTargetSpeed = math.huge
  if trafficTableLen > 0 and plan.targetSpeed > 0 then
    local distOnPlan = - plan[1].length * plan.egoXnormOnSeg -- 0
    local segDirVec, segVx, segC, segVz, segVy = vec3(), vec3(), vec3(), vec3(), vec3()
    for i = 1, plan.planCount - 1 do
      local n1, n2 = plan[i], plan[i+1]
      distOnPlan = distOnPlan + n1.length -- distance from the ego vehicle front position to the end of the ith segment along the plan
      segDirVec:setSub2(n2.pos, n1.pos); segDirVec:setScaled(1 / (n1.length + 1e-30))

      -- Bounding box of segment [n1, n2]
      segVx:setScaled2(segDirVec, 0.5 * n1.length)
      segC:setAdd2(n1.pos, segVx)
      segVz = mapmgr.surfaceNormalBelow(segC, (n1.radiusOrig + n2.radiusOrig) * 0.25); segVz:setScaled(-1)
      segVy:setCross(segVz, segVx); segVy:setScaled(0.5 * ego.width / (segVy:length() +  1e-30)) -- 0.5 * (ego.width + 1)
      segVy:setScaled2(segVz:cross(segVx):normalized(), 0.5 * ego.width)

      for j = trafficTableLen, 1, -1 do
        local v = trafficTable[j]
        v.posMiddle, v.vx, v.vy, v.vz = getObjectBoundingBox(v.id)
        v.vx = v.vx*1.1
        v.posFront = v.posMiddle + v.vx
        v.posRear = v.posMiddle - v.vx
        v.dirVec = v.vx:normalized()
        v.length = v.vx:length() * 2
        v.width = v.vy:length() * 2
        for kk = 1, 2 do
          if kk == 2 then
            local check_ahead = (v.posFront - (ego.pos - ego.length * ego.dirVec)):dot(ego.dirVec) > 0
            if check_ahead then
              local vProj = v.vel*0.2
              v.posMiddle, v.posFront, v.posRear = v.posMiddle + vProj, v.posFront + vProj, v.posRear + vProj
              --obj.debugDrawProxy:drawSphere(0.5, v.posFront, color(0,255,0,50))
            else
              break
            end
          end

          if overlapsOBB_OBB(v.posMiddle, v.vx, v.vy, v.vz, segC, segVx, segVy, segVz) then
            local vRearXnorm, vFrontXnorm = v.posRear:xnormOnLine(n1.pos, n2.pos), v.posFront:xnormOnLine(n1.pos, n2.pos)

            plan.distances = min(distOnPlan, plan.distances)
            -- if the vehicle overlaps the first segment check if its xnorm is greater than the xnorm of the ego vehicle
            if i > 1 or max(vRearXnorm, vFrontXnorm) > plan.egoXnormOnSeg then
              local vXnorm = clamp(min(vRearXnorm, vFrontXnorm), 0, 1)
              --local ego2PlDist = max(0, distOnPlan - plan[1].length * plan.egoXnormOnSeg + clamp(vXnorm, 0, 1) * n1.length) -- if current segment length is added after the traffic table loop

              -- the ego.speed term creates a feedback loop
              -- lowering the coefficient of that term mitigates the effect of the feedback loop
              -- parts of the throttle/brake/handbrake control logic at the end of driveToTarget also seem to be creating issues when at low targetSpeed
              -- see function driveToTarget: TODO: handbrake when stoped or moving backward and TODO: handbrake when turning
              local ego2PlDist_0 = max(0, distOnPlan - (1 - vXnorm) * n1.length) --max(2.5, opt.racing and ego.speed*0.5 or ego.speed * 1)
              plan.distances = min(ego2PlDist_0, plan.distances)

              local ego2PlDist = ego2PlDist_0 - max(2.5, ego.speed * 1)
              local velProjOnSeg = v.vel:dot(segDirVec) -- max(0, v.vel:dot(segDirVec))

              --dump('dist and vel on seg', ego2PlDist, velProjOnSeg)

              local targetSpeed = max(0, abs(velProjOnSeg) * velProjOnSeg + 2 * g * min(aggression, ego.staticFrictionCoef) * ego2PlDist)

              -- might help improve the throttle/brake input stability caused by the feedback loop of the ego.speed term in ego2PlDist
              --if plan.trafficTargetSpeed < 0.25 then plan.trafficTargetSpeed = 0 end
              if plan.distances == ego2PlDist_0 then
                plan.trafficTargetSpeed = targetSpeed
                plan.trafficMinProjSpeed = velProjOnSeg
              end

            end

            table.remove(trafficTable, j)
            trafficTableLen = trafficTableLen - 1
          end

          if plan.trafficTargetSpeed == 0 then break end
        end
      end

      --distOnPlan = distOnPlan + n1.length -- distance to the end of the ith segment

      if trafficTableLen == 0 or plan.trafficTargetSpeed == 0 then -- or ego.speed * ego.speed < 2 * distOnPlan * (0.2 * ego.staticFrictionCoef * g)
        break
      end
    end
  end

  -- logic to overwrite trafficTargetSpeed in racing mode
  if opt.racing then
      -- speed difference between ego vehicle and vehicle ahead
      local dv = ego.speed - plan.trafficMinProjSpeed
      -- catching distance: distance from vehicle ahead up to which I can increase my trafficTargetSpeed in order to catch him
      ego.race.d = linearScale(dv, 0, 20, 0.5 * ego.length, 2 * ego.length)
      -- logic for emergency brake (it is not working do to false flag, need some improvements on TTC value)
      local TTC = plan.distances / max(dv, 1e-3)
      if TTC < 2 and abs(plan.trafficMinProjSpeed) < 1 then
        plan.trafficTargetSpeed = 0
      else
        -- controller for trafficTargetSpeed: it is defined by 3 terms:
        -- 1) speed of vehicle ahead on our current plan
        -- 2) boost factor in order to try to catch him. This factor increases trafficTargetSpeed up to ego.race.d distance and with an aggression defined by ego.race.Td
        -- 3) Proportional factor: useful to reduce trafficTargetSpeed when dv > 0. It acts strongly when distance is less than ego.race.d
        plan.trafficTargetSpeed = plan.trafficMinProjSpeed + max(0, (plan.distances - ego.race.d) / ego.race.Td) - ego.race.kp * max(0, dv)
      end
      plan.trafficTargetSpeed = max(plan.trafficTargetSpeed, 0)
  else
    plan.trafficTargetSpeed = sqrt(plan.trafficTargetSpeed)
  end
end

local function offsetPlan(plan, altPlan, side)
  local sideSign = side == 'right' and 1 or side == 'left' and -1 or 0
  altPlan.copy = true
  local latdisp = (1.2 * ego.width) or 3
  local margin = ego.width * 0.5
  altPlan.offset = latdisp * sideSign
  local dist = 0
  local tempVec = vec3()
  -- apply offset and update other geometrical quantities
  for i = 1, plan.planCount do
    local n = altPlan[i]
    dist = dist + (n.length or 0)
    local offset = clamp(altPlan.offset, -(plan[i].halfWidth - margin) - plan[i].lateralXnorm, (plan[i].halfWidth - margin) - plan[i].lateralXnorm)
    tempVec:setScaled2(plan[i].normal, offset)
    n.pos:setAdd(tempVec)
    n.lateralXnorm = n.lateralXnorm + offset

    if i > 1 then
      local n_1 = altPlan[i-1]
      n.vec:setSub2(n_1.pos, n.pos); n.vec.z = 0
      n.dirVec:set(n.vec); n.dirVec:normalize()
      n_1.turnDir:setSub2(n_1.dirVec, n.dirVec); n_1.turnDir:normalize()
    end
  end

  updatePlanLen(altPlan, 2, altPlan.planCount)
end

local function minimalcopyPlan(originalPlan)
  local newPlan = {}

  -- Copy array elements
  for i = 1, #originalPlan do
    local original = originalPlan[i]
    newPlan[i] = {
      pos = vec3(original.pos),
      length = original.length,
      radiusOrig = original.radiusOrig,
      normal = vec3(original.normal),
      halfWidth = original.halfWidth,
      lateralXnorm = original.lateralXnorm,
      ---
      speed = original.speed,
      posOrig = vec3(original.posOrig),
      biNormal = vec3(original.biNormal),
      dirVec = vec3(original.dirVec),
      vec = vec3(original.vec),
      rangeLeft = original.rangeLeft,
      rangeRight = original.rangeRight,
      rangeLaneCount = original.rangeLaneCount,
      rangeBestLane = original.rangeBestLane, -- Avoid ?
      pathidx = original.pathidx,
      widthMarginOffset = original.widthMarginOffset, -- Avoid ?
      curvature = original.curvature,
      turnDir = original.turnDir,   -- Avoid ?
      dispDir = original.dispDir, -- Avoid ?
      laneLimLeft = original.laneLimLeft,
      laneLimRight = original.laneLimRight,
      curvatureZ = 0,
      trafficSqVel = math.huge

    }
  end

  -- Copy plan metadata
  newPlan.planLen = originalPlan.planLen
  newPlan.planCount = originalPlan.planCount
  newPlan.egoXnormOnSeg = originalPlan.egoXnormOnSeg
  newPlan.egoSeg = originalPlan.egoSeg
  newPlan.stopSeg = math.huge
  newPlan.trafficMinProjSpeed = math.huge
  newPlan.targetSpeed = originalPlan.targetSpeed
  newPlan.trafficTargetSpeed = originalPlan.trafficTargetSpeed
  newPlan.targetSeg = originalPlan.targetSeg
  newPlan.targetPos = vec3(originalPlan.targetPos)
  newPlan.egoDeviation = originalPlan.egoDeviation
  newPlan.targetSpeedLegal = originalPlan.targetSpeedLegal -- Avoid ?

  return newPlan
end

local function side_avoidance(plan)
  plan.sideDisp = nil
  plan.dispLat = 0
  if #traffic.trafficTable > 0 then
    local dispLeft, dispRight = 0, 0
    local Lss, c_base, T_close, c_base_away, margin_static = ego.length, 0.3, 0.8, 0.3, 0.2
    local dP, dV, nvec = vec3(), vec3(), vec3()
    nvec:setScaled2(ego.rightVec, -1)

    for _, v in ipairs(traffic.trafficTable) do
      dP:setScaled2(ego.pos, -1)
      dV:setScaled2(ego.vel, -1)
      dP:setAdd(v.posFront)
      dV:setAdd(v.vel)
      local dS = dP:dot(ego.dirVec) -- longitudinal distance between ego vehicle and v-vehicle
      local dD = dP:dot(nvec)      -- lateral distance between ego vehicle and v-vehicle
      local v_rel = dV:dot(nvec)   -- lateral relative speed between ego vehicle and v-vehicle
      local a = math.exp(-square(dS / Lss)) -- Intensity factor
      --a = a > 0.05 and a or 0
      a = dS < - 1.2 * ego.length and 0 or a -- No action if other vehicle is far behind us
      local v_close = max(0, -sign(dD) * v_rel) -- Approaching speed, positive if approaching, zero otherwise
      local c_req = v_close > 0 and c_base + T_close * v_close or c_base_away -- compute desired free gap
      local half_sum = 0.5 * (ego.width + v.width) + margin_static
      local gap_free = max(0, abs(dD) - half_sum) -- compute current free gap
      local deficit = max(0, c_req - gap_free) -- compute missing free gap
      local contrib_mag = a * deficit -- scale missing free gap by intensity factor
      if contrib_mag > 0 then
        if dD >= 0 then
          dispLeft = contrib_mag > 0.05 and max(contrib_mag, dispLeft) or 0
        else
          dispRight = contrib_mag > 0.05 and max(contrib_mag, dispRight) or 0
        end
      end
    end
    plan.dispLat = dispLeft - dispRight -- store displacement. dispLat > 0 -> I want to move targetPos to the right, hence on tragetSeg.normal direction
  end
end


local function raceplanAhead(route, baseRoute, pmode)
  ----########## Intro Code #########-----
  if not route then return end

  if not route.path then
    route = createNewRoute(route)
  end
  -- load the plan that has to be updated ()
  local plan

  if pmode == 'left' then
    plan = route.planL
  elseif pmode == 'pp' then
    plan = route.planPP
  elseif pmode == 'right' then
    plan = route.planR
  else
    plan = route.plan
  end


  if baseRoute and not plan[1] then
    -- merge from base plan
    local bsrPlan = baseRoute.plan
    if bsrPlan[2] then
      local commonPathEnd
      route.path, commonPathEnd = mergePathPrefix(baseRoute.path, route.path, bsrPlan[2].pathidx)
      route.lastLaneChangeIdx = 2
      table.clear(route.laneChanges)
      route.pathLength = {0}
      if commonPathEnd >= 1 then
        local refpathidx = bsrPlan[2].pathidx - 1
        local planLen, planCount = 0, 0
        for i = 1, #bsrPlan do
          local n = bsrPlan[i]
          if n.pathidx > commonPathEnd then break end
          planLen = planLen + (n.length or 0)
          planCount = i

          plan[i] = {
            posOrig = vec3(n.posOrig),
            pos = vec3(n.pos),
            vec = vec3(n.vec),
            dirVec = vec3(n.dirVec),
            turnDir = vec3(n.turnDir),
            biNormal = vec3(n.biNormal),
            normal = vec3(n.normal),
            radiusOrig = n.radiusOrig,
            pathidx = max(1, n.pathidx-refpathidx),
            roadSpeedLimit = n.roadSpeedLimit,
            halfWidth = n.halfWidth,
            widthMarginOffset = n.widthMarginOffset,
            wayPointAhead = n.wayPointAhead,
            length = n.length,
            curvature = n.curvature,
            curvatureZ = n.curvatureZ,
            lateralXnorm = n.lateralXnorm,
            laneLimLeft = n.laneLimLeft,
            laneLimRight = n.laneLimRight,
            legalSpeed = nil,
            speed = nil,
            rangeLeft = n.rangeLeft,
            rangeRight = n.rangeRight,
            rangeLaneCount = n.rangeLaneCount,
            rangeBestLane = n.rangeBestLane,
            trafficSqVel = math.huge,
            dispDir = n.dispDir
          }
        end
        plan.planLen = planLen
        plan.planCount = planCount
        plan.egoDeviation = 0
        if plan[bsrPlan.targetSeg+1] then
          plan.targetSeg = bsrPlan.targetSeg
          plan.targetPos = vec3(bsrPlan.targetPos)
          plan.egoSeg = bsrPlan.egoSeg
          plan.egoXnormOnSeg = bsrPlan.egoXnormOnSeg
        end
      end
    end
  end

  if not plan[1] then
    local posOrig = vec3(ego.pos)
    local radiusOrig = 2
    local normal = vec3(0, 0, 0)
    local latXnorm = 0
    local rangeLeft, rangeRight, rangeBestLane = 0, 1, 0
    local laneLimLeft, laneLimRight = -ego.width * 0.5, ego.width * 0.5
    local biNormal = mapmgr.surfaceNormalBelow(ego.pos, ego.width * 0.5); biNormal:setScaled(-1)
    local wp, lanes, roadSpeedLimit
    if ego.currentSegment[1] and ego.currentSegment[2] then
      local wp1 = route.path[1]
      local wp2
      if wp1 == ego.currentSegment[1] then
        wp2 = ego.currentSegment[2]
      elseif wp1 == ego.currentSegment[2] then
        wp2 = ego.currentSegment[1]
      end
      if wp2 and route.path[2] ~= wp2 then
        -- local pos1 = mapData.positions[wp1]
        -- local pos2 = mapData.positions[wp2]
        local pos1, pos2 = mapData:getEdgePositions(wp1, wp2)
        local xnorm = ego.pos:xnormOnLine(pos2, pos1)
        if xnorm >= 0 and xnorm <= 1 then
          local rad1, rad2 = mapData:getEdgeRadii(wp1, wp2)
          local rad = lerp(rad2, rad1, xnorm)
          posOrig = linePointFromXnorm(pos2, pos1, xnorm)
          normal:setCross(biNormal, pos1 - pos2); normal:normalize()
          radiusOrig = rad
          wp = wp2
          roadSpeedLimit = mapData.graph[wp1][wp2].speedLimit
          latXnorm = ego.pos:xnormOnLine(posOrig, posOrig + normal)
          laneLimLeft = latXnorm - ego.width * 0.5 -- TODO: rethink the limits here
          laneLimRight = latXnorm + ego.width * 0.5
          if opt.driveInLaneFlag then
            lanes = getEdgeLaneConfig(wp2, wp1)
            rangeLeft, rangeRight = laneRange(lanes)

            local normalizedLatXnorm = (latXnorm / radiusOrig + 1) * 0.5
            local normalizedLaneLimLeft = (laneLimLeft / radiusOrig + 1) * 0.5
            local normalizedLaneLimRight = (laneLimRight / radiusOrig + 1) * 0.5

            local bestLane
            bestLane, normalizedLaneLimLeft, normalizedLaneLimRight = getBestLane(lanes, normalizedLatXnorm, normalizedLaneLimLeft, normalizedLaneLimRight)

            local _, _, rangeLeftIdx, rangeRightIdx = getLaneRangeFromLane(lanes, bestLane)
            rangeBestLane = bestLane - rangeLeftIdx -- bestLane - rangeRightIdx

            laneLimLeft = (normalizedLaneLimLeft * 2 - 1) * radiusOrig
            laneLimRight = (normalizedLaneLimRight * 2 - 1) * radiusOrig
            latXnorm = (laneLimLeft + laneLimRight) * 0.5
          end
        end
      end
    end

    local rangeLaneCount = lanes and numOfLanesInDirection(lanes, ""+"") or 1 -- numOfLanesFromRadius(radiusOrig)
    local vec = vec3(-8 * ego.dirVec.x, -8 * ego.dirVec.y, 0)

    plan[1] = {
      posOrig = posOrig,
      pos = vec3(ego.pos),
      vec = vec,
      dirVec = vec:normalized(),
      turnDir = vec3(0,0,0),
      biNormal = biNormal,
      normal = normal,
      radiusOrig = radiusOrig,
      widthMarginOffset = 0,
      length = 0,
      curvature = 0,
      curvatureZ = 0,
      halfWidth = radiusOrig,
      lateralXnorm = latXnorm,
      laneLimLeft = laneLimLeft,
      laneLimRight = laneLimRight,
      rangeLeft = rangeLeft,
      rangeRight = rangeRight,
      rangeLaneCount = rangeLaneCount,
      rangeBestLane = rangeBestLane,
      pathidx = nil,
      roadSpeedLimit = roadSpeedLimit,
      legalSpeed = nil,
      speed = nil,
      wp = wp,
      trafficSqVel = math.huge,
      dispDir = 0
    }

    plan.planCount = 1
    plan.planLen = 0
    plan.egoXnormOnSeg = 0
    plan.egoDeviation = 0
  end

  -- estimate of the stopping distance assuming 0.2 g longitudinal acceleration
  local minPlanLen = clamp(0.5 * ego.speed * ego.speed / (0.2 * g), 40, 400)

  --profilerPushEvent(""ai_buildPlan"")
  while not plan[MIN_PLAN_COUNT] or (plan.planLen - plan.egoXnormOnSeg * plan[1].length) < minPlanLen do -- TODO: (plan.planLen < minPlanLen and plan.stopSeg + 1 == plan.planCount)
    local n = buildNextRoute(route, plan)
    if not n then break end
    plan.planCount = plan.planCount + 1
    plan[plan.planCount] = n
    plan[plan.planCount-1].length = n.pos:distance(plan[plan.planCount-1].pos)
    plan.planLen = plan.planLen + plan[plan.planCount-1].length
  end
  --profilerPopEvent(""ai_buildPlan"")

  if not plan[2] then return end
  if not plan[1].pathidx then
    plan[1].pathidx = plan[2].pathidx
    plan[1].roadSpeedLimit = plan[2].roadSpeedLimit
  end

  -- Calculate the length of the path at each path node one segment per call of planAhead
  if not route.pathLength[#route.path] then
    local n = #route.pathLength
    route.pathLength[n+1] = mapData.positions[route.path[n+1]]:distance(mapData.positions[route.path[max(1, n)]]) + route.pathLength[n]
  end

  -- subdivide plan segments that are longer than some (distance dependent) length.
  -- i.e. whether a segment will be subdivided depends on its distance (path length) from the start of the plan.
  -- at the minimum a segment will be subdivided if it is longer than 6m.
  -- Performs at most one subdivision per call of planAhead.
  local distOnPlan = 0
  --profilerPushEvent(""ai_trajectory_splitting"")
  for i = 1, plan.planCount - 1 do
    local segLenSq = plan[i].posOrig:squaredDistance(plan[i+1].posOrig)
    local xSq = square(distOnPlan)
    if min(segLenSq, square(plan[i].length)) > square(min(220, (25e-8 * xSq + 1e-5) * xSq + 6)) and distOnPlan < 550 then
      local n1, n2 = plan[i], plan[i+1]

      local posOrig = n1.posOrig + n2.posOrig; posOrig:setScaled(0.5)
      local radiusOrig = (n1.radiusOrig + n2.radiusOrig) * 0.5 -- TODO: this might be inacurate since posOrig might not be halfway between n1.posOrig and n2.posOrig

      local biNormal = mapmgr.surfaceNormalBelow(posOrig, radiusOrig * 0.5); biNormal:setScaled(-1)

      -- Interpolated normals
      local normal = vec3()
      if segLenSq > square(2 * radiusOrig + n1.radiusOrig + n2.radiusOrig) then
        -- calculate normal from the direction vector of edge (i, i+1)
        normal:setSub2(plan[i+1].pos, plan[i].pos)
        normal:setCross(biNormal, normal)
        normal:normalize()
      else
        -- calculate from adjacent normals
        local norm1 = plan[i].normal:cross(biNormal)
        norm1:setCross(biNormal, norm1); norm1:normalize()
        local norm2 = plan[i+1].normal:cross(biNormal)
        norm2:setCross(biNormal, norm2); norm2:normalize()
        normal:setAdd2(norm1, norm2)
        normal:setScaled(1 / (normal:length() + 1e-30))
      end

      local pos = n1.pos + n2.pos; pos:setScaled(0.5)
      local vec = n1.pos - pos; vec.z = 0
      local dirVec = vec:normalized()

      local _, t2 = closestLinePoints(pos, pos + normal, n1.posOrig, n2.posOrig)
      posOrig = linePointFromXnorm(n1.posOrig, n2.posOrig, t2)
      local edgeNormal = biNormal:cross(n2.posOrig - n1.posOrig); edgeNormal:normalize()
      local _, t2 = closestLinePoints(posOrig, posOrig + normal, plan[i].posOrig + plan[i].radiusOrig * edgeNormal, plan[i+1].posOrig + plan[i+1].radiusOrig * edgeNormal)
      local limPos = linePointFromXnorm(plan[i].posOrig + plan[i].radiusOrig * edgeNormal, plan[i+1].posOrig + plan[i+1].radiusOrig * edgeNormal, max(0, min(1, t2)))
      local roadHalfWidth = posOrig:distance(limPos)
      local lateralXnorm = pos:xnormOnLine(posOrig, limPos) * roadHalfWidth -- [-r, r]

      n1.length = n1.length * 0.5

      n2.vec:set(vec)
      n2.dirVec:set(dirVec)

      --local laneLimLeft = (n1.laneLimLeft / (n1.radiusOrig * n1.chordLength) + n2.laneLimLeft / (n2.radiusOrig * n2.chordLength)) * 0.5 * roadHalfWidth
      --local laneLimRight = (n1.laneLimRight / (n1.radiusOrig * n1.chordLength) + n2.laneLimRight / (n2.radiusOrig * n2.chordLength)) * 0.5 * roadHalfWidth

      local rangeLeft = (n1.rangeLeft + n2.rangeLeft) * 0.5 -- lane range left boundary lateral coordinate in [0, 1]. 0 is left road boundary: always 0 when driveInLane is off
      local rangeRight = (n1.rangeRight + n2.rangeRight) * 0.5 -- lane range right boundary lateral coordinate in [0, 1]. 1 is right road boundary: always 1 when driveInLane is off
      local rangeLaneCount = (n1.rangeLaneCount + n2.rangeLaneCount) * 0.5 -- number of lanes in the range: always 1 when driveInLane is off

      local laneWidth = (rangeRight - rangeLeft) / rangeLaneCount -- self explanatory: entire width of the road when driveInLane is off i.e. 1
      local rangeBestLane = (n1.rangeBestLane + n2.rangeBestLane) * 0.5 -- best lane in the range: only one lane to pick from when driveInLane is off

      local laneLimLeft = linearScale(rangeLeft + rangeBestLane * laneWidth, 0, 1, -roadHalfWidth, roadHalfWidth) -- lateral coordinate of left boundary of lane rescaled to the road half width
      local laneLimRight = linearScale(rangeLeft + (rangeBestLane + 1) * laneWidth, 0, 1, -roadHalfWidth, roadHalfWidth) -- lateral coordinate of right boundary of lane rescaled to the road half width

      local roadSpeedLimit
      if n2.pathidx > 1 then
        roadSpeedLimit = mapData.graph[route.path[n2.pathidx]][route.path[n2.pathidx-1]].speedLimit
      else
        roadSpeedLimit = n2.roadSpeedLimit
      end

      if plan.stopSeg >= i + 1 then
        plan.stopSeg = plan.stopSeg + 1
      end

      local manSpeed
      if n1.manSpeed and n2.manSpeed then
        manSpeed = (n1.manSpeed + n2.manSpeed) * 0.5
      end

      tableInsert(plan, i+1, {
        posOrig = posOrig,
        pos = pos,
        vec = vec,
        dirVec = dirVec,
        turnDir = vec3(0, 0, 0),
        biNormal = biNormal,
        normal = normal,
        radiusOrig = radiusOrig,
        pathidx = n2.pathidx,
        roadSpeedLimit = roadSpeedLimit,
        halfWidth = roadHalfWidth,
        widthMarginOffset = (n1.widthMarginOffset + n2.widthMarginOffset) * 0.5,
        laneLimLeft = laneLimLeft,
        laneLimRight = laneLimRight,
        rangeLeft = rangeLeft,
        rangeRight = rangeRight,
        rangeLaneCount = rangeLaneCount,
        rangeBestLane = rangeBestLane, -- 0 Indexed
        length = n1.length,
        curvature = (n1.curvature + n2.curvature) * 0.5,
        curvatureZ = 0,
        lateralXnorm = lateralXnorm,
        legalSpeed = nil,
        manSpeed = manSpeed,
        speed = nil,
        trafficSqVel = math.huge,
        dispDir = 0
      })

      if n1.lanesOpen and n2.lanesOpen then
        openLaneToLaneRange(plan[i+1])
      end

      plan.planCount = plan.planCount + 1
      break
    end
    distOnPlan = distOnPlan + sqrt(segLenSq)
  end
  --profilerPopEvent(""ai_trajectory_splitting"")
  distOnPlan = nil

  if plan.targetSeg == nil then
    calculateTarget(plan)
  end

  ----#### Populate Traffic Table ####----
  table.clear(traffic.trafficTable)
  for plID, v in pairs(mapmgr.getObjects()) do
    if plID ~= objectId and (M.mode ~= 'chase' or plID ~= player.id or internalState.chaseData.playerState == 'stopped') then
      v.targetType = (player and plID == player.id) and M.mode
      if opt.avoidCars == 'on' or v.targetType == 'follow' then
        v.length = obj:getObjectInitialLength(plID) + 0.3
        v.width = obj:getObjectInitialWidth(plID)
        local posFront = obj:getObjectFrontPosition(plID)
        local dirVec = v.dirVec
        v.posFront = dirVec * 0.3 + posFront
        v.posRear = dirVec * (-v.length) + posFront
        v.posMiddle = (v.posFront + v.posRear) * 0.5
        local egoRear = ego.pos - ego.dirVec * ego.length
        local ego2v = v.posFront - egoRear
        table.insert(traffic.trafficTable, v)
      end
    end
  end
  plan.trafficMinProjSpeed = math.huge

  ----#### Side avoidance pt. 1####----
  plan.sideDisp = nil
  if pmode == 'pp' then
    side_avoidance(plan) -- compute displacement
    -- apply limited displacement by modifying the current plan (useful to avoid cars being stuck side by side when touching)
    if plan.dispLat ~= 0 then
      plan.sideDisp = true
      local sideDisp = plan.dispLat -- (sideDisp > 0) means v-vehicle is on our left side and ego should move right
      sideDisp = min(dt * parameters.awarenessForceCoef * 10, abs(sideDisp)) * sign2(sideDisp) -- limited displacement per frame
      local curDist = 0
      local lastPlanIdx = 2
      local targetDist = square(ego.speed) / (2 * g * aggression) + max(30, ego.speed * 3) -- longer adjustment at higher speeds
      local tmpVec = vec3()
      for i = 1, plan.planCount - 1 do
        openLaneToLaneRange(plan[i])
        plan[i].lateralXnorm = clamp(plan[i].lateralXnorm + sideDisp * (targetDist - curDist) / targetDist, plan[i].laneLimLeft - ego.width * 0.6, plan[i].laneLimRight + ego.width * 0.6)
        tmpVec:setScaled2(plan[i].normal, plan[i].lateralXnorm)
        plan[i].pos:setAdd2(plan[i].posOrig, tmpVec)
        curDist = curDist + (i > 1 and plan[i - 1].length or 0)
        lastPlanIdx = i

        if i > 1 then
         plan[i].vec:setSub2(plan[i-1].pos, plan[i].pos); plan[i].vec.z = 0
        end
        plan[i].dirVec:set(plan[i].vec)
        plan[i].dirVec:normalize()

        if curDist > targetDist then break end
      end

      updatePlanLen(plan, 2, lastPlanIdx + 1)
    end
  end

  plan.hitLimit = false
  -- detect if plan is moved to close to road limit
  if pmode == 'pp' then
    plan.hitLimit = min(abs((abs(plan[2].lateralXnorm) - plan[2].halfWidth)), abs((abs(plan[1].lateralXnorm) - plan[1].halfWidth))) / (0.5 * ego.width) < 1
  end
  -- calculate spring forces
  ------######### Compute Forces ########---------
  --profilerPushEvent(""ai_calculate_smoothing"")
  for i = 0, plan.planCount do
    if forces[i] then
      if pmode == 'pp' and route.plan_index and i > 0 and currentRoute.offset then
        forces[i] = plan[i].normal * currentRoute.offset
      else
        forces[i]:set(0,0,0)
      end
    else
      forces[i] = vec3()
    end
  end

  local nforce = vec3()

  for i = 1, plan.planCount-1 do
    local n1 = plan[i]
    local v1 = n1.dirVec
    local v2 = plan[i+1].dirVec

    n1.turnDir:setSub2(v1, v2); n1.turnDir:normalize()
    nforce:setScaled2(n1.turnDir, (1-twt.state) * max(1 - v1:dot(v2), 0) * parameters.turnForceCoef)

    forces[i+1]:setSub(nforce)
    forces[i-1]:setSub(nforce)
    nforce:setScaled(2)
    forces[i]:setAdd(nforce)
  end

  --profilerPopEvent(""ai_calculate_smoothing"")

  ------######### Smoothing ##########----------
  --profilerPushEvent(""ai_smoothness_integration"")
  local tmpVec = vec3()
  local roadWidthMargin = ego.width * 0.6
  local laneWidthMargin = ego.width * 0.6
  local forceMagLim = parameters.springForceIntegratorDispLim
  local skipLast = 1
  for i = 2, plan.planCount-skipLast do
    local n = plan[i]
    local roadHalfWidth = n.halfWidth

    -- Calculate node displacement: avoids switching displacement direction (sign) in concecutive frames
    local displacement = max(min(n.normal:dot(forces[i]), forceMagLim), -forceMagLim)
    displacement = displacement * max(min(displacement * n.dispDir * math.huge, 1), 0) -- second term returns 0 if (displacement * n.dispDir) is negative, 1 otherwise.
    n.dispDir = sign(displacement)

    local roadLimRight = max(0, roadHalfWidth - roadWidthMargin) -- should be non-negative (zero or positive)
    local newLateralXnorm = clamp(n.lateralXnorm + displacement,
      max(n.laneLimLeft + laneWidthMargin, -roadLimRight) + max(0, plan.offset or 0) ,
      min(n.laneLimRight - laneWidthMargin, roadLimRight) + min(0, plan.offset or 0))

    tmpVec:setScaled2(n.normal, newLateralXnorm - n.lateralXnorm)
    n.pos:setAdd(tmpVec) -- remember that posOrig and pos are not alligned along the normal
    n.vec:setSub2(plan[i-1].pos, n.pos); n.vec.z = 0
    n.dirVec:set(n.vec); n.dirVec:normalize()

    n.lateralXnorm = newLateralXnorm
  end
  --profilerPopEvent(""ai_smoothness_integration"")

  updatePlanLen(plan, 2, plan.planCount)

  -------########## Error Distribution ##########---------
  --profilerPopEvent(""ai_error_smoother"")
  if pmode == 'pp' then -- adjust plan error for current plan
    uniformPlanErrorDistribution(plan)
  end

  calculateTarget(plan)

  -- ######side avoidance pt. 2####### --
  if plan.sideDisp and not plan.hitLimit then
    -- move targetPos to ensure a side avoidance actions in terms of steering (pt. 1 is not moving it too much due to limited displacement per frame)
    local targetNode = plan[plan.targetSeg]
    local newdisp = clamp(targetNode.lateralXnorm + plan.dispLat,
      max(targetNode.laneLimLeft + laneWidthMargin, -max(0, targetNode.halfWidth - roadWidthMargin)),
      min(targetNode.laneLimRight - laneWidthMargin, max(0, targetNode.halfWidth - roadWidthMargin)))
    local dispLat = newdisp - targetNode.lateralXnorm
    plan.targetPos = plan.targetPos + plan[plan.targetSeg].normal * dispLat
  end
  --profilerPopEvent(""ai_calculate_target"")

  -----###### calculate node horizontal curvature ######------
  --profilerPushEvent(""ai_calculate_curvature"")
  local len, n3vec = 0, vec3()
  plan[1].curvature = plan[1].curvature or inCurvature(plan[1].vec, plan[2].vec)
  for i = 2, plan.planCount - 1 do
    local n1, n2 = plan[i], plan[i+1]

    n3vec:setSub2(n1.pos, plan[min(plan.planCount, i+2)].pos); n3vec.z = 0

    local c1 = inCurvature(n1.vec, n2.vec)
    local c2 = inCurvature(n1.vec, n3vec)

    local curvature
    if c1 <= c2 then
      curvature = sign2(n1.turnDir:dot(n1.normal)) * c1
    else
      curvature = sign2((n1.vec):dot(n1.normal) - n3vec:dot(n1.normal)) * c2
    end

    -- calculate curvature temporal smoothing parameter as a function of the trajectory length distance
    local curvatureRateDt = min(5 + 0.005 * len * len, 100) * dt
    n1.curvature = n1.curvature + (curvature - n1.curvature) * curvatureRateDt / (1 + curvatureRateDt)

    len = len + n1.length
  end
  --profilerPopEvent(""ai_calculate_curvature"")

  ------######## Speed Planning ########-----
  local totalAccel = min(aggression, ego.staticFrictionCoef) * g

  local lastNode = plan[plan.planCount]
  if route.path[lastNode.pathidx+1] or (loopPath and noOfLaps and noOfLaps > 1) then
    if plan.stopSeg <= plan.planCount then
      lastNode.speed = 0
    else
      lastNode.speed = lastNode.manSpeed or sqrt(2 * 550 * totalAccel) -- shouldn't this be calculated based on the path length remaining?
    end
  else
    lastNode.speed = lastNode.manSpeed or 0
  end
  lastNode.roadSpeedLimit = plan[plan.planCount-1].roadSpeedLimit
  lastNode.legalSpeed = min(lastNode.roadSpeedLimit or math.huge, lastNode.speed)

  -- Use Backward or Forward + Backward algorithm
  --profilerPushEvent('ai_speedProfile')
  local gT = vec3()
  for i = 1, plan.planCount-1 do -- curvature is not defined on the last plan node
    local n1, n2 = plan[i], plan[i+1]
    -- consider inclination
    gT:setSub2(n2.pos, n1.pos); gT:setScaled(gravityDir:dot(gT) / max(square(n1.length), 1e-30)) -- gravity vec parallel to road segment: positive when downhill
    local gN = gravityDir:distance(gT) -- gravity component normal to road segment
    n1.acc_max = totalAccel * gN
    n1.speed = min(n1.acc_max / max(abs(n1.curvature), 1e-30), gN * g / max(n1.curvatureZ, 1e-30)) -- available centripetal acceleration * radius
  end
  plan[plan.planCount].acc_max = plan[plan.planCount-1].acc_max

  if speedProfileMode == 'ForwBack' then
    solver_f_acc_profile(plan)
  end

  solver_b_acc_profile(plan)

  --profilerPopEvent('ai_speedProfile')

  plan.targetSpeed = plan[1].speed + max(0, plan.egoXnormOnSeg) * (plan[2].speed - plan[1].speed)
  plan.targetSpeed = targetSpeedSmoother:get(plan.targetSpeed, dt)
  if M.speedMode == 'legal' then
    plan.targetSpeedLegal = plan[1].legalSpeed + max(0, plan.egoXnormOnSeg) * (plan[2].legalSpeed - plan[1].legalSpeed)
  else
    plan.targetSpeedLegal = math.huge
  end

  calculateTrafficTargetSpeed(plan, traffic.trafficTable, #traffic.trafficTable, pmode, route)
  plan.originaltargetSpeed = plan.targetSpeed -- save target speed computed by geometry only
  plan.targetSpeed = min(plan.targetSpeed, plan.trafficTargetSpeed)

  ------######## Return #########--------
  return route
end

local function planAhead(route, baseRoute)
  if not route then return end

  if not route.path then
    route = createNewRoute(route)
  end

  local plan = route.plan

  if baseRoute and not plan[1] then
    -- merge from base plan
    local bsrPlan = baseRoute.plan
    if bsrPlan[2] then
      local commonPathEnd
      route.path, commonPathEnd = mergePathPrefix(baseRoute.path, route.path, bsrPlan[2].pathidx)
      route.lastLaneChangeIdx = 2
      table.clear(route.laneChanges)
      route.pathLength = {0}
      if commonPathEnd >= 1 then
        local refpathidx = bsrPlan[2].pathidx - 1
        local planLen, planCount = 0, 0
        for i = 1, #bsrPlan do
          local n = bsrPlan[i]
          if n.pathidx > commonPathEnd then break end
          planLen = planLen + (n.length or 0)
          planCount = i

          plan[i] = {
            posOrig = vec3(n.posOrig),
            pos = vec3(n.pos),
            vec = vec3(n.vec),
            dirVec = vec3(n.dirVec),
            turnDir = vec3(n.turnDir),
            biNormal = vec3(n.biNormal),
            normal = vec3(n.normal),
            radiusOrig = n.radiusOrig,
            pathidx = max(1, n.pathidx-refpathidx),
            roadSpeedLimit = n.roadSpeedLimit,
            halfWidth = n.halfWidth,
            widthMarginOffset = n.widthMarginOffset,
            wayPointAhead = n.wayPointAhead,
            length = n.length,
            curvature = n.curvature,
            curvatureZ = n.curvatureZ,
            lateralXnorm = n.lateralXnorm,
            laneLimLeft = n.laneLimLeft,
            laneLimRight = n.laneLimRight,
            legalSpeed = nil,
            speed = nil,
            rangeLeft = n.rangeLeft,
            rangeRight = n.rangeRight,
            rangeLaneCount = n.rangeLaneCount,
            rangeBestLane = n.rangeBestLane,
            trafficSqVel = math.huge,
            dispDir = n.dispDir
          }
        end
        plan.planLen = planLen
        plan.planCount = planCount
        plan.egoDeviation = 0
        if plan[bsrPlan.targetSeg+1] then
          plan.targetSeg = bsrPlan.targetSeg
          plan.targetPos = vec3(bsrPlan.targetPos)
          plan.egoSeg = bsrPlan.egoSeg
          plan.egoXnormOnSeg = bsrPlan.egoXnormOnSeg
        end
      end
    end
  end

  if not plan[1] then
    local posOrig = vec3(ego.pos)
    local radiusOrig = 2
    local normal = vec3(0, 0, 0)
    local latXnorm = 0
    local rangeLeft, rangeRight, rangeBestLane = 0, 1, 0
    local laneLimLeft, laneLimRight = -ego.width * 0.5, ego.width * 0.5
    local biNormal = mapmgr.surfaceNormalBelow(ego.pos, ego.width * 0.5); biNormal:setScaled(-1)
    local wp, lanes, roadSpeedLimit
    if ego.currentSegment[1] and ego.currentSegment[2] then
      local wp1 = route.path[1]
      local wp2
      if wp1 == ego.currentSegment[1] then
        wp2 = ego.currentSegment[2]
      elseif wp1 == ego.currentSegment[2] then
        wp2 = ego.currentSegment[1]
      end
      if wp2 and route.path[2] ~= wp2 then
        -- local pos1 = mapData.positions[wp1]
        -- local pos2 = mapData.positions[wp2]
        local pos1, pos2 = mapData:getEdgePositions(wp1, wp2)
        local xnorm = ego.pos:xnormOnLine(pos2, pos1)
        if xnorm >= 0 and xnorm <= 1 then
          local rad1, rad2 = mapData:getEdgeRadii(wp1, wp2)
          local rad = lerp(rad2, rad1, xnorm)
          posOrig = linePointFromXnorm(pos2, pos1, xnorm)
          normal:setCross(biNormal, pos1 - pos2); normal:normalize()
          radiusOrig = rad
          wp = wp2
          roadSpeedLimit = mapData.graph[wp1][wp2].speedLimit
          latXnorm = ego.pos:xnormOnLine(posOrig, posOrig + normal)
          laneLimLeft = latXnorm - ego.width * 0.5 -- TODO: rethink the limits here
          laneLimRight = latXnorm + ego.width * 0.5
          if opt.driveInLaneFlag then
            lanes = getEdgeLaneConfig(wp2, wp1)
            rangeLeft, rangeRight = laneRange(lanes)

            local normalizedLatXnorm = (latXnorm / radiusOrig + 1) * 0.5
            local normalizedLaneLimLeft = (laneLimLeft / radiusOrig + 1) * 0.5
            local normalizedLaneLimRight = (laneLimRight / radiusOrig + 1) * 0.5

            local bestLane
            bestLane, normalizedLaneLimLeft, normalizedLaneLimRight = getBestLane(lanes, normalizedLatXnorm, normalizedLaneLimLeft, normalizedLaneLimRight)

            local _, _, rangeLeftIdx, rangeRightIdx = getLaneRangeFromLane(lanes, bestLane)
            rangeBestLane = bestLane - rangeLeftIdx -- bestLane - rangeRightIdx

            laneLimLeft = (normalizedLaneLimLeft * 2 - 1) * radiusOrig
            laneLimRight = (normalizedLaneLimRight * 2 - 1) * radiusOrig
            latXnorm = (laneLimLeft + laneLimRight) * 0.5
          end
        end
      end
    end

    local rangeLaneCount = lanes and numOfLanesInDirection(lanes, ""+"") or 1 -- numOfLanesFromRadius(radiusOrig)
    local vec = vec3(-8 * ego.dirVec.x, -8 * ego.dirVec.y, 0)

    plan[1] = {
      posOrig = posOrig,
      pos = vec3(ego.pos),
      vec = vec,
      dirVec = vec:normalized(),
      turnDir = vec3(0,0,0),
      biNormal = biNormal,
      normal = normal,
      radiusOrig = radiusOrig,
      widthMarginOffset = 0,
      length = 0,
      curvature = 0,
      curvatureZ = 0,
      halfWidth = radiusOrig,
      lateralXnorm = latXnorm,
      laneLimLeft = laneLimLeft,
      laneLimRight = laneLimRight,
      rangeLeft = rangeLeft,
      rangeRight = rangeRight,
      rangeLaneCount = rangeLaneCount,
      rangeBestLane = rangeBestLane,
      pathidx = nil,
      roadSpeedLimit = roadSpeedLimit,
      legalSpeed = nil,
      speed = nil,
      wp = wp,
      trafficSqVel = math.huge,
      dispDir = 0
    }

    plan.planCount = 1
    plan.planLen = 0
    plan.egoXnormOnSeg = 0
    plan.egoDeviation = 0
  end

  local minPlanLen
  if M.mode == 'traffic' then
    minPlanLen = getMinPlanLen(20, ego.speed, 0.2 * ego.staticFrictionCoef) -- 0.25 * min(aggression, ego.staticFrictionCoef)
  else
    minPlanLen = getMinPlanLen(40)
  end

  --profilerPushEvent(""ai_buildPlan"")
  while not plan[MIN_PLAN_COUNT] or (plan.planLen - (plan.egoXnormOnSeg or 0) * plan[1].length) < minPlanLen do -- TODO: (plan.planLen < minPlanLen and plan.stopSeg + 1 == plan.planCount)
    local n = buildNextRoute(route)
    if not n then break end
    plan.planCount = plan.planCount + 1
    plan[plan.planCount] = n
    plan[plan.planCount-1].length = n.pos:distance(plan[plan.planCount-1].pos)
    plan.planLen = plan.planLen + plan[plan.planCount-1].length
  end
  --profilerPopEvent(""ai_buildPlan"")

  if not plan[2] then return end
  if not plan[1].pathidx then
    plan[1].pathidx = plan[2].pathidx
    plan[1].roadSpeedLimit = plan[2].roadSpeedLimit
  end

  -- Calculate the length of the path at each path node one segment per call of planAhead
  if not route.pathLength[#route.path] then
    local n = #route.pathLength
    table.insert(
      route.pathLength,
      mapData.positions[route.path[n+1]]:distance(mapData.positions[route.path[max(1, n)]]) + route.pathLength[n]
    )
  end

  -- check path node at lastLaneChangeIdx for a possible lane change
  --profilerPushEvent(""ai_find_LaneChanges"")
  if route.lastLaneChangeIdx < #route.path then
    local wp1, wp2
    if route.lastLaneChangeIdx == 1 then
      wp2 = route.path[route.lastLaneChangeIdx]
      if plan[1].wp and (plan[1].wp ~= wp2) then
        wp1 = plan[1].wp
      else
        --wp1 not found: safeguard
        route.lastLaneChangeIdx = 2
        wp1, wp2 = route.path[route.lastLaneChangeIdx-1], route.path[route.lastLaneChangeIdx]
      end
    else
      wp1, wp2 = route.path[route.lastLaneChangeIdx-1], route.path[route.lastLaneChangeIdx]
    end
    if route.lastLaneChangeIdx < #route.path then
      if numOfLanesInDirection(getEdgeLaneConfig(wp1, wp2), '+') > 1 then
        local minNode = roadNaturalContinuation(wp1, wp2)
        local wp3 = route.path[route.lastLaneChangeIdx+1]
        if minNode and minNode ~= wp3 then -- road natural continuation at wp2 is not in our path
          local minNodePos, wp2Pos_2 = mapData:getEdgePositions(minNode, wp2)
          local minNodeEdgeVec = minNodePos - wp2Pos_2
          local wp1Pos, wp2Pos_1 = mapData:getEdgePositions(wp1, wp2)
          local wp1TOwp2EdgeVec = wp2Pos_1 - wp1Pos
          if minNodeEdgeVec:dot(wp1TOwp2EdgeVec) > 0 then -- road natural continuation is up to 90 deg
            local edgeNormal = gravityDir:cross(minNodePos - wp2Pos_2):normalized()
            local wp3Pos = mapData:getEdgePositions(wp3, wp2)
            local side = sign2(edgeNormal:dot(wp3Pos) - edgeNormal:dot(minNodePos))
            table.insert(route.laneChanges, {pathIdx = route.lastLaneChangeIdx, side = side, alternate = minNode})
          end
        end
      end
      route.lastLaneChangeIdx = route.lastLaneChangeIdx + 1
    end
  end
  --profilerPopEvent(""ai_find_LaneChanges"")

  local distOnPlan = 0
  --profilerPushEvent(""ai_trajectory_splitting"")
  for i = 1, plan.planCount-1 do
    local segLenSq = plan[i].posOrig:squaredDistance(plan[i+1].posOrig)
    local xSq = square(distOnPlan)
    if min(segLenSq, square(plan[i].length)) > square(min(220, (25e-8 * xSq + 1e-5) * xSq + 6)) and distOnPlan < 550 then
      local n1, n2 = plan[i], plan[i+1]

      local posOrig = n1.posOrig + n2.posOrig; posOrig:setScaled(0.5)
      local radiusOrig = (n1.radiusOrig + n2.radiusOrig) * 0.5 -- TODO: this might be inacurate since posOrig might not be halfway between n1.posOrig and n2.posOrig

      local biNormal = mapmgr.surfaceNormalBelow(posOrig, radiusOrig * 0.5); biNormal:setScaled(-1)

      -- Interpolated normals
      local normal = vec3()
      if segLenSq > square(2 * radiusOrig + n1.radiusOrig + n2.radiusOrig) then
        -- calculate normal from the direction vector of edge (i, i+1)
        normal:setSub2(plan[i+1].pos, plan[i].pos)
        normal:setCross(biNormal, normal)
        normal:normalize()
      else
        -- calculate from adjacent normals
        local norm1 = plan[i].normal:cross(biNormal)
        norm1:setCross(biNormal, norm1); norm1:normalize()
        local norm2 = plan[i+1].normal:cross(biNormal)
        norm2:setCross(biNormal, norm2); norm2:normalize()
        normal:setAdd2(norm1, norm2)
        normal:setScaled(1 / (normal:length() + 1e-30))
      end

      local pos = n1.pos + n2.pos; pos:setScaled(0.5)
      local vec = n1.pos - pos; vec.z = 0
      local dirVec = vec:normalized()

      local _, t2 = closestLinePoints(pos, pos + normal, n1.posOrig, n2.posOrig)
      posOrig = linePointFromXnorm(n1.posOrig, n2.posOrig, t2)
      local edgeNormal = biNormal:cross(n2.posOrig - n1.posOrig); edgeNormal:normalize()
      local _, t2 = closestLinePoints(posOrig, posOrig + normal, plan[i].posOrig + plan[i].radiusOrig * edgeNormal, plan[i+1].posOrig + plan[i+1].radiusOrig * edgeNormal)
      local limPos = linePointFromXnorm(plan[i].posOrig + plan[i].radiusOrig * edgeNormal, plan[i+1].posOrig + plan[i+1].radiusOrig * edgeNormal, max(0, min(1, t2)))
      local roadHalfWidth = posOrig:distance(limPos)
      local lateralXnorm = pos:xnormOnLine(posOrig, limPos) * roadHalfWidth -- [-r, r]

      n1.length = n1.length * 0.5

      n2.vec:set(vec)
      n2.dirVec:set(dirVec)

      --local laneLimLeft = (n1.laneLimLeft / (n1.radiusOrig * n1.chordLength) + n2.laneLimLeft / (n2.radiusOrig * n2.chordLength)) * 0.5 * roadHalfWidth
      --local laneLimRight = (n1.laneLimRight / (n1.radiusOrig * n1.chordLength) + n2.laneLimRight / (n2.radiusOrig * n2.chordLength)) * 0.5 * roadHalfWidth

      local rangeLeft = (n1.rangeLeft + n2.rangeLeft) * 0.5 -- lane range left boundary lateral coordinate in [0, 1]. 0 is left road boundary: always 0 when driveInLane is off
      local rangeRight = (n1.rangeRight + n2.rangeRight) * 0.5 -- lane range right boundary lateral coordinate in [0, 1]. 1 is right road boundary: always 1 when driveInLane is off
      local rangeLaneCount = (n1.rangeLaneCount + n2.rangeLaneCount) * 0.5 -- number of lanes in the range: always 1 when driveInLane is off

      local laneWidth = (rangeRight - rangeLeft) / rangeLaneCount -- self explanatory: entire width of the road when driveInLane is off i.e. 1
      local rangeBestLane = (n1.rangeBestLane + n2.rangeBestLane) * 0.5 -- best lane in the range: only one lane to pick from when driveInLane is off

      local laneLimLeft = linearScale(rangeLeft + rangeBestLane * laneWidth, 0, 1, -roadHalfWidth, roadHalfWidth) -- lateral coordinate of left boundary of lane rescaled to the road half width
      local laneLimRight = linearScale(rangeLeft + (rangeBestLane + 1) * laneWidth, 0, 1, -roadHalfWidth, roadHalfWidth) -- lateral coordinate of right boundary of lane rescaled to the road half width

      local roadSpeedLimit
      if n2.pathidx > 1 then
        roadSpeedLimit = mapData.graph[route.path[n2.pathidx]][route.path[n2.pathidx-1]].speedLimit
      else
        roadSpeedLimit = n2.roadSpeedLimit
      end

      if plan.stopSeg >= i + 1 then
        plan.stopSeg = plan.stopSeg + 1
      end

      local manSpeed
      if n1.manSpeed and n2.manSpeed then
        manSpeed = (n1.manSpeed + n2.manSpeed) * 0.5
      end

      tableInsert(plan, i+1, {
        posOrig = posOrig,
        pos = pos,
        vec = vec,
        dirVec = dirVec,
        turnDir = vec3(0, 0, 0),
        biNormal = biNormal,
        normal = normal,
        radiusOrig = radiusOrig,
        pathidx = n2.pathidx,
        roadSpeedLimit = roadSpeedLimit,
        halfWidth = roadHalfWidth,
        widthMarginOffset = (n1.widthMarginOffset + n2.widthMarginOffset) * 0.5,
        laneLimLeft = laneLimLeft,
        laneLimRight = laneLimRight,
        rangeLeft = rangeLeft,
        rangeRight = rangeRight,
        rangeLaneCount = rangeLaneCount,
        rangeBestLane = rangeBestLane, -- 0 Indexed
        length = n1.length,
        curvature = (n1.curvature + n2.curvature) * 0.5,
        curvatureZ = 0,
        lateralXnorm = lateralXnorm,
        legalSpeed = nil,
        manSpeed = manSpeed,
        speed = nil,
        trafficSqVel = math.huge,
        dispDir = 0
      })

      if n1.lanesOpen and n2.lanesOpen then
        openLaneToLaneRange(plan[i+1])
      end

      plan.planCount = plan.planCount + 1
      break
    end
    distOnPlan = distOnPlan + sqrt(segLenSq)
  end
  --profilerPopEvent(""ai_trajectory_splitting"")
  distOnPlan = nil

  if plan.targetSeg == nil then
    calculateTarget(plan)
  end

  --profilerPushEvent(""ai_calculate_smoothing"")
  -- calculate spring forces
  local nforce = vec3()
  if opt.trajMethod ~= 'springDampers' then
    for i = 0, plan.planCount do
      if forces[i] then
        forces[i]:set(0, 0, 0)
      else
        forces[i] = vec3()
      end
    end

    for i = 1, plan.planCount-1 do
      local n1 = plan[i]
      local v1 = n1.dirVec
      local v2 = plan[i+1].dirVec

      n1.turnDir:setSub2(v1, v2); n1.turnDir:normalize()
      nforce:setScaled2(n1.turnDir, (1-twt.state) * max(1 - v1:dot(v2), 0) * parameters.turnForceCoef)

      forces[i+1]:setSub(nforce)
      forces[i-1]:setSub(nforce)
      nforce:setScaled(2)
      forces[i]:setAdd(nforce)
    end
  else
    for i = 0, plan.planCount do
      if forces[i] then
        forces[i]:set(0, 0, 0)
      else
        forces[i] = vec3()
        velocities[i] = vec3()
      end
    end

    local dforce = vec3()
    local stiff = 400
    local damper = 2
    for i = 1, plan.planCount-1 do
      local n1 = plan[i]
      local v1 = n1.dirVec
      local v2 = plan[i+1].dirVec

      n1.turnDir:setSub2(v1, v2); n1.turnDir:normalize()
      nforce:setScaled2(n1.turnDir, (1-twt.state) * max(1 - v1:dot(v2), 0) * parameters.turnForceCoef)

      nforce:setScaled2(n1.turnDir, (1-twt.state) * max(1 - v1:dot(v2), 0) * parameters.turnForceCoef * stiff)
      dforce:setScaled2((velocities[i+1] - velocities[i]) - (velocities[i] - velocities[i-1]), parameters.turnForceCoef * damper * 0.25)
      dforce:setScaled2(n1.turnDir, n1.turnDir:dot(dforce))
      nforce:setAdd(dforce)

      forces[i+1]:setSub(nforce)
      forces[i-1]:setSub(nforce)
      nforce:setScaled(2)
      forces[i]:setAdd(nforce)
    end

    for i = 1, plan.planCount-1 do
      forces[i] = forces[i] - velocities[i] * parameters.turnForceCoef * damper
      velocities[i] = velocities[i] + forces[i] * dt
      forces[i] = velocities[i] * dt
    end
  end
  --profilerPopEvent(""ai_calculate_smoothing"")

  -- other vehicle awareness --
  -- computing path indexes (start/final) for trafficFilter
  -- and computing filter radius
  --profilerPushEvent(""ai_awareness"")
  local indexes = {start = plan[1].pathidx , final = plan[plan.planCount].pathidx}
  if traffic.filtered then
    traffic.Rfs = traffic.Rfs_fun(ego.speed)
    traffic.Rfl = traffic.Rfl_fun(ego.speed)
    traffic.distAhead = traffic.Rfs
    local dist = plan.planLen
    local final = indexes.final
    while (dist < traffic.distAhead or final < indexes.start + 1) and route.path[final + 1] do
      dist = dist + mapData.positions[route.path[final]]:distance(mapData.positions[route.path[final+1]])
      final = final + 1
    end
    --obj.debugDrawProxy:drawSphere(2, mapData.positions[route.path[final]], color(0,255,0,50))
    indexes.final = final
  end

  table.clear(traffic.trafficTable)
  ego.ghostR, ego.ghostL = nil, nil

  for plID, v in pairs(mapmgr.getObjects()) do
    if plID ~= objectId and (M.mode ~= 'chase' or plID ~= player.id or internalState.chaseData.playerState == 'stopped') then
      v.targetType = (player and plID == player.id) and M.mode
      if opt.avoidCars == 'on' or v.targetType == 'follow' then
        v.length = obj:getObjectInitialLength(plID) + 0.3
        v.width = obj:getObjectInitialWidth(plID)
        local posFront = obj:getObjectFrontPosition(plID)
        local dirVec = v.dirVec
        v.posFront = dirVec * 0.3 + posFront
        v.posRear = dirVec * (-v.length) + posFront
        v.posMiddle = (v.posFront + v.posRear) * 0.5
        --obj.debugDrawProxy:drawSphere(traffic.Rfs, ego.pos, color(0,0,0,50))
        --obj.debugDrawProxy:drawSphere(traffic.Rfl, ego.pos, color(255,0,0,50))

        if traffic.filtered then
          local dist = ego.pos:squaredDistance(v.posMiddle)
          if dist <= traffic.Rfs * traffic.Rfs then
            -- process with trafficFilter vehicles inside smaller radius
            if trafficFilter(indexes, route, v, traffic.vdraw) then
              table.insert(traffic.trafficTable, v)
            end
            -- be sure to not have this vehicle inside Que
            traffic.trafficFilterQue.dict[plID] = nil
            -- set FromQue to nil (means that this vehicle was not taken from Que)
            traffic.trafficFilterFromQue[plID] = nil
          elseif dist <= traffic.Rfl * traffic.Rfl then
            -- process with trafficFilter vehicles inside larger radius
            if traffic.trafficFilterFromQue[plID] then
              -- if vehicle (at the previous frame) was taken from Que, then process it again with trafficFilter
              if trafficFilter(indexes, route, v, traffic.vdraw) then
                table.insert(traffic.trafficTable, v)
              end
              -- be sure to not have this vehicle inside Que
              traffic.trafficFilterQue.dict[plID] = nil
            else
              -- if it is not has been processed from que, then add it to que if it is not already inside
              if not traffic.trafficFilterQue.dict[plID] then
                table.insert(traffic.trafficFilterQue.array, plID)
                traffic.trafficFilterQue.dict[plID] = true
                traffic.trafficFilterFromQue[plID] = nil
              end
            end
          else
            -- process vehicles outside of both radii
            traffic.trafficFilterQue.dict[plID] = nil
            traffic.trafficFilterFromQue[plID] = nil
          end
        else -- no filtered case (take all vehicles)
          table.insert(traffic.trafficTable, v)
        end
      end
    end
  end

  if traffic.filtered then
    local tFQarray, tFQdict = traffic.trafficFilterQue.array, traffic.trafficFilterQue.dict
    -- cleanup trafficFilterQue
    local j = 1
    for i = 1, #tFQarray do
      local vid = tFQarray[i]
      if tFQdict[vid] and mapmgr.objects[vid] and mapmgr.objects[vid].posFront then --
        if i ~= j then
          tFQarray[j] = tFQarray[i]
          tFQarray[i] = nil
        end
        j = j + 1
      else
        tFQarray[i], tFQdict[vid] = nil, nil
      end
    end

    -- pop que and check vehicle
    if tFQarray[1] and (traffic.frameQue*dt >= traffic.rateQue) then
      local vid = table.remove(tFQarray, 1)
      tFQdict[vid] = nil
      local v = mapmgr.objects[vid]
      -- process the first vehicle in Que
      if trafficFilter(indexes, route, v, traffic.vdraw) then
        -- set FromQue to true (means that this vehicle was taken from Que)
        traffic.trafficFilterFromQue[vid] = true
        table.insert(traffic.trafficTable, v)
      end
      traffic.frameQue = 0
    end
  end


  local trafficTableLen = #traffic.trafficTable
  plan.trafficMinProjSpeed = math.huge


  local newOvertake = false
  local openPlanLanesIdx = 0
  if trafficTableLen > 0 then
    local fl, rl, fr, rr
    local lenVec = ego.dirVec * ego.length
    local midPos = ego.pos - lenVec * 0.5
    --local planPos = linePointFromXnorm(plan[1].pos, plan[2].pos, plan.egoXnormOnSeg or 0)
    --midPos = linePointFromXnorm(planPos, planPos - lenVec, midPos:xnormOnLine(planPos, planPos - lenVec)) -- offset as next plan node
    local dispLeft, dispRight = 0, 0

    if opt.racing then
      for _, v in ipairs(traffic.trafficTable) do -- side avoidance loop
        local backAwereness = 0 --0.25 -- must be between 0 and 1
        local xnormF = v.posFront:xnormOnLine(midPos + lenVec, midPos - backAwereness * lenVec)
        local xnormR = v.posRear:xnormOnLine(midPos + lenVec, midPos - backAwereness * lenVec)
        local xnormL = xnormF > 0 and xnormF or xnormR
        if ego.speed > 1 and v.vel:dot(ego.dirVec) > 0 and xnormL > 0 and xnormL < 1 and abs(v.posFront.z - ego.pos.z) < 4 then
          -- distance from ego.pos to v.posFront or v.posRear
          local distF = (v.posFront - ego.pos):dot(ego.rightVec)
          local distR = (v.posRear - ego.pos):dot(ego.rightVec)
          -- side of v w.r.t. ego (ego -> v = 1, v <- ego = -1)
          local side = sign(distR)

          local dist = min(abs(distF), abs(distR))
          -- Relative Velocity of ego w.r.t. v vehicle
          local vRel = ego.vel - v.vel
          -- relative lateral speed of v w.r.t. ego (rsLat > 0 means v is moving toward us)
          local rsLat = vRel:dot(ego.rightVec) * side
          -- time to lateral collision (> 0 means collision is imminent, < 0 means collision does not happen)
          local TTC = dist * sign2(rsLat) / (abs(rsLat) + 1e-30)
          -- relative longitudinal speed of v w.r.t. ego (rsLong > 0 means ego is moving faster than v)
          local rsLong = vRel:dot(ego.dirVec)

          local TTO
          if rsLong > 0 then -- time to overtake v
            TTO = (2 * ego.length * lerp(1, lerp(0.5, 0, backAwereness), xnormL) + (xnormF < 0 and v.length or 0)) / (rsLong + 1e-30)
          else -- time to be overtaken by v
            TTO = (2 * ego.length * lerp(0.5, 1, backAwereness) * xnormL + (xnormF > 0 and v.length or 0)) / (-rsLong + 1e-30)
          end

          -- if TTC is less than TTO or if is greater but vehicles are close to each other: ACTIVATE SIDE AVOIDANCE
          if v.dirVec:dot(ego.dirVec) > 0.3 then
            if TTC > 0 and TTC < min(3, TTO) then
              if side < 0 then -- v-vehicle is on our left side
                dispLeft = max(dispLeft, square(clamp(0.1 / TTC, 0, 1)))
              elseif side > 0 then -- v-vehicle is on our right side  --(and (xnormF < 0.5 or v.vel:dot(ego.dirVec) > ego.speed))
                dispRight = max(dispRight, square(clamp(0.1 / TTC, 0, 1)))
              end
              --obj.debugDrawProxy:drawSphere(0.2, ego.pos + 0.5 * ego.dirVec * ego.length, color(255, 128, 0, 160))
              --obj.debugDrawProxy:drawSphere(0.2, midPos, color(255, 128, 0, 160))
            elseif dist < 0.5 * (ego.width + v.width + 0.2) and TTC > -0.1 then
              if side < 0 then -- v-vehicle is on our left side
                dispLeft = max(dispLeft, 0.1)
              elseif side > 0 then -- v-vehicle is on our right side  --(and (xnormF < 0.5 or v.vel:dot(ego.dirVec) > ego.speed))
                dispRight = max(dispRight, 0.1)
              end
              --obj.debugDrawProxy:drawSphere(0.2, ego.pos + 0.5 * ego.dirVec * ego.length, color(0, 0, 0, 160))
              --obj.debugDrawProxy:drawSphere(0.2, midPos, color(0, 0, 0, 160))
            end
          end
        end
      end
    else
      for _, v in ipairs(traffic.trafficTable) do -- side avoidance loop
        local xnorm = v.posFront:xnormOnLine(midPos + lenVec, midPos - lenVec)
        if ego.speed > 1 and v.vel:dot(ego.dirVec) > 0 and xnorm > 0 and xnorm < 1 and abs(v.posFront.z - ego.pos.z) < 4 then
          fl = fl or midPos - ego.rightVec * ego.width * 0.5 + lenVec
          rl = rl or fl - lenVec * 2
          fr = fr or midPos + ego.rightVec * ego.width * 0.5 + lenVec
          rr = rr or fr - lenVec * 2

          local posF = v.posFront
          local rightVec = v.dirVec:cross(v.dirVecUp)
          local posL = posF - rightVec * (v.width * 0.5 + 0.1)
          local posR = posF + rightVec * (v.width * 0.5 + 0.1)

          local xnorm1, xnorm2 = closestLinePoints(posF, posR, rl, fl)
          local xnorm3, xnorm4 = closestLinePoints(posF, posL, rr, fr)

          if xnorm1 > 0 and xnorm1 < 1 and xnorm2 > 0 and xnorm2 < 1 then -- v-vehicle is on our left side
            dispLeft = max(dispLeft, linePointFromXnorm(posF, posR, xnorm1):squaredDistance(posR))
          elseif xnorm3 > 0 and xnorm3 < 1 and xnorm4 > 0 and xnorm4 < 1 then -- v-vehicle is on our right side
            dispRight = max(dispRight, linePointFromXnorm(posF, posL, xnorm3):squaredDistance(posL))
          end
        end
      end
    end

    --if fl then
      --local cornerColor = color(255, 128, 0, 160)
      --obj.debugDrawProxy:drawSphere(0.2, fl, cornerColor)
      --obj.debugDrawProxy:drawSphere(0.2, rl, cornerColor)
      --obj.debugDrawProxy:drawSphere(0.2, fr, cornerColor)
      --obj.debugDrawProxy:drawSphere(0.2, rr, cornerColor)
      --local sideColor = color(clamp(sqrt(dispLeft) * 255, 0, 255), 0, clamp(sqrt(dispRight) * 255, 0, 255), 160)
      --obj.debugDrawProxy:drawSphere(0.4, midPos + vec3(0,0,2), sideColor)
    --end

    plan.sideDisp = nil
    if dispLeft > 0 or dispRight > 0 then
      local sideDisp = sqrt(dispLeft) - sqrt(dispRight) -- (sideDisp > 0) means v-vehicle is on our left side and ego should move right
      sideDisp = min(dt * parameters.awarenessForceCoef * 10, abs(sideDisp)) * sign2(sideDisp) -- limited displacement per frame
      plan.sideDisp = true
      -- maybe needs some smoother to prevent left / right ""bouncing""
      local curDist = 0
      local lastPlanIdx = 2
      local targetDist = square(ego.speed) / (2 * g * aggression) + max(opt.racing and 100 or 30, ego.speed * 3) -- longer adjustment at higher speeds

      local tmpVec = vec3()
      for i = 2, plan.planCount - 1 do
        openLaneToLaneRange(plan[i])
        plan[i].lateralXnorm = clamp(plan[i].lateralXnorm + sideDisp * (targetDist - curDist) / targetDist, plan[i].laneLimLeft, plan[i].laneLimRight)
        tmpVec:setScaled2(plan[i].normal, plan[i].lateralXnorm)
        plan[i].pos:setAdd2(plan[i].posOrig, tmpVec)
        curDist = curDist + plan[i - 1].length
        lastPlanIdx = i

        plan[i].vec:setSub2(plan[i-1].pos, plan[i].pos); plan[i].vec.z = 0
        plan[i].dirVec:set(plan[i].vec)
        plan[i].dirVec:normalize()

        if curDist > targetDist then break end
      end

      updatePlanLen(plan, 2, lastPlanIdx + 1)
    end

    local trafficMinSpeedSq = math.huge
    local distanceT = 0
    local minTrafficDir = 1
    local nDir, forceVec = vec3(), vec3()
    nDir:setSub2(plan[2].pos, plan[1].pos); nDir:setScaled(1 / (plan[1].length + 1e-30))
    local egoPathVel = ego.vel:dot(nDir)
    local egoPathVelInv = 1 / abs(egoPathVel + 1e-30)
    local inMultipleLanes = plan[2].laneLimRight - plan[2].laneLimLeft > 3.45 * 1.5 -- one and a half lanes
    for i = 2, plan.planCount-1 do
      local arrivalT = distanceT * egoPathVelInv
      local n1, n2 = plan[i], plan[i+1]
      local n1pos, n2pos = n1.pos, n2.pos
      nDir:setSub2(n2pos, n1pos); nDir:setScaled(1 / (n1.length + 1e-30))
      n1.trafficSqVel = math.huge

      for j = trafficTableLen, 1, -1 do
        local v = traffic.trafficTable[j]
        local plPosFront, plPosRear, plWidth = v.posFront, v.posRear, v.width
        local ego2PlVec = plPosFront - ego.pos
        local ego2PlDir = ego2PlVec:dot(ego.dirVec)

        if ego2PlDir > 0 then
          local velDisp = arrivalT * v.vel
          if v.vel:length() < ego.speed and (v.noproj or opt.racing) then
            velDisp = velDisp * min(1,square(square(square(max(0,arrivalT/4)))))
          end
          plPosFront = plPosFront + velDisp
          plPosRear = plPosRear + velDisp
        end

        local extVec = 0.5 * max(ego.width, plWidth) * nDir
        local n1ext, n2ext = n1pos - extVec, n2pos + extVec
        local rnorm, vnorm = closestLinePoints(n1ext, n2ext, plPosFront, plPosRear)

        local minSqDist = math.huge
        if rnorm > 0 and rnorm < 1 and vnorm > 0 and vnorm < 1 then
          minSqDist = 0
        else
          local rlen = n1.length + plWidth
          local xnorm = plPosFront:xnormOnLine(n1ext, n2ext) * rlen
          local v1 = vec3()
          if xnorm > 0 and xnorm < rlen then
            v1:setScaled2(nDir, xnorm); v1:setAdd(n1ext)
            minSqDist = min(minSqDist, v1:squaredDistance(plPosFront))
          end

          xnorm = plPosRear:xnormOnLine(n1ext, n2ext) * rlen
          if xnorm > 0 and xnorm < rlen then
            v1:setScaled2(nDir, xnorm); v1:setAdd(n1ext)
            minSqDist = min(minSqDist, v1:squaredDistance(plPosRear))
          end

          rlen = v.length + ego.width
          v1:setSub2(n1ext, plPosRear)
          local v1dot = v1:dot(v.dirVec)
          if v1dot > 0 and v1dot < rlen then
            minSqDist = min(minSqDist, v1:squaredDistance(v1dot * v.dirVec))
          end

          v1:setSub2(n2ext, plPosRear)
          v1dot = v1:dot(v.dirVec)
          if v1dot > 0 and v1dot < rlen then
            minSqDist = min(minSqDist, v1:squaredDistance(v1dot * v.dirVec))
          end
        end

        local limWidth = v.targetType == 'follow' and 2 * max(n1.radiusOrig, n2.radiusOrig) or plWidth

        if minSqDist < square((ego.width + limWidth) * 0.8) then
          local velProjOnSeg = max(0, v.vel:dot(nDir))

          local vehicleIsStopped = isVehicleStopped(v)

          if vehicleIsStopped then
            local distToParked = 0
            for ii = 2, i do
              distToParked = distToParked + plan[ii].length
            end
            if distToParked < 25 then
              openPlanLanesIdx = max(openPlanLanesIdx, i)
            end
          end

          if not newOvertake then
            if plan.stopSeg == math.huge and v.targetType ~= 'follow' then -- apply side forces to avoid vehicles
              local side1 = sign(n1.normal:dot(v.posMiddle) - n1.normal:dot(n1.pos))
              local side2 = sign(n2.normal:dot(v.posMiddle) - n2.normal:dot(n2.pos))

              if not v.sideDir then
                v.sideDir = side1 -- save the avoidance direction once to compare it with all of the subsequent plan nodes
              end

              if v.sideDir == side1 and inMultipleLanes then -- calculate force coef only if the avoidance side matches the initial value

                local forceCoef = trafficStates.side.side *
                                  parameters.awarenessForceCoef *
                                  max(0, ego.speed - velProjOnSeg, -sign(nDir:dot(v.dirVec)) * trafficStates.side.cTimer) /
                                  ((1 + minSqDist) * (1 + distanceT * min(0.1, 1 / (2 * max(0, egoPathVel - v.vel:dot(nDir)) + 1e-30))))

                if opt.racing then
                  forceCoef = forceCoef * 0.25
                end
                forceVec:setScaled2(n1.normal, side1 * forceCoef)
                forces[i]:setSub(forceVec)

                forceVec:setScaled2(n1.normal, side2 * forceCoef)
                forces[i+1]:setSub(forceVec)
              end
            end
          else
            if plan.stopSeg == math.huge and v.targetType ~= 'follow' and not v.overtaken then
              v.overtaken = true
              if inMultipleLanes then
                local Deltax = distanceT
                local factor1 = clamp(ego.vel:dot(nDir) - velProjOnSeg, 0, 4)
                local factor2 = max(0,-sign(nDir:dot(v.dirVec)) * trafficStates.side.cTimer)
                for ii = 2, plan.planCount-1 do
                  -- Logic for performing the overtake manouver
                  local n1i = plan[ii]
                  --local n2i = plan[ii + 1]
                  local distY = n1i.normal:dot(v.posMiddle) - n1i.normal:dot(n1i.pos)
                  --local distY = plan[1].normal:dot(v.posMiddle) - plan[1].normal:dot(ego.pos)
                  --local Deltax = -n2i.dirVec:dot(v.posMiddle - n1i.pos) --Need to be improved
                  if ii > 2 then
                    Deltax = Deltax - plan[ii-1].length
                  end
                  if not v.sideDir then
                    v.sideDir = sign(distY) -- save the avoidance direction once to compare it with all of the subsequent plan nodes
                  end
                  if v.sideDir == sign(distY) then
                    local forceCoef = sign(distY)*max(0, ((n1i.radiusOrig) - abs(distY))*math.exp(-0.001*square(Deltax)))*(1*parameters.awarenessForceCoef*dt)
                    forceCoef = forceCoef*max(factor1, factor2)*trafficStates.side.side
                    forceVec:setScaled2(n1i.normal, forceCoef)
                    forces[ii]:setSub(forceVec)
                  end
                end
              end
            end
          end

          if M.mode ~= 'flee' and M.mode ~= 'random' and (M.mode ~= 'manual' or (n1.laneLimRight - n1.laneLimLeft) <= ego.width + plWidth) then
            -- sets a minimum speed due to other vehicle velocity projection on plan segment
            -- only sets it if ego mode is valid; or if mode is ""manual"" but there is not enough space to pass

            if minSqDist < square((ego.width + limWidth) * 0.51)  then
              -- obj.debugDrawProxy:drawSphere(0.25, v.posFront, color(0,0,255,255))
              -- obj.debugDrawProxy:drawSphere(0.25, plPosFront, color(0,0,255,255))
              if not vehicleIsStopped then
                table.remove(traffic.trafficTable, j)
                trafficTableLen = trafficTableLen - 1
              end
              plan.trafficMinProjSpeed = min(plan.trafficMinProjSpeed, velProjOnSeg)

              n1.trafficSqVel = min(n1.trafficSqVel, velProjOnSeg * velProjOnSeg)
              trafficMinSpeedSq = min(trafficMinSpeedSq, v.vel:squaredLength())
              minTrafficDir = min(minTrafficDir, v.dirVec:dot(nDir))
            end

            if i == 2 and minSqDist < square((ego.width + limWidth) * 0.6) and ego2PlDir > 0 and v.vel:dot(ego.rightVec) * ego2PlVec:dot(ego.rightVec) < 0 then
              n1.trafficSqVel = max(0, n1.trafficSqVel - abs(1 - v.vel:dot(ego.dirVec)) * (v.vel:length()))
            end
          end
        end
      end

      distanceT = distanceT + n1.length

      if trafficTableLen < 1 then
        break
      end
    end

    -- this code was supposed to keep the vehicle stopped until the intersection was clear
    -- not working as intended, different solution needed
    --if trafficStates.intersection.timer < parameters.trafficWaitTime and plan.trafficMinProjSpeed < 3 then
      --trafficStates.intersection.timer = 0 -- reset the intersection waiting timer
    --end

    trafficStates.block.block = max(trafficMinSpeedSq, ego.speed * ego.speed) < 1 and (minTrafficDir < -0.7 or trafficStates.intersection.block)
    if not opt.racing then
      plan[1].trafficSqVel = plan[2].trafficSqVel
    end

    if openPlanLanesIdx > 0 and plan[openPlanLanesIdx].length < ego.length * 1.5 then openPlanLanesIdx = openPlanLanesIdx + 1 end

    openPlanLanesToLaneRange(plan, openPlanLanesIdx)
  end
  --profilerPopEvent(""ai_awareness"")

  -- remove lane change if vehicle has gone past it
  --profilerPushEvent(""ai_remove_laneChange"")
  while route.laneChanges[1] and plan[2].pathidx > route.laneChanges[1].pathIdx do
    electrics.stop_turn_signal()
    table.remove(route.laneChanges, 1)
  end
  --profilerPopEvent(""ai_remove_laneChange"")

  local skipLast = 1
  local lastNodeLatXnorm, lastNodeLimLeft, lastNodeLimRight

  --profilerPushEvent(""ai_process_laneChange"")
  if route.laneChanges[1] and math.floor(plan[2].rangeLaneCount + 0.5) > 1 and route.laneChanges[1].side ~= 0 then
    local exitNodeIdx = route.laneChanges[1].pathIdx
    local distToExit
    if plan[plan.planCount].pathidx > exitNodeIdx then
      distToExit = plan.planLen
      for i = plan.planCount, 2, -1 do
        if plan[i].pathidx == exitNodeIdx then
          break
        else
          distToExit = distToExit - plan[i-1].length
        end
      end
    else
      distToExit = plan.planLen + max(0, route.pathLength[route.laneChanges[1].pathIdx] - route.pathLength[plan[plan.planCount].pathidx])
    end

    if (distToExit < min(600, max(15, ego.speed * ego.speed * 0.7)) or route.laneChanges[1].commit) then --and not plan.noExit
      local side = route.laneChanges[1].side
      -- check if the exit is blocked by a vehicle
      if (side < 0 and ego.ghostL) or (side > 0 and ego.ghostR) then
        plan.noExit = true
      else
        plan.noExit = nil
      end

      -- if the exit is not blocked, do a lane change
      if not plan.noExit or route.laneChanges[1].commit then
        route.laneChanges[1].commit = true
        --print('lane change is going to happen')
        --obj.debugDrawProxy:drawSphere(2, ego.pos, color(255,0,255,255))
        if side < 0 then
          if (electrics.values.turnsignal or -1) >= 0 then electrics.toggle_left_signal() end
        else
          if (electrics.values.turnsignal or 1) <= 0 then electrics.toggle_right_signal() end
        end
        skipLast = 0
        lastNodeLatXnorm = plan[plan.planCount].lateralXnorm
        lastNodeLimLeft = plan[plan.planCount].laneLimLeft
        lastNodeLimRight = plan[plan.planCount].laneLimRight
        local planDist = 0
        local sideForceCoeff = 2.5 * side * dt / distToExit
        local planExitIdx = plan.planCount
        if plan[plan.planCount].pathidx >= exitNodeIdx then -- if last plan node is at or past the path exit node
          planExitIdx = 1
          for i = plan.planCount, 3, -1 do
            if plan[i].pathidx == exitNodeIdx then -- if this plan node is at the exit node
              if i == plan.planCount then -- if it is also the last plan node
                lastNodeLatXnorm = nil
              end
              planExitIdx = i
              break
            end
          end
        else
          lastNodeLatXnorm = nil
        end

        -- Add lane change forces to all nodes up to the exit node
        for i = 3, planExitIdx do
          planDist = planDist + plan[i-1].length
          local n = plan[i]
          local roadHalfWidth = n.halfWidth
          local laneHalfWidth = roadHalfWidth * (n.rangeRight - n.rangeLeft) / n.rangeLaneCount
          if side < 0 then
            n.laneLimLeft = (2 * n.rangeLeft - 1) * roadHalfWidth -- open left lane limit to left range limit
            n.laneLimRight = max(n.laneLimLeft + ego.width, min(n.laneLimRight, n.lateralXnorm + laneHalfWidth))
            forces[i]:setAdd(planDist * sideForceCoeff * square(min(1, 0.25 * abs(n.lateralXnorm - n.laneLimLeft))) * n.normal)
          else
            n.laneLimRight = (2 * n.rangeRight - 1) * roadHalfWidth -- open right lane limit to right range limit
            n.laneLimLeft = min(n.laneLimRight - ego.width, max(n.laneLimLeft, n.lateralXnorm - laneHalfWidth))
            forces[i]:setAdd(planDist * sideForceCoeff * square(min(1, 0.25 * abs(n.laneLimRight - n.lateralXnorm))) * n.normal)
          end
        end
        for i = planExitIdx + 1, plan.planCount do
          planDist = max(0, planDist - plan[i-1].length)
          if planDist == 0 then break end
          local n = plan[i]
          if side < 0 then
            forces[i]:setAdd(planDist * sideForceCoeff * square(min(1, 0.25 * abs(n.lateralXnorm - n.laneLimLeft))) * n.normal)
          else
            forces[i]:setAdd(planDist * sideForceCoeff * square(min(1, 0.25 * abs(n.laneLimRight - n.lateralXnorm))) * n.normal)
          end
        end
        updatePlanbestRange(plan)
      else -- if the exit is blocked, avoid lane change by changing path & plan

        --------- Plan cleaning -----------
        local clearIdx = max(exitNodeIdx-1, plan[2].pathidx)
        -- clear all plan nodes from clearIdx to plan.planCount
        local final_plan_count = plan.planCount
        for i = plan.planCount, 1, -1 do
          if plan[i].pathidx > clearIdx then
            plan.planLen = plan.planLen - plan[i-1].length
            plan[i] = nil
            final_plan_count = final_plan_count - 1
          else
            break
          end
        end
        plan.planCount = final_plan_count

        ----------- Path cleaning -------------
        -- remove all path nodes after the exit node
        for i = #route.path, min(#route.path, exitNodeIdx) + 1, -1  do
          table.remove(route.path, i)
          table.remove(route.pathLength, i)
        end
        -- insert the alternate path at the exit node
        table.insert(route.path, route.laneChanges[1].alternate)
        -- clear route lane changes
        route.lastLaneChangeIdx = #route.path - 1
        table.clear(route.laneChanges)
        -- clear and update traffic path state for the new path
        if #trafficPathState > 0 then
          table.clear(trafficPathState)
          trafficPathState[1] = route.path[#route.path-1]
          trafficPathState[2] = route.path[#route.path]
        end
      end
    end
  end
  --profilerPopEvent(""ai_process_laneChange"")

  --profilerPushEvent(""ai_smoothness_integration"")
  local tmpVec = vec3()
  local roadWidthMargin = ego.width * 0.5
  local laneWidthMargin = ego.width * 0.4
  local forceMagLim = parameters.springForceIntegratorDispLim
  for i = 2, plan.planCount-skipLast do
    local n = plan[i]
    local roadHalfWidth = n.halfWidth

    -- Apply a force towards the center of the lane when driving in lane
    local forceToLaneCenter = 0
    if opt.driveInLaneFlag and not n.lanesOpen then
      local rangeLeft = (2 * n.rangeLeft - 1) * roadHalfWidth
      local rangeRight = (2 * n.rangeRight - 1) * roadHalfWidth
      local b = 0.5 * (n.laneLimRight - n.laneLimLeft) + 1e-30
      local dispToLeftRange = min(1, max(0, b - (n.lateralXnorm - rangeLeft)) / b)
      local dispToRightRange = min(1, max(0, b - (rangeRight - n.lateralXnorm)) / b)
      forceToLaneCenter = 0.15 * (dispToLeftRange - dispToRightRange)
    end

    -- Calculate node displacement: avoids switching displacement direction (sign) in concecutive frames
    local displacement = forceToLaneCenter + max(min(n.normal:dot(forces[i]), forceMagLim), -forceMagLim)
    displacement = displacement * max(min((displacement * n.dispDir) * math.huge, 1), 0) -- second term returns 0 if (displacement * n.dispDir) is negative, 1 otherwise.
    n.dispDir = sign(displacement)

    local roadLimRight = max(0, roadHalfWidth - roadWidthMargin) -- should be non-negative (zero or positive)
    local limLow = max(n.laneLimLeft + laneWidthMargin, -roadLimRight)
    local limHigh = min(n.laneLimRight - laneWidthMargin, roadLimRight)
    local limAvg = (limLow + limHigh) * 0.5 -- guard against clamp limit crossing

    local newLateralXnorm = clamp(n.lateralXnorm + displacement, min(limLow, limAvg), max(limHigh, limAvg))

    tmpVec:setScaled2(n.normal, newLateralXnorm - n.lateralXnorm)
    n.pos:setAdd(tmpVec) -- remember that posOrig and pos are not alligned along the normal
    n.vec:setSub2(plan[i-1].pos, n.pos); n.vec.z = 0
    n.dirVec:set(n.vec); n.dirVec:normalize()

    n.lateralXnorm = newLateralXnorm
  end
  --profilerPopEvent(""ai_smoothness_integration"")

  if lastNodeLatXnorm then
    local roadHalfWidth = plan[plan.planCount].halfWidth
    local rangeLeft, rangeRight = (2 * plan[plan.planCount].rangeLeft - 1) * roadHalfWidth, (2 * plan[plan.planCount].rangeRight - 1) * roadHalfWidth
    local latXnorm = clamp(plan[plan.planCount].lateralXnorm, rangeLeft, rangeRight)
    local disp = latXnorm - lastNodeLatXnorm
    plan[plan.planCount].laneLimLeft = max(rangeLeft, min(latXnorm, lastNodeLimLeft + disp))
    plan[plan.planCount].laneLimRight = min(rangeRight, max(latXnorm, lastNodeLimRight + disp))
  end

  updatePlanLen(plan, 2, plan.planCount)

  -- smoothly distribute error from planline onto the front segments
  --profilerPushEvent(""ai_error_smoother"")
  if parameters.planErrorSmoothing and plan.targetPos and plan.targetSeg and plan.planCount > plan.targetSeg and twt.state == 0 then
    local dTotal = 0
    local sumLen = table.new(plan.targetSeg-1, 0)
    sumLen[1] = 0
    for i = 2, plan.targetSeg - 1  do
      sumLen[i] = dTotal
      dTotal = dTotal + plan[i].length
    end
    dTotal = max(1, dTotal + plan.targetPos:distance(plan[plan.targetSeg].pos))

    local p1, p2 = plan[1].pos, plan[2].pos
    local dispVec = ego.pos - linePointFromXnorm(p1, p2, ego.pos:xnormOnLine(p1, p2)); dispVec:setScaled(0.5 * dt)

    tmpVec:setSub2(p2, p1); tmpVec:setCross(tmpVec, ego.upVec); tmpVec:normalize()
    plan.egoDeviation = dispVec:dot(tmpVec)

    local dispVecRatio = dispVec / dTotal
    for i = plan.targetSeg - 1, 1, -1 do
      local n = plan[i]

      dispVec:setScaled2(dispVecRatio, dTotal - sumLen[i])
      dispVec:setSub(dispVec:dot(n.biNormal) * n.biNormal)
      n.pos:setAdd(dispVec)

      local halfWidth = n.halfWidth
      tmpVec:setAdd2(n.posOrig, n.normal)
      n.lateralXnorm = clamp(n.pos:xnormOnLine(n.posOrig, tmpVec), -halfWidth, halfWidth)

      plan[i+1].vec:setSub2(plan[i].pos, plan[i+1].pos); plan[i+1].vec.z = 0
      plan[i+1].dirVec:setScaled2(plan[i+1].vec, 1 / plan[i+1].vec:lengthGuarded())
    end

    updatePlanLen(plan, 1, plan.targetSeg-1)
  end
  --profilerPopEvent(""ai_error_smoother"")

  -- TODO: This error smoother looks to behave better for race driving. It could replace the above.
  -- uniformPlanErrorDistribution(plan)

  --profilerPushEvent(""ai_calculate_target"")
  calculateTarget(plan)
  --profilerPopEvent(""ai_calculate_target"")

  -- calculate node horizontal curvature
  --profilerPushEvent(""ai_calculate_curvature"")
  local len, n3vec = 0, vec3()
  plan[1].curvature = plan[1].curvature or inCurvature(plan[1].vec, plan[2].vec)
  for i = 2, plan.planCount - 1 do
    local n1, n2 = plan[i], plan[i+1]

    n3vec:setSub2(n1.pos, plan[min(plan.planCount, i+2)].pos); n3vec.z = 0

    local c1 = inCurvature(n1.vec, n2.vec)
    local c2 = inCurvature(n1.vec, n3vec)

    local curvature
    if c1 <= c2 then
      curvature = sign2(n1.turnDir:dot(n1.normal)) * c1
    else
      curvature = sign2((n1.vec):dot(n1.normal) - n3vec:dot(n1.normal)) * c2
    end

    -- calculate curvature temporal smoothing parameter as a function of the trajectory length distance
    local curvatureRateDt = min(5 + 0.005 * len * len, 100) * dt
    n1.curvature = n1.curvature + (curvature - n1.curvature) * curvatureRateDt / (1 + curvatureRateDt)

    len = len + n1.length
  end
  --profilerPopEvent(""ai_calculate_curvature"")

  -- calculate node vertical curvature
  if not opt.racing then
    len = 0
    local v1z, v2z, v3z = vec3(), vec3(), vec3()
    for i = 2, plan.planCount - 1 do
      local n1, n2 = plan[i], plan[i+1]

      v1z:set(plan[i-1].length, 0, n1.posOrig.z - plan[i-1].posOrig.z)
      v2z:set(n1.length, 0, n2.posOrig.z - n1.posOrig.z)
      v3z:set(n1.length + (n2.length or 0), 0, plan[min(plan.planCount, i + 2)].posOrig.z - n1.posOrig.z)

      local curvatureZ = min(inCurvature(v1z, v2z), inCurvature(v1z, v3z))
      --dump(i,'curvature', curvature, 'Zcurv', curvatureZ)

      -- calculate curvature temporal smoothing parameter (fast reacting, time dependent)
      local curvatureRateDt = min(25 + 0.000045 * len * len * len * len, 1000) * dt
      n1.curvatureZ = curvatureZ + (curvatureRateDt / (1 + curvatureRateDt)) * (n1.curvatureZ - curvatureZ)

      len = len + n1.length
    end
  end

  -- Speed Planning --
  local totalAccel = min(aggression, ego.staticFrictionCoef) * g

  local lastNode = plan[plan.planCount]
  if route.path[lastNode.pathidx+1] or (loopPath and noOfLaps and noOfLaps > 1) then
    if plan.stopSeg <= plan.planCount then
      lastNode.speed = 0
    else
      lastNode.speed = lastNode.manSpeed or sqrt(2 * 550 * totalAccel) -- shouldn't this be calculated based on the path length remaining?
    end
  else
    lastNode.speed = lastNode.manSpeed or 0
  end
  lastNode.roadSpeedLimit = plan[plan.planCount-1].roadSpeedLimit
  lastNode.legalSpeed = min(lastNode.roadSpeedLimit or math.huge, lastNode.speed)

  -- Use Backward or Forward + Backward algorithm
  --profilerPushEvent('ai_speedProfile')
  if speedProfileMode then
    local gT = vec3()
    for i = 1, plan.planCount-1 do -- curvature is not defined on the last plan node
      local n1, n2 = plan[i], plan[i+1]
      -- consider inclination
      gT:setSub2(n2.pos, n1.pos); gT:setScaled(gravityDir:dot(gT) / max(square(n1.length), 1e-30)) -- gravity vec parallel to road segment: positive when downhill
      local gN = gravityDir:distance(gT) -- gravity component normal to road segment
      n1.acc_max = totalAccel * gN
      n1.speed = min(n1.acc_max / max(abs(n1.curvature), 1e-30), gN * g / max(n1.curvatureZ, 1e-30)) -- available centripetal acceleration * radius
    end
    plan[plan.planCount].acc_max = plan[plan.planCount-1].acc_max

    if speedProfileMode == 'ForwBack' then
      solver_f_acc_profile(plan)
    end

    solver_b_acc_profile(plan)
  else -- Use standard algotihm with curvature
    local gT = vec3()
    for i = plan.planCount-1, 1, -1 do
      local n1, n2 = plan[i], plan[i+1]

      -- consider inclination
      gT:setSub2(n2.pos, n1.pos); gT:setScaled(gravityDir:dot(gT) / max(square(n1.length), 1e-30)) -- gravity vec parallel to road segment: positive when downhill
      local gN = gravityDir:distance(gT) -- gravity component normal to road segment

      local curvature = max(abs(n1.curvature), 1e-5)
      local turnSpeedSq = totalAccel * gN / curvature -- available centripetal acceleration * radius

      local n1SpeedSq
      if plan.stopSeg <= i then
        n1SpeedSq = 0
      else -- speed limit imposed by other traffic vehicles and speed limit imposed by trajectory geometry (curvature and path length)
        -- https://physics.stackexchange.com/questions/312569/non-uniform-circular-motion-velocity-optimization
        n1SpeedSq = min(n1.trafficSqVel, turnSpeedSq * sin(min(asin(min(1, square(n2.speed) / turnSpeedSq)) + 2 * curvature * n1.length, pi * 0.5)))
      end

      n1.speed = n1.manSpeed or
                  (M.speedMode == 'limit' and M.routeSpeed and min(M.routeSpeed, sqrt(n1SpeedSq))) or
                  (M.speedMode == 'set' and M.routeSpeed) or
                  sqrt(n1SpeedSq)

      -- Speed envelope considering road speed limits
      if M.speedMode == 'legal' then
        n2.legalSpeed = n2.legalSpeed or n2.speed

        if plan.stopSeg <= i then
          n1.legalSpeed = 0
        else -- speed limit imposed by other traffic vehicles and speed limit imposed by trajectory geometry (curvature and path length)
          local n1LegalSpeedSq = min(n1.trafficSqVel, turnSpeedSq * sin(min(asin(min(1, square(n2.legalSpeed) / turnSpeedSq)) + 2 * curvature * n1.length, pi * 0.5)))
          if n1.roadSpeedLimit then
            n1.legalSpeed = min(sqrt(n1LegalSpeedSq), n1.roadSpeedLimit * (1 + aggression * 2 - 0.6))
          else
            n1.legalSpeed = sqrt(n1LegalSpeedSq)
          end
        end
      end

      n1.trafficSqVel = math.huge
    end
  end
  --profilerPopEvent('ai_speedProfile')

  plan.targetSpeed = plan[1].speed + max(0, plan.egoXnormOnSeg) * (plan[2].speed - plan[1].speed)
  plan.targetSpeed = targetSpeedSmoother:get(plan.targetSpeed, dt)
  if M.speedMode == 'legal' then
    plan.targetSpeedLegal = plan[1].legalSpeed + max(0, plan.egoXnormOnSeg) * (plan[2].legalSpeed - plan[1].legalSpeed)
  else
    plan.targetSpeedLegal = math.huge
  end

  -- TODO: WIP
  --calculateTrafficTargetSpeed(plan, traffic.trafficTable, trafficTableLen)
  --plan.targetSpeed = min(plan.targetSpeed, plan.trafficTargetSpeed)

  return route
end

local function resetMapAndRoute()
  mapData = nil
  signalsData = nil
  currentRoute = nil
  loopPath = nil
  noOfLaps = nil
  internalState.road = 'onroad'
  internalState.changePlanTimer = 0
  resetAggression()
  resetInternalStates()
  resetParameters()
end

local function getMapEdges(cutOffDrivability, node)
  -- creates a table (edgeDict) with map edges with drivability > cutOffDrivability
  if mapData ~= nil then
    local allSCC = mapData:scc(node) -- An array of dicts containing all strongly connected components reachable from 'node'.
    local maxSccLen = 0
    local sccIdx
    for i, scc in ipairs(allSCC) do
      -- finds the scc with the most nodes
      local sccLen = scc[0] -- position at which the number of nodes in currentSCC is stored
      if sccLen > maxSccLen then
        sccIdx = i
        maxSccLen = sccLen
      end
      scc[0] = nil
    end
    local currentSCC = allSCC[sccIdx]
    local keySet = {}
    local keySetLen = 0

    edgeDict = {}
    for nid, n in pairs(mapData.graph) do
      if currentSCC[nid] or not opt.driveInLaneFlag then
        for lid, data in pairs(n) do
          if (currentSCC[lid] or not opt.driveInLaneFlag) and (data.drivability > cutOffDrivability) then
            local inNode = data.inNode or nid
            local outNode = inNode == nid and lid or nid
            keySetLen = keySetLen + 1
            keySet[keySetLen] = {inNode, outNode}
            edgeDict[inNode..'\0'..outNode] = 1
            if not data.inNode or not opt.driveInLaneFlag then
              edgeDict[outNode..'\0'..inNode] = 1
            end
          end
        end
      end
    end

    if keySetLen == 0 then return end
    local edge = keySet[math.random(keySetLen)]

    return edge[1], edge[2]
  end
end

local function newManualPath()
  local newRoute, n1, n2, dist
  local offRoad = false

  if manualPath then
    if currentRoute and currentRoute.path then
      pathExtend(currentRoute.path, manualPath)
    else
      newRoute = createNewRoute(manualPath)
      currentRoute = newRoute
    end
    manualPath = nil
  elseif wpList then
    if currentRoute and currentRoute.path then
      newRoute = {
        path = currentRoute.path,
        plan = currentRoute.plan,
        laneChanges = currentRoute.laneChanges,
        lastLaneChangeIdx = currentRoute.lastLaneChangeIdx,
        pathLength = currentRoute.pathLength
      }
    else
      n1, n2, dist = mapmgr.findClosestRoad(ego.pos)

      if n1 == nil or n2 == nil then
        guihooks.message(""Could not find a road network, or closest road is too far"", 5, ""AI debug"")
        log('D', ""AI"", ""Could not find a road network, or closest road is too far"")
        return
      end

      ego.currentSegment[1] = n1
      ego.currentSegment[2] = n2

      if dist > 2 * max(mapData.radius[n1], mapData.radius[n2]) then
        offRoad = true
        local vec1 = mapData.positions[n1] - ego.pos
        local vec2 = mapData.positions[n2] - ego.pos

        if ego.dirVec:dot(vec1) > 0 and ego.dirVec:dot(vec2) > 0 then
          if vec1:squaredLength() > vec2:squaredLength() then
            n1, n2 = n2, n1
          end
        elseif ego.dirVec:dot(mapData.positions[n2] - mapData.positions[n1]) > 0 then
          n1, n2 = n2, n1
        end
      elseif ego.dirVec:dot(mapData.positions[n2] - mapData.positions[n1]) > 0 then
        n1, n2 = n2, n1
      end

      newRoute = createNewRoute({n1})
    end

    for i = 0, #wpList-1 do
      local wp1 = wpList[i] or newRoute.path[#newRoute.path]
      local wp2 = wpList[i+1]
      local route = mapData:getPath(wp1, wp2, opt.driveInLaneFlag and 1e4 or 1)
      local routeLen = #route
      if routeLen == 0 or (routeLen == 1 and wp2 ~= wp1) then
        guihooks.message(""Path between waypoints '"".. wp1 ..""' - '"".. wp2 ..""' Not Found"", 7, ""AI debug"")
        log('D', ""AI"", ""Path between waypoints '"".. wp1 ..""' - '"".. wp2 ..""' Not Found"")
        return
      end

      for j = 2, routeLen do
        tableInsert(newRoute.path, route[j])
      end
    end

    wpList = nil

    if not offRoad and newRoute.path[3] and newRoute.path[2] == n2 then
      tableRemove(newRoute.path, 1)
    end

    currentRoute = newRoute
  end
end

local function setScriptedPath(arg)
  mapmgr.setCustomMap(arg.mapData)
  mapData = mapmgr.mapData

  setParameters({
    driveStyle = arg.driveStyle or 'default',
    staticFrictionCoefMult = max(0.95, arg.staticFrictionCoefMult or 0.95),
    lookAheadKv = max(0.1, arg.lookAheadKv or parameters.lookAheadKv),
    planErrorSmoothing = false,
    avoidCars = arg.avoidCars,
    understeerThrottleControl = arg.understeerThrottleControl,
    oversteerThrottleControl = arg.oversteerThrottleControl,
    throttleTcs = arg.throttleTcs,
    abBrakeControl = arg.abBrakeControl,
    underSteerBrakeControl = arg.underSteerBrakeControl,
    throttleKp = arg.throttleKp,
    springForceIntegratorDispLim = arg.springForceIntegratorDispLim,
    turnForceCoef = arg.turnForceCoef})

  opt.avoidCars = arg.avoidCars or 'off'
  noOfLaps = arg.noOfLaps
  loopPath = arg.loopPath
  setSpeed(arg.routeSpeed)
  setSpeedMode(arg.routeSpeedMode)
  setAggressionExternal(arg.aggression)

  if arg.speedProfile and next(arg.speedProfile) then
    speedProfile = arg.speedProfile
  end

  currentRoute = createNewRoute(arg.path) -- {path = arg.path, plan = {}}

  stateChanged()
end

local function validateUserInput(list)
  validateInput = nop
  list = list or wpList
  if not list then return end
  local isValid = list[1] and true or false
  for i = 1, #list do -- #wpList
    local nodeAlias = mapmgr.nodeAliases[list[i]]
    if nodeAlias then
      if mapData.graph[nodeAlias] then
        list[i] = nodeAlias
      else
        if isValid then
          guihooks.message(""One or more of the waypoints were not found on the map. Check the game console for more info."", 6, ""AI debug"")
          log('D', ""AI"", ""The waypoints with the following names could not be found on the Map"")
          isValid = false
        end
        -- print(list[i])
      end
    end
  end

  return isValid
end

local function fleePlan()
  if opt.aggressionMode == 'rubberBand' then
    setAggressionInternal(max(0.3, 0.95 - 0.0015 * player.pos:distance(ego.pos)))
  end

  -- extend the plan if possible and desirable
  if currentRoute and not currentRoute.plan.reRoute then
    local plan = currentRoute.plan
    if ego.pos:dot(ego.dirVec) >= player.pos:dot(ego.dirVec) and not targetWPName and internalState.road ~= 'offroad' and plan.trafficMinProjSpeed > 3 then
      local path = currentRoute.path
      local pathCount = #path
      if pathCount >= 3 and plan[2].pathidx > pathCount * 0.7 then
        local cr1 = path[pathCount-1]
        local cr2 = path[pathCount]
        local dirVec = mapData.positions[cr2] - mapData.positions[cr1]
        dirVec:normalize()
        pathExtend(path, mapData:getFleePath(cr2, dirVec, player.pos, getMinPlanLen(), 0.01, 0.01))
        planAhead(currentRoute)
        return
      end
    end
  end

  if not currentRoute or internalState.changePlanTimer == 0 or currentRoute.plan.reRoute then
    local wp1, wp2 = mapmgr.findClosestRoad(ego.pos)
    if wp1 == nil or wp2 == nil then
      internalState.road = 'offroad'
      return
    else
      internalState.road = 'onroad'
    end

    ego.currentSegment[1] = wp1
    ego.currentSegment[2] = wp2

    local dirVec
    if currentRoute and currentRoute.plan.trafficMinProjSpeed < 3 then
      internalState.changePlanTimer = 5
      dirVec = -ego.dirVec
    else
      dirVec = ego.dirVec
    end

    local startnode = pickAiWp(wp1, wp2, dirVec)
    local path
    if not targetWPName then
      path = mapData:getFleePath(startnode, dirVec, player.pos, getMinPlanLen(), 0.01, 0.01)
    else -- flee to destination
      path = mapData:getPathAwayFrom(startnode, targetWPName, ego.pos, player.pos)
      if next(path) == nil then
        targetWPName = nil
      end
    end

    if not path[1] then
      internalState.road = 'offroad'
      return
    else
      internalState.road = 'onroad'
    end

    local route = planAhead(path, currentRoute)
    if route and route.plan then
      local tempPlan = route.plan
      if not currentRoute or internalState.changePlanTimer > 0 or tempPlan.targetSpeed >= min(ego.speed, currentRoute.plan.targetSpeed) and targetsCompatible(currentRoute, route) then
        currentRoute = route
        internalState.changePlanTimer = max(1, internalState.changePlanTimer)
        return
      elseif currentRoute.plan.reRoute then
        currentRoute = route
        internalState.changePlanTimer = max(1, internalState.changePlanTimer)
        return
      end
    end
  end

  planAhead(currentRoute)
end

local function chasePlan()
  local positions = mapData.positions
  local radii = mapData.radius

  internalState.chaseData.targetSpeed = nil

  local wp1, wp2, dist1 = mapmgr.findBestRoad(ego.pos, ego.dirVec)
  if wp1 == nil or wp2 == nil then
    internalState.road = 'offroad'
    return
  end

  local playerSpeed = player.vel:length()
  local playerVel = playerSpeed > 1 and player.vel or player.dirVec -- uses dirVec for very low speeds

  local plwp1, plwp2, dist2 = mapmgr.findBestRoad(player.pos, playerVel)
  if plwp1 == nil or plwp2 == nil then
    internalState.road = 'offroad'
    return
  end

  if positions[wp2]:dot(ego.dirVec) < positions[wp1]:dot(ego.dirVec) then wp1, wp2 = wp2, wp1 end
  -- wp2 is next node for ego to drive to

  ego.currentSegment[1] = wp1
  ego.currentSegment[2] = wp2

  if (playerVel / (playerSpeed + 1e-30)):dot(positions[plwp2] - positions[plwp1]) < 0 then plwp1, plwp2 = plwp2, plwp1 end
  -- plwp2 is next node that player is driving to

  if dist1 > max(radii[wp1], radii[wp2]) + ego.width and dist2 > max(radii[plwp1], radii[plwp2]) + obj:getObjectInitialWidth(player.id) then
    internalState.road = 'offroad'
    return
  end

  local playerNode = plwp2
  local egoPlDist = ego.pos:distance(player.pos) -- should this be a signed distance?
  local egoPosRear = ego.pos - ego.dirVec * ego.length
  local nearDist = max(ego.length + 8, internalState.chaseData.playerStoppedTimer) -- larger if player stopped for longer (anti softlock)
  local isAtPlayerSeg = (wp1 == playerNode or wp2 == playerNode)

  if opt.aggressionMode == 'rubberBand' then
    if M.mode == 'follow' then
      setAggressionInternal(min(0.75, 0.3 + 0.0025 * egoPlDist))
    else
      setAggressionInternal(min(0.95, 0.8 + 0.0015 * egoPlDist))
    end
  end

  -- consider calculating the aggression value but then passing it through a smoother so that transitions between chase mode and follow mode are smooth

  if playerSpeed < 1 then
    internalState.chaseData.playerStoppedTimer = internalState.chaseData.playerStoppedTimer + dt
  else
    internalState.chaseData.playerStoppedTimer = 0
  end

  if internalState.chaseData.playerStoppedTimer > 5 and egoPlDist < max(nearDist, square(ego.speed) / (2 * g * aggression)) then -- within braking distance to player
    internalState.chaseData.playerState = 'stopped'

    if ego.speed < 0.3 and egoPlDist < nearDist then
      -- do not plan new route if stopped near player
      currentRoute = nil
      internalState.road = 'onroad'
      return
    end
  else
    internalState.chaseData.playerState = nil
  end

  if internalState.chaseData.driveAhead and ego.speed >= 10 then -- unset this flag if the ego reached a minimum speed
    internalState.chaseData.driveAhead = false
  end

  if M.mode == 'follow' and ego.speed < 0.3 and isAtPlayerSeg and egoPlDist < nearDist then
    -- do not plan new route if ego reached player
    currentRoute = nil
    internalState.road = 'onroad'
    return
  end

  if currentRoute then
    local curPlan = currentRoute.plan
    local playerNodeInPath = waypointInPath(currentRoute.path, playerNode, curPlan[2].pathidx) or false

    local planVec = curPlan[2].pos - curPlan[1].pos
    local playerIncoming = playerSpeed >= 3 and playerNode == wp1 and egoPlDist < max(ego.speed, playerSpeed) and playerVel:dot(planVec) < 0 -- player is driving towards or past ego on the segment
    local playerBehind = playerSpeed >= 3 and planVec:dot(playerVel) > 0 and ego.dirVec:dot(egoPosRear - player.pos) > 0 -- player got passed by ego
    local playerOtherWay = not playerNodeInPath and planVec:dot(positions[playerNode] - ego.pos) < 0 and (playerSpeed < 3 or playerVel:dot(player.pos - ego.pos) > 0) -- player is driving other way from ego

    local route
    if not playerNodeInPath and not internalState.chaseData.driveAhead and (ego.speed < 3 or ego.dirVec:dot(player.pos - ego.pos) > 0) then -- prevents ego from cancelling its current route if it should slow down to turn around
      local path = mapData:getChasePath(wp1, wp2, plwp1, plwp2, ego.pos, ego.vel, player.pos, player.vel, opt.driveInLaneFlag and 1e4 or 1)

      route = planAhead(path, currentRoute) -- ignore current route if path should go other way
      if route and route.plan then --and tempPlan.targetSpeed >= min(ego.speed, curPlan.targetSpeed) and (tempPlan.targetPos-curPlan.targetPos):dot(ego.dirVec) >= 0 then
        currentRoute = route
      end
    end

    local pathLen = getPathLen(currentRoute.path, playerNodeInPath or math.huge) -- curPlan[2].pathidx
    local playerMinPlanLen = getMinPlanLen(0, playerSpeed)
    if M.mode == 'chase' and pathLen < playerMinPlanLen then -- chase path should be extended
      local pathCount = #currentRoute.path
      local fleePath = mapData:getFleePath(currentRoute.path[pathCount], playerVel, player.pos, playerMinPlanLen, 0, 0)
      if fleePath[2] ~= wp1 and fleePath[2] ~= wp2 and fleePath[2] ~= currentRoute.path[pathCount - 1] then -- only extend the path if it does not do a u-turn
        pathExtend(currentRoute.path, fleePath)
      end
    end

    if not route then
      planAhead(currentRoute)
    end

    local targetSpeed

    if M.mode == 'chase' then
      local brakeDist = square(ego.speed) / (2 * g * aggression)
      local relSpeed = playerVel:dot(ego.dirVec)
      local crashSpeed = 10 -- minimum relative crash speed
      if egoPlDist < max(brakeDist, nearDist) and ego.dirVec:dot(egoPosRear - player.pos) < 0 then
        targetSpeed = max(crashSpeed, relSpeed + crashSpeed)
        internalState.chaseData.targetSpeed = targetSpeed
      end
    end

    if not internalState.chaseData.driveAhead then
      if playerIncoming or playerOtherWay then -- come to a stop, then plan to turn around
        targetSpeed = 0
      elseif playerBehind then -- match the player speed based on distance
        targetSpeed = clamp(playerSpeed * (1 - egoPlDist / 120), 5, max(5, curPlan[2].speed))
      end
    end
    curPlan.targetSpeed = targetSpeed or curPlan.targetSpeed

    if M.mode == 'chase' then
      internalState.road = 'onroad'

      if playerIncoming then -- player is head on versus ego
        internalState.road = 'tail'
      elseif egoPlDist < 25 and ego.dirVec:dot((ego.pos - ego.dirVec * ego.length) - player.pos) < 0 then -- player is near ego, but ego path does a u-turn
        local uTurn = false
        for i, p in ipairs(currentRoute.path) do -- detect path u-turn
          if p == playerNode then break end
          if i > 2 and ego.dirVec:dot(positions[p] - positions[currentRoute.path[i - 1]]) < 0 then
            uTurn = true
            break
          end
        end
        if uTurn then
          -- cast a ray to see if ego can directly attack player without hitting a barrier
          if obj:castRayStatic(ego.pos + ego.upVec * 0.5, (ego.pos - player.pos) / (egoPlDist + 1e-30), egoPlDist) >= egoPlDist then
            internalState.road = 'tail'
            if isAtPlayerSeg then -- important to reset the route here
              currentRoute = nil
              return
            end
          end
        end
      end
      if not playerIncoming and (plwp2 == currentRoute.path[curPlan[2].pathidx] or plwp2 == currentRoute.path[curPlan[2].pathidx + 1]) then -- player is matching ego target node
        local playerNodePos1 = positions[plwp2]
        local segDir = playerNodePos1 - positions[plwp1]
        local targetLineDir = vec3(-segDir.y, segDir.x, 0); targetLineDir:normalize()
        local xnorm1 = closestLinePoints(playerNodePos1, playerNodePos1 + targetLineDir, player.pos, player.pos + player.dirVec)
        local xnorm2 = closestLinePoints(playerNodePos1, playerNodePos1 + targetLineDir, ego.pos, ego.pos + ego.dirVec)
        -- player xnorm and ego xnorm get interpolated here
        local tarPos = playerNodePos1 + targetLineDir * clamp(lerp(xnorm1, xnorm2, 0.5), -radii[plwp2], radii[plwp2])

        local p2Target = tarPos - player.pos; p2Target:normalize()
        local plVel2Target = playerSpeed > 0.1 and player.vel:dot(p2Target) or 0
        local plTimeToTarget = tarPos:distance(player.pos) / (plVel2Target + 1e-30)

        local egoVel2Target = ego.speed > 0.1 and ego.vel:dot((tarPos - ego.pos):normalized()) or 0
        local egoTimeToTarget = tarPos:distance(ego.pos) / (egoVel2Target + 1e-30)

        if egoTimeToTarget < plTimeToTarget and not playerBehind then
          internalState.road = 'tail'
        end
      end
    end

    if internalState.chaseData.playerState == 'stopped' then
      currentRoute.plan.targetSpeed = 0
    end
  else
    local path
    if M.mode == 'chase' and ego.dirVec:dot(playerVel) > 0 and ego.dirVec:dot(egoPosRear - player.pos) > 0 then
      path = mapData:getFleePath(wp2, playerVel, player.pos, getMinPlanLen(100, ego.speed), 0, 0)
      internalState.chaseData.driveAhead = true
    else
      path = mapData:getChasePath(wp1, wp2, plwp1, plwp2, ego.pos, ego.vel, player.pos, player.vel, opt.driveInLaneFlag and 1e4 or 1)
      internalState.chaseData.driveAhead = false
    end

    local route = planAhead(path)
    if route and route.plan then
      currentRoute = route
    end
  end
end

M.pullOver = false
local function setPullOver(val)
  M.pullOver = val
end

local relativePosOtherVehicle = vec3()
local posRelativeToPolice = vec3()
local function trafficActions()
  if not currentRoute then return end
  local path, plan = currentRoute.path, currentRoute.plan

  -- horn
  if parameters.enableElectrics and trafficStates.action.hornTimer == 0 then
    electrics.horn(true)
    trafficStates.action.hornTimerLimit = max(0.1, math.random())
  end
  if trafficStates.action.hornTimer >= trafficStates.action.hornTimerLimit then
    electrics.horn(false)
    trafficStates.action.hornTimer = -1
  end

  if trafficStates.action.hornTimer >= 0 then
    trafficStates.action.hornTimer = trafficStates.action.hornTimer + dt
  end

  local pullOver = false
  pullOver = M.pullOver

  -- hazard lights
  if beamstate.damage >= 1000 then
    if recover.recoverOnCrash then
      recover._recoverOnCrash = true
    else
      if electrics.values.signal_left_input == 0 and electrics.values.signal_right_input == 0 then
        electrics.set_warn_signal(1)
      end
      pullOver = true
    end
  end

  -- pull over
  local minSirenSqDist = math.huge
  local nearestPoliceId

  for plID, v in pairs(mapmgr.getObjects()) do
    if plID ~= objectId and v.states then
      if v.states.lightbar == 2 or (v.states.lightbar == 1 and v.vel:squaredLength() >= 100) then
        local posFront = obj:getObjectFrontPosition(plID)
        minSirenSqDist = min(minSirenSqDist, posFront:squaredDistance(ego.pos))
        nearestPoliceId = plID
      end
    end
  end
  if minSirenSqDist <= 10000 then
    pullOver = true
    trafficStates.action.nearestPoliceId = nearestPoliceId
  end

  if trafficStates.action.nearestPoliceId then
    local police = mapmgr.objects[trafficStates.action.nearestPoliceId]
    if police and police.states and police.states.lightbar then
      posRelativeToPolice:setSub2(ego.pos, police.pos)
      posRelativeToPolice:normalize()
      if posRelativeToPolice:dot(police.dirVec) > 0.94 then
        if ego.speed < 10 and ego.pos:squaredDistance(police.pos) < 400 then
          pullOver = true -- vehicle stays pulled over in this case, and other traffic may keep driving
        end

        if ego.dirVec:dot(police.dirVec) > 0.5 then
          -- Check if there's a vehicle next to this one
          for otherID, v in pairs(mapmgr.getObjects()) do
            if otherID ~= objectId and v.pos and otherID ~= trafficStates.action.nearestPoliceId and v.dirVec and v.dirVec:dot(ego.dirVec) < 0 then
              local distance = ego.pos:squaredDistance(v.pos)

              -- Check if the other vehicle is within a reasonable distance to be considered ""next to"" us
              if distance < 225 then -- within 15 meters
                relativePosOtherVehicle:setSub2(v.pos, ego.pos)
                local forwardDist = relativePosOtherVehicle:dot(ego.dirVec)
                local lateralDist = relativePosOtherVehicle:dot(ego.rightVec)

                -- Check if the vehicle is alongside us
                if abs(forwardDist) < 10 and abs(lateralDist) < 6 then -- vehicle is alongside within 8m forward/back and 6m lateral
                  -- Only check for vehicles on the other side of the street
                  -- For right-hand drive: other side is to the left (positive cross product z-component)
                  -- For left-hand drive: other side is to the right (negative cross product z-component)
                  local isOnOtherSide = mapmgr.rules.rightHandDrive and lateralDist > 0 or not mapmgr.rules.rightHandDrive and lateralDist < 0

                  if isOnOtherSide then
                    pullOver = false
                    break
                  end
                end
              end
            end
          end
        end
      end
    end
  end

  if pullOver and not trafficStates.action.forcedStop and ego.speed >= 3 then
    local brakeDist = square(ego.speed) / (2 * g * aggression)
    local dist = max(10, brakeDist)
    local idx = getLastNodeWithinDistance(plan, dist)
    local n = plan[idx]
    local side = mapmgr.rules.rightHandDrive and -1 or 1
    local disp = n.pos:distance(n.posOrig + n.normal * side * (n.halfWidth - ego.width * 0.5))
    trafficStates.side.displacement = disp
    --dist = dist + disp * 4 -- arbitrary extra distance?

    laneChange(plan, max(10, dist - 20), disp * side)
    setStopPoint(plan, dist, {avoidJunction = true})
    trafficStates.action.forcedStop = true
    trafficStates.side.side = mapmgr.rules.rightHandDrive and -1 or 1
  end

  if not pullOver and trafficStates.action.forcedStop then
    --laneChange(plan, 40, -trafficStates.side.displacement) -- this is no longer needed?
    setStopPoint()
    trafficStates.action.forcedStop = false
    trafficStates.action.nearestPoliceId = nil
  end

  if trafficStates.action.forcedStop and ego.speed < min(plan.targetSpeed or 0, 1) then -- instant plan stop
    setStopPoint(plan, 0)
  end

  -- Search for controlled (traffic light or stop sign) or uncontrolled (right of way) intersections along the path
  local tSi = trafficStates.intersection
  if not tSi.node then
    tSi.block = false

    tSi.startIdx = tSi.startIdx or (plan[1].wp and plan[1].pathidx-1 or plan[1].pathidx)
    for i = tSi.startIdx, #path - 1 do -- TODO: would searching up to min(#path-1, plan[plan.planCount].pathIdx) work to distribute the load over more frames work?
      local nid1, nid2 = path[i], path[i + 1]
      if not nid1 then
        nid1 = plan[1].wp -- just in case the ego is at the very start of the plan
      end

      if nid1 and nid2 then
        -- if trafficStates.intersection.prevNode == nid1 then break end -- vehicle is still within previous intersection

        local n1Pos, n2Pos = mapData.positions[nid1], mapData.positions[nid2]

        -- *****Controlled intersection (traffic light or stop sign)******
        if signalsData and signalsData[nid1] and signalsData[nid1][nid2] then -- nodes from current path match the signals dict
            -- TODO: check the array for the ideal signal to use
            -- lane check as well, if applicable
          local bestSignal = signalsData[nid1][nid2][1]

          local nDir = n2Pos - n1Pos
          nDir.z = 0
          nDir:normalize()
          table.clear(tSi)
          tSi.node = nid1
          tSi.nextNode = nid2
          tSi.nodeIdx = 1
          tSi.pos = bestSignal.pos
          tSi.dir = nDir
          tSi.action = bestSignal.action
          tSi.block = false
          tSi.controlled = true

          -- adding turnDir
          if path[i + 2] then
            local n3Pos = mapData.positions[path[i + 2]]
            if tableSize(mapData.graph[nid2]) > 2 then -- if next path node is not in the middle of the junction
              tSi.turnDir = n3Pos - n2Pos
              tSi.turnDir.z = 0
              tSi.turnDir:normalize()
              tSi.turnNode = nid2
            else
              if path[i + 3] then
                tSi.turnDir = mapData.positions[path[i + 3]] - n3Pos
                tSi.turnDir.z = 0
                tSi.turnDir:normalize()
                tSi.turnNode = path[i + 2]
              end
            end
          end

        end

        -- *****detect uncontrolled intersection or set the turn direction for an already detected controlled intersection******
        if tableSize(mapData.graph[nid1]) > 2 and not tSi.node and tSi.startIdx > 0 then
          -- we should try to get the effective curvature of the path after this point to determine turn signals

          -- Get Direction Vector of edge exiting nid1
          local linkDir = vec3(); linkDir:setSub2(mapData:getEdgePositions(nid2, nid1))
          linkDir.z = 0
          linkDir:normalize()

          -- Get path Direction Vector to nid1
          local prevNode = path[i-1] or plan[1].wp
          local nDir = vec3()
          local drivability = 1
          if mapData.graph[nid1][prevNode] then
            nDir:setSub2(mapData:getEdgePositions(nid1, prevNode))
            nDir.z = 0
            nDir:normalize()
            drivability = mapData.graph[nid1][prevNode].drivability
          else
            prevNode = nil
            nDir:set(ego.dirVec)
          end

          -- Give way if the direction change at nid1 is greater than 45 deg and less than 135 deg
          -- or if the current path edge leading to nid1 has drivability lower than other roads incident on nid1
          local giveWay = abs(nDir:dot(linkDir)) < 0.707

          if not giveWay and drivability < 1 then
            for _, edgeData in pairs(mapData.graph[nid1]) do
              if edgeData.drivability > drivability then
                giveWay = true
                break
              end
            end
          end

          if giveWay then
            local fourthNode -- the fourth node in a T-junction (the other three nodes being prevNode, nid1, nid2)
            -- the prevNode check is to make sure one of the three roads of the T-Junction is the one the vehicle is comming from
            if prevNode and tableSize(mapData.graph[nid1]) == 3 then
              for k, v in pairs(mapData.graph[nid1]) do
                if k ~= prevNode and k ~= nid2 then
                  fourthNode = k
                end
              end
            end

            -- Checks if the vehicle has right of way in this T-junction
            local side = mapmgr.rules.rightHandDrive and -1 or 1
            local nContinuation = fourthNode and roadNaturalContinuation(fourthNode, nid1)
            local dotDir = side*gravityDir:cross(nDir):dot(linkDir)
            if not (fourthNode and nContinuation ~= nid2 and dotDir > 0) then

              local pos = n1Pos - nDir * (max(3, mapData.radius[nid1]) + 2) --needs at least + 3

              table.clear(tSi)
              tSi.node = nid1
              tSi.nextNode = nid2
              tSi.turnNode = nid1
              tSi.turnDir = linkDir
              tSi.pos = pos
              tSi.dir = nDir
              tSi.action = 3
              tSi.block = false
              -- tSi.fullGiveWay -> giveWay to both left + right
              -- tSi.oneGiveWay -> giveWay only on (right) side
              -- tSi.otherGiveWay -> giveWay only on (left) side
              if fourthNode then
                tSi.fullGiveWay = nContinuation == nid2
                if not tSi.fullGiveWay then
                  tSi.oneGiveWay = dotDir < 0
                else
                  if dotDir > 0 then
                    tSi.fullGiveWay = false
                    tSi.otherGiveWay = true
                  end
                end
              else
                tSi.oneGiveWay = true
              end
            end
          end
        end
      end
      tSi.startIdx = i + 1

      if tSi.node then

        tSi.turn = 0
        tSi.timer = 0
        if tSi.turnDir then
          if abs(tSi.dir:dot(tSi.turnDir)) < 0.707 then
            tSi.turn = -sign2(tSi.dir:cross(gravityDir):dot(tSi.turnDir))
          end
        end

        break
      end
    end
  end

  -- Manage stopping at found intersections
  if tSi.node and not trafficStates.action.forcedStop then
    local signalsRef = tSi.nodeIdx and signalsData[tSi.node][tSi.nextNode][tSi.nodeIdx]
    if signalsRef then
      tSi.action = signalsRef.action or 0 -- get action from referenced table
    else
      tSi.action = tSi.action or 0 -- default action (""go"")
    end
    --local sColor = tSi.action == 0 and color(0,255,0,160) or color(255,255,0,160)
    --obj.debugDrawProxy:drawSphere(1, tSi.pos, sColor)
    --obj.debugDrawProxy:drawText(tSi.pos + vec3(0, 0, 1), color(0,0,0,255), tostring(tSi.turn))

    local stopSeg = math.huge
    local brakeDist = square(ego.speed) / (2 * g * ego.staticFrictionCoef * min(1, aggression * 1.3))
    local distSq = ego.pos:squaredDistance(tSi.pos)

    if not tSi.proximity then -- checks if intersection was reached (needs improvement)
      tSi.proximity = distSq <= 400
    end

    if tSi.pos:dot(tSi.dir) + 4 * tSi.dir:dot(tSi.dir) >= ego.pos:dot(tSi.dir)  then -- vehicle position is at the stop pos (with extra distance, to be safe)
      if tSi.action == 3 or tSi.action == 2 or (tSi.action == 1 and (square(brakeDist) < distSq or tSi.commitStopOnYellow)) then -- red light or other stop condition
        local bestDist = 100
        for i = 1, plan.planCount - 1 do -- get best plan node to set as a stopping point
          -- currently checks every frame due to plan segment updates
          -- positional check is used due to issues with using plan.pathidx or complex intersections
          -- it would be great to improve this in the future
          local dist = plan[i].pos:squaredDistance(tSi.pos)
          if dist < bestDist then
            bestDist = dist
            stopSeg = i
          end
        end
        if stopSeg < math.huge and tSi.action == 1 then
          tSi.commitStopOnYellow = true
        end
      end

      if tSi.action == 3 or tSi.action == 2 then
        if stopSeg <= 2 and ego.speed <= 1 then -- stopped at stopping point
          tSi.timer = tSi.timer + dt
          -- if on an uncontrolled intersection, check if there are any vehicles around. if there aren't then continue.
          if tSi.action == 3 then
            local vehicleInRange = false
            local vPosF = vec3()
            local egoCenterPos = getObjectBoundingBox(objectId)
            local distToJcenter = tSi.turnNode and ego.pos:distance(mapData.positions[tSi.turnNode]) or 1
            for vId, v in pairs(mapmgr.getObjects()) do
              if vId ~= objectId then
                local vC, vX = getObjectBoundingBox(vId)
                vPosF:setAdd2(vC, vX)

                -- checkDirRad: v is outside a slice of +-45 degrees and is under a thredshold distance
                local check = false
                local checkDirRad
                if not isVehicleStopped(v) and v.dirVec:dot(vPosF - (ego.pos + distToJcenter * ego.dirVec)) < 0 then
                  checkDirRad = v.dirVec:dot(tSi.dir) < 0.707 and egoCenterPos:squaredDistance(vPosF) < square(max(min(60, max(40, v.vel:squaredLength() / (g * ego.staticFrictionCoef))), v.vel:length()*4))
                end
                -- Different tests for each kind of stop (controlled or fullGiveway/oneGiveWay/otherGiveWay)
                if checkDirRad then
                  if tSi.oneGiveWay then
                    local vFxnorm = tSi.turnDir and vPosF:xnormOnLine(tSi.pos, tSi.pos + 1.5*mapData.radius[tSi.turnNode or tSi.node]*tSi.turnDir) or 0
                    if vFxnorm > 0 and vFxnorm < 1 and v.dirVec:dot(tSi.dir) < -0.707 then
                      check = true
                    end
                  elseif tSi.otherGiveWay or tSi.turn == (mapmgr.rules.rightHandDrive and -1 or 1) then -- other or stop/full but turning to right
                    if tSi.turnDir and v.dirVec:dot(tSi.turnDir) > 0.707 then
                      check = true
                    end
                  else
                    check = true
                  end
                end

                if check then
                  vehicleInRange = true
                  local kr = tSi.controlled and parameters.delayFactorWaitTime[1] or parameters.delayFactorWaitTime[2]
                  local ks = 0.9
                  tSi.timer = tSi.timer - (kr + min(v.vel:squaredLength(),1)*(ks - kr)/1)*dt
                  tSi.timer = max(tSi.timer, 0)
                  break
                end
              end
            end
            if not vehicleInRange then
              tSi.timer = parameters.trafficWaitTime
            end
          end
        end

        if tSi.timer >= parameters.trafficWaitTime then
          if tSi.action == 2 then
            -- Turn on red allowed (right turn for RHT (LHD) and left turn for LHT (RHD) allowed after stopping and intersection is clear)
            if mapmgr.rules.turnOnRed and tSi.turn == (mapmgr.rules.rightHandDrive and -1 or 1) then
              tSi.nodeIdx = nil
              tSi.action = 0
            end
          else
            tSi.nodeIdx = nil
            tSi.action = 0
          end
        end
      end
    else
      if tSi.proximity then
        tSi.nodeIdx = nil
        tSi.action = 0
        if distSq > 400 then -- assumes that vehicle has cleared the intersection (20 m away from the signal point)
          -- temp data until next intersection search
          -- resync startIdx if it has fallen behind by the time the intersection is cleared.
          local startIdx = tSi.startIdx
          if plan[1].pathidx < plan[2].pathidx then -- plan[1] node is on a different path index than the node ahead of it
            -- skip path node if it is behind vehicle
            startIdx = max(startIdx, plan[1].pathidx)
          else
            startIdx = max(startIdx, plan[1].pathidx-1)
          end
          table.clear(tSi)
          tSi.timer = 0
          tSi.turn = 0
          tSi.block = false
          --tSi.prevNode = tSi.node
          tSi.startIdx = startIdx
        end
      end
    end

    plan.stopSeg = stopSeg
    if parameters.enableElectrics and tSi.turnNode and ego.pos:squaredDistance(mapData.positions[tSi.turnNode]) < square(max(50, brakeDist * 1.2)) then -- approaching intersection
      if tSi.turn < 0 and electrics.values.turnsignal >= 0 then
        electrics.toggle_left_signal()
      elseif tSi.turn > 0 and electrics.values.turnsignal <= 0 then
        electrics.toggle_right_signal()
      end
    end
  end
end

local function trafficPlan()
  --profilerPushEvent('ai_trafficPlan_pathfinding')
  if trafficStates.block.block then
    trafficStates.block.timer = trafficStates.block.timer + dt
  else
    trafficStates.block.timer = trafficStates.block.timer * 0.8
    trafficStates.block.hornFlag = false
  end

  if currentRoute and currentRoute.path[1] and not currentRoute.plan.reRoute and trafficStates.block.timer <= trafficStates.block.timerLimit then --and not currentRoute.plan.noExit
    local plan = currentRoute.plan
    local path = currentRoute.path
    if (internalState.road ~= 'offroad' and plan.planLen + getPathLen(path, plan[plan.planCount].pathidx) < getMinPlanLen()) or not path[plan[plan.planCount].pathidx+2] then
      local pathCount = #path

      local newPath
      newPath = mapData:getPathTWithState(path[pathCount], mapData.positions[path[pathCount]], getMinPlanLen(100), trafficPathState[1] and trafficPathState or ego.dirVec)
      table.clear(trafficPathState)
      for i, v in ipairs(newPath) do trafficPathState[i] = v end

      pathExtend(path, newPath)
    end
  else
    local wp1, wp2 = mapmgr.findBestRoad(ego.pos, ego.dirVec)

    if wp1 == nil or wp2 == nil then
      guihooks.message(""Could not find a road network, or closest road is too far"", 5, ""AI debug"")
      currentRoute = nil
      internalState.road = 'offroad'
      internalState.changePlanTimer = 0
      driveCar(0, 0, 0, 1)
      return
    end

    local radius = mapData.radius
    local position = mapData.positions
    local graph = mapData.graph

    local dirVec
    if trafficStates.block.timer > trafficStates.block.timerLimit and not graph[wp1][wp2].oneWay and (radius[wp1] + radius[wp2]) * 0.5 > ego.length then
      dirVec = -ego.dirVec -- tries to plan reverse direction
    else
      dirVec = ego.dirVec
    end

    wp1, wp2 = pickAiWp(wp1, wp2, dirVec)

    local path
    path = mapData:getPathTWithState(wp1, ego.pos, getMinPlanLen(80), ego.dirVec)
    table.clear(trafficPathState)
    for i, v in ipairs(path) do trafficPathState[i] = v end

    if path[2] == wp2 and path[3] then
      local xnorm = ego.pos:xnormOnLine(position[wp1], position[wp2])
      if xnorm >= 0 and xnorm <= 1 and (position[wp2] - position[wp1]):dot(ego.dirVec) < 0 then
        -- vehicle is within the first path segment but facing the wrong way
        table.remove(path, 1)
      end
    end
    ego.currentSegment[1] = wp1
    ego.currentSegment[2] = wp2

    if path and path[1] then
      local route = planAhead(path, currentRoute)

      if route and route.plan then
        trafficStates.block.timerLimit = max(1, parameters.trafficWaitTime * 2)

        table.clear(trafficStates.intersection)
        trafficStates.intersection.timer = 0
        trafficStates.intersection.turn = 0
        trafficStates.intersection.block = false

        if trafficStates.block.timer > trafficStates.block.timerLimit and trafficStates.action.hornTimer == -1 then
          trafficStates.block.timer = 0
          if not trafficStates.block.hornFlag then
            trafficStates.action.hornTimer = 0 -- activates horn
            trafficStates.block.hornFlag = true -- prevents horn from triggering again while stopped
          end

          currentRoute = route
          return
        elseif not currentRoute then
          currentRoute = route
          return
        elseif route.plan.targetSpeed >= min(currentRoute.plan.targetSpeed, ego.speed) and targetsCompatible(currentRoute, route) then
          currentRoute = route
          return
        end
      end
    end
  end
  --profilerPopEvent('ai_trafficPlan_pathfinding')

  --profilerPushEvent('ai_trafficActions')
  trafficActions()
  --profilerPopEvent('ai_trafficActions')

  --profilerPushEvent('ai_planAhead')
  planAhead(currentRoute)
  --profilerPopEvent('ai_planAhead')
end

local function warningAIDisabled(message)
  guihooks.message(message, 5, ""AI debug"")
  M.mode = 'disabled'
  M.updateGFX = nop
  resetMapAndRoute()
  stateChanged()
end

local function targetFollowControl(targetSpeed, distLim) -- throttle and brake control for when driving directly to player
  -- distLim: Minimum distance allowed

  -- local targetPos, throttleTargetSpeed, brakeTargetSpeed <-- WIP
  if not targetSpeed then
    if not player or not player.pos then return 0, 0, 0 end
    local plC, plX, plY, plZ = getObjectBoundingBox(player.id)
    local ego2PlDirVec = plC - ego.pos; ego2PlDirVec:normalize()
    local minHit = intersectsRay_OBB(ego.pos, ego2PlDirVec, plC, plX, plY, plZ)
    local plSpeedFromego = player.vel:dot(ego2PlDirVec)
    local ego2PlDist = minHit - (distLim or 3)
    targetSpeed = sqrt(max(0, abs(plSpeedFromego) * plSpeedFromego + 2 * g * min(aggression, ego.staticFrictionCoef) * ego2PlDist))

    -- WIP
    -- throttleTargetSpeed = sqrt(max(0, abs(plSpeedFromego) * plSpeedFromego + 2 * g * min(aggression, ego.staticFrictionCoef) * (minHit - (distLim or 3) - ego.speed * 1)))
    -- brakeTargetSpeed = sqrt(max(0, abs(plSpeedFromego) * plSpeedFromego + 2 * g * min(aggression * 1.5, ego.staticFrictionCoef) * (minHit - (distLim or 3))))
    -- targetPos = catmullRomChordal(ego.pos-ego.dirVec, ego.pos, plC-plX, plC-plX+plX:normalized(), min(1, max(ego.speed * parameters.lookAheadKv, 4.5) / ego.pos:distance(plC - plX)))
    -- obj.debugDrawProxy:drawSphere(0.25, targetPos, color(255, 0, 0, 255))
    -- obj.debugDrawProxy:drawSphere(0.25, plC-plX, color(0, 0, 255, 255))
    -- obj.debugDrawProxy:drawSphere(0.15, ego.pos + brakeTargetSpeed * ego.upVec, color(255, 0, 0, 255))
    -- obj.debugDrawProxy:drawSphere(0.15, ego.pos + throttleTargetSpeed * ego.upVec, color(0, 255, 0, 255))
    -- obj.debugDrawProxy:drawSphere(0.15, ego.pos + ego.speed * ego.upVec, color(0, 0, 255, 255))
  end

  local speedDif = targetSpeed - ego.speed
  return clamp(speedDif, 0, 1), clamp(-speedDif, 0, 1), targetSpeed

  -- WIP
  --return clamp((throttleTargetSpeed - ego.speed) * 0.25, 0, 1), clamp(ego.speed - brakeTargetSpeed, 0, 1), brakeTargetSpeed, targetPos
end

local function drivabilityChangeReroute()
  -- Description: handle changes in edge drivabilities
  -- This function compares the current path for collisions with the drivability change set
  -- if there is an edge along the current path that had its drivability decreased
  -- a flag is raised (currentRoute.plan.reRoute) then handled by the appropriate planner

  if currentRoute ~= nil then
    -- changeSet format: {nodeA1, nodeB1, driv1, nodeA2, nodeB2, driv2, ...}
    local changeSet = mapmgr.changeSet
    local changeSetCount = #changeSet
    local changeSetDict = table.new(0, 2 * (changeSetCount / 3))

    -- populate the changeSetDict with the changeSet nodes
    for i = 1, changeSetCount, 3 do
      if changeSet[i+2] < 0 then
        changeSetDict[changeSet[i]] = true
        changeSetDict[changeSet[i+1]] = true
      end
    end

    local path = currentRoute.path
    local nodeCollisionIdx
    for i = currentRoute.plan[2].pathidx, #path do
      if changeSetDict[path[i]] then
        -- if there is a collision continue with a thorough check (edges against edges)
        nodeCollisionIdx = i
        break
      end
    end

    if nodeCollisionIdx then
      table.clear(changeSetDict)
      local edgeTab = {'','\0',''}
      -- populate the changeSetDict with changeSet edges
      for i = 1, changeSetCount, 3 do
        if changeSet[i+2] < 0 then
          local nodeA, nodeB = changeSet[i], changeSet[i+1]
          edgeTab[1] = nodeA < nodeB and nodeA or nodeB
          edgeTab[3] = nodeA == edgeTab[1] and nodeB or nodeA
          changeSetDict[tableConcat(edgeTab)] = true
        end
      end

      local edgeCollisionIdx
      -- compare path edges with changeSetDict edges starting with the earliest edge containing the initialy detected node collision
      for i = max(currentRoute.plan[2].pathidx, nodeCollisionIdx - 1), #path-1 do
        local nodeA, nodeB = path[i], path[i+1]
        edgeTab[1] = nodeA < nodeB and nodeA or nodeB
        edgeTab[3] = nodeA == edgeTab[1] and nodeB or nodeA
        if changeSetDict[tableConcat(edgeTab)] then
          edgeCollisionIdx = i
          currentRoute.plan.reRoute = edgeCollisionIdx
          break
        end
      end

      -- if edgeCollisionIdx then
      --   -- find closest possible diversion point from edgeCollisionIdx
      --   local graph = mapData.graph
      --   for i = edgeCollisionIdx, currentRoute.plan[2].pathidx, -1 do
      --     local node = path[i]
      --     if tableSize(graph[node]) > 2 then

      --     end
      --   end
      --   dump(objectId, edgeCollisionIdx, path[edgeCollisionIdx], path[edgeCollisionIdx+1])
      -- end
    end
  end
end

local function getSafeTeleportPosRot()
  if currentRoute and currentRoute.path and currentRoute.path[2] then
    local pathIdx = #currentRoute.path
    local node = currentRoute.path[pathIdx]
    local pos = mapData.positions[node]

    local node2 = currentRoute.path[pathIdx-1]
    local pos2 = mapData.positions[node2]

    local dir = (pos - pos2):normalized()
    local up = mapmgr.surfaceNormalBelow(pos)
    local rot = quatFromDir(-dir:cross(up):cross(up), up) -- minus sign is due to convention used by safeTeleport

    if not mapData.graph[node][node2].oneway then
      -- if not a one way road shift the position to the right by half the road radius (ie. 1/4 of the width)
      pos = pos + dir:cross(up):normalized() * (mapData.radius[node] * 0.5)
    end

    return pos, rot
  end
end

M.updateGFX = nop
local function updateGFX(dtGFX)
  dt = dtGFX
  if traffic.rateQue > 0 then
    traffic.frameQue = traffic.frameQue + 1
  end

  if mapData ~= mapmgr.mapData then
    currentRoute = nil
  end

  if mapmgr.changeSet then
    drivabilityChangeReroute()
    mapmgr.changeSet = nil
  end

  mapData = mapmgr.mapData
  signalsData = mapmgr.signalsData

  if mapData == nil then return end

  ego.pos:set(obj:getFrontPosition())
  ego.pos.z = max(ego.pos.z - 1, obj:getSurfaceHeightBelow(ego.pos))
  ego.prevDirVec:set(ego.dirVec)
  ego.dirVec:set(obj:getDirectionVectorXYZ())
  ego.upVec:set(obj:getDirectionVectorUpXYZ())
  ego.rightVec:setCross(ego.dirVec, ego.upVec); ego.rightVec:normalize()
  ego.vel:set(obj:getSmoothRefVelocityXYZ())
  ego.speed = ego.vel:length()
  ego.width = ego.width or obj:getInitialWidth()
  ego.length = ego.length or obj:getInitialLength()
  ego.staticFrictionCoef = parameters.staticFrictionCoefMult * obj:getStaticFrictionCoef() -- depends on ground model, tire and tire load

  if lastCommand.throttle > 0.5 and ego.speed < 1 then
    internalState.egoCannotMoveTime = internalState.egoCannotMoveTime + dt
  else
    internalState.egoCannotMoveTime = 0
  end

  if ego.speed < 3 then
    trafficStates.side.cTimer = trafficStates.side.cTimer + dt
    trafficStates.side.timer = (trafficStates.side.timer + dt) % (2 * trafficStates.side.timerLimit)
    trafficStates.side.side = sign2(trafficStates.side.timerLimit - trafficStates.side.timer)
  else
    trafficStates.side.cTimer = max(0, trafficStates.side.cTimer - dt)
    trafficStates.side.timer = 0
    trafficStates.side.side = 1
  end

  if recover.recoverOnCrash then
    if ego.speed < 3 then
      recover.recoverTimer = recover.recoverTimer + dt
    else
      recover.recoverTimer = max(0, recover.recoverTimer - 5 * dt)
    end
    if recover._recoverOnCrash or recover.recoverTimer > 60 then
      recover._recoverOnCrash = false
      recover.recoverTimer = 0
      local pos, rot = getSafeTeleportPosRot()
      if pos then
        obj:queueGameEngineLua(
          ""map.safeTeleport("" .. obj:getId() .. "", "" .. pos.x .. "", "" .. pos.y .. "", "" .. pos.z .. "", "" .. rot.x .. "", "" .. rot.y .. "", "" .. rot.z .. "", "" .. rot.w .. "", nil, nil, true, true, true)""
        )
        return
      end
    end
  end

  internalState.changePlanTimer = max(0, internalState.changePlanTimer - dt)

  -- local wp1, wp2 = mapmgr.findClosestRoad(ego.pos)
  -- if (mapData.positions[wp2] - mapData.positions[wp1]):dot(ego.dirVec) > 0 then
  --   wp1, wp2 = wp2, wp1
  -- end
  -- ego.currentSegment = {wp1, wp2}
  ego.currentSegment[1] = nil
  ego.currentSegment[2] = nil

  ------------------ RANDOM MODE ----------------
  if M.mode == 'random' then
    local route
    if not currentRoute or currentRoute.plan.reRoute or currentRoute.plan.planLen + getPathLen(currentRoute.path, currentRoute.plan[currentRoute.plan.planCount].pathidx) < getMinPlanLen() then
      local wp1, wp2 = mapmgr.findClosestRoad(ego.pos)
      if wp1 == nil or wp2 == nil then
        warningAIDisabled(""Could not find a road network, or closest road is too far"")
        return
      end
      ego.currentSegment[1] = wp1
      ego.currentSegment[2] = wp2

      if internalState.road == 'offroad' then
        local vec1 = mapData.positions[wp1] - ego.pos
        local vec2 = mapData.positions[wp2] - ego.pos
        if ego.dirVec:dot(vec1) > 0 and ego.dirVec:dot(vec2) > 0 then
          if vec1:squaredLength() > vec2:squaredLength() then
            wp1, wp2 = wp2, wp1
          end
        elseif ego.dirVec:dot(mapData.positions[wp2] - mapData.positions[wp1]) > 0 then
          wp1, wp2 = wp2, wp1
        end
      elseif ego.dirVec:dot(mapData.positions[wp2] - mapData.positions[wp1]) > 0 then
        wp1, wp2 = wp2, wp1
      end

      local path = mapData:getRandomPath(wp1, wp2, opt.driveInLaneFlag and 1e4 or 1)

      if path and path[1] then
        local route = planAhead(path, currentRoute)
        if route and route.plan then
          if not currentRoute then
            currentRoute = route
          else
            local curPlanIdx = currentRoute.plan[2].pathidx
            local curPathCount = #currentRoute.path
            if curPlanIdx >= curPathCount * 0.9 or (targetsCompatible(currentRoute, route) and route.plan.targetSpeed >= ego.speed) then
              currentRoute = route
            end
          end
        end
      end
    end

    if currentRoute ~= route then
      planAhead(currentRoute)
    end

  ------------------ TRAFFIC MODE ----------------
  elseif M.mode == 'traffic' then
    --profilerPushEvent('ai_trafficPlan')
    trafficPlan()
    --profilerPopEvent('ai_trafficPlan')

  ------------------ MANUAL MODE ----------------
  elseif M.mode == 'manual' then
    if validateInput(wpList or manualPath) then
      newManualPath()
    elseif scriptData then
      setScriptedPath(scriptData)
      scriptData = nil
    end

    if opt.aggressionMode == 'rubberBand' then
      updatePlayerData()
      if player ~= nil then
        if (ego.pos - player.pos):dot(ego.dirVec) > 0 then
          setAggressionInternal(max(min(0.1 + max((150 - player.pos:distance(ego.pos)) / 150, 0), M.extAggression), 0.5))
        else
          setAggressionInternal()
        end
      end
    end

    if opt.racing and false then

      --timeprobe()

      if currentRoute then
        if not currentRoute.plan[1] then
          raceplanAhead(currentRoute)
        end
        if not currentRoute.altPlan then
          currentRoute.altPlan = {}
        else
          table.clear(currentRoute.altPlan)
        end

        -- create purePerformance plan
        if not currentRoute.planPP then
          currentRoute.planPP = minimalcopyPlan(currentRoute.plan)
        end
        raceplanAhead(currentRoute, nil, 'pp')
        currentRoute.plan = currentRoute.planPP
        --table.insert(currentRoute.altPlan, currentRoute.planPP)

        -- create Left plan
        if not currentRoute.planL then
          currentRoute.planL = minimalcopyPlan(currentRoute.plan)
          offsetPlan(currentRoute.plan, currentRoute.planL, 'left')
        end
        raceplanAhead(currentRoute, nil, 'left')
        table.insert(currentRoute.altPlan, currentRoute.planL)

        -- create Right plan
        if not currentRoute.planR then
          currentRoute.planR = minimalcopyPlan(currentRoute.plan)
          offsetPlan(currentRoute.plan, currentRoute.planR, 'right')
        end
        raceplanAhead(currentRoute, nil, 'right')
        table.insert(currentRoute.altPlan, currentRoute.planR)

        -- Search the best plan
        local plan_index
        local current_cost = currentRoute.plan.targetSpeed
        local current_trafficSpeed = currentRoute.plan.trafficTargetSpeed
        local current_throttle = clamp((currentRoute.plan.targetSpeed - ego.speed) * parameters.throttleKp, 0, 1)
        local cost_time = currentRoute.plan.planLen/max(currentRoute.plan.targetSpeed, 0.1)
        local speed_margin = 2
        local n = vec3(-ego.dirVec.y, ego.dirVec.x, 0); n:normalize()
        for k = 1, #currentRoute.altPlan do
          local kplan = currentRoute.altPlan[k]
          local d = currentRoute.plan.targetPos + 0.1 * sign(k-1.5)*currentRoute.plan[currentRoute.plan.targetSeg].normal - (ego.pos - ego.length * ego.dirVec)
          local kcurvature = abs(2 * d:dot(n) / (d:dot(d)))
          local kspeed = kplan[kplan.targetSeg].speed
          local speed_check = kplan.targetSpeed > current_cost + speed_margin
          local ax = max(ego.speed * ego.speed - kspeed * kspeed, 0) / (2 * d:lengthGuarded())
          -- acc_check: check if overtake respects grip limit
          local acc_check = square(currentRoute.plan[1].acc_max) - square(ax) > square(ego.speed * ego.speed * kcurvature)
          -- time_check: check if alternative plan is faster (minor time)
          local time_check = kplan.planLen/kplan.targetSpeed < cost_time - 1
          -- traffic_check: check if trafficTargetSpeed of alternative plan is greater than current one
          local traffic_check = kplan.trafficTargetSpeed > current_trafficSpeed + speed_margin
          -- throttle_check: check if alternative plan is rising the throttle value (only when I'm not braking)
          local delta_throttle = linearScale(currentRoute.plan.distances, ego.length, 3 * ego.length, ego.race.dT_min, ego.race.dT_max)
          local throttle_check = lastCommand.throttle > 0 and clamp((kplan.targetSpeed - ego.speed) * parameters.throttleKp, 0, 1) >= min(current_throttle + delta_throttle, 1) or false
          -- side_check: avoid overtake it is against side avoidance manouver
          local side_check = (currentRoute.plan.dispLat and currentRoute.plan.dispLat ~= 0) and currentRoute.plan.dispLat*(k - 1.5) or 1
          if acc_check and traffic_check and throttle_check and speed_check and time_check and side_check > 0 then
            current_cost = kplan.targetSpeed
            plan_index = k
          end
        end

        -- Committ the best plan
        if plan_index then
          currentRoute.plan_index = plan_index
          currentRoute.offset = currentRoute.altPlan[plan_index].offset
          -- If distance to the vehicle ahead is less than catching distance, I'll push the overtake using targetSpeed from geometry only
          if currentRoute.plan.distances > ego.race.d then
            currentRoute.plan.targetSpeed = currentRoute.plan.originaltargetSpeed
          end
          -- Monitor distance between targetPos of current Plan and desidered plan, do a full switch if my targetPos is too close or goes beyond the desired one
          local targetError = currentRoute.plan.targetPos - currentRoute.altPlan[plan_index].targetPos
          local side = currentRoute.plan[currentRoute.plan.targetSeg].normal:dot(targetError)
          if targetError:length() < 0.9 or (plan_index == 1 and side < 0) or (plan_index == 2 and side > 0) then
            currentRoute.planL = nil
            currentRoute.planR = nil
          end
        else
          currentRoute.plan_index = nil
          currentRoute.offset = nil
        end
      end
    else
      planAhead(currentRoute)
    end

  ------------------ SPAN MODE ------------------
  elseif M.mode == 'span' then
    if currentRoute == nil then
      local positions = mapData.positions
      local wpAft, wpFore = mapmgr.findClosestRoad(ego.pos)
      if not (wpAft and wpFore) then
        warningAIDisabled(""Could not find a road network, or closest road is too far"")
        return
      end
      if ego.dirVec:dot(positions[wpFore] - positions[wpAft]) < 0 then wpAft, wpFore = wpFore, wpAft end

      ego.currentSegment[1] = wpFore
      ego.currentSegment[2] = wpAft

      local target, targetLink

      if not (edgeDict and edgeDict[1]) then
        -- creates the edgeDict and returns a random edge
        target, targetLink = getMapEdges(M.cutOffDrivability or 0, wpFore)
        if not target then
          warningAIDisabled(""No available target with selected characteristics"")
          return
        end
      end

      local path = {}
      while true do
        if not target then
          local maxDist = -math.huge
          local lim = 1
          repeat
            -- get most distant non walked edge
            for k, v in pairs(edgeDict) do
              if v <= lim then
                if lim > 1 then edgeDict[k] = 1 end
                local i = string.find(k, '\0')
                local n1id = string.sub(k, 1, i-1)
                local sqDist = positions[n1id]:squaredDistance(ego.pos)
                if sqDist > maxDist then
                  maxDist = sqDist
                  target = n1id
                  targetLink = string.sub(k, i+1, #k)
                end
              end
            end
            lim = math.huge -- if the first iteration does not produce a target
          until target
        end

        local nodeDegree = 1
        for lid, _ in pairs(mapData.graph[target]) do
          -- we're looking for neighboring nodes other than the targetLink
          if lid ~= targetLink then
            nodeDegree = nodeDegree + 1
          end
        end
        if nodeDegree == 1 then
          local key = target..'\0'..targetLink
          edgeDict[key] = edgeDict[key] + 1
        end

        path = mapData:spanMap(wpFore, wpAft, target, edgeDict, opt.driveInLaneFlag and 1e7 or 1)

        if not path[2] and wpFore ~= target then
          -- remove edge from edgeDict list and get a new target (while loop will iterate again)
          edgeDict[target..'\0'..targetLink] = nil
          edgeDict[targetLink..'\0'..target] = nil
          target = nil
          if next(edgeDict) == nil then
            warningAIDisabled(""Could not find a path to any of the possible targets"")
            return
          end
        elseif not path[1] then
          warningAIDisabled(""No Route Found"")
          return
        else
          -- insert the second edge node in newRoute if it is not already contained
          local pathCount = #path
          if path[pathCount-1] ~= targetLink then path[pathCount+1] = targetLink end
          break
        end
      end

      local route = planAhead(path)
      if not route then return end
      currentRoute = route
    else
      planAhead(currentRoute)
    end

  ------------------ FLEE MODE ------------------
  elseif M.mode == 'flee' then
    updatePlayerData()
    if player then
      if validateInput() then
        targetWPName = wpList[1]
        wpList = nil
      end

      fleePlan()

      if internalState.road == 'offroad' then
        local targetPos = ego.pos + (ego.pos - player.pos) * 100
        local targetSpeed = math.huge
        driveToTarget(targetPos, 1, 0, targetSpeed)
        return
      end
    else
      -- guihooks.message(""No vehicle to Flee from"", 5, ""AI debug"") -- TODO: this freezes the up because it runs on the gfx step
      return
    end

  ------------------ CHASE MODE ------------------
  elseif M.mode == 'chase' or M.mode == 'follow' then
    updatePlayerData()
    if player then
      chasePlan()

      if internalState.road == 'tail' then
        --internalState.road = 'onroad'
        --currentRoute = nil
        local plego = player.pos - ego.pos
        local relvel = ego.vel:dot(plego) - player.vel:dot(plego)

        local throttle, brake, targetSpeed = targetFollowControl(internalState.chaseData.targetSpeed or math.huge)
        if relvel > 0 then
          driveToTarget(player.pos + (plego:length() / (relvel + 1e-30)) * player.vel, throttle, brake, targetSpeed)
        else
          driveToTarget(player.pos, throttle, brake, targetSpeed)
        end
        return
      elseif internalState.road == 'offroad' then
        local throttle, brake, targetSpeed = targetFollowControl(M.mode == 'chase' and math.huge)
        driveToTarget(player.pos, throttle, brake, targetSpeed)
        return
      elseif currentRoute == nil then
        driveCar(0, 0, 0, 1)
        return
      end

    else
      -- guihooks.message(""No vehicle to Chase"", 5, ""AI debug"")
      return
    end

  ------------------ STOP MODE ------------------
  elseif M.mode == 'stop' then
    if currentRoute then
      planAhead(currentRoute)
      local targetSpeed = max(0, ego.speed - sqrt(max(0, square(ego.staticFrictionCoef * g) - square(sensors.gx2))) * dt) -- TODO: check this calculation, i don't think it does what you think it does
      currentRoute.plan.targetSpeed = min(currentRoute.plan.targetSpeed, targetSpeed)
    elseif ego.vel:dot(ego.dirVec) > 0 then
      driveCar(0, 0, 0.5, 0)
    else
      driveCar(0, 1, 0, 0)
    end
    if ego.speed < 0.08 then
      driveCar(0, 0, 0, 1)
      M.mode = 'disabled'
      M.manualTargetName = nil
      M.updateGFX = nop
      resetMapAndRoute()
      stateChanged()
      if controller.mainController and restoreGearboxMode then
        controller.mainController.setGearboxMode('realistic')
      end
      return
    end
  end
  -----------------------------------------------

  if currentRoute then
    local plan = currentRoute.plan
    local targetPos = plan.targetPos
    local egoSeg = plan.egoSeg

    -- cleanup path if it has gotten too long
    if not opt.racing and not loopPath and plan[egoSeg].pathidx >= 10 and currentRoute.path[20]  then
      local path = currentRoute.path
      local k = plan[egoSeg].pathidx - 2
      for i = 1, #path do
        path[i] = path[k+i]
      end
      for i = 1, plan.planCount do
        plan[i].pathidx = plan[i].pathidx - k
      end
      -- sync lane change indices
      currentRoute.lastLaneChangeIdx = currentRoute.lastLaneChangeIdx - k
      for _, v in ipairs(currentRoute.laneChanges) do
        v.pathIdx = v.pathIdx - k
      end
      local pathDistK = currentRoute.pathLength[k+1]
      for i = 1, #currentRoute.pathLength do
        currentRoute.pathLength[i] = currentRoute.pathLength[k+i] and currentRoute.pathLength[k+i] - pathDistK or nil
      end
      -- sync trafficState intersection search index
      if trafficStates and trafficStates.intersection and trafficStates.intersection.startIdx then
        trafficStates.intersection.startIdx = trafficStates.intersection.startIdx - k
        -- if trafficStates.intersection.startIdx < 1 then
        --   trafficStates.intersection.startIdx = nil
        -- end
      end
    end

    local targetSpeed = plan.targetSpeed

    if ego.upVec:dot(gravityDir) >= -0.2588 then -- vehicle upside down
      driveCar(0, 0, 0, 0)
      return
    end

    local lowTargetSpeedVal = 0.24
    if not plan[egoSeg+2] and ((targetSpeed < lowTargetSpeedVal and ego.speed < 0.15) or (targetPos - ego.pos):dot(ego.dirVec) < 0) then
      if M.mode == 'span' then
        local path = currentRoute.path
        for i = 1, #path - 1 do
          local key = path[i]..'\0'..path[i+1]
          -- in case we have gone over an edge that is not in the edgeDict list
          edgeDict[key] = edgeDict[key] and (edgeDict[key] * 20)
        end
      end

      if ego.speed < 0.15 then
        driveCar(0, 0, 0, 1)
        aistatus('route done', 'route')
        if dataLogger.logData ~= nop then
          startStopDataLog()
        end
        guihooks.message(""Route done"", 5, ""AI debug"")
        currentRoute = nil
      else
        driveCar(0, 0, max(0.3, lastCommand.brake), 0)
      end
      return
    end

    -- come off controls when close to intermediate node with zero speed (ex. intersection), arcade autobrake takes over
    if (plan[egoSeg+1].speed == 0 and plan[egoSeg+2]) and ego.speed < 0.15 then
      driveCar(0, 0, 0, 0)
      return
    end

    if electrics.values.ignitionLevel == 3 then
      if ego.speed < 1.5 then
        driveCar(0, 0, 0, 1)
      end
      return
    end

    if ego.speed < 0.1 and targetSpeed > 0.5 and (lastCommand.throttle ~= 0 or lastCommand.brake ~= 0) and twt.state == 0 and
    not (controller.isFrozen or electrics.values['transbrake'] or (trafficStates.intersection.action == 3 or trafficStates.intersection.action == 2)) then

      if internalState.crash.time == 0 then
        internalState.crash.pos = ego.pos:copy()
      end
      internalState.crash.time = internalState.crash.time + dt
      if internalState.crash.time > 1 then
        local diff = ego.pos:squaredDistance(internalState.crash.pos)
        if  diff < 0.1*0.1 then
          if recover.recoverOnCrash then
            recover._recoverOnCrash = true
            internalState.crash.time = 0
          else
            internalState.crash.dir = vec3(ego.dirVec)
            internalState.crash.manoeuvre = 1
          end
        else
          internalState.crash.time = 0
        end
      end
    end

    -- Throttle and Brake control
    local speedDif = targetSpeed - ego.speed
    local rate = targetSpeedDifSmoother[speedDif > 0 and targetSpeedDifSmoother.state >= 0 and speedDif >= targetSpeedDifSmoother.state]
    speedDif = targetSpeedDifSmoother:getWithRate(speedDif, dt, rate)

    local legalSpeedDif = plan.targetSpeedLegal - ego.speed
    local lowSpeedDif = min(speedDif - clamp((ego.speed - 2) * 0.5, 0, 1), legalSpeedDif) * parameters.throttleKp
    local lowTargSpeedConstBrake = lowTargetSpeedVal - targetSpeed -- apply constant brake below some targetSpeed

    local throttle = clamp(lowSpeedDif, 0, 1) * sign(max(0, -lowTargSpeedConstBrake)) -- throttle not enganged for targetSpeed < 0.26

    local brakeLimLow = sign(max(0, lowTargSpeedConstBrake)) * 0.5

    local brake = sign(max(0, (electrics.values.smoothShiftLogicAV or 0) - 3))
    if plan.sideDisp and opt.racing then
      local speedDifH = targetSpeed / sqrt(min(1, aggression)) - ego.speed
      brake = clamp(-speedDifH, brakeLimLow, 1) * brake  -- arcade autobrake comes in at |smoothShiftLogicAV| < 5
    else
      brake = clamp(-speedDif, brakeLimLow, 1) * brake -- arcade autobrake comes in at |smoothShiftLogicAV| < 5
    end

    if brake > 0 and abs(speedDif) < 0.5 and lastCommand.throttle == 0 and lastCommand.brake == 0 then
      -- check if deceleration without braking is larger or equal to the desired deceleration
      if sensors.gy2 >= (square(plan[1].speed) - square(plan[2].speed)) / (2 * plan[1].length) then
        brake = 0
      end
    end

    driveToTarget(targetPos, throttle, brake)
  end

  dataLogger.logData()
end

local function debugDraw(focusPos)
  local debugDrawer = obj.debugDrawProxy

  if M.mode == 'script' and scriptai ~= nil then
    scriptai.debugDraw()
  end

  if currentRoute then
    local plan = currentRoute.plan
    local targetPos = plan.targetPos
    local targetSpeed = plan.targetSpeed

    if targetPos then
      debugDrawer:drawSphere(0.25, targetPos, color(255,0,0,255))

      local egoSeg = plan.egoSeg
      local shadowPos = currentRoute.plan[egoSeg].pos + plan.egoXnormOnSeg * (plan[egoSeg+1].pos - plan[egoSeg].pos)
      local blue = color(0,0,255,255)
      debugDrawer:drawSphere(0.25, shadowPos, blue)

      for vehId in pairs(mapmgr.getObjects()) do
        if vehId ~= objectId then
          debugDrawer:drawSphere(0.25, obj:getObjectFrontPosition(vehId), blue)
        end
      end

      if player then
        debugDrawer:drawSphere(0.3, player.pos, color(0,255,0,255))
      end
    end

    if M.debugMode == 'target' then
      if mapData and mapData.graph and currentRoute.path then
        local p = mapData.positions[currentRoute.path[#currentRoute.path]]
        debugDrawer:drawSphere(4, p, color(255,0,0,100))
        debugDrawer:drawText(p + vec3(0, 0, 4), color(0,0,0,255), 'Destination')
      end

    elseif M.debugMode == 'route' then
      local maxCount = 700
      local last = visDebug.routeRec.last
      local count = min(#visDebug.routeRec, maxCount)
      if count == 0 or visDebug.routeRec[last]:squaredDistance(ego.pos) > 7 * 7 then
        last = 1 + last % maxCount
        visDebug.routeRec[last] = vec3(ego.pos)
        count = min(count+1, maxCount)
        visDebug.routeRec.last = last
      end

      local tmpVec = vec3(0.7, ego.width, 0.7)
      local black = color(0, 0, 0, 128)
      for i = 1, count-1 do
        debugDrawer:drawSquarePrism(visDebug.routeRec[1+(last+i-1)%count], visDebug.routeRec[1+(last+i)%count], tmpVec, tmpVec, black)
      end

      if currentRoute.plan[1].pathidx then
        local positions = mapData.positions
        local path = currentRoute.path
        tmpVec:setAdd(vec3(0, ego.width, 0))
        local transparentRed = color(255, 0, 0, 120)
        for i = currentRoute.plan[1].pathidx, #path - 1 do
          debugDrawer:drawSquarePrism(positions[path[i]], positions[path[i+1]], tmpVec, tmpVec, transparentRed)
        end
      end

      -- Draw candidate paths if available
      if visDebug.candidatePaths and visDebug.candidatePaths[1] then
        local winner = visDebug.candidatePaths.winner
        local source = visDebug.candidatePaths[1][1] -- all paths have the same source node
        debugDrawer:drawSphere(2, mapData.positions[source], color(0, 0, 0, 255))
        for i = 1, #visDebug.candidatePaths do
          local thisPath = visDebug.candidatePaths[i]
          local thisPathCount = #thisPath
          local thisScore = visDebug.candidatePaths[i].score
          for i = 1, thisPathCount-1 do
            debugDrawer:drawCylinder(mapData.positions[thisPath[i]], mapData.positions[thisPath[i+1]], 0.5, jetColor(thisScore, 200))
          end
          local thisPathLastNode = thisPath[thisPathCount]
          debugDrawer:drawSphere(4, mapData.positions[thisPathLastNode], jetColor(thisScore, 255))
          if thisPathLastNode == winner then
            debugDrawer:drawCylinder(mapData.positions[thisPathLastNode], mapData.positions[thisPathLastNode] + vec3(0, 0, 8), 2, color(0, 0, 0, 255))
          end
          local txt = thisPathLastNode.."" -> ""..strFormat(""%0.4f"", thisScore)
          debugDrawer:drawText(mapData.positions[thisPathLastNode] + vec3(0, 0, 2), color(0, 0, 0, 255), txt)
        end
      else
        -- Mark destination node in current path
        if currentRoute.path then
          local p = mapData.positions[currentRoute.path[#currentRoute.path]]
          debugDrawer:drawSphere(4, p, color(255, 0, 0, 100))
          debugDrawer:drawText(p + vec3(0, 0, 4), color(0, 0, 0, 255), 'Destination')
        end
      end

    elseif M.debugMode == 'speeds' then
      -- Debug graph
      local altPlanTab = currentRoute.altPlan and currentRoute.altPlan or {}
      for k = 1, #altPlanTab do
        -- Plot altPlan
        local altPlan = altPlanTab[k]
        if altPlan then
          debugDrawer:drawSphere(0.1, altPlan.targetPos + vec3(0,0,0.5), color(0,255,255,255))
          for j = 1, altPlan.planCount do
            local point = altPlan[j]
            debugDrawer:drawSphere(0.1, point.pos + vec3(0,0,0.5), color(255,255,255,255))
            debugDrawer:drawSphere(0.1, point.pos + vec3(0,0,point.speed*0.2), color(255,255,255,255))
            debugDrawer:drawText(point.pos + vec3(0,0,point.speed*0.2), color(0, 0, 0, 255), strFormat(""%2.0f"", point.speed*3.6).."" kph"")
            if j > 1 then
              debugDrawer:drawCylinder(altPlan[j-1].pos + vec3(0,0,0.5), point.pos + vec3(0,0,0.5), 0.05, color(255, 255, 255, 100))
              debugDrawer:drawCylinder(altPlan[j-1].pos + vec3(0,0,altPlan[j-1].speed*0.2), point.pos + vec3(0,0,point.speed*0.2), 0.05, color(255*clamp(k-2, 0, 1), 255*clamp(k-1,0,1), 255, 100))
            end
          end
        end
      end
      if plan.traj_index then
        local altPlan = altPlanTab[plan.traj_index]
        if altPlan then
          for j = 1, altPlan.planCount do
            local point = altPlan[j]
            debugDrawer:drawSphere(0.1, point.pos + vec3(0,0,0.5), color(0,0,0,255))
            if j > 1 then
              debugDrawer:drawCylinder(altPlan[j-1].pos + vec3(0,0,0.5), point.pos + vec3(0,0,0.5), 0.1, color(100, 200, 100, 255))
            end
          end
        end
      end

      -- Debug Throttle brake application
      local maxCount = 175
      local count = min(#visDebug.trajecRec, maxCount)
      local last = visDebug.trajecRec.last
      if count == 0 or visDebug.trajecRec[last][1]:squaredDistance(ego.pos) > (0.2 * 0.2) then
        last = 1 + last % maxCount
        visDebug.trajecRec[last] = {vec3(ego.pos), ego.speed, targetSpeed, lastCommand.brake, lastCommand.throttle}
        count = min(count+1, maxCount)
        visDebug.trajecRec.last = last
      end

      local tmpVec1 = vec3(0.7, ego.width, 0.7)
      for i = 1, count-1 do
        local n = visDebug.trajecRec[1 + (last + i) % count]
        debugDrawer:drawSquarePrism(visDebug.trajecRec[1 + (last + i - 1) % count][1], n[1], tmpVec1, tmpVec1, color(255 * sqrt(abs(n[4])), 255 * sqrt(n[5]), 0, 100))
      end

      local prevEntry
      local zOffSet = vec3(0, 0, 0.4)
      local yellow, blue = color(255,255,0,200), color(0,0,255,200)
      local tmpVec2 = vec3()
      for i = 1, count-1 do
        local v = visDebug.trajecRec[1 + (last + i - 1) % count]
        if prevEntry then
          -- actuall speed
          tmpVec1:set(0, 0, prevEntry[2] * 0.2)
          tmpVec2:set(0, 0, v[2] * 0.2)
          debugDrawer:drawCylinder(prevEntry[1] + tmpVec1, v[1] + tmpVec2, 0.02, yellow)

          -- target speed
          tmpVec1:set(0, 0, prevEntry[3] * 0.2)
          tmpVec2:set(0, 0, v[3] * 0.2)
          debugDrawer:drawCylinder(prevEntry[1] + tmpVec1, v[1] + tmpVec2, 0.02, blue)
        end

        tmpVec1:set(0, 0, v[3] * 0.2)
        debugDrawer:drawCylinder(v[1], v[1] + tmpVec1, 0.01, blue)

        if focusPos:squaredDistance(v[1]) < visDebug.labelRenderDistance * visDebug.labelRenderDistance then
          tmpVec1:set(0, 0, v[2] * 0.2)
          debugDrawer:drawText(v[1] + tmpVec1 + zOffSet, yellow, strFormat(""%2.0f"", v[2]*3.6).."" kph"")

          tmpVec1:set(0, 0, v[3] * 0.2)
          debugDrawer:drawText(v[1] + tmpVec1 + zOffSet, blue, strFormat(""%2.0f"", v[3]*3.6).."" kph"")
        end
        prevEntry = v
      end

      -- Planned speeds
      if plan[1] then
        local red = color(255,0,0,200) -- getContrastColor(objectId)
        local black = color(0, 0, 0, 255)
        local green = color(0, 255, 0, 200)
        local prevSpeed = -1
        local prevLegalSpeed = -1
        local prevPoint = plan[1].pos
        local prevPoint_ = plan[1].pos
        local tmpVec = vec3()
        for i = 1, #plan do
          local n = plan[i]

          local speed = (n.speed >= 0 and n.speed) or prevSpeed
          tmpVec:set(0, 0, speed * 0.2)
          local p1 = n.pos + tmpVec
          debugDrawer:drawCylinder(n.pos, p1, 0.03, red)
          debugDrawer:drawCylinder(prevPoint, p1, 0.05, red)
          debugDrawer:drawText(p1, black, strFormat(""%2.0f"", speed*3.6).."" kph"")
          prevSpeed = speed
          prevPoint = p1

          if M.speedMode == 'legal' then
            local legalSpeed = (n.legalSpeed >= 0 and n.legalSpeed) or prevLegalSpeed
            tmpVec:set(0, 0, legalSpeed * 0.2)
            local p1_ = n.pos + tmpVec
            debugDrawer:drawCylinder(n.pos, p1_, 0.03, green)
            debugDrawer:drawCylinder(prevPoint_, p1_, 0.05, green)
            debugDrawer:drawText(p1_, black, strFormat(""%2.0f"", legalSpeed*3.6).."" kph"")
            prevLegalSpeed = legalSpeed
            prevPoint_ = p1_
          end

          --[[
          if traffic and traffic[i] then
            for _, data in ipairs(traffic[i]) do
              local plPosOnPlan = linePointFromXnorm(n.pos, plan[i+1].pos, data[2])
              debugDrawer:drawSphere(0.25, plPosOnPlan, color(0,255,0,100))
            end
          end
          --]]
        end

        ---[[ Debug road width and lane limits
        local prevPointOrig = plan[1].posOrig
        local tmpVec = vec3(1, 1, 1)
        local tmpVec1 = vec3(0.5, 0.5, 0.5)

        for i = 1, #plan do
          local n = plan[i]
          local p1Orig = n.posOrig - n.biNormal
          debugDrawer:drawCylinder(n.posOrig, p1Orig, 0.03, black)
          debugDrawer:drawCylinder(p1Orig, p1Orig + n.normal, 0.03, black)
          debugDrawer:drawCylinder(prevPointOrig, p1Orig, 0.03, black)
          local roadHalfWidth = n.halfWidth
          --debugDrawer:drawCylinder(n.posOrig, p1Orig, roadHalfWidth, color(255, 0, 0, 40))
          if n.laneLimLeft and n.laneLimRight then -- You need to uncomment the appropriate code in planAhead force integrator loop for this to work
            debugDrawer:drawSquarePrism(n.pos - (n.lateralXnorm - n.laneLimLeft) * n.normal, n.pos + (n.laneLimRight - n.lateralXnorm) * n.normal, tmpVec, tmpVec, color(0,0,255,120))
          end
          if n.rangeLeft and n.rangeRight then
            local rangeLeft = linearScale(n.rangeLeft, 0, 1, -roadHalfWidth, roadHalfWidth)
            local rangeRight = linearScale(n.rangeRight, 0, 1, -roadHalfWidth, roadHalfWidth)
            debugDrawer:drawSquarePrism(n.posOrig + rangeLeft * n.normal, n.posOrig + rangeRight * n.normal, tmpVec1, tmpVec1, color(255,0,0,120))
          end
          prevPointOrig = p1Orig
        end
        --]]

        --[[ Debug lane change. You need to uncomment upvalue newPositionsDebug for this to work
        if newPositionsDebug[1] then
          local green = color(0,255,0,200)
          local prevPoint = newPositionsDebug[1]
          for i = 1, #newPositionsDebug do
            local pos = newPositionsDebug[i]
            local p1 = pos + vec3(0, 0, 2)
            debugDrawer:drawCylinder(pos, p1, 0.03, green)
            debugDrawer:drawCylinder(prevPoint, p1, 0.05, green)
            prevPoint = p1
          end
        end
        --]]

        for i = max(1, plan[1].pathidx-2), #currentRoute.path-2 do
          local wp1 = currentRoute.path[i]
          local wp2 = currentRoute.path[i+1]
          if tableSize(mapData.graph[wp2]) > 2 then
            local minNode = roadNaturalContinuation(wp1, wp2)
            if minNode and minNode ~= currentRoute.path[i+2] then
              debugDrawer:drawCylinder(mapData.positions[wp2], mapData.positions[minNode], 0.2, black)
            end
          end
        end
      end

      -- Player segment visual debug for chase / follow mode
      -- if internalState.chaseData.playerRoad then
      --   local col1, col2
      --   if internalState.road == 'tail' then
      --     col1 = color(0,0,0,200)
      --     col2 = color(0,0,0,200)
      --   else
      --     col1 = color(255,0,0,100)
      --     col2 = color(0,0,255,100)
      --   end
      --   local plwp1 = internalState.chaseData.playerRoad[1]
      --   debugDrawer:drawSphere(2, mapData.positions[plwp1], col1)
      --   local plwp2 = internalState.chaseData.playerRoad[2]
      --   debugDrawer:drawSphere(2, mapData.positions[plwp2], col2)
      -- end

    elseif M.debugMode == 'trajectory' then
      -- Debug Curvatures
      -- local plan = currentRoute.plan
      -- if plan ~= nil then
      --   local prevPoint = plan[1].pos
      --   for i = 1, #plan do
      --     local p = plan[i].pos
      --     local v = plan[i].curvature or 1e-10
      --     local scaledV = abs(1000 * v)
      --     debugDrawer:drawCylinder(p, p + vec3(0, 0, scaledV), 0.06, color(abs(min(sign(v),0))*255,max(sign(v),0)*255,0,200))
      --     debugDrawer:drawText(p + vec3(0, 0, scaledV), color(0,0,0,255), strFormat(""%5.4e"", v))
      --     debugDrawer:drawCylinder(prevPoint, p + vec3(0, 0, scaledV), 0.06, col)
      --     prevPoint = p + vec3(0, 0, scaledV)
      --   end
      -- end

      -- Debug Planned Speeds
      if plan[1] then
        local col = getContrastColor(objectId)
        local prevPoint = plan[1].pos
        local prevSpeed = -1
        local drawLen = 0
        for i = 1, #plan do
          local n = plan[i]
          local p = n.pos
          local v = (n.speed >= 0 and n.speed) or prevSpeed
          local p1 = p + vec3(0, 0, v*0.2)
          --debugDrawer:drawLine(p + vec3(0, 0, v*0.2), (n.pos + n.turnDir) + vec3(0, 0, v*0.2), col)
          debugDrawer:drawCylinder(p, p1, 0.03, col)
          debugDrawer:drawCylinder(prevPoint, p1, 0.05, col)
          debugDrawer:drawText(p1, color(0,0,0,255), strFormat(""%2.0f"", v*3.6) .. "" kph"")
          prevPoint = p1
          prevSpeed = v
          drawLen = drawLen + n.vec:length()
          if drawLen > 80 then break end
        end
      end

      -- Debug Throttle brake application
      local maxCount = 175
      local count = min(#visDebug.trajecRec, maxCount)
      local last = visDebug.trajecRec.last
      if count == 0 or visDebug.trajecRec[last][1]:squaredDistance(ego.pos) > 0.25 * 0.25 then
        last = 1 + last % maxCount
        visDebug.trajecRec[last] = {vec3(ego.pos), lastCommand.throttle, lastCommand.brake}
        count = min(count+1, maxCount)
        visDebug.trajecRec.last = last
      end

      local tmpVec = vec3(0.7, ego.width, 0.7)
      for i = 1, count-1 do
        local n = visDebug.trajecRec[1+(last+i)%count]
        debugDrawer:drawSquarePrism(visDebug.trajecRec[1+(last+i-1)%count][1], n[1], tmpVec, tmpVec, color(255 * sqrt(abs(n[3])), 255 * sqrt(n[2]), 0, 100))
      end
    elseif false and M.debugMode == 'rays' then
      local egoScanLength = ego.length * 0.9 --small adjustments for origins to be a bit inside the car
      local egoScanWidth = ego.width * 0.7
      local shiftHorizontalVec = (egoScanWidth * 0.5) * ego.rightVec --creation of horizontal helper vector
      local shiftVerticalVec = -0.05 * ego.length * ego.dirVec --creation of vertical helper vector
      local shiftPerpendicularVec = 0.35 * ego.upVec
      local egoPosElevatedR = ego.pos:copy() --creation of FR corner vector
      egoPosElevatedR:setAdd(shiftHorizontalVec)
      egoPosElevatedR:setAdd(shiftVerticalVec)
      egoPosElevatedR:setAdd(shiftPerpendicularVec) -- elevation, this should work only on flat inclination for now
      local egoPosElevatedL = egoPosElevatedR:copy() --creation of FL corner vector
      shiftHorizontalVec:setScaled(-2)
      egoPosElevatedL:setAdd(shiftHorizontalVec)
      local egoPosBackElevatedL = egoPosElevatedL:copy() --creation of BR corner vector
      shiftVerticalVec:setScaled(egoScanLength * 20 / ego.length)
      egoPosBackElevatedL:setAdd(shiftVerticalVec)
      local egoPosBackElevatedR = egoPosElevatedR:copy() --creation of BL corner vector
      egoPosBackElevatedR:setAdd(shiftVerticalVec)

      local rayDist = 4 * ego.wheelBase -- TODO: Optimize rayDist. Higher is better for more open spaces but w performance hit
      populateOBBinRange(rayDist)
      local tmpVec = vec3()
      local helperVec = vec3()
      local rounds = twt.idx - 1
      dump(""rounds in debug"", rounds)

      for i = twt.idx, rounds do --the ray cast loop: each iteration scans one corner and one side
        i = i % 8 + 1
        local j = i * 4
        tmpVec:setLerp(twt.posTable[twt.RRT[j-3]], twt.posTable[twt.RRT[j-2]], twt.blueNoiseCoef)
        helperVec:setLerp(twt.dirTable[twt.RRT[j-1]], twt.dirTable[twt.RRT[j]], twt.blueNoiseCoef) -- LERP corner direction
        helperVec:normalize()
        local rayLen = castRay(tmpVec, helperVec, min(twt.rayMins[i], rayDist))

        local shiftVec = helperVec * rayLen
        local rayHitPos = tmpVec + shiftVec
        debugDrawer:drawCylinder(tmpVec, rayHitPos, 0.02, color(255,255,255,255))

        if twt.rayMins[i] > rayLen then -- odd index is corners
          twt.minRayCoefs[i] = twt.blueNoiseCoef
          twt.rayMins[i] = rayLen
        else
          tmpVec:setLerp(twt.posTable[twt.RRT[j-3]], twt.posTable[twt.RRT[j-2]], twt.minRayCoefs[i])
          helperVec:setLerp(twt.dirTable[twt.RRT[j-1]], twt.dirTable[twt.RRT[j]], twt.minRayCoefs[i]) -- LERP corner direction
          helperVec:normalize()
          twt.rayMins[i] = castRay(tmpVec, helperVec, min(2 * twt.rayMins[i], rayDist))
        end
      end

      -- debugDrawer:drawSphere(0.3, ego.pos, color(255,255,0,255))
      -- dump(obj)
      -- local test = obj:getCornerPosition(0)
      -- local test2 = obj:getCornerPosition(1)
      -- local test3 = obj:getCornerPosition(2)
      -- local test4 = obj:getCornerPosition(3)
      -- local frontPos = obj:getFrontPosition()

      -- dump(test)
      -- debugDrawer:drawSphere(0.1, frontPos, color(255,255,0,255))
      -- debugDrawer:drawSphere(0.3, test2, color(255,0,0,255))
      -- debugDrawer:drawSphere(0.3, test3, color(255,0,0,255))
      -- debugDrawer:drawSphere(0.3, test4, color(255,0,0,255))
      -- debugDrawer:drawSphere(0.3, test, color(255,0,0,255))
      -- local test2 = obj:getFrontPositionRelative()
      -- dump(test2)
      -- debugDrawer:drawSphere(0.3, ego.wheelBase[2], color(255,255,0,255))
      -- ray origins
      -- debugDrawer:drawSphere(0.1, ego.pos, color(0,0,0,255))
      debugDrawer:drawSphere(0.1, twt.posTable[1], color(255,255,255,255))
      debugDrawer:drawSphere(0.1, twt.posTable[2], color(255,255,255,255))
      debugDrawer:drawSphere(0.1, twt.posTable[3], color(255,255,255,255))
      debugDrawer:drawSphere(0.1, twt.posTable[4], color(255,255,255,255))

      for _, d in pairs(visDebug.debugSpots) do
        debugDrawer:drawSphere(0.2, d[1], d[2])
      end
    end
  end

  if false then
    local c, x, y, z = getObjectBoundingBox(objectId) -- center, front vec, left vec, up vec
    local col = color(255, 0, 0, 255)
    drawOBB(c, x, y, z, col)

    if dt then
      for k, v in pairs(mapmgr.getObjects()) do
        if k ~= objectId then
          --dump(v.pos)
          obj.debugDrawProxy:drawSphere(0.2, v.pos, color(0, 0, 255, 255))
          local vPos = vec3(obj:getObjectFrontPosition(k))
          obj.debugDrawProxy:drawSphere(0.2, vPos, color(0, 0, 255, 255))
          obj.debugDrawProxy:drawSphere(0.2, vPos + v.vel * dt, color(0, 255, 0, 255))
          --dump(obj:getObjectDirectionVector(k))
          --dump(obj:getObjectDirectionVectorUp(k))
        end
      end
    end
    obj.debugDrawProxy:drawSphere(0.15, obj:getFrontPosition(), color(255, 0, 0, 255))
  end

  --[[
  if true then
    -- Draw vehicle ref node, wheel hub positions and wheel contact points (estimates) with ground
    local refNodePos = obj:getPosition()
    debugDrawer:drawSphere(0.1, refNodePos, color(255,0,0,255))
    for _, wheel in pairs(wheels.wheels) do
      local wheelRadius = wheel.radius
      local wheelPosAbsolute = refNodePos + obj:getNodePosition(wheel.node1)
      debugDrawer:drawSphere(0.1, wheelPosAbsolute, color(255,0,0,255))
      local contactPointPos = wheelPosAbsolute - obj:getDirectionVectorUp() * wheelRadius
      debugDrawer:drawSphere(0.1, contactPointPos, color(255,0,0,255))
    end

    -- vehicle frontPos
    local vehFrontPos = obj:getFrontPosition()
    debugDrawer:drawSphere(0.1, obj:getFrontPosition(), color(255, 255, 255, 255))
    -- vehicle frontPos
    debugDrawer:drawSphere(0.1, vehFrontPos:z0(), color(0, 255, 255, 255))

    -- calculated spawn pos (from script front pos)
    debugDrawer:drawSphere(0.1, vec3(736.8858419,102.6078886,0.1169999319), color(0, 0, 255, 255))

    -- script first pos (ground truth)
    debugDrawer:drawSphere(0.1, vec3(734.9434413112983, 102.21897064457461, 1.0), color(255, 0, 255, 255))

    -- Draw world reference Frame
    debugDrawer:drawSphere(0.1, vec3(0, 0, 0), color(0, 255, 0, 255)) -- World 0
    debugDrawer:drawCylinder(vec3(0, 0, 0), 5 * vec3(1, 0, 0), 0.05, color(0, 255, 0, 255)) -- x (green)
    debugDrawer:drawCylinder(vec3(0, 0, 0), 5 * vec3(0, 1, 0), 0.05, color(255, 0, 0, 255)) -- y (red)
    debugDrawer:drawCylinder(vec3(0, 0, 0), 5 * vec3(0, 0, 1), 0.05, color(0, 0, 255, 255)) -- z (blue)
  end
  --]]
end

local function setAvoidCars(v)
  M.extAvoidCars = v
  if M.extAvoidCars == 'off' or M.extAvoidCars == 'on' then
    opt.avoidCars = M.extAvoidCars
  else
    opt.avoidCars = M.mode == 'manual' and 'off' or 'on'
  end
  stateChanged()
end

local function driveInLane(v)
  if v == 'on' then
    M.driveInLaneFlag = 'on'
    opt.driveInLaneFlag = true
  else
    M.driveInLaneFlag = 'off'
    opt.driveInLaneFlag = false
  end
  stateChanged()
end

local function setVehicleDebugMode(newMode)
  tableMerge(M, newMode)
  if M.debugMode ~= 'trajectory' then
    visDebug.trajecRec = {last = 0}
  end
  if M.debugMode ~= 'route' then
    visDebug.routeRec = {last = 0}
  end
  if M.debugMode ~= 'speeds' then
    visDebug.trajecRec = {last = 0}
  end
  if M.debugMode ~= 'rays' then
    visDebug.trajecRec = {last = 0}
  end
  if M.debugMode ~= 'off' then
    M.debugDraw = debugDraw
  else
    M.debugDraw = nop
  end
end

local function setMode(mode)
  if tableSizeC(wheels.wheels) == 0 then return end
  if mode ~= nil then
    if M.mode ~= mode then -- new AI mode is not the same as the old one
      obj:queueGameEngineLua('onAiModeChange('..objectId..', ""'..mode..'"")')
    end
    M.mode = mode
  end

  if M.extAvoidCars == 'off' or M.extAvoidCars == 'on' then
    opt.avoidCars = M.extAvoidCars
  else
    opt.avoidCars = (M.mode == 'manual' and 'off' or 'on')
  end

  if M.mode ~= 'script' then
    if M.mode ~= 'disabled' and M.mode ~= 'stop' then
      resetMapAndRoute()

      mapmgr.requestMap()
      M.updateGFX = updateGFX
      targetSpeedDifSmoother:set(0)
      targetSpeedSmoother:set(ego.speed)

      if controller.mainController then
        if electrics.values.gearboxMode == 'realistic' then
          restoreGearboxMode = true
        end
        controller.mainController.setGearboxMode('arcade')
      end

      ego.wheelBase = calculateWheelBase()

      if M.mode == 'flee' or M.mode == 'chase' or M.mode == 'follow' then
        setAggressionMode('rubberBand')
      end

      if M.mode == 'traffic' then
        setSpeedMode('legal')
        driveInLane('on')
        setTractionModel(1)
        setSpeedProfileMode('Back')
        obj:setSelfCollisionMode(2)
        obj:setAerodynamicsMode(2)
      else
        setTractionModel(2)
        obj:setSelfCollisionMode(1)
        obj:setAerodynamicsMode(1)
      end
    end

    if M.mode == 'disabled' then
      driveCar(0, 0, 0, 0)
      M.updateGFX = nop
      currentRoute = nil
      if controller.mainController and restoreGearboxMode then
        controller.mainController.setGearboxMode('realistic')
      end
    end

    stateChanged()
    sounds.updateObjType()
  end

  visDebug.trajecRec = {last = 0}
  visDebug.routeRec = {last = 0}
end

local function setRecoverOnCrash(val)
  recover.recoverOnCrash = val
end

local function toggleTrafficMode()
  if M.mode == ""traffic"" then
    setMode(""disabled"")
    setRecoverOnCrash(false)
  else
    setMode(""traffic"")
    setRecoverOnCrash(true)
  end
end

local function reset() -- called when the user pressed I
  M.manualTargetName = nil
  resetInternalStates()

  throttleSmoother:set(0)
  smoothTcs:set(1)

  if M.mode ~= 'disabled' then
    driveCar(0, 0, 0, 0)
    setMode() -- some scenarios don't work if this is changed to setMode('disabled')
  end
  stateChanged()

  if dataLogger.logData ~= nop then
    startStopDataLog()
  end
end

local function resetLearning()
end

local function setState(newState)
  if tableSizeC(wheels.wheels) == 0 then return end

  if newState.mode and newState.mode ~= M.mode then -- new AI mode is not the same as the old one
    obj:queueGameEngineLua('onAiModeChange('..objectId..', ""'..newState.mode..'"")')
  end

  local mode = M.mode
  tableMerge(M, newState)
  setAggressionExternal(M.extAggression)

  -- after a reload (cntr-R) vehicle should be left with handbrake engaged if mode is disabled
  -- preserve initial state of vehicle controls (handbrake engaged) if current mode and new mode are both 'disabled'
  if not (mode == 'disabled' and M.mode == 'disabled') then
    setMode()
  end

  setVehicleDebugMode(M)
  setTargetObjectID(M.targetObjectID)
  stateChanged()
end

local function setTarget(wp)
  M.manualTargetName = wp
  validateInput = validateUserInput
  wpList = {wp}
end

local function setPath(path)
  manualPath = path
  validateInput = validateUserInput
end

local function driveUsingPath(arg)
  --[[ At least one argument of either path or wpTargetList or script must be specified. All other arguments are optional.

  * path: A sequence of waypoint names that form a path by themselves to be followed in the order provided.
  * wpTargetList: A sequence of waypoint names to be used as succesive targets ex. wpTargetList = {'wp1', 'wp2'}.
                  Between any two consequitive waypoints a shortest path route will be followed.
  * script: A sequence of positions from a user-defined trajectory. For each node/position we have
            * mandatory properties:
              * x, y, z global coordinates of the corresponding node
            * optional properties:
              * r, the width of the path built using the scripted trajectory at the corresponding node
              * vl, roadSpeedLimit for the corresponding node. If this value is specified and routeSpeedMode is set to 'legal', vl will act as an upper bound for the speed profile
              * v, speed value for the corresponding node. If this value is specified the ai is forced to reach it at the corresponding node, skipping awareness and routeSpeedLimit (if they are enabled)

  -- Optional Arguments --
  * wpSpeeds: Type: (key/value pairs, key: ""node_name"", value: speed, number in m/s)
              Define target speeds for individual waypoints. The ai will try to meet this speed when at the given waypoint.
  * noOfLaps: Type: number. Default value: nil
              The number of laps if the path is a loop. If not defined, the ai will just follow the succesion of waypoints once.
  * routeSpeed: A speed in m/s. To be used in tandem with ""routeSpeedMode"".
                Type: number
  * routeSpeedMode: Values: 'limit': the ai will not go above the 'routeSpeed' defined by routeSpeed.
                            'set': the ai will try to always go at the speed defined by ""routeSpeed"".
  * driveInLane: Values: 'on' (anything else is considered off/inactive)
                 When 'on' the ai will keep on the correct side of the road on two way roads.
                 This also affects pathFinding in that when this option is active ai paths will traverse roads in the legal direction if posibble.
                 Default: inactive
  * aggression: Value: 0.3 - 1. The aggression value with which the ai will drive the route.
                At 1 the ai will drive at the limit of traction. A value of 0.3 would be considered normal every day driving, going shopping etc.
                Default: 0.3
  * avoidCars: Values: 'on' / 'off'.  When 'on' the ai will be aware of (avoid crashing into) other vehicles on the map. Default is 'off'
  * examples:
  ai.driveUsingPath{ wpTargetList = {'wp1', 'wp10'}, driveInLane = 'on', avoidCars = 'on', routeSpeed = 35, routeSpeedMode = 'limit', wpSpeeds = {wp1 = 10, wp2 = 40}, aggression = 0.3}
  In the above example the speeds set for wp1 and wp2 will take precedence over ""routeSpeed"" for the specified nodes.
  --]]

  if (arg.wpTargetList == nil and arg.path == nil and arg.script == nil) or
    (type(arg.wpTargetList) ~= 'table' and type(arg.path) ~= 'table' and type(arg.script) ~= 'table') or
    (arg.wpSpeeds ~= nil and type(arg.wpSpeeds) ~= 'table') or
    (arg.noOfLaps ~= nil and type(arg.noOfLaps) ~= 'number') or
    (arg.routeSpeed ~= nil and type(arg.routeSpeed) ~= 'number') or
    (arg.routeSpeedMode ~= nil and type(arg.routeSpeedMode) ~= 'string') or
    (arg.driveInLane ~= nil and type(arg.driveInLane) ~= 'string') or
    (arg.aggression ~= nil and type(arg.aggression) ~= 'number')
  then
    return
  end

  if arg.script then
    -- Set vehicle position and orientation at the start of the path
    -- Get initial position and orientation of vehicle at start of path (possibly time offset and/or time delayed)
    local script = arg.script
    local dir, up, pos
    if script[1].dir then
      -- vehicle initial orientation vectors exist

      dir = vec3(script[1].dir)
      up = vec3(script[1].up or mapmgr.surfaceNormalBelow(vec3(script[1])))

      local frontPosRelOrig = obj:getOriginalFrontPositionRelative() -- original relative front position in the vehicle coordinate system (left, back, up)
      local vx = dir * -frontPosRelOrig.y
      local vz = up * frontPosRelOrig.z
      local vy = dir:cross(up) * -frontPosRelOrig.x
      pos = vec3(script[1]) - vx - vz - vy
      local dH = require('scriptai').wheelToGroundDist(pos, dir, up)
      pos:setAdd(dH * up)
    else
      -- vehicle initial orientation vectors don't exist
      -- estimate vehicle orientation vectors from path and ground normal

      local p1 = vec3(script[1])
      local p1z0 = p1:z0()
      local scriptPosi = vec3()
      local k
      for i = 2, #script do
        scriptPosi:set(script[i].x, script[i].y, 0)
        if p1z0:squaredDistance(scriptPosi) > 0.2 * 0.2 then
          k = i
          break
        end
      end

      if k then
        local p2 = vec3(script[k])
        dir = p2 - p1; dir:normalize()
        up = mapmgr.surfaceNormalBelow(p1)

        local frontPosRelOrig = obj:getOriginalFrontPositionRelative() -- original relative front position in the vehicle coordinate system (left, back, up)
        local vx = dir * -frontPosRelOrig.y
        local vz = up * frontPosRelOrig.z
        local vy = dir:cross(up) * -frontPosRelOrig.x
        pos = p1 - vx - vz - vy
        local dH = require('scriptai').wheelToGroundDist(pos, dir, up)
        pos:setAdd(dH * up)
      end
    end

    if dir then
      local rot = quatFromDir(dir:cross(up):cross(up), up)
      obj:queueGameEngineLua(
        ""getObjectByID("" .. objectId .. ""):resetBrokenFlexMesh();"" ..
        ""vehicleSetPositionRotation("" .. objectId .. "","" .. pos.x .. "","" .. pos.y .. "","" .. pos.z .. "","" .. rot.x .. "","" .. rot.y .. "","" .. rot.z .. "","" .. rot.w .. "")""
      )

      mapmgr.setCustomMap() -- nils mapmgr.mapData
      M.mode = 'manual'
      stateChanged()
      noOfLaps = max(arg.noOfLaps or 1, 1)
      local pathMap = require('graphpath').newGraphpath() -- create a dummy graph

      local scrCount = #arg.script
      if noOfLaps > 1 and arg.script[scrCount].x == arg.script[1].x and arg.script[scrCount].y == arg.script[1].y and arg.script[scrCount].z == arg.script[1].z then
        loopPath = true
      end

      local path = table.new(scrCount, 0)
      local speedProfile = table.new(0, scrCount)
      local radius = obj:getInitialWidth()

      -- set the graph node positions and widths and create the path array and speed profile data
      for i = 1, scrCount - (loopPath and 1 or 0) do -- avoid adding the last point if the scripts loops
        local node = 'wp_'..tostring(i)
        pathMap:setPointPositionRadius(node, vec3(arg.script[i].x, arg.script[i].y, arg.script[i].z), arg.script[i].r or radius)
        path[i] = node
        speedProfile[node] = arg.script[i].v -- TODO: This is a problem with a looping path for first/last node speed setting
      end

      if loopPath then
        table.insert(path, path[1])
      end

      -- add the nodes and edges to the dummy graph
      for i = 1, scrCount - 1 do
        local n1id, n2id = path[i], path[i+1]
        pathMap:uniEdge(n1id, n2id, pathMap.positions[n1id]:distance(pathMap.positions[n2id]), 1, arg.script[i].vl or 100, nil, false)
      end

      scriptData = deepcopy(arg)
      scriptData.mapData = pathMap
      scriptData.path = path
      scriptData.speedProfile = speedProfile
      scriptData.noOfLaps = noOfLaps
      scriptData.loopPath = loopPath
    end
  else
    setState({mode = 'manual'})

    setParameters({ -- setParameters calls tableMerge so the nil guards are not really needed
      driveStyle = arg.driveStyle or 'default',
      staticFrictionCoefMult = arg.staticFrictionCoefMult,
      lookAheadKv = max(0.1, arg.lookAheadKv or parameters.lookAheadKv),
      understeerThrottleControl = arg.understeerThrottleControl,
      oversteerThrottleControl = arg.oversteerThrottleControl,
      throttleTcs = arg.throttleTcs,
      abBrakeControl = arg.abBrakeControl,
      underSteerBrakeControl = arg.underSteerBrakeControl,
      throttleKp = arg.throttleKp,
      targetSpeedSmootherRate = arg.targetSpeedSmootherRate,
      turnForceCoef = arg.turnForceCoef,
      springForceIntegratorDispLim = arg.springForceIntegratorDispLim
    })

    noOfLaps = max(arg.noOfLaps or 1, 1)
    wpList = arg.wpTargetList
    manualPath = arg.path
    validateInput = validateUserInput
    opt.avoidCars = arg.avoidCars or 'off'

    if noOfLaps > 1 and ((wpList and wpList[2] and wpList[1] == wpList[#wpList]) or (manualPath and manualPath[2] and manualPath[1] == manualPath[#manualPath])) then
      loopPath = true
    end

    speedProfile = arg.wpSpeeds or {}
    setSpeed(arg.routeSpeed)
    setSpeedMode(arg.routeSpeedMode)

    driveInLane(arg.driveInLane)

    setAggressionExternal(arg.aggression)
    stateChanged()
  end
end

local function spanMap(cutOffDrivability)
  M.cutOffDrivability = cutOffDrivability or 0
  setState({mode = 'span'})
  stateChanged()
end

local function setCutOffDrivability(drivability)
  M.cutOffDrivability = drivability or 0
  stateChanged()
end

local function onDeserialized(v)
  setState(v)
  stateChanged()
end

local function dumpCurrentRoute()
  dump(currentRoute)
end

local function getParameters()
  return parameters
end

local function startRecording(recordSpeed)
  M.mode = 'script'
  scriptai = require(""scriptai"")
  scriptai.startRecording(recordSpeed)
  M.updateGFX = scriptai.updateGFX
end

local function stopRecording()
  M.mode = 'disabled'
  scriptai = require(""scriptai"")
  local script = scriptai.stopRecording()
  M.updateGFX = scriptai.updateGFX
  return script
end

local function startFollowing(...)
  local script = ...
  if script.path then
    script = script.path
  end
  if script[1] and script[1].v then
    driveUsingPath({script = script})
  else
    M.mode = 'script'
    scriptai = require(""scriptai"")
    scriptai.startFollowing(...)
    M.updateGFX = scriptai.updateGFX
  end
end

local function scriptStop(...)
  M.mode = 'disabled'
  scriptai = require(""scriptai"")
  scriptai.scriptStop(...)
  M.updateGFX = scriptai.updateGFX
end

local function scriptState()
  scriptai = require(""scriptai"")
  return scriptai.scriptState()
end

local function setScriptDebugMode(mode)
  scriptai = require(""scriptai"")
  if mode == nil or mode == 'off' then
    M.debugMode = 'all'
    M.debugDraw = nop
    return
  end

  M.debugDraw = debugDraw
  scriptai.debugMode = mode
end

local function isDriving()
  return M.updateGFX == updateGFX or (scriptai ~= nil and scriptai.isDriving())
end


-- public interface
M.driveInLane = driveInLane
M.stateChanged = stateChanged
M.reset = reset
M.setMode = setMode
M.toggleTrafficMode = toggleTrafficMode
M.setAvoidCars = setAvoidCars
M.setTarget = setTarget
M.setPath = setPath
M.setSpeed = setSpeed
M.setSpeedMode = setSpeedMode
M.setParameters = setParameters
M.getParameters = getParameters
M.setVehicleDebugMode = setVehicleDebugMode
M.setState = setState
M.getState = getState
M.debugDraw = nop
M.driveUsingPath = driveUsingPath
M.setAggressionMode = setAggressionMode
M.setAggression = setAggressionExternal
M.onDeserialized = onDeserialized
M.setTargetObjectID = setTargetObjectID
M.laneChange = laneChange
M.setStopPoint = setStopPoint
M.dumpCurrentRoute = dumpCurrentRoute
M.spanMap = spanMap
M.setCutOffDrivability = setCutOffDrivability
M.resetLearning = resetLearning
M.isDriving = isDriving
M.startStopDataLog = startStopDataLog
M.setRecoverOnCrash = setRecoverOnCrash
M.getEdgeLaneConfig = getEdgeLaneConfig
M.setPullOver = setPullOver
M.roadNaturalContinuation = roadNaturalContinuation -- for debugging

-- scriptai
M.startRecording = startRecording
M.stopRecording = stopRecording
M.startFollowing = startFollowing
M.stopFollowing = scriptStop
M.scriptStop = scriptStop
M.scriptState = scriptState
M.setScriptDebugMode = setScriptDebugMode
M.setTractionModel = setTractionModel
M.setSpeedProfileMode = setSpeedProfileMode

return M
"
NWDvit8g,Cracked 'PDF to Foundry Importer' for PF2e originally by fryguy,DaBenjle,JavaScript,Friday 21st of November 2025 11:29:45 PM CDT,"// Override your ./<foundryuserdata>/Data/pdftofoundry/importer.mjs file with this content,
// then simply restart foundry and it will no longer do a purchase validity check.
var __defProp = Object.defineProperty;
var __defNormalProp = (_0x41471d, _0x1e1100, _0x28c88f) =>
  _0x1e1100 in _0x41471d
    ? __defProp(_0x41471d, _0x1e1100, {
        enumerable: true,
        configurable: true,
        writable: true,
        value: _0x28c88f,
      })
    : (_0x41471d[_0x1e1100] = _0x28c88f);
var __name = (_0x2cc3f2, _0x2cbd13) =>
  __defProp(_0x2cc3f2, ""name"", {
    value: _0x2cbd13,
    configurable: true,
  });
var __publicField = (_0x1d9f24, _0x1bb1c5, _0x151e39) =>
  __defNormalProp(
    _0x1d9f24,
    typeof _0x1bb1c5 !== ""symbol"" ? _0x1bb1c5 + """" : _0x1bb1c5,
    _0x151e39
  );
import {
  j as _0x288a9b,
  _ as _0x5c4fdf,
  b as _0x27c34c,
  c as _0x44b372,
  l as _0x4b0578,
  d as _0x39aa0d,
  p as _0x4d9c6f,
} from ""./vendor.mjs"";
import {
  m as _0x119297,
  s as _0x499903,
  u as _0x69751b,
  g as _0x33a514,
  t as _0x549107,
  M as _0x177173,
  a as _0x47bd8f,
} from ""./FoundryGui.mjs"";
const _ModuleImporter = class _ModuleImporter {
  constructor(_0x201ad8) {
    __publicField(this, ""additionalMessages"", """");
    __publicField(this, ""sceneSort"", 0);
    __publicField(this, ""adventure"");
    __publicField(this, ""npcActors"", new Map());
    __publicField(this, ""createdFolders"", []);
    this.adventure = _0x201ad8;
  }
  async fetchJson(_0x5daf33) {
    const _0x44882b = await fetch(""/modules/pdftofoundry/"" + _0x5daf33);
    return await _0x44882b.json();
  }
  async fromUuid(_0x2b073f) {
    const _0x3aefec = await fromUuid(_0x2b073f);
    if (!_0x3aefec) {
      return null;
    }
    return game.actors.fromCompendium(_0x3aefec);
  }
  async ensureFolderExists(_0x1e5d43) {
    if (this.createdFolders.includes(_0x1e5d43)) {
      return;
    }
    const _0xf4481d = _0x1e5d43.split(""/"");
    if (_0xf4481d.length > 1) {
      await this.ensureFolderExists(
        _0xf4481d.slice(0, _0xf4481d.length - 1).join(""/"")
      );
    }
    try {
      await _0x119297(_0x1e5d43);
    } catch {}
    await _0x499903(500);
    this.createdFolders.push(_0x1e5d43);
  }
  async emitFile(_0x329632, _0x4bf299, _0x1d3cf7) {
    const _0x5e78d8 = game.settings.get(""pdftofoundry"", ""basePath"");
    const _0x115a13 = _0x288a9b(_0x5e78d8, this.adventure.prefix, _0x329632);
    await this.ensureFolderExists(_0x115a13);
    await _0x69751b(_0x1d3cf7, _0x115a13, _0x4bf299);
    return _0x288a9b(_0x115a13, _0x4bf299);
  }
  async emitImage(_0x33f4d7, _0x53eabe, _0x46d6d8) {
    if (_0x46d6d8.toBlob === undefined) {
      return await this.emitFile(
        _0x33f4d7,
        _0x53eabe,
        await _0x46d6d8.toBuffer()
      );
    }
    const _0x4ea853 = await new Promise((_0x5bce14) =>
      _0x46d6d8.toBlob((_0x2cbf77) => _0x5bce14(_0x2cbf77), ""image/webp"")
    );
    return await this.emitFile(_0x33f4d7, _0x53eabe, _0x4ea853);
  }
  getCanonicalArtForToken(_0x4a9600) {
    const _0x453a44 = _0x33a514()
      .filter((_0x30f0c4) => _0x30f0c4.prefix !== this.adventure.prefix)
      .flatMap((_0x220801) =>
        _0x220801.npcs
          .filter((_0x40d020) => _0x4a9600.shouldBeReplacedByArt(_0x40d020))
          .map((_0x12f759) => _0x549107.getTokenArt(_0x220801, _0x12f759))
          .filter((_0x2cf234) => _0x2cf234 !== undefined)
      );
    if (_0x453a44 == null) {
      return undefined;
    } else {
      return _0x453a44[0];
    }
  }
  async finalize() {
    _0x549107.uploadTokenArt();
    ui.notifications.queue = [];
  }
  fixupJournal(_0x416647, _0x3d92f0) {
    _0x416647.text.content = _0x416647.text.content.replace(
      /<h4 data-monster-id=""(.*?)"">([^<>]+)<\/h4>/g,
      (_0x209bf9, _0x6c074d, _0x13d257) => {
        if (_0x3d92f0.has(_0x6c074d)) {
          return ""@Actor["" + _0x3d92f0.get(_0x6c074d) + ""]{"" + _0x13d257 + ""}"";
        }
        console.log(
          ""PDFToFoundry | Couldn't find actor for "" +
            _0x6c074d +
            "" : "" +
            _0x13d257
        );
        return _0x209bf9;
      }
    );
  }
  getCanonicalSceneMapping() {
    const _0x5fedd7 = game.settings.get(""pdftofoundry"", ""basePath"");
    const _0x22d98d = _0x33a514().flatMap((_0x4cd3bb) =>
      _0x4cd3bb.scenes.map((_0x370c45) => {
        var _0x4d9c6e;
        var _0xa165fd;
        return {
          path: _0x288a9b(
            _0x5fedd7,
            _0x4cd3bb.prefix,
            _0x370c45.name + "".webp""
          ),
          name:
            (_0x4d9c6e = _0x370c45.canonical) == null
              ? undefined
              : _0x4d9c6e.name,
          priority:
            (_0xa165fd = _0x370c45.canonical) == null
              ? undefined
              : _0xa165fd.priority,
        };
      })
    );
    return _0x22d98d;
  }
  async createScene(_0x124656, _0x309d88, _0x178cb7, _0x379612) {
    if (_0x309d88) {
      const _0x49b3ea = this.getCanonicalSceneMapping();
      for (const _0xffae0c of game.scenes.contents) {
        const _0x15cde2 = _0x49b3ea
          .filter((_0x579885) => _0x579885.name === _0x309d88)
          .find((_0x42f0f5) => _0x42f0f5.path === _0xffae0c.background.src);
        if (_0x15cde2 && _0x178cb7 > _0x15cde2.priority) {
          await _0xffae0c.update({
            img: _0x124656.background.src,
            width: _0x124656.width,
            height: _0x124656.height,
            ""background.offsetX"": _0x124656.background.offsetX,
            ""background.offsetY"": _0x124656.background.offsetY,
          });
          const _0x1e7c6a = await _0xffae0c.createThumbnail();
          _0xffae0c.update(
            {
              thumb: _0x1e7c6a.thumb,
            },
            {
              diff: false,
            }
          );
          if (!game.settings.get(""pdftofoundry"", ""alwaysCreateScenes"")) {
            return;
          }
        } else if (_0x15cde2 && _0x178cb7 < _0x15cde2.priority) {
          _0x124656.background.src = _0xffae0c.background.src;
          _0x124656.width = _0xffae0c.width;
          _0x124656.height = _0xffae0c.height;
          _0x124656.background.offsetX = _0xffae0c.background.offsetX;
          _0x124656.background.offsetY = _0xffae0c.background.offSetY;
          _0x178cb7 = _0x15cde2.priority;
        }
      }
    }
    const [_0x5f3b5e] = await Scene.createDocuments([_0x124656]);
    _0x124656._id = _0x5f3b5e.id;
    const _0x23de64 = [];
    for (const _0x29c729 of _0x379612) {
      const _0x5cfdbf = this.npcActors[_0x29c729.id];
      if (!_0x5cfdbf) {
        continue;
      }
      const _0x2368cb = await _0x5cfdbf.getTokenDocument({
        x: _0x29c729.x,
        y: _0x29c729.y,
        hidden: true,
      });
      _0x23de64.push(_0x2368cb.toObject());
    }
    _0x5f3b5e.createEmbeddedDocuments(""Token"", _0x23de64);
    const _0x1f09c5 = game.scenes.get(_0x5f3b5e.id);
    if (_0x1f09c5) {
      const _0x1078c9 = await _0x1f09c5.createThumbnail();
      await _0x1f09c5.update(
        {
          thumb: _0x1078c9.thumb,
        },
        {
          diff: false,
        }
      );
    }
    return _0x1f09c5;
  }
  async importActor(_0x4952b6, _0x35f7fc) {
    const _0x4db2b0 = this.getCanonicalArtForToken(_0x35f7fc.npc);
    const _0x3e9576 = await this.fromUuid(_0x4952b6);
    if (!_0x3e9576) {
      return null;
    }
    _0x3e9576.img = _0x4db2b0 !== undefined ? _0x4db2b0.actor : _0x35f7fc.img;
    _0x3e9576.prototypeToken.texture.src =
      _0x4db2b0 !== undefined ? _0x4db2b0.token : _0x35f7fc.token;
    _0x3e9576.folder = _0x35f7fc.folder;
    if (_0x35f7fc.name) {
      _0x3e9576.name = _0x35f7fc.name;
      _0x3e9576.prototypeToken.name = _0x35f7fc.name;
    }
    if (_0x35f7fc.elite) {
      _0x3e9576.system.traits.value.push(""elite"");
    }
    if (_0x35f7fc.weak) {
      _0x3e9576.system.traits.value.push(""weak"");
    }
    _0x3e9576.flags.pdftofoundry = {
      module: this.adventure.prefix,
      id: _0x35f7fc.id,
    };
    const _0x5aedd8 = game.settings.get(
      ""pdftofoundry"",
      ""alwaysUseImportedIcons""
    );
    if (!_0x5aedd8) {
      const _0x329777 = game.compendiumArt.get(_0x35f7fc.npc.uniqueKey);
      if (_0x329777 !== undefined) {
        _0x3e9576.img = _0x329777.actor;
        foundry.utils.mergeObject(_0x3e9576.prototypeToken, _0x329777.token, {
          inplace: true,
          recursive: true,
        });
      }
    }
    let _0x2eff27 = null;
    if (!this.adventure.noImport) {
      const _0x5eabcb = CONFIG.Actor.documentClass;
      const _0x46106a = await _0x5eabcb.createDocuments([_0x3e9576], {
        fromCompendium: true,
      });
      _0x2eff27 = _0x46106a[0];
      this.npcActors[_0x35f7fc.id] = _0x46106a[0];
    }
    if (_0x4db2b0 === undefined && !_0x35f7fc.npc.isPlaceholderArt()) {
      _0x549107.setTokenArt(this.adventure, _0x35f7fc, {
        actor: _0x35f7fc.img,
        token: _0x35f7fc.token,
      });
    }
    return _0x2eff27;
  }
  async import(_0x33b8e3, _0x4f3a13) {
    var _0x1e99b0;
    var _0x1ea252;
    const _0x5d005e = new _0x177173();
    this.adventure.progressFn = _0x4f3a13;
    this.adventure.preprocess(_0x33b8e3.textDetails);
    await this.adventure.extractImageJournals(_0x33b8e3, _0x5d005e, this);
    const _0x37d873 = {};
    for (const [_0x14317d, _0x570d62] of this.adventure.pages.entries()) {
      _0x4f3a13(
        ""Extracting page "" + _0x14317d,
        _0x14317d / this.adventure.pages.length
      );
      _0x570d62(_0x33b8e3, (_0x5f5919, _0x546344) => {
        if (_0x37d873[_0x5f5919] === undefined) {
          _0x37d873[_0x5f5919] = [];
        }
        _0x37d873[_0x5f5919].push(_0x546344);
      });
    }
    for (let _0x1eda14 in _0x37d873) {
      const _0x53ccf3 = this.adventure.extractDetails(
        _0x37d873[_0x1eda14],
        _0x5d005e,
        _0x1eda14
      );
      for (const _0x44ebe4 of _0x53ccf3) {
        _0x5d005e.journalEntries.push(_0x44ebe4);
        if (_0x1eda14.startsWith(""sidebar"")) {
          _0x1eda14 = ""Sidebars"";
        }
      }
    }
    this.adventure.finalize(_0x5d005e);
    _0x549107.eagerLoad();
    const _0x379219 = __name((_0x47ca53, _0x3531cd = ""m"") => {
      let _0x3de05e = undefined;
      return async () =>
        (_0x3de05e ||= (
          await Folder.createDocuments([
            {
              name: this.adventure.fullName,
              type: _0x47ca53,
              parent: null,
              sorting: _0x3531cd,
            },
          ])
        )[0]);
    }, ""lazyFolder"");
    const _0x287d1a = _0x379219(""Scene"");
    const _0x267e82 = _0x379219(""JournalEntry"");
    const _0x4e0d0e = _0x379219(""Actor"", ""a"");
    for (const _0x1d2f7f of this.adventure.combines) {
      this.adventure.appendJournal(_0x5d005e, _0x1d2f7f.source, _0x1d2f7f.dest);
    }
    const _0x1651d5 = new Map();
    for (const [_0x5f4f98, _0x123bae] of this.adventure.npcs.entries()) {
      _0x4f3a13(
        ""Extracting npc "" + _0x5f4f98,
        _0x5f4f98 / this.adventure.npcs.length
      );
      const _0x20825f = await _0x123bae.generate(_0x33b8e3, this);
      if (_0x20825f === undefined) {
        console.error(
          ""PDFToFoundry | There wasn't an npc to import for "" + _0x123bae.id
        );
        continue;
      }
      if (!this.adventure.noImport);
      const [_0x5ce8bc, _0x35cd79] = _0x20825f;
      const _0x48e8cd = await this.importActor(_0x5ce8bc, {
        ..._0x35cd79,
        folder: (await _0x4e0d0e()).id,
      });
      if (!_0x48e8cd) {
        if (_0x48e8cd === undefined) {
          this.additionalMessages += ""<br>Failed importing "" + _0x123bae.id;
        }
        continue;
      }
      for (const _0x149550 of _0x123bae.forIds ?? []) {
        _0x1651d5.set(_0x149550, _0x48e8cd.id);
      }
    }
    for (const _0x4dd10e of _0x5d005e.journalEntries) {
      this.fixupJournal(_0x4dd10e, _0x1651d5);
    }
    let _0x571e55 = 0;
    let _0x1cfba7 = [..._0x5d005e.journalEntries];
    const _0x1ce87e = [];
    for (const _0x3f348e of this.adventure.journalPages) {
      const _0x2520a4 = _0x3f348e.pages
        .map((_0xd8e762) => {
          const _0x183269 = _0x1cfba7.find(
            (_0x3dcf91) => _0x3dcf91.flags.pdftofoundry.id === _0xd8e762.id
          );
          if (_0x183269 !== undefined && _0xd8e762.name) {
            _0x183269.name = _0x33b8e3.decodeEncodedString(_0xd8e762.name);
          }
          return _0x183269;
        })
        .filter((_0x11a9f0) => _0x11a9f0);
      _0x1cfba7 = _0x1cfba7.filter(
        (_0xbc5b3b) =>
          !_0x2520a4.some(
            (_0x165b78) =>
              _0x165b78.flags.pdftofoundry.id ===
              _0xbc5b3b.flags.pdftofoundry.id
          )
      );
      if (_0x2520a4.length > 0) {
        _0x1ce87e.push({
          name: _0x33b8e3.decodeEncodedString(_0x3f348e.name),
          pages: _0x2520a4,
        });
      }
    }
    if (_0x1cfba7.length > 0) {
      _0x1ce87e.push({
        pages: _0x1cfba7,
        name: this.adventure.fullName,
      });
    }
    for (const { pages: _0x21c0d2, name: _0x1c7400 } of _0x1ce87e) {
      _0x571e55 += 100;
      const _0x3233a1 = {
        name: _0x1c7400,
        folder: (await _0x267e82()).id,
        sort: _0x571e55,
        permission: {
          default: 0,
        },
        pages: _0x21c0d2.map((_0x3eb743) => ({
          ..._0x3eb743,
        })),
      };
      const _0x2b60a8 = await JournalEntry.createDocuments([_0x3233a1]);
      for (let _0x387fc9 = 0; _0x387fc9 < _0x21c0d2.length; _0x387fc9++) {
        _0x21c0d2[_0x387fc9].journalId = _0x2b60a8[0].id;
        _0x21c0d2[_0x387fc9].journalPageId =
          _0x2b60a8[0].pages.contents[_0x387fc9].id;
      }
    }
    let _0x13c5cc = 0;
    let _0x2128e9 = undefined;
    for (const [_0x1ecc24, _0xedee92] of this.adventure.scenes.entries()) {
      _0x4f3a13(
        ""Extracting scene "" + _0x1ecc24,
        _0x1ecc24 / this.adventure.scenes.length
      );
      try {
        const _0x461656 = await _0xedee92.generate(_0x33b8e3, _0x5d005e, this);
        if (_0x461656 === undefined) {
          continue;
        }
        _0x13c5cc += 100;
        const _0x4cc403 = await this.createScene(
          {
            ..._0x461656,
            sort: _0x13c5cc,
            folder: (await _0x287d1a()).id,
          },
          (_0x1e99b0 = _0xedee92.canonical) == null
            ? undefined
            : _0x1e99b0.name,
          (_0x1ea252 = _0xedee92.canonical) == null
            ? undefined
            : _0x1ea252.priority,
          _0xedee92.tokens
        );
        _0x2128e9 = _0x2128e9 ?? _0x4cc403;
      } catch (_0x56b968) {
        console.error(_0x56b968);
      }
    }
    this.finalize();
    if (_0x2128e9 !== undefined) {
      await _0x2128e9.activate();
    }
    _0x4f3a13(""Complete. Enjoy!"", 1);
  }
};
__name(_ModuleImporter, ""ModuleImporter"");
let ModuleImporter = _ModuleImporter;
const _PdfData = class _PdfData {
  constructor(_0x3d07d1) {
    __publicField(this, ""imageDetails"");
    __publicField(this, ""textDetails"");
    Object.assign(this, _0x3d07d1);
  }
  createEncodedStringFromText(_0x2af7a7) {
    let _0x4af552 = """";
    let _0x43a6ba = _0x2af7a7;
    while (_0x43a6ba.length > 0) {
      let _0x563f9b = false;
      for (let _0xf2884e = _0x43a6ba.length; _0xf2884e > 0; _0xf2884e--) {
        const _0x12c7d9 = _0x43a6ba.substring(0, _0xf2884e);
        let _0x28d3ca = undefined;
        if (_0xf2884e === 1) {
          _0x28d3ca = _0x12c7d9;
        }
        for (const _0x4075f0 of this.textDetails) {
          const _0x4025f1 = _0x4075f0.text
            .toLocaleLowerCase()
            .indexOf(_0x12c7d9.toLocaleLowerCase());
          if (_0x4025f1 !== -1) {
            const _0x8d6a01 = _0x4075f0.text.substring(
              _0x4025f1,
              _0x4025f1 + _0xf2884e
            );
            let _0x237827 = undefined;
            if (_0x8d6a01 === _0x12c7d9) {
              _0x237827 =
                ""{"" +
                _0x4075f0.id +
                "":"" +
                _0x4025f1 +
                "":"" +
                (_0x4025f1 + _0xf2884e) +
                ""}"";
            } else if (this.sentenceCase(_0x8d6a01) === _0x12c7d9) {
              _0x237827 =
                ""{"" +
                _0x4075f0.id +
                "":"" +
                _0x4025f1 +
                "":"" +
                (_0x4025f1 + _0xf2884e) +
                "":S}"";
            } else if (_0x8d6a01.toLocaleUpperCase() === _0x12c7d9) {
              _0x237827 =
                ""{"" +
                _0x4075f0.id +
                "":"" +
                _0x4025f1 +
                "":"" +
                (_0x4025f1 + _0xf2884e) +
                "":U}"";
            } else if (_0x8d6a01.toLocaleLowerCase() === _0x12c7d9) {
              _0x237827 =
                ""{"" +
                _0x4075f0.id +
                "":"" +
                _0x4025f1 +
                "":"" +
                (_0x4025f1 + _0xf2884e) +
                "":L}"";
            } else {
              const _0x494a06 = [...Array(_0x12c7d9.length).keys()].filter(
                (_0x431cd8) =>
                  _0x12c7d9[_0x431cd8] ===
                  _0x12c7d9[_0x431cd8].toLocaleUpperCase()
              );
              _0x237827 =
                ""{"" +
                _0x4075f0.id +
                "":"" +
                _0x4025f1 +
                "":"" +
                (_0x4025f1 + _0xf2884e) +
                "":"" +
                _0x494a06.join("","") +
                ""}"";
            }
            if (
              _0x28d3ca === undefined ||
              _0x237827.length < _0x28d3ca.length
            ) {
              _0x28d3ca = _0x237827;
            }
          }
        }
        if (_0x28d3ca) {
          _0x4af552 += _0x28d3ca;
          _0x43a6ba = _0x43a6ba.substring(_0xf2884e);
          _0x563f9b = true;
          break;
        }
      }
      if (!_0x563f9b) {
        break;
      }
    }
    return _0x4af552;
  }
  decodeEncodedString(_0x4e3b28) {
    return _0x4e3b28.replace(
      /\{([^}]*):([^}]*):([^}]*)(:([^}]*))?\}/g,
      (_0xed3863) => {
        const _0x37b413 = _0xed3863
          .substring(1, _0xed3863.length - 1)
          .split("":"");
        const _0x1a45ee = this.textDetails.find(
          (_0x37c57d) => _0x37c57d.id === _0x37b413[0]
        );
        if (!_0x1a45ee) {
          return """";
        }
        let _0x28b859 = _0x1a45ee.text.substring(
          Number(_0x37b413[1]),
          Number(_0x37b413[2])
        );
        if (_0x37b413.length >= 4 && _0x37b413[3] === ""L"") {
          _0x28b859 = _0x28b859.toLocaleLowerCase();
        } else if (_0x37b413.length >= 4 && _0x37b413[3] === ""U"") {
          _0x28b859 = _0x28b859.toLocaleUpperCase();
        } else if (_0x37b413.length >= 4 && _0x37b413[3] === ""S"") {
          _0x28b859 = this.sentenceCase(_0x28b859);
        } else if (_0x37b413.length >= 4) {
          const _0x37f938 = _0x37b413[3].split("","");
          _0x28b859 = [...Array(_0x28b859.length).keys()]
            .map((_0x5878a3) =>
              _0x37f938.find((_0x2989d0) => _0x2989d0 === """" + _0x5878a3)
                ? _0x28b859[_0x5878a3].toLocaleUpperCase()
                : _0x28b859[_0x5878a3]
            )
            .join("""");
        }
        return _0x28b859;
      }
    );
  }
  sentenceCase(_0x10efce) {
    return _0x10efce
      .split("" "")
      .map((_0x704cc) =>
        _0x704cc.length > 1
          ? _0x704cc[0].toUpperCase() + _0x704cc.substr(1).toLowerCase()
          : _0x704cc
      )
      .join("" "")
      .trim();
  }
  getText(_0x25dc31) {
    const _0xc8a098 = this.textDetails.find(
      (_0x42f834) =>
        _0x42f834.page === _0x25dc31.page &&
        Math.abs(_0x42f834.x - _0x25dc31.x) < 1 &&
        Math.abs(_0x42f834.y - _0x25dc31.y) < 1
    );
    if (!_0xc8a098) {
      return """";
    }
    let _0x46d80b = _0xc8a098.text;
    if (_0x25dc31.substring !== undefined) {
      _0x46d80b = _0x46d80b.substring(
        _0x25dc31.substring.start,
        _0x25dc31.substring.end
      );
    }
    if (
      _0x25dc31.sentenceCase === undefined ||
      _0x25dc31.sentenceCase === true
    ) {
      _0x46d80b = this.sentenceCase(_0x46d80b);
    }
    return _0x46d80b;
  }
  getTextById(_0xd41d59) {
    const _0x5c844b = this.textDetails.find(
      (_0x570364) => _0x570364.id === _0xd41d59
    );
    if (!_0x5c844b) {
      return """";
    }
    return _0x5c844b.text;
  }
};
__name(_PdfData, ""PdfData"");
let PdfData = _PdfData;
function log(_0x2af440) {}
__name(log, ""log"");
async function parsePdf(_0x3e4a48, _0x376800, _0x2a6a09) {
  const _0xaced8 = _0x5c4fdf(_0x3e4a48);
  const _0x48d8b9 = await _0xaced8.promise;
  const _0x4837fd = [];
  const _0x1ad58f = [];
  const _0x198638 = new Set();
  let _0x562860 = 1;
  const _0xe67a5d = Array(_0x48d8b9.numPages)
    .fill(1)
    .map((_0x42e0a5, _0x56880b) => _0x42e0a5 + _0x56880b);
  for (let _0x4ec28c = 0; _0x4ec28c < _0xe67a5d.length; _0x4ec28c++) {
    const _0x2a0d7b = _0xe67a5d[_0x4ec28c];
    _0x376800(""Fetching page "" + _0x2a0d7b, _0x4ec28c / _0xe67a5d.length);
    const _0x379152 = await _0x48d8b9.getPage(_0x2a0d7b);
    const _0x451685 = await _0x379152.getOperatorList({
      intent: ""any"",
    });
    const _0x2a33c0 = _0x562860;
    let _0x8975ab = false;
    const _0x37bdf5 = [];
    const _0x45714f = __name((_0x1b2409) => {
      let _0x21bbdd = _0x1b2409;
      let _0x582d6f = [1, 0, 0, 1, 0, 0];
      try {
        const _0x59a23d = _0x379152.commonObjs.get(_0x1b2409);
        _0x21bbdd = _0x59a23d.name;
        if (_0x59a23d.fontMatrix) {
          _0x582d6f = _0x59a23d.fontMatrix;
        }
      } catch {}
      const _0x51cd5e = _0x1b2409.indexOf(""+"");
      if (_0x51cd5e !== -1) {
        _0x21bbdd = _0x1b2409.substring(_0x51cd5e + 1);
      }
      return [_0x21bbdd, _0x582d6f];
    }, ""getFontDetails"");
    const _0x2e99fe = Object.entries(_0x27c34c).reduce(
      (_0x59bcbb, _0x535250) => {
        const [_0x38ee1e, _0x1ea908] = _0x535250;
        _0x59bcbb[_0x1ea908] = _0x38ee1e;
        return _0x59bcbb;
      },
      {}
    );
    const _0x326258 = {
      fontName: """",
      baseFontSize: 1,
      currentTextMatrix: [1, 0, 0, 1, 0, 0],
      currentTextLineMatrix: [1, 0, 0, 1, 0, 0],
      fillRGBColor: """",
      strokeRGBColor: """",
      lineWidth: 0,
      leading: 0,
      charSpacing: 0,
      wordSpacing: 0,
      gstate: {},
      transform: [1, 0, 0, 1, 0, 0],
      path: [],
      clip: [],
      fontMatrix: [1, 0, 0, 1, 0, 0],
      textContinuation: false,
    };
    const _0x305d54 = [];
    let _0x482ed6 = _0x326258;
    const _0x143dd9 = __name((_0x34392a, _0x46f028) => {
      _0x482ed6.currentTextLineMatrix[4] +=
        _0x34392a * _0x482ed6.currentTextLineMatrix[0];
      _0x482ed6.currentTextLineMatrix[5] +=
        _0x46f028 * _0x482ed6.currentTextLineMatrix[3];
      _0x482ed6.currentTextMatrix = [..._0x482ed6.currentTextLineMatrix];
      _0x482ed6.textContinuation = false;
    }, ""moveText"");
    for (let _0x132a45 = 0; _0x132a45 < _0x451685.fnArray.length; _0x132a45++) {
      const _0x3d94d9 = _0x451685.argsArray[_0x132a45];
      const _0x6760d9 = _0x2e99fe[_0x451685.fnArray[_0x132a45]];
      switch (_0x451685.fnArray[_0x132a45]) {
        case _0x27c34c.setTextMatrix:
          log(""    setTextMatrix "" + JSON.stringify(_0x3d94d9));
          _0x482ed6.currentTextLineMatrix = _0x3d94d9;
          _0x482ed6.currentTextMatrix = [..._0x482ed6.currentTextLineMatrix];
          break;
        case _0x27c34c.setFont:
          [_0x482ed6.fontName, _0x482ed6.baseFontSize] = _0x3d94d9;
          [_0x482ed6.fontName, _0x482ed6.fontMatrix] = _0x45714f(
            _0x482ed6.fontName
          );
          _0x482ed6.fontName = _0x482ed6.fontName.replace(/[^+]+\+/, """");
          break;
        case _0x27c34c.showText: {
          const _0x359d61 = _0x3d94d9[0]
            .map((_0x5a5f3d) => _0x5a5f3d.unicode)
            .join("""");
          const _0x4df8e0 = _0x3d94d9[0]
            .map((_0x331cad) => _0x331cad.width ?? 0)
            .reduce((_0x1f5b37, _0x10f24b) => _0x1f5b37 + _0x10f24b, 0);
          const _0x15382c = _0x3d94d9[0]
            .map((_0x11fda8) => _0x11fda8.isSpace ?? 0)
            .reduce((_0x9f5fc5, _0x541d49) => _0x9f5fc5 + _0x541d49, 0);
          const _0x2803b7 = _0x482ed6.currentTextMatrix[2];
          const _0x2cc691 = _0x482ed6.currentTextMatrix[3];
          const _0x31399c = Math.sqrt(
            _0x2803b7 * _0x2803b7 + _0x2cc691 * _0x2cc691
          );
          const _0x284037 = _0x482ed6.baseFontSize * _0x31399c;
          const _0x463402 = _0x482ed6.fontName + "":"" + _0x284037;
          const _0x3efa92 = _0x482ed6.currentTextMatrix[4];
          const _0x49f853 = _0x482ed6.currentTextMatrix[5];
          log(
            ""(["" +
              _0x3efa92 +
              "", "" +
              _0x49f853 +
              ""], "" +
              _0x482ed6.fontName +
              "":"" +
              _0x284037 +
              "" - "" +
              _0x482ed6.fillRGBColor +
              ""/"" +
              _0x482ed6.strokeRGBColor +
              ""/"" +
              _0x482ed6.lineWidth +
              "" ["" +
              _0x482ed6.charSpacing +
              "" / "" +
              _0x482ed6.wordSpacing +
              ""]) "" +
              _0x4df8e0 +
              ""/"" +
              _0x15382c +
              ' - ""' +
              _0x359d61 +
              '""'
          );
          const _0x412eab = ensureId(
            _0x198638,
            (_0x461ccd) =>
              _0x2a33c0 +
              "":"" +
              Math.round(_0x3efa92) +
              "":"" +
              Math.round(_0x49f853) +
              (_0x461ccd > 0 ? "":"" + _0x461ccd : """")
          );
          if (_0x49f853 === 2) {
            _0x8975ab = true;
          }
          const _0x15c6be =
            _0x4837fd.length > 0 &&
            _0x4837fd[_0x4837fd.length - 1].text === _0x359d61;
          if (!_0x15c6be && _0x284037 > 4) {
            if (
              _0x482ed6.textContinuation &&
              _0x359d61.trim() === """" &&
              _0x463402 === _0x4837fd[_0x4837fd.length - 1].fontId
            ) {
              _0x4837fd[_0x4837fd.length - 1].text =
                _0x4837fd[_0x4837fd.length - 1].text.trimEnd() + _0x359d61;
            } else if (_0x359d61.trim() !== """") {
              _0x4837fd.push({
                text: _0x359d61,
                fontId: _0x463402,
                fontName: _0x482ed6.fontName,
                fontSize: _0x284037,
                color: _0x482ed6.fillRGBColor,
                isLeftAligned: false,
                isIndented: false,
                page: _0x2a33c0,
                x: _0x3efa92,
                y: _0x49f853,
                id: btoa(_0x412eab).replace(/=/g, """"),
              });
            }
          }
          _0x482ed6.currentTextMatrix[4] +=
            (_0x4df8e0 * _0x482ed6.fontMatrix[0] +
              _0x359d61.length * _0x482ed6.charSpacing +
              _0x15382c * _0x482ed6.wordSpacing) *
            _0x482ed6.currentTextMatrix[0];
          _0x482ed6.textContinuation = true;
          break;
        }
        case _0x27c34c.beginText:
          break;
        case _0x27c34c.endText:
          break;
        case _0x27c34c.moveText:
          _0x143dd9(_0x3d94d9[0], _0x3d94d9[1]);
          break;
        case _0x27c34c.setCharSpacing:
          _0x482ed6.charSpacing = _0x3d94d9[0];
          break;
        case _0x27c34c.setWordSpacing:
          _0x482ed6.wordSpacing = _0x3d94d9[0];
          break;
        case _0x27c34c.setLeadingMoveText:
          log(""    setLeadingMoveText "" + JSON.stringify(_0x3d94d9));
          _0x482ed6.leading = -_0x3d94d9[1];
          _0x143dd9(_0x3d94d9[0], _0x3d94d9[1]);
          break;
        case _0x27c34c.nextLine:
          _0x143dd9(0, -_0x482ed6.leading);
          break;
        case _0x27c34c.save:
          log(""    save - "" + JSON.stringify(_0x482ed6));
          _0x305d54.push(JSON.parse(JSON.stringify(_0x482ed6)));
          break;
        case _0x27c34c.restore:
          _0x482ed6 = _0x305d54.pop();
          log(""    restore - "" + JSON.stringify(_0x482ed6));
          break;
        case _0x27c34c.paintJpegXObject:
        case _0x27c34c.paintImageXObject:
          log(""    "" + _0x6760d9 + "" - "" + JSON.stringify(_0x3d94d9));
          _0x37bdf5.push({
            image: _0x3d94d9[0],
            gstate: _0x482ed6.gstate,
            transform: _0x482ed6.transform,
            clip: _0x482ed6.clip,
          });
          break;
        case _0x27c34c.setFillRGBColor:
          _0x482ed6.fillRGBColor =
            ""#"" +
            Array.from(_0x3d94d9)
              .map((_0x31d9d2) => _0x31d9d2.toString(16).padStart(2, ""0""))
              .join("""");
          log(""    setFillRGBColor - "" + JSON.stringify(_0x3d94d9));
          break;
        case _0x27c34c.setStrokeRGBColor:
          _0x482ed6.strokeRGBColor =
            ""#"" +
            Array.from(_0x3d94d9)
              .map((_0x41389d) => _0x41389d.toString(16).padStart(2, ""0""))
              .join("""");
          log(""    setStrokeRGBColor - "" + JSON.stringify(_0x3d94d9));
          break;
        case _0x27c34c.setLineWidth:
          _0x482ed6.lineWidth = _0x3d94d9[0];
          break;
        case _0x27c34c.setGState:
          log(""    setGState - "" + JSON.stringify(_0x482ed6.gstate));
          break;
        case _0x27c34c.beginGroup:
          log(""    beginGroup - "" + JSON.stringify(_0x3d94d9[0]));
          _0x482ed6.gstate = _0x3d94d9[0];
          break;
        case _0x27c34c.endGroup:
          log(""    endGroup - "" + JSON.stringify(_0x3d94d9[0]));
          _0x482ed6.gstate = {};
          break;
        case _0x27c34c.transform:
          log(""    transform - "" + JSON.stringify(_0x3d94d9));
          _0x482ed6.transform = _0x3d94d9;
          break;
        case _0x27c34c.constructPath:
          log(""    constructPath - "" + JSON.stringify(_0x3d94d9));
          _0x482ed6.path = _0x3d94d9;
          break;
        case _0x27c34c.clip:
          _0x482ed6.clip.push(_0x482ed6.path);
          break;
        default:
          log(""    ?"" + _0x6760d9 + "" - "" + JSON.stringify(_0x3d94d9));
          break;
      }
    }
    if (_0x8975ab || _0x2a33c0 + 3 < 11) {
      _0x562860 += 1;
    }
    for (const _0x23cf19 of _0x37bdf5) {
      const _0x47c34a = _0x23cf19.image;
      const _0x5d95a7 = _0x47c34a.startsWith(""g_"")
        ? _0x379152.commonObjs
        : _0x379152.objs;
      const _0x57ac3f = new Promise((_0x4b445a) =>
        _0x5d95a7.get(_0x47c34a, (_0x4e3dd5) => _0x4b445a(_0x4e3dd5))
      );
      const _0x5816dc = await _0x57ac3f;
      let _0x3475c9 = __name(async (_0x2f0c95) => {}, ""renderToCanvasFn"");
      if (_0x5816dc.src !== undefined) {
        _0x3475c9 = __name(async (_0x32d7ff) => {
          const _0x2fd524 = await _0x4b0578(_0x5816dc.src);
          _0x32d7ff.drawImage(
            _0x2fd524,
            0,
            0,
            _0x5816dc.width,
            _0x5816dc.height
          );
        }, ""renderToCanvasFn"");
      } else if (_0x5816dc.kind === 3) {
        _0x3475c9 = __name(async (_0x4f16fe) => {
          const _0x3450cd = _0x4f16fe.createImageData(
            _0x5816dc.width,
            _0x5816dc.height
          );
          const _0x534496 = _0x3450cd.data;
          _0x534496.set(_0x5816dc.data, 0);
          _0x4f16fe.putImageData(_0x3450cd, 0, 0);
        }, ""renderToCanvasFn"");
      } else if (_0x5816dc.kind === 2) {
        _0x3475c9 = __name(async (_0x4c76b1) => {
          const _0x50d661 = _0x4c76b1.createImageData(
            _0x5816dc.width,
            _0x5816dc.height
          );
          const _0xf3e903 = _0x50d661.data;
          for (
            let _0x296ae3 = 0, _0x2c4939 = 0;
            _0x296ae3 < _0x5816dc.data.length;
            _0x296ae3 += 3, _0x2c4939 += 4
          ) {
            _0xf3e903[_0x2c4939] = _0x5816dc.data[_0x296ae3];
            _0xf3e903[_0x2c4939 + 1] = _0x5816dc.data[_0x296ae3 + 1];
            _0xf3e903[_0x2c4939 + 2] = _0x5816dc.data[_0x296ae3 + 2];
            _0xf3e903[_0x2c4939 + 3] = 255;
          }
          _0x4c76b1.putImageData(_0x50d661, 0, 0);
        }, ""renderToCanvasFn"");
      } else if (_0x5816dc.bitmap !== undefined) {
        _0x3475c9 = __name(async (_0x48306f) => {
          _0x48306f.drawImage(
            _0x5816dc.bitmap,
            0,
            0,
            _0x5816dc.width,
            _0x5816dc.height
          );
        }, ""renderToCanvasFn"");
      } else {
        console.error(""unknown kind of image :( :( :("");
      }
      const _0x2a2f41 = __name(
        async (
          _0x49327a,
          _0x47b689,
          _0x4beb2a,
          _0x445674,
          _0xed1541,
          _0x5ed590,
          _0x1b919e
        ) => {
          let _0x34ecf5 = _0x44b372(_0x5816dc.width, _0x5816dc.height);
          const _0x2dea93 = _0x34ecf5.getContext(""2d"");
          await _0x3475c9(_0x2dea93);
          if (
            _0x4beb2a !== undefined &&
            _0x445674 !== undefined &&
            _0xed1541 !== undefined &&
            _0x5ed590 !== undefined
          ) {
            const _0x32a3a0 = _0xed1541 - _0x4beb2a;
            const _0x10f678 = _0x5ed590 - _0x445674;
            const _0x15c7e6 = _0x44b372(_0x32a3a0, _0x10f678);
            const _0x367b68 = _0x15c7e6.getContext(""2d"");
            _0x367b68.fillStyle = ""white"";
            _0x367b68.fillRect(0, 0, _0x15c7e6.width, _0x15c7e6.height);
            _0x367b68.drawImage(
              _0x34ecf5,
              _0x4beb2a,
              _0x445674,
              _0x32a3a0,
              _0x10f678,
              0,
              0,
              _0x32a3a0,
              _0x10f678
            );
            _0x34ecf5 = _0x15c7e6;
          }
          if (_0x1b919e !== undefined && _0x1b919e !== 0) {
            let _0x4bbecb = _0x34ecf5.width;
            let _0x34ae16 = _0x34ecf5.height;
            if (_0x1b919e % 2 !== 0) {
              [_0x4bbecb, _0x34ae16] = [_0x34ae16, _0x4bbecb];
            }
            const _0x2104e1 = _0x44b372(_0x4bbecb, _0x34ae16);
            const _0x48b25f = _0x2104e1.getContext(""2d"");
            _0x48b25f.fillStyle = ""white"";
            _0x48b25f.fillRect(0, 0, _0x2104e1.width, _0x2104e1.height);
            _0x48b25f.save();
            _0x48b25f.translate(_0x4bbecb / 2, _0x34ae16 / 2);
            _0x48b25f.rotate((_0x1b919e * Math.PI) / 2);
            _0x48b25f.drawImage(
              _0x34ecf5,
              -_0x34ecf5.width / 2,
              -_0x34ecf5.height / 2
            );
            _0x48b25f.restore();
            _0x34ecf5 = _0x2104e1;
          }
          if (
            _0x49327a !== undefined &&
            _0x47b689 !== undefined &&
            _0x49327a !== _0x5816dc.width &&
            _0x47b689 !== _0x5816dc.height
          ) {
            const _0x38b10d = _0x44b372(_0x49327a, _0x47b689);
            const _0x574eb1 = _0x38b10d.getContext(""2d"");
            _0x574eb1.fillStyle = ""white"";
            _0x574eb1.fillRect(0, 0, _0x38b10d.width, _0x38b10d.height);
            _0x574eb1.drawImage(
              _0x34ecf5,
              0,
              0,
              _0x38b10d.width,
              _0x38b10d.height
            );
            _0x34ecf5 = _0x38b10d;
          }
          return _0x34ecf5;
        },
        ""getImageCanvas""
      );
      const _0x362bd2 = ensureId(
        _0x198638,
        (_0x3e5345) =>
          _0x2a33c0 +
          "":"" +
          JSON.stringify(_0x23cf19.transform) +
          (_0x3e5345 > 0 ? "":"" + _0x3e5345 : """")
      );
      _0x1ad58f.push({
        id: btoa(_0x362bd2).replace(/=/g, """"),
        page: _0x2a33c0,
        width: _0x5816dc.width,
        height: _0x5816dc.height,
        transform: _0x23cf19.transform,
        gstate: _0x23cf19.gstate,
        clip: _0x23cf19.clip,
        getImageCanvas: _0x2a2f41,
      });
    }
  }
  {
    for (const _0x23ba8c of _0x4837fd) {
      log(
        _0x23ba8c.fontId +
          "" ("" +
          _0x23ba8c.x +
          "", "" +
          _0x23ba8c.y +
          ') ""' +
          _0x23ba8c.text +
          '""'
      );
    }
  }
  return new PdfData({
    textDetails: _0x4837fd,
    imageDetails: _0x1ad58f,
  });
}
__name(parsePdf, ""parsePdf"");
function ensureId(_0xf2cca, _0x465614) {
  let _0x336e6d = 0;
  let _0x48a307;
  while (true) {
    _0x48a307 = _0x465614(_0x336e6d);
    if (!_0xf2cca.has(_0x48a307)) {
      break;
    }
    _0x336e6d += 1;
  }
  _0xf2cca.add(_0x48a307);
  return _0x48a307;
}
__name(ensureId, ""ensureId"");
_0x39aa0d.workerSrc = _0x4d9c6f;
const readUploadedFileAsBinary = __name((_0x1d9f8c) => {
  const _0x234455 = new FileReader();
  return new Promise((_0x250ca3, _0x66b911) => {
    _0x234455.onerror = () => {
      _0x234455.abort();
      _0x66b911(new DOMException(""Problem parsing input file.""));
    };
    _0x234455.onload = () => {
      _0x250ca3(_0x234455.result);
    };
    _0x234455.readAsArrayBuffer(_0x1d9f8c);
  });
}, ""readUploadedFileAsBinary"");
const readUploadedFileAsText = __name((_0xb22c4c) => {
  const _0x4f26e4 = new FileReader();
  return new Promise((_0x3f237d, _0x470efc) => {
    _0x4f26e4.onerror = () => {
      _0x4f26e4.abort();
      _0x470efc(new DOMException(""Problem parsing input file.""));
    };
    _0x4f26e4.onload = () => {
      _0x3f237d(_0x4f26e4.result);
    };
    _0x4f26e4.readAsText(_0xb22c4c);
  });
}, ""readUploadedFileAsText"");
function progressFn(_0x5a2b2e, _0x180328) {
  const _0x3b85cc = document.getElementById(""loading"");
  const _0x6cec05 = Math.clamp(_0x180328 * 100, 0, 100);
  _0x3b85cc.querySelector(""#context"").textContent = _0x5a2b2e;
  _0x3b85cc.querySelector(""#loading-bar"").style.width = _0x6cec05 + ""%"";
  _0x3b85cc.querySelector(""#progress"").textContent = """";
  _0x3b85cc.style.display = ""block"";
  if (_0x180328 === 1 && !_0x3b85cc.hidden) {
    $(_0x3b85cc).fadeOut(5000);
  }
}
__name(progressFn, ""progressFn"");
async function generateData(_0x4d785c) {
  let _0x21250c;
  if (_0x4d785c.type === ""application/json"") {
    const _0x311f4d = await readUploadedFileAsText(_0x4d785c);
    _0x21250c = {
      textDetails: JSON.parse(_0x311f4d),
      imageDetails: [],
    };
  } else {
    const _0x4f5334 = await readUploadedFileAsBinary(_0x4d785c);
    const _0x249de0 = new Uint8Array(_0x4f5334);
    _0x21250c = await parsePdf(_0x249de0, progressFn);
  }
  const _0x3903f3 = _0x47bd8f(_0x21250c);
  if (_0x3903f3 === undefined) {
    progressFn(""failed to detect pdf. cannot proceed."", 1);
    postChatMessage(
      ""Could not detect PDF to import. PDF to Foundry only supports importing adventures that it has been programmed to support. For a list of supported adventures, please see the import dialog.""
    );
    return;
  }
  try {
    const _0xddc06c = new ModuleImporter(_0x3903f3);
    await _0xddc06c.import(_0x21250c, progressFn);
    const _0x19462c =
      ""Your import of "" +
      _0x3903f3.fullName +
      "" is complete"" +
      _0xddc06c.additionalMessages;
    postChatMessage(_0x19462c);
  } catch (_0x27931f) {
    progressFn(_0x27931f.message, 1);
    if (
      _0x27931f.message === ""Couldn't detect watermark :(. Please no pirate.""
    ) {
      postChatMessage(
        ""Couldn't detect watermark. PDF to Foundry will only import officially licensed adventures.""
      );
    } else {
      postChatMessage(""Error: "" + _0x27931f.message);
    }
  }
}
__name(generateData, ""generateData"");
function postChatMessage(_0x2dd0ab) {
  const _0x15d840 = {
    whisper: [game.userId],
    content: _0x2dd0ab,
    type: 0,
    blind: true,
    speaker: {
      alias: ""PDF to Foundry"",
    },
  };
  ChatMessage.create(_0x15d840, {});
}
__name(postChatMessage, ""postChatMessage"");
export { generateData };"
qVfCxNu3,recoil,clownstalk,Lua,Friday 21st of November 2025 10:57:01 PM CDT,"local RecoilModule = {}
RecoilModule.__index = RecoilModule

local RunService = game:GetService(""RunService"")
local TweenService = game:GetService(""TweenService"")

local Camera = workspace.CurrentCamera

local function lerp(a, b, t)
	return a + (b - a) * t
end

local Spring = {}
Spring.__index = Spring

function Spring.new(stiffness, damping, mass)
	local self = setmetatable({}, Spring)
	self.stiffness = stiffness or 100
	self.damping = damping or 10
	self.mass = mass or 1
	self.position = vector.zero
	self.velocity = vector.zero
	self.target = vector.zero
	return self
end

function Spring:Update(dt)
	local force = (self.target - self.position) * self.stiffness
	force = force - self.velocity * self.damping
	local acceleration = force / self.mass
	self.velocity += (acceleration * dt)
	self.position += (self.velocity * dt)
	return self.position
end

function Spring:Impulse(force)
	self.velocity += (force / self.mass)
end

function Spring:Reset()
	self.position = vector.zero
	self.velocity = vector.zero
	self.target = vector.zero
end

function RecoilModule.new()
	local self = setmetatable({}, RecoilModule)

	self.spring = Spring.new(150, 15, 1)
	self.visualSpring = Spring.new(200, 20, 1)
	self.shakeSpring = Spring.new(250, 25, 0.8)

	self.currentRecoil = vector.zero
	self.targetRecoil = vector.zero
	self.visualRecoil = vector.zero
	self.shakeRecoil = vector.zero

	self.patterns = {}
	self.currentPatternIndex = 1
	self.shotCount = 0

	self.recoverySpeed = 8
	self.maxRecoilX = 15
	self.maxRecoilY = 25

	self.connection = nil
	self.isActive = false

	self.config = {
		multiplier = 1;
		recoveryDelay = 0.1;
		patternReset = .5;
		smoothing = .85;
		visualIntensity = 1.2;
		adsMultiplier = .6;
		shakeIntensity = 1.5;
		shakeFrequency = 35;
		shakeDecay = .88;
		horizontalShake = 1.8;
		verticalShake = 1.4;
		rotationalShake = .8;
	} -- default config, presets at the bottom

	self.lastShotTime = 0
	self.isAiming = false
	self.shakeTime = 0
	self.currentShakeIntensity = 0

	return self
end

function RecoilModule:SetConfig(config)
	for key, value in config do
		if self.config[key] ~= nil then
			self.config[key] = value
		end
	end

	if config.spring then
		self.spring.stiffness = config.spring.stiffness or self.spring.stiffness
		self.spring.damping = config.spring.damping or self.spring.damping
		self.spring.mass = config.spring.mass or self.spring.mass
	end

	if config.visualSpring then
		self.visualSpring.stiffness = config.visualSpring.stiffness or self.visualSpring.stiffness
		self.visualSpring.damping = config.visualSpring.damping or self.visualSpring.damping
		self.visualSpring.mass = config.visualSpring.mass or self.visualSpring.mass
	end

	if config.shakeSpring then
		self.shakeSpring.stiffness = config.shakeSpring.stiffness or self.shakeSpring.stiffness
		self.shakeSpring.damping = config.shakeSpring.damping or self.shakeSpring.damping
		self.shakeSpring.mass = config.shakeSpring.mass or self.shakeSpring.mass
	end

	self.recoverySpeed = config.recoverySpeed or self.recoverySpeed
	self.maxRecoilX = config.maxRecoilX or self.maxRecoilX
	self.maxRecoilY = config.maxRecoilY or self.maxRecoilY
end

function RecoilModule:LoadPreset(preset)
	if preset.pattern then
		self.patterns = preset.pattern
	end

	if preset.config then
		self:SetConfig(preset.config)
	end
end

function RecoilModule:SetAiming(isAiming)
	self.isAiming = isAiming
end

function RecoilModule:AddRecoil(recoilData)
	local currentTime = os.clock()

	if currentTime - self.lastShotTime > self.config.patternReset then
		self.shotCount = 0
		self.currentPatternIndex = 1
	end

	self.lastShotTime = currentTime
	self.shotCount += 1

	local recoilAmount = recoilData or {x = 0; y = 1; z = 0}

	if self.patterns and #self.patterns > 0 then
		local pattern = self.patterns[math.min(self.currentPatternIndex, #self.patterns)]
		recoilAmount = {
			x = pattern.x or recoilAmount.x;
			y = pattern.y or recoilAmount.y;
			z = pattern.z or recoilAmount.z;
		}
		self.currentPatternIndex = math.min(self.currentPatternIndex + 1, #self.patterns)
	end

	local multiplier = self.config.multiplier
	if self.isAiming then
		multiplier *= self.config.adsMultiplier
	end

	local kick = vector.create(
		recoilAmount.x * multiplier,
		recoilAmount.y * multiplier,
		recoilAmount.z * multiplier
	)

	self.spring:Impulse(kick)

	local visualKick = kick * self.config.visualIntensity
	self.visualSpring:Impulse(visualKick)

	local shakeKick = vector.create(
		(math.random() - .5) * self.config.horizontalShake * self.config.shakeIntensity,
		(math.random() - .5) * self.config.verticalShake * self.config.shakeIntensity,
		(math.random() - .5) * self.config.rotationalShake * self.config.shakeIntensity
	)
	self.shakeSpring:Impulse(shakeKick)

	self.currentShakeIntensity = self.config.shakeIntensity
	self.shakeTime = currentTime

	if not self.isActive then
		self:Start()
	end
end

function RecoilModule:AddCameraShake(intensity, duration, frequency)
	intensity = intensity or .5
	duration = duration or .2
	frequency = frequency or 20

	local startTime = os.clock()
	local shakeConnection

	shakeConnection = RunService.RenderStepped:Connect(function()
		local elapsed = os.clock() - startTime
		if elapsed > duration then
			shakeConnection:Disconnect()
			return
		end

		local progress = elapsed / duration
		local fadeOut = 1 - progress

		local shakeX = math.sin(elapsed * frequency) * intensity * fadeOut
		local shakeY = math.cos(elapsed * frequency * 1.3) * intensity * fadeOut
		local shakeZ = math.sin(elapsed * frequency * .7) * intensity * .5 * fadeOut

		self.visualSpring:Impulse(vector.create(shakeX, shakeY, shakeZ) * .1)
	end)
end

function RecoilModule:Update(dt)
	local recoilSpring = self.spring:Update(dt)
	local visualSpring = self.visualSpring:Update(dt)
	local shakeSpring = self.shakeSpring:Update(dt)

	self.currentRecoil = lerp(self.currentRecoil, recoilSpring, 1 - self.config.smoothing)
	self.visualRecoil = visualSpring

	local currentTime = os.clock()
	local shakeElapsed = currentTime - self.shakeTime

	if self.currentShakeIntensity > .01 then
		self.currentShakeIntensity = self.currentShakeIntensity * self.config.shakeDecay

		local freq = self.config.shakeFrequency
		local shakeNoise = vector.create(
			math.sin(shakeElapsed * freq) * self.currentShakeIntensity * .15,
			math.cos(shakeElapsed * freq * 1.3) * self.currentShakeIntensity * .12,
			math.sin(shakeElapsed * freq * .7) * self.currentShakeIntensity * .08
		)

		self.shakeRecoil = shakeSpring + shakeNoise
	else
		self.shakeRecoil = shakeSpring
	end

	if currentTime - self.lastShotTime > self.config.recoveryDelay then
		self.spring.target = vector.zero
		self.visualSpring.target = vector.zero
		self.shakeSpring.target = vector.zero

		if self.spring.position.Magnitude < .01 and self.spring.velocity.Magnitude < .01 then
			self.shotCount = 0
			self.currentPatternIndex = 1
		end
	end

	local totalRecoil = self.currentRecoil + self.visualRecoil + self.shakeRecoil

	totalRecoil = vector.create(
		math.clamp(totalRecoil.X, -self.maxRecoilX, self.maxRecoilX),
		math.clamp(totalRecoil.Y, -self.maxRecoilY, self.maxRecoilY),
		totalRecoil.Z
	)

	local currentCFrame = Camera.CFrame
	local recoilCFrame = CFrame.Angles(
		math.rad(-totalRecoil.Y),
		math.rad(totalRecoil.X),
		math.rad(totalRecoil.Z)
	)

	Camera.CFrame = currentCFrame * recoilCFrame
end

function RecoilModule:Start()
	if self.connection then
		return
	end

	self.isActive = true
	self.connection = RunService.RenderStepped:Connect(function(dt)
		self:Update(dt)
	end)
end

function RecoilModule:Stop()
	if self.connection then
		self.connection:Disconnect()
		self.connection = nil
		self.isActive = false
	end
end

function RecoilModule:Reset()
	self.spring:Reset()
	self.visualSpring:Reset()
	self.shakeSpring:Reset()
	self.currentRecoil = vector.zero
	self.targetRecoil = vector.zero
	self.visualRecoil = vector.zero
	self.shakeRecoil = vector.zero
	self.shotCount = 0
	self.currentPatternIndex = 1
	self.lastShotTime = 0
	self.currentShakeIntensity = 0
	self.shakeTime = 0
end

function RecoilModule:Destroy()
	self:Stop()
	setmetatable(self, nil)
end

return RecoilModule"
ffLZiP2L,python_decorator,Hib6498,Python,Friday 21st of November 2025 10:35:09 PM CDT,"import logging
from time import perf_counter
from functools import wraps

logging.basicConfig(
    format=""%(asctime)s - %(levelname)s - %(message)s"",
    level=logging.DEBUG,
    datefmt=""%Y-%m-%d %H:%M:%S""
)

def timer(func):
    @wraps(func)
    def _timer(*args, **kwargs):
        logging.info(f""Executing {func.__name__}."")
        start = perf_counter()
        result = func(*args, **kwargs)
        end = perf_counter()
        logging.info(f""Executed {func.__name__} in {start-end: .6f} seconds."")
        return result
    return _timer

@timer
def elementwise_unsafe_divide(array, divisor):
    if not all((divisor, isinstance(divisor, int))):
        logging.critical(""Invalid divisor provided:"", divisor)
        exit(1)
        
    result = []
    invalid_operations = 0

    for elem in array:
        try:
            result.append(elem / divisor)
        except (ZeroDivisionError, TypeError):
            invalid_operations += 1
            result.append(elem)
            continue

    logging.warning(f""Encountered {invalid_operations} invalid operations"")
    return result

def main():
    arr = [1, 2, 4, ""hi"", ""bye""]
    print(""Array:"", arr)
    result = elementwise_unsafe_divide(arr, 4)
    print(""arr / 4(elementwise):"", result)
    
if __name__ == ""__main__"":
    main()"
AHx4UisH,devcontainer-jsonconfig-0,witherzuo,JSON,Friday 21st of November 2025 07:32:24 PM CDT,"{
    ""name"": ""MagicZone"",
    ""build"": {
        ""dockerfile"": ""Containerfile"",
        ""context"": "".""
    },
    ""customizations"": {
        ""vscode"": {
            ""settings"": {
                ""files.associations"": {
                    ""wrangler.json"": ""jsonc""
                }
            }
        }
    },
    ""mounts"": [
        {
            ""source"": ""${localWorkspaceFolderBasename}-node-modules"",
            ""target"": ""${containerWorkspaceFolder}/node_modules"",
            ""type"": ""volume""
        }
    ],
    ""forwardPorts"": [
        3000,
        8787
    ],
    ""updateContentCommand"": ""pnpm install"",
    ""containerUser"": ""node"",
    ""remoteUser"": ""node""
}"
uQkay5A7,PROTON VPN,riezkymr,JSON,Friday 21st of November 2025 07:14:09 PM CDT,"PROTON VPN 

Notes
1. How to remove the official Linux app
To uninstall the Linux app, open a terminal and enter:

** sudo apt autoremove proton-vpn-gnome-desktop && sudo apt purge protonvpn-stable-release **

2. How to disable the kill switch if you have uninstalled the app
You can easily turn off the kill switch inside our Linux app, but this isnâ€™t possible if youâ€™ve already uninstalled it. In this case, you can remove the kill switch and restore access to the internet as follows:

a) Identify the Proton VPN connection name with the command:

** nmcli connection show --active ** 

This will show a list of your systemâ€™s active connections.

b) Look for any connections that begin with prefix pvpn- This usually includes pvpn-killswitch and pvpn-ipv6leak-protection, and may include pvpn-routed-killswitch. Delete all these connections using the following command:

** nmcli connection delete [connection name] ** 

For example:

** nmcli connection delete pvpn-killswitch ** 

c) Re-run the following command to check that all Proton VPN connections have been removed:

** nmcli connection show --active ** 

If you see any Proton VPN connections left, delete them as described above."
LW1Mcknf,Full Premium manager,stayway,Java,Friday 21st of November 2025 05:47:10 PM CDT,"d### Eclipse Workspace Patch 1.0
#P L2J_Mobius_CT_2.6_HighFive
Index: dist/game/data/scripts/custom/NpcPremium/101000-info.htm
===================================================================
--- dist/game/data/scripts/custom/NpcPremium/101000-info.htm	(nonexistent)
+++ dist/game/data/scripts/custom/NpcPremium/101000-info.htm	(working copy)
@@ -0,0 +1,16 @@
+<html><title>Premium Benefits</title><body>
+<br><center>
+<img src=""L2UI_CH3.herosymbol"" width=128 height=128><br>
+<font color=""LEVEL"">Premium Account Benefits</font>
+</center><br>
+Premium members receive the following benefits:<br>
+<font color=LEVEL></font> +50% Experience<br>
+<font color=LEVEL></font> +50% SP<br>
+<font color=LEVEL></font> +30% Drop Rate<br>
+<font color=LEVEL></font> +30% Spoil Rate<br>
+<font color=LEVEL></font> Access to Premium Zone<br>
+<font color=LEVEL></font> Premium Skills<br>
+<font color=LEVEL></font> No XP loss on death<br><br>
+<font color=""FF9900"">Price: 1 Premium Coin per day</font><br><br>
+<button value=""Back to Main"" action=""bypass Quest PremiumNpc menu"" width=150 height=25 back=""L2UI_CT1.Button_DF_Down"" fore=""L2UI_CT1.Button_DF"">
+</body></html>
\ No newline at end of file
Index: dist/game/data/scripts/custom/NpcPremium/PremiumNpc.java
===================================================================
--- dist/game/data/scripts/custom/NpcPremium/PremiumNpc.java	(nonexistent)
+++ dist/game/data/scripts/custom/NpcPremium/PremiumNpc.java	(working copy)
@@ -0,0 +1,306 @@
+/*
+ * Copyright (c) 2013 L2jMobius
+ * 
+ * Permission is hereby granted, free of charge, to any person obtaining a copy
+ * of this software and associated documentation files (the ""Software""), to deal
+ * in the Software without restriction, including without limitation the rights
+ * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
+ * copies of the Software, and to permit persons to whom the Software is
+ * furnished to do so, subject to the following conditions:
+ * 
+ * The above copyright notice and this permission notice shall be
+ * included in all copies or substantial portions of the Software.
+ * 
+ * THE SOFTWARE IS PROVIDED ""AS IS"", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
+ * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
+ * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
+ * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,
+ * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR
+ * IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
+ */
+
+package custom.NpcPremium;
+
+import java.text.SimpleDateFormat;
+import java.util.Date;
+import java.util.concurrent.TimeUnit;
+
+import org.l2jmobius.gameserver.managers.PremiumManager;
+import org.l2jmobius.gameserver.model.actor.Npc;
+import org.l2jmobius.gameserver.model.actor.Player;
+import org.l2jmobius.gameserver.model.item.enums.ItemProcessType;
+import org.l2jmobius.gameserver.model.script.Script;
+
+/**
+ * @author Stayway
+ */
+public class PremiumNpc extends Script
+{
+	private static final int NPC_ID = 101000;
+	private static final int PREMIUM_COIN_ID = 6393;
+	
+	public PremiumNpc()
+	{
+		addStartNpc(NPC_ID);
+		addTalkId(NPC_ID);
+		addFirstTalkId(NPC_ID);
+	}
+	
+	@Override
+	public String onEvent(String event, Npc npc, Player player)
+	{
+		if ((player == null) || (npc == null))
+		{
+			return null;
+		}
+		
+		player.sendMessage(""Debug: Event received: "" + event);
+		
+		if (event.equals(""menu""))
+		{
+			return showMainHtml(npc, player);
+		}
+		else if (event.equals(""info""))
+		{
+			return showInfoHtml(npc, player);
+		}
+		else if (event.startsWith(""buy_""))
+		{
+			String[] split = event.split(""_"");
+			if (split.length == 2)
+			{
+				try
+				{
+					int days = Integer.parseInt(split[1]);
+					return processPurchase(player, days, days, npc);
+				}
+				catch (NumberFormatException e)
+				{
+					player.sendMessage(""Invalid number of days."");
+				}
+			}
+		}
+		else if (event.equals(""check_status""))
+		{
+			return showStatusHtml(npc, player);
+		}
+		
+		// Se nenhum evento especÃ­fico, mostrar menu principal
+		return showMainHtml(npc, player);
+	}
+	
+	@Override
+	public String onFirstTalk(Npc npc, Player player)
+	{
+		return showMainHtml(npc, player);
+	}
+	
+	private String showMainHtml(Npc npc, Player player)
+	{
+		String html = getHtm(player, ""data/scripts/custom/NpcPremium/"" + npc.getId() + ""-main.html"");
+		if (html == null)
+		{
+			html = createMainHtml();
+		}
+		
+		// Substituir variÃ¡veis
+		if (html != null)
+		{
+			html = html.replace(""%playername%"", player.getName());
+			html = html.replace(""%coinCount%"", String.valueOf(getPlayerCoins(player)));
+			
+			// Adicionar status do premium atual
+			String premiumStatus = getPremiumStatus(player);
+			html = html.replace(""%premiumStatus%"", premiumStatus);
+		}
+		
+		return html;
+	}
+	
+	private String showInfoHtml(Npc npc, Player player)
+	{
+		String html = getHtm(player, ""data/scripts/custom/NpcPremium/"" + npc.getId() + ""-info.html"");
+		if (html == null)
+		{
+			html = createInfoHtml();
+		}
+		return html;
+	}
+	
+	private String showStatusHtml(Npc npc, Player player)
+	{
+		String html = getHtm(player, ""data/scripts/custom/NpcPremium/"" + npc.getId() + ""-status.html"");
+		if (html == null)
+		{
+			html = createStatusHtml(player);
+		}
+		else
+		{
+			html = html.replace(""%premiumStatus%"", getPremiumStatus(player));
+		}
+		return html;
+	}
+	
+	private String processPurchase(Player player, int days, int coinsNeeded, Npc npc)
+	{
+		int currentCoins = getPlayerCoins(player);
+		
+		if (currentCoins < coinsNeeded)
+		{
+			player.sendMessage(""You need "" + coinsNeeded + "" Premium Coins! You have only "" + currentCoins + ""."");
+			return showMainHtml(npc, player);
+		}
+		
+		if (PremiumManager.getInstance() == null)
+		{
+			player.sendMessage(""âŒ Premium system is not available. Please contact administration."");
+			return showMainHtml(npc, player);
+		}
+		
+		boolean success = player.destroyItemByItemId(ItemProcessType.FEE, PREMIUM_COIN_ID, coinsNeeded, npc, true);
+		
+		if (success)
+		{
+			boolean premiumAdded = addPremium(player, days);
+			
+			if (premiumAdded)
+			{
+				player.sendMessage(""ðŸŽ‰ Premium activated for "" + days + "" days! Enjoy!"");
+				
+				String html = getHtm(player, ""data/scripts/custom/NpcPremium/"" + npc.getId() + ""-success.html"");
+				if (html == null)
+				{
+					html = createSuccessHtml(days, coinsNeeded, currentCoins - coinsNeeded, player);
+				}
+				else
+				{
+					html = html.replace(""%days%"", String.valueOf(days));
+					html = html.replace(""%coinsUsed%"", String.valueOf(coinsNeeded));
+					html = html.replace(""%coinsLeft%"", String.valueOf(currentCoins - coinsNeeded));
+					html = html.replace(""%premiumStatus%"", getPremiumStatus(player));
+				}
+				
+				return html;
+			}
+			player.addItem(ItemProcessType.REFUND, PREMIUM_COIN_ID, coinsNeeded, npc, true);
+			player.sendMessage(""âŒ Error activating premium. Your coins have been refunded."");
+			return showMainHtml(npc, player);
+		}
+		
+		player.sendMessage(""âŒ Error processing payment. Please try again."");
+		return showMainHtml(npc, player);
+	}
+	
+	private int getPlayerCoins(Player player)
+	{
+		return (int) player.getInventory().getInventoryItemCount(PREMIUM_COIN_ID, -1);
+	}
+	
+	/**
+	 * @param player
+	 * @param days
+	 * @return
+	 */
+	private boolean addPremium(Player player, int days)
+	{
+		try
+		{
+			// Verificar se o PremiumManager estÃ¡ disponÃ­vel
+			if (PremiumManager.getInstance() == null)
+			{
+				player.sendMessage(""âŒ Premium system is not available."");
+				return false;
+			}
+			
+			// Adicionar tempo premium usando o PremiumManager
+			PremiumManager.getInstance().addPremiumTime(player.getAccountName(), days, TimeUnit.DAYS);
+			
+			// Log para debug
+			System.out.println(""Premium added for account: "" + player.getAccountName() + "", days: "" + days + "", by NPC: "" + NPC_ID);
+			
+			// **CORREÃ‡ÃƒO: Verificar usando getPremiumExpiration em vez de hasPremium**
+			long expiration = PremiumManager.getInstance().getPremiumExpiration(player.getAccountName());
+			long currentTime = System.currentTimeMillis();
+			boolean hasPremium = (expiration > currentTime);
+			
+			player.sendMessage(""Premium expiration: "" + new SimpleDateFormat(""dd/MM/yyyy HH:mm"").format(new Date(expiration)));
+			player.sendMessage(""Has premium: "" + hasPremium);
+			
+			return hasPremium;
+		}
+		catch (Exception e)
+		{
+			System.err.println(""Error adding premium for player "" + player.getName() + "": "" + e.getMessage());
+			e.printStackTrace();
+			player.sendMessage(""âŒ System error while activating premium: "" + e.getMessage());
+			return false;
+		}
+	}
+	
+	/**
+	 * @param player
+	 * @return
+	 */
+	private String getPremiumStatus(Player player)
+	{
+		try
+		{
+			if (PremiumManager.getInstance() == null)
+			{
+				return ""<font color=\""FF0000\"">Premium System Unavailable</font>"";
+			}
+			
+			long expiration = PremiumManager.getInstance().getPremiumExpiration(player.getAccountName());
+			long currentTime = System.currentTimeMillis();
+			
+			if (expiration > currentTime)
+			{
+				String expireDate = new SimpleDateFormat(""dd/MM/yyyy HH:mm"").format(new Date(expiration));
+				long daysLeft = (expiration - currentTime) / (1000 * 60 * 60 * 24);
+				return ""<font color=\""00FF00\"">ACTIVE</font> - Expires: "" + expireDate + "" ("" + daysLeft + "" days left)"";
+			}
+			return ""<font color=\""FF0000\"">INACTIVE</font> - No active premium"";
+		}
+		catch (Exception e)
+		{
+			return ""<font color=\""FF0000\"">Error checking status</font>"";
+		}
+	}
+	
+	public static void main(String[] args)
+	{
+		new PremiumNpc();
+	}
+}
\ No newline at end of file
Index: dist/game/data/scripts/custom/NpcPremium/101000-main.htm
===================================================================
--- dist/game/data/scripts/custom/NpcPremium/101000-main.htm	(nonexistent)
+++ dist/game/data/scripts/custom/NpcPremium/101000-main.htm	(working copy)
@@ -0,0 +1,40 @@
+<html>
+<title>Premium System</title>
+<body>
+<br>
+<center>
+<font color=""LEVEL"">Premium Account System</font>
+</center>
+<br>
+Welcome, %playername%!<br>
+Your Premium Coins: %coinCount%<br>
+<br>
+Choose your premium package:<br>
+<br>
+
+<table width=300>
+<tr>
+<td><button value=""1 Day - 1 Coin"" action=""bypass Quest PremiumNpc buy_1"" width=150 height=25 back=""L2UI_CT1.Button_DF_Down"" fore=""L2UI_CT1.Button_DF""></td>
+<td><button value=""7 Days - 7 Coins"" action=""bypass Quest PremiumNpc buy_7"" width=150 height=25 back=""L2UI_CT1.Button_DF_Down"" fore=""L2UI_CT1.Button_DF""></td>
+</tr>
+<tr>
+<td><button value=""15 Days - 15 Coins"" action=""bypass Quest PremiumNpc buy_15"" width=150 height=25 back=""L2UI_CT1.Button_DF_Down"" fore=""L2UI_CT1.Button_DF""></td>
+<td><button value=""30 Days - 30 Coins"" action=""bypass Quest PremiumNpc buy_30"" width=150 height=25 back=""L2UI_CT1.Button_DF_Down"" fore=""L2UI_CT1.Button_DF""></td>
+</tr>
+<tr>
+<td><button value=""90 Days - 90 Coins"" action=""bypass Quest PremiumNpc buy_90"" width=150 height=25 back=""L2UI_CT1.Button_DF_Down"" fore=""L2UI_CT1.Button_DF""></td>
+<td><button value=""365 Days - 365 Coins"" action=""bypass Quest PremiumNpc buy_365"" width=150 height=25 back=""L2UI_CT1.Button_DF_Down"" fore=""L2UI_CT1.Button_DF""></td>
+</tr>
+</table>
+<br>
+
+<button value=""Premium Benefits Information"" action=""bypass Quest PremiumNpc info"" width=200 height=25 back=""L2UI_CT1.Button_DF_Down"" fore=""L2UI_CT1.Button_DF"">
+<br>
+<br>
+
+<center>
+<button value=""Buy VIP-Coins"" action=""url !2267"" width=200 height=25 back=""L2UI_CT1.Button_DF_Down"" fore=""L2UI_CT1.Button_DF"">
+</center>
+
+</body>
+</html>
\ No newline at end of file
Index: dist/game/data/scripts/custom/NpcPremium/101000-info.htm
===================================================================
--- dist/game/data/scripts/custom/NpcPremium/101000-info.htm	(nonexistent)
+++ dist/game/data/scripts/custom/NpcPremium/101000-info.htm	(working copy)
@@ -0,0 +1,16 @@
+<html><title>Premium Benefits</title><body>
+<br><center>
+<img src=""L2UI_CH3.herosymbol"" width=128 height=128><br>
+<font color=""LEVEL"">Premium Account Benefits</font>
+</center><br>
+Premium members receive the following benefits:<br>
+<font color=LEVEL></font> +50% Experience<br>
+<font color=LEVEL></font> +50% SP<br>
+<font color=LEVEL></font> +30% Drop Rate<br>
+<font color=LEVEL></font> +30% Spoil Rate<br>
+<font color=LEVEL></font> Access to Premium Zone<br>
+<font color=LEVEL></font> Premium Skills<br>
+<font color=LEVEL></font> No XP loss on death<br><br>
+<font color=""FF9900"">Price: 1 Premium Coin per day</font><br><br>
+<button value=""Back to Main"" action=""bypass Quest PremiumNpc menu"" width=150 height=25 back=""L2UI_CT1.Button_DF_Down"" fore=""L2UI_CT1.Button_DF"">
+</body></html>
\ No newline at end of file
Index: dist/game/data/scripts/custom/NpcPremium/101000-main.htm
===================================================================
--- dist/game/data/scripts/custom/NpcPremium/101000-main.htm	(nonexistent)
+++ dist/game/data/scripts/custom/NpcPremium/101000-main.htm	(working copy)
@@ -0,0 +1,40 @@
+<html>
+<title>Premium System</title>
+<body>
+<br>
+<center>
+<font color=""LEVEL"">Premium Account System</font>
+</center>
+<br>
+Welcome, %playername%!<br>
+Your Premium Coins: %coinCount%<br>
+<br>
+Choose your premium package:<br>
+<br>
+
+<table width=300>
+<tr>
+<td><button value=""1 Day - 1 Coin"" action=""bypass Quest PremiumNpc buy_1"" width=150 height=25 back=""L2UI_CT1.Button_DF_Down"" fore=""L2UI_CT1.Button_DF""></td>
+<td><button value=""7 Days - 7 Coins"" action=""bypass Quest PremiumNpc buy_7"" width=150 height=25 back=""L2UI_CT1.Button_DF_Down"" fore=""L2UI_CT1.Button_DF""></td>
+</tr>
+<tr>
+<td><button value=""15 Days - 15 Coins"" action=""bypass Quest PremiumNpc buy_15"" width=150 height=25 back=""L2UI_CT1.Button_DF_Down"" fore=""L2UI_CT1.Button_DF""></td>
+<td><button value=""30 Days - 30 Coins"" action=""bypass Quest PremiumNpc buy_30"" width=150 height=25 back=""L2UI_CT1.Button_DF_Down"" fore=""L2UI_CT1.Button_DF""></td>
+</tr>
+<tr>
+<td><button value=""90 Days - 90 Coins"" action=""bypass Quest PremiumNpc buy_90"" width=150 height=25 back=""L2UI_CT1.Button_DF_Down"" fore=""L2UI_CT1.Button_DF""></td>
+<td><button value=""365 Days - 365 Coins"" action=""bypass Quest PremiumNpc buy_365"" width=150 height=25 back=""L2UI_CT1.Button_DF_Down"" fore=""L2UI_CT1.Button_DF""></td>
+</tr>
+</table>
+<br>
+
+<button value=""Premium Benefits Information"" action=""bypass Quest PremiumNpc info"" width=200 height=25 back=""L2UI_CT1.Button_DF_Down"" fore=""L2UI_CT1.Button_DF"">
+<br>
+<br>
+
+<center>
+<button value=""Buy VIP-Coins"" action=""url !2267"" width=200 height=25 back=""L2UI_CT1.Button_DF_Down"" fore=""L2UI_CT1.Button_DF"">
+</center>
+
+</body>
+</html>
\ No newline at end of file
Index: dist/game/data/scripts/custom/NpcPremium/101000-success.htm
===================================================================
--- dist/game/data/scripts/custom/NpcPremium/101000-success.htm	(nonexistent)
+++ dist/game/data/scripts/custom/NpcPremium/101000-success.htm	(working copy)
@@ -0,0 +1,10 @@
+<html><title>Purchase Successful</title><body>
+<br><center>
+<font color=00FF00>Purchase Successful!</font><br><br>
+Thank you for your purchase!<br><br>
+Days Purchased: <font color=LEVEL>%days% days</font><br>
+Coins Used: <font color=FF9900>%coinsUsed%</font><br>
+Coins Left: <font color=00FF00>%coinsLeft%</font><br><br>
+Your premium benefits are now active!<br><br>
+<button value=""Back to Main"" action=""bypass Quest PremiumNpc menu"" width=150 height=25 back=""L2UI_CT1.Button_DF_Down"" fore=""L2UI_CT1.Button_DF"">
+</center></body></html>
\ No newline at end of file
Index: dist/game/data/scripts/custom/NpcPremium/PremiumNpc.java
===================================================================
--- dist/game/data/scripts/custom/NpcPremium/PremiumNpc.java	(nonexistent)
+++ dist/game/data/scripts/custom/NpcPremium/PremiumNpc.java	(working copy)
@@ -0,0 +1,306 @@
+/*
+ * Copyright (c) 2013 L2jMobius
+ * 
+ * Permission is hereby granted, free of charge, to any person obtaining a copy
+ * of this software and associated documentation files (the ""Software""), to deal
+ * in the Software without restriction, including without limitation the rights
+ * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
+ * copies of the Software, and to permit persons to whom the Software is
+ * furnished to do so, subject to the following conditions:
+ * 
+ * The above copyright notice and this permission notice shall be
+ * included in all copies or substantial portions of the Software.
+ * 
+ * THE SOFTWARE IS PROVIDED ""AS IS"", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
+ * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
+ * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
+ * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,
+ * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR
+ * IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
+ */
+
+package custom.NpcPremium;
+
+import java.text.SimpleDateFormat;
+import java.util.Date;
+import java.util.concurrent.TimeUnit;
+
+import org.l2jmobius.gameserver.managers.PremiumManager;
+import org.l2jmobius.gameserver.model.actor.Npc;
+import org.l2jmobius.gameserver.model.actor.Player;
+import org.l2jmobius.gameserver.model.item.enums.ItemProcessType;
+import org.l2jmobius.gameserver.model.script.Script;
+
+/**
+ * @author Stayway
+ */
+public class PremiumNpc extends Script
+{
+	private static final int NPC_ID = 101000;
+	private static final int PREMIUM_COIN_ID = 6393;
+	
+	public PremiumNpc()
+	{
+		addStartNpc(NPC_ID);
+		addTalkId(NPC_ID);
+		addFirstTalkId(NPC_ID);
+	}
+	
+	@Override
+	public String onEvent(String event, Npc npc, Player player)
+	{
+		if ((player == null) || (npc == null))
+		{
+			return null;
+		}
+		
+		player.sendMessage(""Debug: Event received: "" + event);
+		
+		if (event.equals(""menu""))
+		{
+			return showMainHtml(npc, player);
+		}
+		else if (event.equals(""info""))
+		{
+			return showInfoHtml(npc, player);
+		}
+		else if (event.startsWith(""buy_""))
+		{
+			String[] split = event.split(""_"");
+			if (split.length == 2)
+			{
+				try
+				{
+					int days = Integer.parseInt(split[1]);
+					return processPurchase(player, days, days, npc);
+				}
+				catch (NumberFormatException e)
+				{
+					player.sendMessage(""Invalid number of days."");
+				}
+			}
+		}
+		else if (event.equals(""check_status""))
+		{
+			return showStatusHtml(npc, player);
+		}
+		return showMainHtml(npc, player);
+	}
+	
+	@Override
+	public String onFirstTalk(Npc npc, Player player)
+	{
+		return showMainHtml(npc, player);
+	}
+	
+	private String showMainHtml(Npc npc, Player player)
+	{
+		String html = getHtm(player, ""data/scripts/custom/NpcPremium/"" + npc.getId() + ""-main.html"");
+		if (html == null)
+		{
+			html = createMainHtml();
+		}
+		
+		if (html != null)
+		{
+			html = html.replace(""%playername%"", player.getName());
+			html = html.replace(""%coinCount%"", String.valueOf(getPlayerCoins(player)));
+			
+			// Adicionar status do premium atual
+			String premiumStatus = getPremiumStatus(player);
+			html = html.replace(""%premiumStatus%"", premiumStatus);
+		}
+		
+		return html;
+	}
+	
+	private String showInfoHtml(Npc npc, Player player)
+	{
+		String html = getHtm(player, ""data/scripts/custom/NpcPremium/"" + npc.getId() + ""-info.html"");
+		if (html == null)
+		{
+			html = createInfoHtml();
+		}
+		return html;
+	}
+	
+	private String showStatusHtml(Npc npc, Player player)
+	{
+		String html = getHtm(player, ""data/scripts/custom/NpcPremium/"" + npc.getId() + ""-status.html"");
+		if (html == null)
+		{
+			html = createStatusHtml(player);
+		}
+		else
+		{
+			html = html.replace(""%premiumStatus%"", getPremiumStatus(player));
+		}
+		return html;
+	}
+	
+	private String processPurchase(Player player, int days, int coinsNeeded, Npc npc)
+	{
+		int currentCoins = getPlayerCoins(player);
+		
+		if (currentCoins < coinsNeeded)
+		{
+			player.sendMessage(""You need "" + coinsNeeded + "" Premium Coins! You have only "" + currentCoins + ""."");
+			return showMainHtml(npc, player);
+		}
+		
+		if (PremiumManager.getInstance() == null)
+		{
+			player.sendMessage(""âŒ Premium system is not available. Please contact administration."");
+			return showMainHtml(npc, player);
+		}
+		boolean success = player.destroyItemByItemId(ItemProcessType.FEE, PREMIUM_COIN_ID, coinsNeeded, npc, true);
+		
+		if (success)
+		{
+			boolean premiumAdded = addPremium(player, days);
+			
+			if (premiumAdded)
+			{
+				player.sendMessage(""ðŸŽ‰ Premium activated for "" + days + "" days! Enjoy!"");
+				
+				String html = getHtm(player, ""data/scripts/custom/NpcPremium/"" + npc.getId() + ""-success.html"");
+				if (html == null)
+				{
+					html = createSuccessHtml(days, coinsNeeded, currentCoins - coinsNeeded, player);
+				}
+				else
+				{
+					html = html.replace(""%days%"", String.valueOf(days));
+					html = html.replace(""%coinsUsed%"", String.valueOf(coinsNeeded));
+					html = html.replace(""%coinsLeft%"", String.valueOf(currentCoins - coinsNeeded));
+					html = html.replace(""%premiumStatus%"", getPremiumStatus(player));
+				}
+				
+				return html;
+			}
++			player.addItem(ItemProcessType.REFUND, PREMIUM_COIN_ID, coinsNeeded, npc, true);
+			player.sendMessage(""âŒ Error activating premium. Your coins have been refunded."");
+			return showMainHtml(npc, player);
+		}
+		
+		player.sendMessage(""âŒ Error processing payment. Please try again."");
+		return showMainHtml(npc, player);
+	}
+	
+	private int getPlayerCoins(Player player)
+	{
+		return (int) player.getInventory().getInventoryItemCount(PREMIUM_COIN_ID, -1);
+	}
+	
+	/**
+	 * @param player
+	 * @param days
+	 * @return
+	 */
+	private boolean addPremium(Player player, int days)
+	{
+		try
+		{
+			// Verificar se o PremiumManager estÃ¡ disponÃ­vel
+			if (PremiumManager.getInstance() == null)
+			{
+				player.sendMessage(""âŒ Premium system is not available."");
+				return false;
+			}
+			
+			PremiumManager.getInstance().addPremiumTime(player.getAccountName(), days, TimeUnit.DAYS);
+			
+			// Log para debug
+			System.out.println(""Premium added for account: "" + player.getAccountName() + "", days: "" + days + "", by NPC: "" + NPC_ID);
+			
+			long expiration = PremiumManager.getInstance().getPremiumExpiration(player.getAccountName());
+			long currentTime = System.currentTimeMillis();
+			boolean hasPremium = (expiration > currentTime);
+			
+			player.sendMessage(""Premium expiration: "" + new SimpleDateFormat(""dd/MM/yyyy HH:mm"").format(new Date(expiration)));
+			player.sendMessage(""Has premium: "" + hasPremium);
+			
+			return hasPremium;
+		}
+		catch (Exception e)
+		{
+			System.err.println(""Error adding premium for player "" + player.getName() + "": "" + e.getMessage());
+			e.printStackTrace();
+			player.sendMessage(""âŒ System error while activating premium: "" + e.getMessage());
+			return false;
+		}
+	}
+	
+	/**
+	 * @param player
+	 * @return
+	 */
+	private String getPremiumStatus(Player player)
+	{
+		try
+		{
+			if (PremiumManager.getInstance() == null)
+			{
+				return ""<font color=\""FF0000\"">Premium System Unavailable</font>"";
+			}
+			
+			long expiration = PremiumManager.getInstance().getPremiumExpiration(player.getAccountName());
+			long currentTime = System.currentTimeMillis();
+			
+			if (expiration > currentTime)
+			{
+				String expireDate = new SimpleDateFormat(""dd/MM/yyyy HH:mm"").format(new Date(expiration));
+				long daysLeft = (expiration - currentTime) / (1000 * 60 * 60 * 24);
+				return ""<font color=\""00FF00\"">ACTIVE</font> - Expires: "" + expireDate + "" ("" + daysLeft + "" days left)"";
+			}
+			return ""<font color=\""FF0000\"">INACTIVE</font> - No active premium"";
+		}
+		catch (Exception e)
+		{
+			return ""<font color=\""FF0000\"">Error checking status</font>"";
+		}
+	}
+	
+	public static void main(String[] args)
+	{
+		new PremiumNpc();
+	}
+}
\ No newline at end of file
Index: dist/game/data/scripts/custom/NpcPremium/101000-success.htm
===================================================================
--- dist/game/data/scripts/custom/NpcPremium/101000-success.htm	(nonexistent)
+++ dist/game/data/scripts/custom/NpcPremium/101000-success.htm	(working copy)
@@ -0,0 +1,10 @@
+<html><title>Purchase Successful</title><body>
+<br><center>
+<font color=00FF00>Purchase Successful!</font><br><br>
+Thank you for your purchase!<br><br>
+Days Purchased: <font color=LEVEL>%days% days</font><br>
+Coins Used: <font color=FF9900>%coinsUsed%</font><br>
+Coins Left: <font color=00FF00>%coinsLeft%</font><br><br>
+Your premium benefits are now active!<br><br>
+<button value=""Back to Main"" action=""bypass Quest PremiumNpc menu"" width=150 height=25 back=""L2UI_CT1.Button_DF_Down"" fore=""L2UI_CT1.Button_DF"">
+</center></body></html>
\ No newline at end of file
"
uqTVHXNK,cosas nuevas,oddmushroom,C#,Friday 21st of November 2025 05:29:35 PM CDT,"EN SISTEMA -------------------------------------------------------------------------------------------------------

        public Usuario GetUsuarioPorEmail(string email)
        {

            Usuario usuario = null;
            int i = 0;

            while (usuario == null && i < _usuarios.Count)
            {
                if (_usuarios[i].Email == email)
                {
                    usuario = _usuarios[i];

                }
                else 
                {
                    i++; 
                }
            }
            return usuario;
        }
-------------------------------------------------------------------------------------------------------
        public List<Pago> GetPagosPorNombreEquipo(string nombreEquipo)
        {
            List<Pago> listadoPagosEquipo = new List<Pago>();
            List<Usuario> listadoUsuarios = GetUsuariosPorEquipo(nombreEquipo);

            foreach(Usuario unU in listadoUsuarios)
            {
                List<Pago> pagosUsu = GetPagosPorEmail(unU.Email);
                foreach(Pago unP in pagosUsu)
                {
                    listadoPagosEquipo.Add(unP);
                }
            }
            return listadoPagosEquipo;
        }
-------------------------------------------------------------------------------------------------------
        public List<TipoGasto> GetTipoGastos()
        {
            return _tipoGastos;
        }

        public TipoGasto GetTipoGastoPorNombre(string nombre)
        {
        
            foreach (TipoGasto tipoGasto in _tipoGastos)
            {
                if (tipoGasto.Nombre == nombre)
                    return tipoGasto;
            }
            return null;
        }

EN LAYOUT ---------------------------------------------------------------------------------------------------
(quality of life change)

@{
    string? mailUsuario = Context.Session.GetString(""email"");
    string? rolUsuario = Context.Session.GetString(""rol"");
}

>>>>>>>>>>  @if (mailUsuario != null && rolUsuario == ""Gerente"") {muestro tal cosa}

EN Pago/PagoUnico/PagoRecurrente ----------------------------------------------------------------------------------------------
(pal model binding)

public Pago() { }
public PagoUnico() : base() { }
public PagoRecurrente() : base() { }

EN PAYMENTSCONTROLLER ---------------------------------------------------------------------------------------------------

        public IActionResult AllPayments(int? mes, int? anio) 
        {
            if (HttpContext.Session.GetString(""email"") == null)
            {
                TempData[""login""] = ""Debes iniciar sesion para ver esa pagina"";
                return RedirectToAction(""Login"", ""Home"");
            }

            Usuario usuLogeado = Sistema.Instancia.GetUsuarioPorEmail(HttpContext.Session.GetString(""email""));

            DateTime hoy = DateTime.Today;
            int mesBuscado = mes.GetValueOrDefault(hoy.Month);
            int anioBuscado = anio.GetValueOrDefault(hoy.Year);

            DateTime inicioMes = new DateTime(anioBuscado, mesBuscado, 1);
            DateTime finMes = new DateTime(anioBuscado, mesBuscado, DateTime.DaysInMonth(anioBuscado, mesBuscado));

            List<Pago> pagosEquipo = Sistema.Instancia.GetPagosPorNombreEquipo(usuLogeado.Equipo.Nombre);
            List<Pago> pagosEquipoFiltrados = new List<Pago>();

            foreach (Pago p in pagosEquipo)
            {
                if (p is PagoUnico unPU)
                {
                    if (unPU.Fecha >= inicioMes && unPU.Fecha <= finMes) pagosEquipoFiltrados.Add(unPU);
                }
                else
                {
                    if (p is PagoRecurrente unPR)
                    {
                        if (unPR.Desde <= finMes && unPR.Hasta >= inicioMes) pagosEquipoFiltrados.Add(unPR);
                    }
                }

            }

            ViewBag.Mes = mesBuscado;
            ViewBag.Anio = anioBuscado; 

            pagosEquipoFiltrados.Sort();
            return View(pagosEquipoFiltrados);
        }


-------------------------------------------------------------------------------------------------------
        public IActionResult CreateSinglePayment()
        {
            ViewBag.TipoDeGastos = Sistema.Instancia.GetTipoGastos();
            return View();
        }
-------------------------------------------------------------------------------------------------------

        [HttpPost]
        public IActionResult CreateSinglePayment(PagoUnico pago, string tipoGastoNombre)
        {
            try 
            {
            pago.Usuario = Sistema.Instancia.GetUsuarioPorEmail(HttpContext.Session.GetString(""email""));
            pago.TipoGasto = Sistema.Instancia.GetTipoGastoPorNombre(tipoGastoNombre);
            pago.Validar();
            Sistema.Instancia.AgregarPago(pago);
                ViewBag.Exito = ""Pago registrado con Ã©xito!"";
            }
            catch(Exception ex)
            {
                ViewBag.Error = ex.Message;
            }

            ViewBag.TipoDeGastos = Sistema.Instancia.GetTipoGastos();

            return View();
        }

-------------------------------------------------------------------------------------------------------

        public IActionResult CreateRecurrentPayment()
        {
            ViewBag.TipoDeGastos = Sistema.Instancia.GetTipoGastos();
            return View();
        }
-------------------------------------------------------------------------------------------------------
        [HttpPost]
        public IActionResult CreateRecurrentPayment(PagoRecurrente pago, string tipoGastoNombre)
        {
            try
            {
                pago.Usuario = Sistema.Instancia.GetUsuarioPorEmail(HttpContext.Session.GetString(""email""));
                pago.TipoGasto = Sistema.Instancia.GetTipoGastoPorNombre(tipoGastoNombre);
                pago.Validar();
                if (pago.Hasta.Year == new DateTime().Year) pago.Hasta = new DateTime(2100, 12, 31);

                Sistema.Instancia.AgregarPago(pago);
                ViewBag.Exito = ""Pago registrado con Ã©xito!"";
            }
            catch (Exception ex)
            {
                ViewBag.Error = ex.Message;
            }

            ViewBag.TipoDeGastos = Sistema.Instancia.GetTipoGastos();

            return View();
        }
    }

EN VISTA ALLPAYMENTS ----------------------------------------------------------------------------------

@using Dominio
@model List<Pago>

    <h1>Todos los pagos del equipo</h1>
    
<table class=""table"">
    <thead>
        <th>Nombre</th>
        <th>Apellido</th>
        <th>Email</th>
        <th>DescripciÃ³n</th>
        <th>Tipo de Gasto</th>
        <th>MÃ©todo de pago</th>
        <th>Monto</th>
    </thead>
    <tbody>
        @foreach(Pago unP in Model)
        {
            <tr>
                <td>@unP.Usuario.Nombre</td>
                <td>@unP.Usuario.Apellido</td>
                <td>@unP.Usuario.Email</td>
                <td>@unP.Descripcion</td>
                <td>@unP.TipoGasto</td>
                <td>@unP.MetodoPago</td>
                <td>@unP.Monto</td>
            </tr>
        }
    </tbody>
</table>

<form method=""get"" action=""/Payments/AllPayments"">

    <label>Mes</label>
    <input type=""number"" name=""mes"" min=""1"" max=""12"" value=""@ViewBag.Mes"" />

    <label>AÃ±o</label>
    <input type=""number"" name=""anio"" min=""2000"" max=""2100"" value=""@ViewBag.Anio"" />

    <input type=""submit"" value=""Filtrar"" />
</form>


EN VISTA CREATESINGLEPAYMENT ---------------------------------------------------------------------------------------

@using Dominio
<h1>Registrar nuevo pago Ãºnico</h1>

<form action=""/Payments/CreateSinglePayment"" method=""post"">
    <select name=""MetodoPago""> 
        <option>Seleccione mÃ©todo de pago</option> 
        <option value=""1"">CREDITO</option> 
        <option value=""2"">DEBITO</option> 
        <option value=""3"">EFECTIVO</option> 
    </select>
    <select name=""tipoGastoNombre"">
        <option>Seleccione tipo de gasto</option>
        @foreach(TipoGasto tipoGasto in ViewBag.TipoDeGastos)
        {
            <option value=""@tipoGasto.Nombre"">@tipoGasto.Nombre</option>
        }
    </select>
    <input type=""text"" name=""Descripcion"" placeholder=""DescripciÃ³n"" />
    <input type=""number"" name=""Monto"" placeholder=""Monto"" />
    <input type=""date"" name=""Fecha"" />
    <input type=""submit"" value=""Cargar"" />
</form>

@if (ViewBag.Exito != null)
{
    <p>@ViewBag.Exito</p>
}
@if(ViewBag.Error != null)
{
    <p>@ViewBag.Error</p>
}

EN VISTA CREATERECURRENTPAYMENT -------------------------------------------------------------------------------

@using Dominio
<h1>Registrar nuevo pago recurrente</h1>

<form action=""/Payments/CreateRecurrentPayment"" method=""post"">
    <select name=""MetodoPago"">
        <option>Seleccione mÃ©todo de pago</option>
        <option value=""1"">CREDITO</option>
        <option value=""2"">DEBITO</option>
        <option value=""3"">EFECTIVO</option>
    </select>
    <select name=""tipoGastoNombre"">
        <option>Seleccione tipo de gasto</option>
        @foreach (TipoGasto tipoGasto in ViewBag.TipoDeGastos)
        {
            <option value=""@tipoGasto.Nombre"">@tipoGasto.Nombre</option>
        }
    </select>
    <input type=""text"" name=""Descripcion"" placeholder=""DescripciÃ³n"" />
    <input type=""number"" name=""Monto"" placeholder=""Monto"" />
    <input type=""date"" name=""Desde"" />
    <input type=""date"" name=""Hasta"" />
    <input type=""submit"" value=""Cargar"" />
</form>

@if (ViewBag.Exito != null)
{
    <p>@ViewBag.Exito</p>
}
@if (ViewBag.Error != null)
{
    <p>@ViewBag.Error</p>
}

EN VISTA MYPAYMENTS ----------------------------------------------------------------------------------------------

<a class=""btn btn-success"" href=""/Payments/SelectPaymentType"">Cargar nuevo pago</a>

EN VISTA SELECTPAYMENTTYPE -------------------------------------------------------------------------------------------

<h1>Seleccione tipo de pago</h1>

<a href=""/Payments/CreateSinglePayment"" class=""btn btn-primary"">Pago Ãºnico</a>
<a href=""/Payments/CreateRecurrentPayment"" class=""btn btn-secondary"">Pago recurrente</a>

EN PAGOUNICO (Validar) -------------------------------------------------------------------------------------------

        public override void Validar()
        {
            if (Fecha == DateTime.MinValue)
            {
                throw new Exception(""La fecha no puede ser vacÃ­a"");
            }
            base.Validar();
        }

EN PAGORECURRENTE (Validar) ----------------------------------------------------------------------------------------

        public override void Validar()
        {
            base.Validar();
            if (Desde == DateTime.MinValue)
            {
                throw new Exception(""La fecha de inicio no no puede ser vacÃ­as"");
            }
            if (Desde > Hasta && Hasta != new DateTime())
            {
                throw new Exception(""La fecha de la primera cuota debe ser menor a la de la siguiente o ultima"");
            }
        }

EN PAGO (comparer santi) ----------------------------------------------------------------------------------------------------

public abstract class Pago : IComparable

        public int CompareTo(object? obj)
        {
            if (obj is Pago otroPago)
            {
                if (Monto.CompareTo(otroPago.Monto) < 0)
                {
                    return 1;
                }
                else if (Monto.CompareTo(otroPago.Monto) > 0)
                {
                    return -1;
                }
                else
                {
                    return 0;
                }
            }
            else
            {
                return -1;
            }
        }

"
zTJMtth9,loop-author,Guenni007,CSS,Friday 21st of November 2025 05:29:26 PM CDT,"/* ========================================
   AUTHOR LOOP - GRID LAYOUT
   Platziere diese Datei in: /wp-content/themes/enfold-child/includes/loop-author.css
   ======================================== */

/* Author Grid Container - CSS Grid Layout */
#top.author .av-author-grid-container {
    display: grid !important;
    gap: 20px;
    margin: 40px 0;
    grid-template-columns: repeat(4, 1fr); /* Standard: 4 Spalten */
}

/* Dynamisch per Filter - Spalten-Einstellungen */
#top.author .av-author-grid-container.av-columns-2 {
    grid-template-columns: repeat(2, 1fr);
}

#top.author .av-author-grid-container.av-columns-3 {
    grid-template-columns: repeat(3, 1fr);
}

#top.author .av-author-grid-container.av-columns-5 {
    grid-template-columns: repeat(5, 1fr);
}

#top.author .av-author-grid-container.av-columns-6 {
    grid-template-columns: repeat(6, 1fr);
}

/* Grid Items - Flexbox fÃ¼r gleiche HÃ¶he */
#top.author .av-author-grid-container .flex_column {
    margin: 0 !important;
    padding: 0 !important;
    width: auto !important;
    max-width: none !important;
    display: flex !important;
    flex-direction: column !important;
}

/* Grid Item Container - Flexbox fÃ¼r Button-Ausrichtung */
#top.author .av-author-grid-item {
    display: flex;
    flex-direction: column;
    background: #fff;
    border: 1px solid #e1e1e1;
    overflow: hidden;
    transition: all 0.3s ease;
    height: 100%;
    flex: 1;
}

#top.author .av-author-grid-item:hover {
    box-shadow: 0 10px 30px rgba(0,0,0,0.1);
    transform: translateY(-5px);
    border-color: #ccc;
}

/* Image Link */
#top.author .av-author-grid-image-link {
    display: block;
    text-decoration: none;
}

/* Image Container */
#top.author .av-author-grid-image {
    position: relative;
    overflow: hidden;
    background: #f5f5f5;
}

/* Placeholder Image */
#top.author .av-author-placeholder-image {
    width: 100%;
    padding-top: 75%; /* 4:3 Aspect Ratio */
    background: #e8e8e8;
    display: flex;
    align-items: center;
    justify-content: center;
    position: relative;
}

#top.author .av-author-placeholder-image svg {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    color: #999;
    opacity: 0.5;
    width: 64px;
    height: 64px;
}

#top.author .av-author-grid-image img {
    display: block;
    width: 100%;
    height: auto;
    transition: transform 0.3s ease;
}

#top.author .av-author-grid-image-link:hover .av-author-grid-image img,
#top.author .av-author-grid-item:hover .av-author-grid-image img {
    transform: scale(1.05);
}

#top.author .av-author-grid-overlay {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0,0,0,0);
    transition: background 0.3s ease;
    pointer-events: none;
}

#top.author .av-author-grid-image-link:hover .av-author-grid-overlay,
#top.author .av-author-grid-item:hover .av-author-grid-overlay {
    background: rgba(0,0,0,0.1);
}

/* Content - nimmt den verfÃ¼gbaren Platz */
#top.author .av-author-grid-content {
    padding: 25px;
    flex: 1 1 auto;
    display: flex;
    flex-direction: column;
}

#top.author .av-author-grid-title {
    font-size: 18px;
    font-weight: 600;
    margin: 0 0 10px 0;
    line-height: 1.4;
}

#top.author .av-author-grid-title a {
    color: #333;
    text-decoration: none;
    transition: color 0.3s ease;
}

#top.author .av-author-grid-title a:hover {
    color: #000;
}

#top.author .av-author-grid-meta {
    display: block;
    font-size: 13px;
    color: #999;
    margin-bottom: 15px;
}

#top.author .av-author-grid-meta .text-sep {
    margin: 0 5px;
}

#top.author .av-author-grid-excerpt {
    font-size: 14px;
    line-height: 1.6;
    color: #666;
    margin: 0;
}

#top.author .av-author-grid-excerpt p {
    margin: 0 0 10px 0;
}

#top.author .av-author-grid-excerpt p:last-child {
    margin-bottom: 0;
}

/* Read More Button - immer am unteren Rand */
#top.author .av-author-grid-read-more {
    padding: 20px 25px;
    margin-top: auto; /* Schiebt sich automatisch nach unten */
    border-top: 1px solid #f0f0f0;
}

#top.author .av-author-grid-read-more .more-link {
    display: inline-block;
    font-weight: 600;
    color: var(--enfold-main-color-primary) !important;
    text-decoration: none;
    transition: color 0.3s ease;
}

#top.author .av-author-grid-read-more .more-link:hover {
    color: #666;
}

#top.author .av-author-grid-read-more .more-link-arrow {
    display: inline-block;
    margin-left: 5px;
    transition: transform 0.3s ease;
}

#top.author .av-author-grid-read-more .more-link:hover .more-link-arrow {
    transform: translateX(5px);
}

/* ========================================
   AUTHOR LOOP - LIST LAYOUT
   ======================================== */

/* List Container */
#top.author .av-author-list-container {
    display: flex;
    flex-direction: column;
    gap: 30px;
    margin: 40px 0;
}

/* List Item */
#top.author .av-author-list-item {
    display: flex;
    gap: 30px;
    background: #fff;
    border: 1px solid #e1e1e1;
    overflow: hidden;
    transition: all 0.3s ease;
    padding: 0;
}

#top.author .av-author-list-item:hover {
    box-shadow: 0 5px 20px rgba(0,0,0,0.08);
    border-color: #ccc;
}

/* List Image */
#top.author .av-author-list-image {
    flex: 0 0 280px;
    overflow: hidden;
    background: #f5f5f5;
}

#top.author .av-author-list-image a {
    display: block;
    height: 100%;
    background-color: var(--enfold-main-color-bg);
}

/* List Placeholder Image */
#top.author .av-author-list-image .av-author-placeholder-image {
    height: 100%;
    min-height: 200px;
    padding: 0;
    background: #e8e8e8;
    display: flex;
    align-items: center;
    justify-content: center;
}

#top.author .av-author-list-image .av-author-placeholder-image svg {
    position: static;
    transform: none;
    color: #999;
    opacity: 0.5;
}

#top.author .av-author-list-image img {
    display: block;
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.3s ease;
}

#top.author .av-author-list-item:hover .av-author-list-image img {
    transform: scale(1.05);
}

/* List Content */
#top.author .av-author-list-content {
    flex: 1;
    padding: 30px;
    display: flex;
    flex-direction: column;
}

#top.author .av-author-list-title {
    font-size: 22px;
    font-weight: 600;
    margin: 0 0 10px 0;
    line-height: 1.4;
}

#top.author .av-author-list-title a {
    color: #333;
    text-decoration: none;
    transition: color 0.3s ease;
}

#top.author .av-author-list-title a:hover {
    color: #000;
}

#top.author .av-author-list-meta {
  display: flex;
  font-size: 0.9em;
  color: #999;
  margin-bottom: 15px;
  flex-flow: row wrap
}

#top .av-author-list-meta .blog-categories {
  text-align: left;
  font-weight: 400;
  font-size: 0.9em;
  top: 0 !important;
}

#top.author .av-author-list-meta .text-sep {
    margin: 0 5px;
}

#top.author .av-author-list-excerpt {
    font-size: 15px;
    line-height: 1.7;
    color: #666;
    margin: 0 0 20px 0;
    flex: 1;
}

#top.author .av-author-list-excerpt p {
    margin: 0 0 15px 0;
}

#top.author .av-author-list-excerpt p:last-child {
    margin-bottom: 0;
}

#top.author .av-author-list-read-more {
    margin-top: auto;
}

#top.author .av-author-list-read-more .more-link {
    display: inline-block;
    font-weight: 600;
    color: var(--enfold-main-color-primary) !important;
    text-decoration: none;
    transition: color 0.3s ease;
}

#top.author .av-author-list-read-more .more-link:hover {
    color: #666;
}

#top.author .av-author-list-read-more .more-link-arrow {
    display: inline-block;
    margin-left: 5px;
    transition: transform 0.3s ease;
}

#top.author .av-author-list-read-more .more-link:hover .more-link-arrow {
    transform: translateX(5px);
}

/* ========================================
   PAGINATION
   ======================================== */

#top.author .av-author-pagination {
    clear: both;
    text-align: center;
    margin: 40px 0 20px;
    width: 100%;
    grid-column: 1 / -1;
}

#top.author .av-author-pagination .pagination {
    display: inline-block;
}

#top.author .av-author-pagination .pagination .current,
#top.author .av-author-pagination .pagination a {
    display: inline-block;
    padding: 8px 15px;
    margin: 0 3px;
    background: #f5f5f5;
    border: 1px solid #e1e1e1;
    text-decoration: none;
    color: #333;
    transition: all 0.3s ease;
}

#top.author .av-author-pagination .pagination .current {
    background: #000;
    color: #fff;
    border-color: #000;
}

#top.author .av-author-pagination .pagination a:hover {
    background: #333;
    color: #fff;
    border-color: #333;
}

/* ========================================
   RESPONSIVE
   ======================================== */

/* Grid Responsive */
@media only screen and (max-width: 1340px) {
    /* 5-6 Spalten -> 3 Spalten */
    #top.author .av-author-grid-container.av-columns-5,
    #top.author .av-author-grid-container.av-columns-6 {
        grid-template-columns: repeat(3, 1fr) !important;
    }
}

@media only screen and (max-width: 989px) {
    /* Alle auf 2 Spalten */
    #top.author .av-author-grid-container {
        grid-template-columns: repeat(2, 1fr) !important;
    }
    
    /* List: Kleineres Bild */
    #top.author .av-author-list-image {
        flex: 0 0 200px;
    }
    
    #top.author .av-author-list-content {
        padding: 20px;
    }
}

@media only screen and (max-width: 767px) {
    /* Grid auf 1 Spalte */
    #top.author .av-author-grid-container {
        gap: 15px;
        grid-template-columns: 1fr !important;
    }
    
    #top.author .av-author-grid-content {
        padding: 20px;
    }
    
    /* List: Vertikal */
    #top.author .av-author-list-container {
        gap: 20px;
    }
    
    #top.author .av-author-list-item {
        flex-direction: column;
        gap: 0;
    }
    
    #top.author .av-author-list-image {
        flex: 0 0 auto;
        max-height: 250px;
    }
    
    #top.author .av-author-list-title {
        font-size: 20px;
    }
}"
